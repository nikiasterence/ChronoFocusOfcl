<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="Chronofocus.png" type="image/x-icon">
    <title>Material 3 Glassmorphic Unit Converter with OptiChain 6 Pro Lite</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #6750A4;
            --on-primary: #FFFFFF;
            --primary-container: #EADDFF;
            --on-primary-container: #21005D;
            --secondary: #625B71;
            --on-secondary: #FFFFFF;
            --secondary-container: #E8DEF8;
            --on-secondary-container: #1D192B;
            --tertiary: #7D5260;
            --on-tertiary: #FFFFFF;
            --tertiary-container: #FFD8E4;
            --on-tertiary-container: #31111D;
            --surface: #FEF7FF;
            --on-surface: #1C1B1F;
            --surface-variant: #E7E0EC;
            --on-surface-variant: #49454F;
            --outline: #79747E;
            --shadow: #000000;
            
            --glass-bg: rgba(255, 255, 255, 0.7);
            --glass-border: rgba(255, 255, 255, 0.3);
            --blur: 20px;
            --shadow-elevation: 0 8px 24px rgba(0, 0, 0, 0.12);
            --transition: .3s cubic-bezier(0.4, 0, 0.2, 1);
            
            --theme-bg: linear-gradient(135deg, #a8b9ff 0%, #c792ea 100%);
            
            /* New rounded corners variables */
            --border-radius-sm: 12px;
            --border-radius-md: 20px;
            --border-radius-lg: 28px;
            --border-radius-xl: 36px;
        }

        .theme-dark {
            --primary: #D0BCFF;
            --on-primary: #381E72;
            --primary-container: #4F378B;
            --on-primary-container: #EADDFF;
            --secondary: #CCC2DC;
            --on-secondary: #332D41;
            --secondary-container: #4A4458;
            --on-secondary-container: #E8DEF8;
            --tertiary: #EFB8C8;
            --on-tertiary: #492532;
            --tertiary-container: #633B48;
            --on-tertiary-container: #FFD8E4;
            --surface: #141218;
            --on-surface: #E6E1E5;
            --surface-variant: #49454F;
            --on-surface-variant: #CAC4D0;
            --outline: #938F99;
            --shadow: #000000;
            
            --glass-bg: rgba(30, 30, 40, 0.7);
            --glass-border: rgba(255, 255, 255, 0.1);
            --theme-bg: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Roboto', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }

        html {
            height: 100%;
        }
        
        body {
            min-height: 100%;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            background: var(--theme-bg);
            overflow-x: hidden;
            transition: background 1s ease;
            color: var(--on-surface);
            padding: 16px 0;
        }

        body::before {
            content: '';
            position: fixed;
            top: 50%; 
            left: 50%;
            width: 200vmax; 
            height: 200vmax;
            transform: translate(-50%, -50%);
            background: radial-gradient(circle, var(--primary) 0%, var(--tertiary) 50%, var(--secondary) 100%);
            background-size: 200% 200%;
            animation: gradientMove 25s ease-in-out infinite;
            z-index: -2;
            opacity: 0.7;
        }

        @keyframes gradientMove {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            50% { transform: translate(-50%, -50%) rotate(180deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }

        /* Liquid Glass Effect */
        .liquid-glass {
            position: relative;
            overflow: hidden;
        }

        .liquid-glass::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                to bottom right,
                rgba(255, 255, 255, 0.1) 0%,
                rgba(255, 255, 255, 0.2) 50%,
                rgba(255, 255, 255, 0.05) 100%
            );
            transform: rotate(30deg);
            z-index: -1;
            animation: liquidFlow 15s infinite linear;
        }

        @keyframes liquidFlow {
            0% { transform: rotate(30deg) translateX(-10%) translateY(-10%); }
            25% { transform: rotate(45deg) translateX(10%) translateY(5%); }
            50% { transform: rotate(30deg) translateX(15%) translateY(15%); }
            75% { transform: rotate(45deg) translateX(-5%) translateY(10%); }
            100% { transform: rotate(30deg) translateX(-10%) translateY(-10%); }
        }

        /* Material 3 Card Styles */
        .card {
            background: var(--glass-bg);
            backdrop-filter: blur(var(--blur));
            border-radius: var(--border-radius-xl);
            border: 1px solid var(--glass-border);
            box-shadow: var(--shadow-elevation);
            transition: var(--transition);
            overflow: hidden;
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 16px 32px rgba(0, 0, 0, 0.15);
        }

        /* Page Layout */
        .page {
            display: none;
            width: 95%;
            max-width: 800px;
            padding: 20px;
            position: relative;
            z-index: 1;
            animation: fadeIn 0.8s ease forwards;
        }

        .active { 
            display: block; 
        }

        h2 {
            text-align: center;
            margin-bottom: 24px;
            font-size: 1.8rem;
            color: var(--on-surface);
            font-weight: 500;
            letter-spacing: -0.5px;
        }
        
        /* New Header for actions */
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            gap: 12px;
        }

        .header-actions {
            display: flex;
            gap: 12px;
            align-items: center;
        }
        
        .header-back-btn {
            flex-grow: 1;
            text-align: left;
        }

        /* Menu Grid */
        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 14px;
            margin-bottom: 24px;
        }

        .menu-item {
            padding: 20px 12px;
            text-align: center;
            border-radius: var(--border-radius-lg);
            cursor: pointer;
            font-weight: 500;
            background: var(--surface-variant);
            color: var(--on-surface-variant);
            transition: all .3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            min-height: 110px;
            justify-content: center;
        }

        .menu-item i {
            font-size: 1.8rem;
            color: var(--primary);
        }

        .menu-item:hover {
            background: var(--primary-container);
            color: var(--on-primary-container);
            transform: translateY(-4px);
        }

        .menu-item.active-category {
            background: var(--primary);
            color: var(--on-primary);
        }

        .menu-item.active-category i {
            color: var(--on-primary);
        }

        /* Converter Styles */
        .converter {
            display: flex;
            flex-direction: column;
            gap: 18px;
            margin-top: 20px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .input-group label {
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--on-surface-variant);
            margin-left: 4px;
        }

        input, select {
            padding: 16px;
            border: none;
            border-radius: var(--border-radius-md);
            font-size: 16px;
            font-weight: 400;
            outline: none;
            background: var(--surface-variant);
            color: var(--on-surface);
            border: 1px solid transparent;
            transition: all .3s ease;
        }

        input::placeholder { 
            color: var(--on-surface-variant); 
        }

        input:focus, select:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(103, 80, 164, 0.2);
        }

        select { 
            appearance: none; 
            -webkit-appearance: none; 
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20width%3D%2220%22%20height%3D%2220%22%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%3E%3Cpath%20d%3D%22M5%208l5%205%205-5%22%20stroke%3D%22%236750A4%22%20stroke-width%3D%222%22%20fill%3D%22none%22%20stroke-linecap%3D%22round%22%20stroke-linejoin%3D%22round%22/%3E%3C/svg%3E'); 
            background-repeat: no-repeat; 
            background-position: right 16px center; 
        }

        option { 
            background: var(--surface); 
            color: var(--on-surface); 
        }

        #conv-output {
            background: var(--surface-variant);
            font-weight: 500;
        }

        /* Buttons */
        .btn-group {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

        .btn {
            padding: 14px 20px;
            border: none;
            border-radius: var(--border-radius-lg);
            cursor: pointer;
            font-weight: 500;
            color: var(--on-primary);
            transition: all .3s ease;
            flex: 1;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 0.875rem;
        }

        .btn-primary {
            background: var(--primary);
        }

        .btn-primary:hover {
            background: var(--primary-container);
            color: var(--on-primary-container);
            box-shadow: 0 4px 12px rgba(103, 80, 164, 0.3);
        }
        
        .btn.btn-back {
            flex: 0 1 auto;
            padding: 10px 18px;
        }

        .btn-secondary {
            background: var(--secondary-container);
            color: var(--on-secondary-container);
        }

        .btn-secondary:hover {
            background: var(--secondary);
            color: var(--on-secondary);
        }

        /* History Section */
        .history-section {
            margin-top: 28px;
            max-height: 300px;
            overflow-y: auto;
            padding: 16px;
            border-radius: var(--border-radius-lg);
            background: var(--surface-variant);
        }

        .history-section h3 {
            margin-bottom: 16px;
            text-align: center;
            font-weight: 500;
            color: var(--on-surface-variant);
            font-size: 1.125rem;
        }

        .history-item {
            padding: 12px 16px;
            border-bottom: 1px solid var(--outline);
            font-size: 0.875rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: var(--border-radius-sm);
            margin-bottom: 8px;
        }

        .history-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .history-item .conversion-text {
            flex: 1;
        }

        .history-item .conversion-date {
            font-size: 0.75rem;
            color: var(--on-surface-variant);
        }

        .clear-history {
            margin-top: 16px;
            text-align: center;
        }

        .clear-history-btn {
            background: transparent;
            border: none;
            color: var(--primary);
            font-size: 0.875rem;
            cursor: pointer;
            text-decoration: underline;
            transition: color 0.3s ease;
        }

        .clear-history-btn:hover {
            color: var(--tertiary);
        }

        /* Theme Selector */
         .theme-toggle-container {
            position: relative;
            display: flex;
        }
        
        .theme-selector {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 12px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            z-index: 10;
            transition: transform 0.5s ease, opacity 0.5s ease;
            background: var(--glass-bg);
            backdrop-filter: blur(var(--blur));
            padding: 16px;
            border-radius: var(--border-radius-lg);
            border: 1px solid var(--glass-border);
            box-shadow: var(--shadow-elevation);
        }

        .theme-selector.hidden {
            transform: translateY(-20px);
            opacity: 0;
            pointer-events: none;
        }

        .theme-option {
            width: 40px;
            height: 40px;
            border-radius: var(--border-radius-md);
            cursor: pointer;
            border: 2px solid transparent;
            transition: transform 0.3s ease, border-color 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
        }

        .theme-option:hover {
            transform: scale(1.1);
        }

        .theme-option.active {
            border-color: var(--on-surface);
        }
        
        .icon-btn {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: var(--surface-variant);
            color: var(--on-surface-variant);
            border: none;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            z-index: 11;
            transition: all 0.3s ease;
        }
        
        .icon-btn:hover {
            transform: scale(1.08);
            background: var(--primary-container);
            color: var(--on-primary-container);
        }
        
        /* AI Assistant */
        .ai-assistant {
            margin-top: 24px;
            padding: 16px;
            border-radius: var(--border-radius-lg);
            background: var(--surface-variant);
        }
        
        .ai-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }
        
        .ai-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            color: var(--on-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }
        
        .ai-title {
            font-weight: 500;
            color: var(--on-surface-variant);
        }
        
        .ai-subtitle {
            font-size: 0.75rem;
            color: var(--on-surface-variant);
            opacity: 0.7;
        }
        
        .ai-input-group {
            display: flex;
            gap: 8px;
        }
        
        .ai-input {
            flex: 1;
            padding: 12px 16px;
            border-radius: var(--border-radius-md);
            border: none;
            background: var(--surface);
            color: var(--on-surface);
            font-size: 0.875rem;
        }
        
        .ai-response {
            margin-top: 16px;
            padding: 12px 16px;
            border-radius: var(--border-radius-md);
            background: var(--surface);
            color: var(--on-surface);
            font-size: 0.875rem;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }
        
        /* Calculator */
        .calculator {
            margin-top: 24px;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
        }
        
        .calculator-display {
            grid-column: 1 / span 4;
            padding: 16px;
            border-radius: var(--border-radius-md);
            background: var(--surface-variant);
            color: var(--on-surface);
            text-align: right;
            font-size: 1.5rem;
            font-weight: 500;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            overflow-x: auto;
        }
        
        .calc-btn {
            padding: 16px;
            border-radius: var(--border-radius-md);
            border: none;
            background: var(--surface-variant);
            color: var(--on-surface);
            font-size: 1.125rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .calc-btn:hover {
            background: var(--primary-container);
            color: var(--on-primary-container);
        }
        
        .calc-btn.operator {
            background: var(--primary);
            color: var(--on-primary);
        }
        
        .calc-btn.operator:hover {
            background: var(--primary-container);
            color: var(--on-primary-container);
        }
        
        .calc-btn.equals {
            background: var(--tertiary);
            color: var(--on-tertiary);
        }
        
        .calc-btn.equals:hover {
            background: var(--tertiary-container);
            color: var(--on-tertiary-container);
        }
        
        .calc-btn.clear {
            background: var(--secondary);
            color: var(--on-secondary);
        }
        
        .calc-btn.clear:hover {
            background: var(--secondary-container);
            color: var(--on-secondary-container);
        }

        .credit {
            margin-top: 32px;
            text-align: center;
            font-size: 0.75rem;
            opacity: 0.7;
            color: var(--on-surface-variant);
        }

        /* AI Section Styles - FIXED LAYOUT */
        .ai-section {
            margin-top: 24px;
            padding: 16px;
            border-radius: var(--border-radius-lg);
            background: var(--surface-variant);
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .ai-section-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 0;
        }
        
        .ai-section-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            color: var(--on-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }
        
        .ai-section-title {
            font-weight: 500;
            color: var(--on-surface-variant);
        }
        
        .ai-section-subtitle {
            font-size: 0.75rem;
            color: var(--on-surface-variant);
            opacity: 0.7;
        }
        
        .ai-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 0;
            overflow-x: auto;
            padding-bottom: 8px;
        }
        
        .ai-tab {
            padding: 10px 16px;
            border-radius: var(--border-radius-md);
            background: var(--surface);
            color: var(--on-surface);
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        .ai-tab.active {
            background: var(--primary);
            color: var(--on-primary);
        }
        
        .ai-tab-content {
            display: none;
            flex-direction: column;
            gap: 16px;
        }
        
        .ai-tab-content.active {
            display: flex;
        }
        
        .ai-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 14px;
            margin-bottom: 0;
        }
        
        .ai-feature {
            padding: 16px;
            border-radius: var(--border-radius-md);
            background: var(--surface);
            color: var(--on-surface);
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .ai-feature:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }
        
        .ai-feature i {
            font-size: 1.5rem;
            margin-bottom: 8px;
            color: var(--primary);
        }
        
        .ai-feature-title {
            font-weight: 500;
            margin-bottom: 4px;
        }
        
        .ai-feature-description {
            font-size: 0.75rem;
            opacity: 0.7;
        }
        
        .ai-results {
            margin-top: 0;
            padding: 16px;
            border-radius: var(--border-radius-md);
            background: var(--surface);
            color: var(--on-surface);
            min-height: 100px;
            flex-grow: 1;
        }
        
        .ai-results h4 {
            margin-bottom: 12px;
            font-weight: 500;
            color: var(--on-surface);
        }
        
        .ai-result-item {
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--outline);
            border-radius: var(--border-radius-sm);
        }
        
        .ai-result-item:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }
        
        .ai-result-label {
            font-weight: 500;
            margin-bottom: 4px;
        }
        
        .ai-result-value {
            font-size: 1.125rem;
            color: var(--primary);
        }
        
        .ai-result-description {
            font-size: 0.75rem;
            opacity: 0.7;
            margin-top: 4px;
        }

        /* New AI Features */
        .ai-form {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        .form-row {
            display: flex;
            gap: 12px;
        }
        
        .form-group {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .form-group label {
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--on-surface-variant);
        }

        /* AI Section Layout Fix */
        .ai-section-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            height: 100%;
        }
        
        .ai-tab-container {
            display: flex;
            flex-direction: column;
            gap: 16px;
            flex-grow: 1;
        }
        
        .ai-results-container {
            margin-top: 16px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        @keyframes fadeIn {
            from { opacity:0; transform: translateY(20px); }
            to { opacity:1; transform: translateY(0); }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .menu-grid { 
                grid-template-columns: repeat(2, 1fr); 
                gap: 12px;
            }
            
            h2 { 
                font-size: 1.6rem; 
            }
            
            .page {
                padding: 16px;
            }
            
            input, select, .menu-item, .btn { 
                font-size: 15px; 
                padding: 14px;
            }
            
            .menu-item {
                min-height: 100px;
                padding: 16px 12px;
            }
            
            .menu-item i {
                font-size: 1.6rem;
            }
            
            .theme-option {
                width: 36px;
                height: 36px;
            }
            
            .icon-btn {
                width: 40px;
                height: 40px;
            }
            
            .calculator {
                grid-template-columns: repeat(4, 1fr);
                gap: 6px;
            }
            
            .calc-btn {
                padding: 14px;
                font-size: 1rem;
            }
            
            .ai-features {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                flex-direction: column;
            }
            
            .ai-tabs {
                padding-bottom: 12px;
            }
            
            .ai-input-group {
                flex-direction: column;
            }
        }

        @media (max-width: 480px) {
            body { padding: 12px 0; }
            .menu-grid { 
                grid-template-columns: 1fr; 
            }
            
            .btn-group {
                flex-direction: column;
            }
            
            .ai-input-group {
                flex-direction: column;
            }
            
            .calculator {
                grid-template-columns: repeat(4, 1fr);
                gap: 4px;
            }
            
            .calc-btn {
                padding: 12px;
                font-size: 0.875rem;
            }
            
            .card-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 16px;
            }
            
            .header-actions {
                align-self: flex-end;
            }
            
            .ai-tabs {
                flex-wrap: wrap;
            }
            
            .ai-tab {
                flex: 1;
                min-width: 100px;
                text-align: center;
            }
            
            .ai-features {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Main Menu Page -->
    <div id="page1" class="page card liquid-glass active">
        <div class="card-header">
             <div style="flex:1;"></div>
            <div class="header-actions">
                 <button class="icon-btn toggle-dark-mode" onclick="toggleDarkMode()">
                    <i class="fas fa-moon"></i>
                </button>
                <div class="theme-toggle-container">
                    <button class="icon-btn toggle-themes" onclick="toggleThemeSelector(this)">
                        <i class="fas fa-palette"></i>
                    </button>
                    <div class="theme-selector hidden">
                        <div class="theme-option" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);" data-theme="royal-purple"><i class="fas fa-crown"></i></div>
                        <div class="theme-option" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);" data-theme="neon-pink"><i class="fas fa-heart"></i></div>
                        <div class="theme-option" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);" data-theme="ocean-blue"><i class="fas fa-water"></i></div>
                        <div class="theme-option" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);" data-theme="emerald-green"><i class="fas fa-leaf"></i></div>
                        <div class="theme-option" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);" data-theme="sunset-orange"><i class="fas fa-sun"></i></div>
                    </div>
                </div>
            </div>
        </div>
        
        <h2>Unit Converter</h2>
        <div class="menu-grid">
            <div class="menu-item" onclick="openConverter('Length')"><i class="fas fa-ruler"></i>Length</div>
            <div class="menu-item" onclick="openConverter('Area')"><i class="fas fa-border-all"></i>Area</div>
            <div class="menu-item" onclick="openConverter('Volume')"><i class="fas fa-cube"></i>Volume</div>
            <div class="menu-item" onclick="openConverter('Mass')"><i class="fas fa-weight-hanging"></i>Mass</div>
            <div class="menu-item" onclick="openConverter('Temperature')"><i class="fas fa-temperature-high"></i>Temperature</div>
            <div class="menu-item" onclick="openConverter('Speed')"><i class="fas fa-tachometer-alt"></i>Speed</div>
            <div class="menu-item" onclick="openConverter('Pressure')"><i class="fas fa-compress-arrows-alt"></i>Pressure</div>
            <div class="menu-item" onclick="openConverter('Power')"><i class="fas fa-bolt"></i>Power</div>
        </div>
        <div class="btn-group">
            <button class="btn btn-primary" onclick="openCalculator()"><i class="fas fa-calculator"></i> Scientific Calculator</button>
            <button class="btn btn-primary" onclick="openAISection()"><i class="fas fa-robot"></i> OptiChain 6 Pro Lite</button>
        </div>
        <div class="credit">Made with ❤️ by cozytustudios</div>
    </div>

    <!-- Converter Page -->
    <div id="page2" class="page card liquid-glass">
        <div class="card-header">
             <div class="header-back-btn">
                 <button class="btn btn-secondary btn-back" onclick="goMenu()"><i class="fas fa-arrow-left"></i> Back</button>
             </div>
             <div class="header-actions">
                <button class="icon-btn toggle-dark-mode" onclick="toggleDarkMode()"><i class="fas fa-moon"></i></button>
                <div class="theme-toggle-container">
                    <button class="icon-btn toggle-themes" onclick="toggleThemeSelector(this)"><i class="fas fa-palette"></i></button>
                    <div class="theme-selector hidden">
                        <div class="theme-option" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);" data-theme="royal-purple"><i class="fas fa-crown"></i></div>
                        <div class="theme-option" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);" data-theme="neon-pink"><i class="fas fa-heart"></i></div>
                        <div class="theme-option" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);" data-theme="ocean-blue"><i class="fas fa-water"></i></div>
                        <div class="theme-option" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);" data-theme="emerald-green"><i class="fas fa-leaf"></i></div>
                        <div class="theme-option" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);" data-theme="sunset-orange"><i class="fas fa-sun"></i></div>
                    </div>
                </div>
             </div>
        </div>
        
        <h2 id="conv-title"></h2>
        <div class="converter">
            <div class="input-group">
                <label for="conv-input">Enter Value</label>
                <input type="number" id="conv-input" placeholder="Enter value">
            </div>
            <div class="input-group">
                <label for="conv-from">From Unit</label>
                <select id="conv-from"></select>
            </div>
            <div class="input-group">
                <label for="conv-to">To Unit</label>
                <select id="conv-to"></select>
            </div>
            <div class="input-group">
                <label for="conv-output">Result</label>
                <input type="text" id="conv-output" placeholder="Result" readonly>
            </div>
        </div>
        
        <!-- AI Assistant -->
        <div class="ai-assistant">
            <div class="ai-header">
                <div class="ai-icon">
                    <i class="fas fa-robot"></i>
                </div>
                <div>
                    <div class="ai-title">OptiChain 6 Pro Lite</div>
                    <div class="ai-subtitle">AI Conversion Assistant</div>
                </div>
            </div>
            <div class="ai-input-group">
                <input type="text" class="ai-input" id="ai-query" placeholder="Ask me to convert anything, e.g. 'convert 1000 degrees to kelvin'">
                <button class="btn btn-primary" onclick="processAIQuery()">Ask</button>
            </div>
            <div class="ai-response" id="ai-response">
                I can help you convert any measurement. Just ask!
            </div>
        </div>
        
        <div class="history-section">
            <h3>Conversion History</h3>
            <div id="history-list"></div>
            <div class="clear-history">
                <button class="clear-history-btn" onclick="clearHistory()">Clear History</button>
            </div>
        </div>
        <div class="credit">Made with ❤️ by cozytustudios</div>
    </div>

    <!-- Calculator Page -->
    <div id="page3" class="page card liquid-glass">
        <div class="card-header">
             <div class="header-back-btn">
                 <button class="btn btn-secondary btn-back" onclick="goMenu()"><i class="fas fa-arrow-left"></i> Back</button>
             </div>
             <div class="header-actions">
                <button class="icon-btn toggle-dark-mode" onclick="toggleDarkMode()"><i class="fas fa-moon"></i></button>
                <div class="theme-toggle-container">
                    <button class="icon-btn toggle-themes" onclick="toggleThemeSelector(this)"><i class="fas fa-palette"></i></button>
                    <div class="theme-selector hidden">
                        <div class="theme-option" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);" data-theme="royal-purple"><i class="fas fa-crown"></i></div>
                        <div class="theme-option" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);" data-theme="neon-pink"><i class="fas fa-heart"></i></div>
                        <div class="theme-option" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);" data-theme="ocean-blue"><i class="fas fa-water"></i></div>
                        <div class="theme-option" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);" data-theme="emerald-green"><i class="fas fa-leaf"></i></div>
                        <div class="theme-option" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);" data-theme="sunset-orange"><i class="fas fa-sun"></i></div>
                    </div>
                </div>
             </div>
        </div>
        
        <h2>Scientific Calculator</h2>
        
        <div class="calculator">
            <div class="calculator-display" id="calc-display">0</div>
            <button class="calc-btn clear" onclick="clearCalculator()">C</button>
            <button class="calc-btn clear" onclick="backspace()">⌫</button>
            <button class="calc-btn operator" onclick="appendToDisplay('%')">%</button>
            <button class="calc-btn operator" onclick="appendToDisplay('/')">/</button>
            <button class="calc-btn" onclick="appendToDisplay('7')">7</button>
            <button class="calc-btn" onclick="appendToDisplay('8')">8</button>
            <button class="calc-btn" onclick="appendToDisplay('9')">9</button>
            <button class="calc-btn operator" onclick="appendToDisplay('*')">×</button>
            <button class="calc-btn" onclick="appendToDisplay('4')">4</button>
            <button class="calc-btn" onclick="appendToDisplay('5')">5</button>
            <button class="calc-btn" onclick="appendToDisplay('6')">6</button>
            <button class="calc-btn operator" onclick="appendToDisplay('-')">-</button>
            <button class="calc-btn" onclick="appendToDisplay('1')">1</button>
            <button class="calc-btn" onclick="appendToDisplay('2')">2</button>
            <button class="calc-btn" onclick="appendToDisplay('3')">3</button>
            <button class="calc-btn operator" onclick="appendToDisplay('+')">+</button>
            <button class="calc-btn" onclick="appendToDisplay('0')">0</button>
            <button class="calc-btn" onclick="appendToDisplay('.')">.</button>
            <button class="calc-btn operator" onclick="appendToDisplay('(')">(</button>
            <button class="calc-btn operator" onclick="appendToDisplay(')')">)</button>
            <button class="calc-btn equals" onclick="calculate()" style="grid-column: span 2;">=</button>
        </div>
        
        <div class="credit">Made with ❤️ by cozytustudios</div>
    </div>

    <!-- AI Section Page - FIXED LAYOUT -->
    <div id="page4" class="page card liquid-glass">
        <div class="card-header">
             <div class="header-back-btn">
                 <button class="btn btn-secondary btn-back" onclick="goMenu()"><i class="fas fa-arrow-left"></i> Back</button>
             </div>
             <div class="header-actions">
                <button class="icon-btn toggle-dark-mode" onclick="toggleDarkMode()"><i class="fas fa-moon"></i></button>
                <div class="theme-toggle-container">
                    <button class="icon-btn toggle-themes" onclick="toggleThemeSelector(this)"><i class="fas fa-palette"></i></button>
                    <div class="theme-selector hidden">
                        <div class="theme-option" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);" data-theme="royal-purple"><i class="fas fa-crown"></i></div>
                        <div class="theme-option" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);" data-theme="neon-pink"><i class="fas fa-heart"></i></div>
                        <div class="theme-option" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);" data-theme="ocean-blue"><i class="fas fa-water"></i></div>
                        <div class="theme-option" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);" data-theme="emerald-green"><i class="fas fa-leaf"></i></div>
                        <div class="theme-option" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);" data-theme="sunset-orange"><i class="fas fa-sun"></i></div>
                    </div>
                </div>
             </div>
        </div>
        
        <h2>OptiChain 6 Pro Lite</h2>
        
        <div class="ai-section">
            <div class="ai-section-container">
                <div class="ai-section-header">
                    <div class="ai-section-icon">
                        <i class="fas fa-brain"></i>
                    </div>
                    <div>
                        <div class="ai-section-title">Advanced AI Calculations</div>
                        <div class="ai-section-subtitle">BMI, BMR, Currency, Nutrition and more</div>
                    </div>
                </div>
                
                <div class="ai-tabs">
                    <div class="ai-tab active" onclick="switchAITab('health')">Health</div>
                    <div class="ai-tab" onclick="switchAITab('finance')">Finance</div>
                    <div class="ai-tab" onclick="switchAITab('nutrition')">Nutrition</div>
                    <div class="ai-tab" onclick="switchAITab('engineering')">Engineering</div>
                    <div class="ai-tab" onclick="switchAITab('custom')">Custom Query</div>
                </div>
                
                <div class="ai-tab-container">
                    <!-- Health Tab -->
                    <div class="ai-tab-content active" id="health-tab">
                        <div class="ai-input-group">
                            <input type="text" class="ai-input" id="health-query" placeholder="Ask me anything: 'BMI for 180cm and 75kg', 'BMR for male 30 years 70kg 175cm'">
                            <button class="btn btn-primary" onclick="processHealthQuery()">Analyze</button>
                        </div>
                        
                        <div class="ai-features">
                            <div class="ai-feature" onclick="quickAction('bmi')">
                                <i class="fas fa-weight"></i>
                                <div class="ai-feature-title">BMI Calculator</div>
                                <div class="ai-feature-description">Calculate Body Mass Index</div>
                            </div>
                            <div class="ai-feature" onclick="quickAction('bmr')">
                                <i class="fas fa-fire"></i>
                                <div class="ai-feature-title">BMR Calculator</div>
                                <div class="ai-feature-description">Basal Metabolic Rate</div>
                            </div>
                            <div class="ai-feature" onclick="quickAction('bodyfat')">
                                <i class="fas fa-percentage"></i>
                                <div class="ai-feature-title">Body Fat %</div>
                                <div class="ai-feature-description">Estimate body fat percentage</div>
                            </div>
                            <div class="ai-feature" onclick="quickAction('idealweight')">
                                <i class="fas fa-balance-scale"></i>
                                <div class="ai-feature-title">Ideal Weight</div>
                                <div class="ai-feature-description">Calculate healthy weight range</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Finance Tab -->
                    <div class="ai-tab-content" id="finance-tab">
                        <div class="ai-input-group">
                            <input type="text" class="ai-input" id="finance-query" placeholder="Ask me: 'Convert 100 USD to EUR', 'Calculate loan for $10000 at 5% for 5 years'">
                            <button class="btn btn-primary" onclick="processFinanceQuery()">Analyze</button>
                        </div>
                        
                        <div class="ai-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="currency-amount">Amount</label>
                                    <input type="number" id="currency-amount" placeholder="Enter amount">
                                </div>
                                <div class="form-group">
                                    <label for="currency-from">From</label>
                                    <select id="currency-from">
                                        <option value="USD">USD - US Dollar</option>
                                        <option value="EUR">EUR - Euro</option>
                                        <option value="GBP">GBP - British Pound</option>
                                        <option value="JPY">JPY - Japanese Yen</option>
                                        <option value="CAD">CAD - Canadian Dollar</option>
                                        <option value="AUD">AUD - Australian Dollar</option>
                                        <option value="CHF">CHF - Swiss Franc</option>
                                        <option value="CNY">CNY - Chinese Yuan</option>
                                        <option value="INR">INR - Indian Rupee</option>
                                        <option value="BDT">BDT - Bangladeshi Taka</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="currency-to">To</label>
                                    <select id="currency-to">
                                        <option value="EUR">EUR - Euro</option>
                                        <option value="USD">USD - US Dollar</option>
                                        <option value="GBP">GBP - British Pound</option>
                                        <option value="JPY">JPY - Japanese Yen</option>
                                        <option value="CAD">CAD - Canadian Dollar</option>
                                        <option value="AUD">AUD - Australian Dollar</option>
                                        <option value="CHF">CHF - Swiss Franc</option>
                                        <option value="CNY">CNY - Chinese Yuan</option>
                                        <option value="INR">INR - Indian Rupee</option>
                                        <option value="BDT">BDT - Bangladeshi Taka</option>
                                    </select>
                                </div>
                            </div>
                            <button class="btn btn-primary" onclick="convertCurrency()">Convert Currency</button>
                        </div>
                        
                        <div class="ai-features">
                            <div class="ai-feature" onclick="quickAction('currency')">
                                <i class="fas fa-money-bill-wave"></i>
                                <div class="ai-feature-title">Currency Converter</div>
                                <div class="ai-feature-description">Convert between currencies</div>
                            </div>
                            <div class="ai-feature" onclick="quickAction('loan')">
                                <i class="fas fa-hand-holding-usd"></i>
                                <div class="ai-feature-title">Loan Calculator</div>
                                <div class="ai-feature-description">Calculate loan payments</div>
                            </div>
                            <div class="ai-feature" onclick="quickAction('investment')">
                                <i class="fas fa-chart-line"></i>
                                <div class="ai-feature-title">Investment Growth</div>
                                <div class="ai-feature-description">Project investment returns</div>
                            </div>
                            <div class="ai-feature" onclick="quickAction('retirement')">
                                <i class="fas fa-piggy-bank"></i>
                                <div class="ai-feature-title">Retirement Planning</div>
                                <div class="ai-feature-description">Estimate retirement savings</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Nutrition Tab -->
                    <div class="ai-tab-content" id="nutrition-tab">
                        <div class="ai-input-group">
                            <input type="text" class="ai-input" id="nutrition-query" placeholder="Ask me: 'Calories in 200g chicken breast', 'Macros for 1500 calorie diet'">
                            <button class="btn btn-primary" onclick="processNutritionQuery()">Analyze</button>
                        </div>
                        
                        <div class="ai-features">
                            <div class="ai-feature" onclick="quickAction('calories')">
                                <i class="fas fa-apple-alt"></i>
                                <div class="ai-feature-title">Calorie Calculator</div>
                                <div class="ai-feature-description">Calculate daily calorie needs</div>
                            </div>
                            <div class="ai-feature" onclick="quickAction('macros')">
                                <i class="fas fa-utensils"></i>
                                <div class="ai-feature-title">Macronutrients</div>
                                <div class="ai-feature-description">Calculate protein, carbs, fat</div>
                            </div>
                            <div class="ai-feature" onclick="quickAction('water')">
                                <i class="fas fa-tint"></i>
                                <div class="ai-feature-title">Hydration</div>
                                <div class="ai-feature-description">Calculate daily water needs</div>
                            </div>
                            <div class="ai-feature" onclick="quickAction('mealplan')">
                                <i class="fas fa-clipboard-list"></i>
                                <div class="ai-feature-title">Meal Planning</div>
                                <div class="ai-feature-description">Create balanced meal plans</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Engineering Tab -->
                    <div class="ai-tab-content" id="engineering-tab">
                        <div class="ai-input-group">
                            <input type="text" class="ai-input" id="engineering-query" placeholder="Ask me: 'Calculate stress on beam', 'Convert 5000 psi to MPa'">
                            <button class="btn btn-primary" onclick="processEngineeringQuery()">Analyze</button>
                        </div>
                        
                        <div class="ai-features">
                            <div class="ai-feature" onclick="quickAction('stress')">
                                <i class="fas fa-compress-arrows-alt"></i>
                                <div class="ai-feature-title">Stress Analysis</div>
                                <div class="ai-feature-description">Calculate material stress</div>
                            </div>
                            <div class="ai-feature" onclick="quickAction('fluid')">
                                <i class="fas fa-tint"></i>
                                <div class="ai-feature-title">Fluid Dynamics</div>
                                <div class="ai-feature-description">Calculate flow rates, pressure</div>
                            </div>
                            <div class="ai-feature" onclick="quickAction('electrical')">
                                <i class="fas fa-bolt"></i>
                                <div class="ai-feature-title">Electrical Calculations</div>
                                <div class="ai-feature-description">Ohm's law, power calculations</div>
                            </div>
                            <div class="ai-feature" onclick="quickAction('structural')">
                                <i class="fas fa-ruler-combined"></i>
                                <div class="ai-feature-title">Structural Analysis</div>
                                <div class="ai-feature-description">Beam deflection, load capacity</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Custom Query Tab -->
                    <div class="ai-tab-content" id="custom-tab">
                        <div class="ai-input-group">
                            <input type="text" class="ai-input" id="advanced-ai-query" placeholder="Ask me anything: 'BMI for 180cm and 75kg', 'Convert 500 grams to pounds', 'Calculate loan for $10000'">
                            <button class="btn btn-primary" onclick="processAdvancedAIQuery()">Analyze</button>
                        </div>
                        
                        <div class="ai-features">
                            <div class="ai-feature" onclick="quickAction('bmi')">
                                <i class="fas fa-weight"></i>
                                <div class="ai-feature-title">BMI Calculator</div>
                                <div class="ai-feature-description">Calculate Body Mass Index</div>
                            </div>
                            <div class="ai-feature" onclick="quickAction('currency')">
                                <i class="fas fa-money-bill-wave"></i>
                                <div class="ai-feature-title">Currency Converter</div>
                                <div class="ai-feature-description">Convert between currencies</div>
                            </div>
                            <div class="ai-feature" onclick="quickAction('calories')">
                                <i class="fas fa-apple-alt"></i>
                                <div class="ai-feature-title">Calorie Calculator</div>
                                <div class="ai-feature-description">Calculate daily calorie needs</div>
                            </div>
                            <div class="ai-feature" onclick="quickAction('loan')">
                                <i class="fas fa-hand-holding-usd"></i>
                                <div class="ai-feature-title">Loan Calculator</div>
                                <div class="ai-feature-description">Calculate loan payments</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="ai-results-container">
                    <div class="ai-results" id="advanced-ai-results">
                        <h4>Analysis Results</h4>
                        <p>Enter your query or select a quick action to see results here.</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="credit">Made with ❤️ by cozytustudios</div>
    </div>

    <script>
        // Theme management
        const themes = {
            'royal-purple': { 
                primary: '#764ba2', onPrimary: '#FFFFFF', primaryContainer: '#e9d8fd', onPrimaryContainer: '#2d0a50', secondary: '#625B71', onSecondary: '#FFFFFF', secondaryContainer: '#E8DEF8', onSecondaryContainer: '#1D192B', tertiary: '#7D5260', onTertiary: '#FFFFFF', tertiaryContainer: '#FFD8E4', onTertiaryContainer: '#31111D', surface: '#FEF7FF', onSurface: '#1C1B1F', surfaceVariant: '#E7E0EC', onSurfaceVariant: '#49454F', outline: '#79747E', bg: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)'
            },
            'neon-pink': { 
                primary: '#f5576c', onPrimary: '#FFFFFF', primaryContainer: '#ffd8dc', onPrimaryContainer: '#4a0010', secondary: '#625B71', onSecondary: '#FFFFFF', secondaryContainer: '#E8DEF8', onSecondaryContainer: '#1D192B', tertiary: '#7D5260', onTertiary: '#FFFFFF', tertiaryContainer: '#FFD8E4', onTertiaryContainer: '#31111D', surface: '#fff5f7', onSurface: '#1C1B1F', surfaceVariant: '#f8d7dc', onSurfaceVariant: '#49454F', outline: '#79747E', bg: 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)'
            },
            'ocean-blue': { 
                primary: '#4facfe', onPrimary: '#FFFFFF', primaryContainer: '#d4eeff', onPrimaryContainer: '#003356', secondary: '#625B71', onSecondary: '#FFFFFF', secondaryContainer: '#E8DEF8', onSecondaryContainer: '#1D192B', tertiary: '#7D5260', onTertiary: '#FFFFFF', tertiaryContainer: '#FFD8E4', onTertiaryContainer: '#31111D', surface: '#f7fcff', onSurface: '#1C1B1F', surfaceVariant: '#d4eeff', onSurfaceVariant: '#49454F', outline: '#79747E', bg: 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)'
            },
            'emerald-green': { 
                primary: '#43e97b', onPrimary: '#FFFFFF', primaryContainer: '#d4f8e0', onPrimaryContainer: '#004d1a', secondary: '#625B71', onSecondary: '#FFFFFF', secondaryContainer: '#E8DEF8', onSecondaryContainer: '#1D192B', tertiary: '#7D5260', onTertiary: '#FFFFFF', tertiaryContainer: '#FFD8E4', onTertiaryContainer: '#31111D', surface: '#f7fff9', onSurface: '#1C1B1F', surfaceVariant: '#d4f8e0', onSurfaceVariant: '#49454F', outline: '#79747E', bg: 'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)'
            },
            'sunset-orange': { 
                primary: '#fa709a', onPrimary: '#FFFFFF', primaryContainer: '#ffd8e4', onPrimaryContainer: '#4d0025', secondary: '#625B71', onSecondary: '#FFFFFF', secondaryContainer: '#E8DEF8', onSecondaryContainer: '#1D192B', tertiary: '#7D5260', onTertiary: '#FFFFFF', tertiaryContainer: '#FFD8E4', onTertiaryContainer: '#31111D', surface: '#fff5f7', onSurface: '#1C1B1F', surfaceVariant: '#ffd8e4', onSurfaceVariant: '#49454F', outline: '#79747E', bg: 'linear-gradient(135deg, #fa709a 0%, #fee140 100%)'
            }
        };

        function toggleThemeSelector(button) {
            const container = button.closest('.theme-toggle-container');
            const themeSelector = container.querySelector('.theme-selector');
            themeSelector.classList.toggle('hidden');
        }

        // Apply theme and hide selector
        function applyTheme(themeName) {
            const theme = themes[themeName];
            const root = document.documentElement;

            Object.keys(theme).forEach(key => {
                const cssVar = `--${key.replace(/([A-Z])/g, '-$1').toLowerCase()}`;
                if (key === 'bg') {
                     root.style.setProperty('--theme-bg', theme[key]);
                } else {
                     root.style.setProperty(cssVar, theme[key]);
                }
            });
            
            document.querySelectorAll('.theme-option').forEach(option => {
                option.classList.toggle('active', option.dataset.theme === themeName);
            });
            
            document.querySelectorAll('.theme-selector').forEach(sel => sel.classList.add('hidden'));
            
            localStorage.setItem('selectedTheme', themeName);
        }

        // Set up theme options
        document.querySelectorAll('.theme-option').forEach(option => {
            option.addEventListener('click', (e) => {
                applyTheme(e.currentTarget.dataset.theme);
            });
        });

        // Dark mode toggle
        function toggleDarkMode() {
            document.body.classList.toggle('theme-dark');
            const isDark = document.body.classList.contains('theme-dark');
            localStorage.setItem('darkMode', isDark);
            
            document.querySelectorAll('.toggle-dark-mode i').forEach(icon => {
                icon.className = isDark ? 'fas fa-sun' : 'fas fa-moon';
            });
        }

        // Load saved preferences on startup
        window.addEventListener('load', () => {
            const savedTheme = localStorage.getItem('selectedTheme') || 'royal-purple';
            applyTheme(savedTheme);
            
            if (localStorage.getItem('darkMode') === 'true') {
                document.body.classList.add('theme-dark');
                document.querySelectorAll('.toggle-dark-mode i').forEach(icon => {
                    icon.className = 'fas fa-sun';
                });
            }
        });

        // Navigation
        function showPage(id){
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }
        
        function goMenu(){ 
            showPage('page1'); 
        }

        function openCalculator() {
            showPage('page3');
        }
        
        function openAISection() {
            showPage('page4');
        }

        // AI Tab Navigation
        function switchAITab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.ai-tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.ai-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab content and mark tab as active
            document.getElementById(`${tabName}-tab`).classList.add('active');
            event.target.classList.add('active');
        }

        // History management
        let conversionHistory = JSON.parse(localStorage.getItem('conversionHistory')) || [];

        function addToHistory(conversion) {
            conversionHistory.unshift({ ...conversion, timestamp: new Date().toLocaleString() });
            conversionHistory = conversionHistory.slice(0, 10);
            localStorage.setItem('conversionHistory', JSON.stringify(conversionHistory));
            updateHistoryDisplay();
        }

        function updateHistoryDisplay() {
            const historyList = document.getElementById('history-list');
            historyList.innerHTML = conversionHistory.length === 0 ? '<div class="history-item">No conversion history yet</div>' : 
                conversionHistory.map(item => `
                    <div class="history-item">
                        <div class="conversion-text">${item.value} ${item.from} = ${item.result} ${item.to}</div>
                        <div class="conversion-date">${item.timestamp}</div>
                    </div>`).join('');
        }

        function clearHistory() {
            if (confirm("Are you sure you want to clear all conversion history?")) {
                conversionHistory = [];
                localStorage.setItem('conversionHistory', '[]');
                updateHistoryDisplay();
            }
        }

        function openConverter(type){
            showPage('page2');
            document.getElementById('conv-title').innerText = type + ' Converter';
            loadUnits(type);
            updateHistoryDisplay();
        }

        // Units
        const units = {
            Length: {'Millimeter (mm)': 1, 'Centimeter (cm)': 10, 'Meter (m)': 1000, 'Kilometer (km)': 1000000, 'Inch (in)': 25.4, 'Foot (ft)': 304.8, 'Yard (yd)': 914.4, 'Mile (mi)': 1609344},
            Area: {'Square millimeter (mm²)': 1, 'Square centimeter (cm²)': 100, 'Square meter (m²)': 1000000, 'Square kilometer (km²)': 1e12, 'Square inch (in²)': 645.16, 'Square foot (ft²)': 92903, 'Square yard (yd²)': 836127, 'Acre': 4046860000, 'Hectare (ha)': 10000000000},
            Volume: {'Milliliter (mL)': 1, 'Liter (L)': 1000, 'Cubic centimeter (cm³)': 1, 'Cubic meter (m³)': 1e6, 'Cubic inch (in³)': 16.387, 'Cubic foot (ft³)': 28316.8, 'US Gallon (gal)': 3785.41, 'US Pint (pt)': 473.176},
            Mass: {'Milligram (mg)': 0.001, 'Gram (g)': 1, 'Kilogram (kg)': 1000, 'Tonne (t)': 1e6, 'Ounce (oz)': 28.3495, 'Pound (lb)': 453.592, 'Stone (st)': 6350.29},
            Temperature: ['Celsius', 'Fahrenheit', 'Kelvin'],
            Speed: {'Meters per second (m/s)': 1, 'Kilometers per hour (km/h)': 0.277778, 'Miles per hour (mph)': 0.44704, 'Knots (kn)': 0.514444, 'Feet per second (ft/s)': 0.3048},
            Pressure: {'Pascal (Pa)': 1, 'Kilopascal (kPa)': 1000, 'Bar': 100000, 'Atmosphere (atm)': 101325, 'Millimeters of mercury (mmHg)': 133.322, 'Pounds per square inch (psi)': 6894.76},
            Power: {'Watt (W)': 1, 'Kilowatt (kW)': 1000, 'Megawatt (MW)': 1e6, 'Horsepower (hp)': 745.7, 'Calorie per second (cal/s)': 4.184}
        };

        function loadUnits(type){
            const from = document.getElementById('conv-from');
            const to = document.getElementById('conv-to');
            from.innerHTML = '';
            to.innerHTML = '';
            const unitList = Array.isArray(units[type]) ? units[type] : Object.keys(units[type]);
            
            unitList.forEach(u => {
                from.innerHTML += `<option value="${u}">${u}</option>`;
                to.innerHTML += `<option value="${u}">${u}</option>`;
            });

            if (to.options.length > 1) to.selectedIndex = 1;
            
            document.getElementById('conv-input').value = '';
            document.getElementById('conv-output').value = '';
        }

        // Conversion Logic
        function convert(){
            const inputEl = document.getElementById('conv-input');
            const outputEl = document.getElementById('conv-output');
            const from = document.getElementById('conv-from').value;
            const to = document.getElementById('conv-to').value;
            const type = document.getElementById('conv-title').innerText.replace(' Converter', '');
            
            if (inputEl.value === "") { outputEl.value = ""; return; }
            
            const val = parseFloat(inputEl.value);
            if(isNaN(val)) return;

            let result;
            if(type === 'Temperature'){
                if (from === to) result = val;
                else if (from === 'Celsius') result = (to === 'Fahrenheit') ? (val * 9/5) + 32 : val + 273.15;
                else if (from === 'Fahrenheit') result = (to === 'Celsius') ? (val - 32) * 5/9 : ((val - 32) * 5/9) + 273.15;
                else result = (to === 'Celsius') ? val - 273.15 : (val - 273.15) * 9/5 + 32;
            } else {
                result = val * units[type][from] / units[type][to];
            }
            
            const formattedResult = parseFloat(result.toPrecision(8));
            outputEl.value = formattedResult;
            
            if (inputEl.value && from && to) {
                addToHistory({type: type, value: inputEl.value, from: from, to: to, result: formattedResult});
            }
        }
        
        ['conv-input', 'conv-from', 'conv-to'].forEach(id => {
            document.getElementById(id).addEventListener(id === 'conv-input' ? 'input' : 'change', convert);
        });

        // AI Assistant - OptiChain 6 Pro Lite
        function processAIQuery() {
            const query = document.getElementById('ai-query').value.toLowerCase().trim();
            const responseEl = document.getElementById('ai-response');
            
            if (!query) {
                responseEl.textContent = "Please enter a conversion request.";
                return;
            }
            
            responseEl.textContent = "Processing your request...";
            
            // Simulate AI processing time (faster response)
            setTimeout(() => {
                let result = parseAIQuery(query);
                if (result) {
                    responseEl.innerHTML = `<strong>${result.value} ${result.from}</strong> = <strong>${result.converted} ${result.to}</strong>`;
                    
                    // Auto-fill the converter
                    if (document.getElementById('page2').classList.contains('active')) {
                        document.getElementById('conv-input').value = result.value;
                        document.getElementById('conv-output').value = result.converted;
                        
                        // Try to set the units if they match
                        const fromSelect = document.getElementById('conv-from');
                        const toSelect = document.getElementById('conv-to');
                        
                        for (let i = 0; i < fromSelect.options.length; i++) {
                            if (fromSelect.options[i].text.toLowerCase().includes(result.from.toLowerCase())) {
                                fromSelect.selectedIndex = i;
                                break;
                            }
                        }
                        
                        for (let i = 0; i < toSelect.options.length; i++) {
                            if (toSelect.options[i].text.toLowerCase().includes(result.to.toLowerCase())) {
                                toSelect.selectedIndex = i;
                                break;
                            }
                        }
                    }
                } else {
                    responseEl.textContent = "I couldn't understand your request. Try something like 'convert 1000 degrees to kelvin' or '50 miles to kilometers'.";
                }
            }, 500); // Faster response time
        }

        function parseAIQuery(query) {
            // Remove common phrases
            query = query.replace(/convert\s+/i, '')
                        .replace(/change\s+/i, '')
                        .replace(/what is\s+/i, '')
                        .replace(/in\s+/i, ' to ')
                        .replace(/into\s+/i, ' to ');
            
            // Extract value and units
            const valueMatch = query.match(/(\d+(?:\.\d+)?)\s*(.+?)\s*to\s*(.+)/);
            if (!valueMatch) return null;
            
            const value = parseFloat(valueMatch[1]);
            const fromUnit = valueMatch[2].trim();
            const toUnit = valueMatch[3].trim();
            
            // Determine conversion type and perform conversion
            let convertedValue;
            let conversionType;
            
            // Temperature conversions
            if (fromUnit.includes('celsius') || fromUnit.includes('°c') || 
                fromUnit.includes('fahrenheit') || fromUnit.includes('°f') ||
                fromUnit.includes('kelvin') || fromUnit.includes('°k')) {
                
                conversionType = 'Temperature';
                
                if ((fromUnit.includes('celsius') || fromUnit.includes('°c')) && 
                    (toUnit.includes('fahrenheit') || toUnit.includes('°f'))) {
                    convertedValue = (value * 9/5) + 32;
                } else if ((fromUnit.includes('celsius') || fromUnit.includes('°c')) && 
                          (toUnit.includes('kelvin') || toUnit.includes('°k'))) {
                    convertedValue = value + 273.15;
                } else if ((fromUnit.includes('fahrenheit') || fromUnit.includes('°f')) && 
                          (toUnit.includes('celsius') || toUnit.includes('°c'))) {
                    convertedValue = (value - 32) * 5/9;
                } else if ((fromUnit.includes('fahrenheit') || fromUnit.includes('°f')) && 
                          (toUnit.includes('kelvin') || toUnit.includes('°k'))) {
                    convertedValue = ((value - 32) * 5/9) + 273.15;
                } else if ((fromUnit.includes('kelvin') || fromUnit.includes('°k')) && 
                          (toUnit.includes('celsius') || fromUnit.includes('°c'))) {
                    convertedValue = value - 273.15;
                } else if ((fromUnit.includes('kelvin') || fromUnit.includes('°k')) && 
                          (toUnit.includes('fahrenheit') || fromUnit.includes('°f'))) {
                    convertedValue = (value - 273.15) * 9/5 + 32;
                } else {
                    return null;
                }
            } 
            // Length conversions
            else if (fromUnit.includes('meter') || fromUnit.includes('kilometer') || 
                     fromUnit.includes('centimeter') || fromUnit.includes('millimeter') ||
                     fromUnit.includes('mile') || fromUnit.includes('foot') || 
                     fromUnit.includes('inch') || fromUnit.includes('yard')) {
                
                conversionType = 'Length';
                const lengthUnits = units.Length;
                
                let fromKey = findMatchingUnit(fromUnit, Object.keys(lengthUnits));
                let toKey = findMatchingUnit(toUnit, Object.keys(lengthUnits));
                
                if (!fromKey || !toKey) return null;
                
                convertedValue = value * lengthUnits[fromKey] / lengthUnits[toKey];
            }
            // Mass conversions
            else if (fromUnit.includes('gram') || fromUnit.includes('kilogram') || 
                     fromUnit.includes('milligram') || fromUnit.includes('tonne') ||
                     fromUnit.includes('pound') || fromUnit.includes('ounce') || 
                     fromUnit.includes('stone')) {
                
                conversionType = 'Mass';
                const massUnits = units.Mass;
                
                let fromKey = findMatchingUnit(fromUnit, Object.keys(massUnits));
                let toKey = findMatchingUnit(toUnit, Object.keys(massUnits));
                
                if (!fromKey || !toKey) return null;
                
                convertedValue = value * massUnits[fromKey] / massUnits[toKey];
            }
            // If we can't determine the type, try a generic approach
            else {
                // Try to find matching units in any category
                for (const category in units) {
                    const categoryUnits = units[category];
                    const unitKeys = Array.isArray(categoryUnits) ? categoryUnits : Object.keys(categoryUnits);
                    
                    let fromKey = findMatchingUnit(fromUnit, unitKeys);
                    let toKey = findMatchingUnit(toUnit, unitKeys);
                    
                    if (fromKey && toKey) {
                        conversionType = category;
                        
                        if (category === 'Temperature') {
                            // Temperature conversion logic would go here
                            // For simplicity, we'll skip complex temperature parsing in generic case
                            return null;
                        } else {
                            convertedValue = value * categoryUnits[fromKey] / categoryUnits[toKey];
                            break;
                        }
                    }
                }
            }
            
            if (!convertedValue) return null;
            
            return {
                value: value,
                from: fromUnit,
                to: toUnit,
                converted: parseFloat(convertedValue.toPrecision(8)),
                type: conversionType
            };
        }

        function findMatchingUnit(unit, unitList) {
            for (const listUnit of unitList) {
                if (listUnit.toLowerCase().includes(unit) || unit.includes(listUnit.split(' ')[0].toLowerCase())) {
                    return listUnit;
                }
            }
            return null;
        }

        // Advanced AI Assistant - OptiChain 6 Pro Lite
        function processAdvancedAIQuery() {
            const query = document.getElementById('advanced-ai-query').value.toLowerCase().trim();
            const resultsEl = document.getElementById('advanced-ai-results');
            
            if (!query) {
                resultsEl.innerHTML = "<p>Please enter a query to analyze.</p>";
                return;
            }
            
            resultsEl.innerHTML = "<p>Processing your request with OptiChain 6 Pro Lite...</p>";
            
            // Simulate AI processing time (faster response)
            setTimeout(() => {
                let result = parseAdvancedAIQuery(query);
                if (result) {
                    displayAdvancedResults(result);
                } else {
                    resultsEl.innerHTML = "<p>I couldn't understand your request. Try something like 'BMI for 180cm and 75kg', 'BMR for male 30 years 70kg 175cm', or 'convert 500 grams to pounds'.</p>";
                }
            }, 300); // Even faster response time
        }

        // Process queries from different tabs
        function processHealthQuery() {
            const query = document.getElementById('health-query').value.toLowerCase().trim();
            const resultsEl = document.getElementById('advanced-ai-results');
            
            if (!query) {
                resultsEl.innerHTML = "<p>Please enter a health-related query.</p>";
                return;
            }
            
            resultsEl.innerHTML = "<p>Analyzing your health data...</p>";
            
            setTimeout(() => {
                let result = parseHealthQuery(query);
                if (result) {
                    displayAdvancedResults(result);
                } else {
                    resultsEl.innerHTML = "<p>I couldn't understand your health query. Try something like 'BMI for 180cm and 75kg' or 'BMR for male 30 years 70kg 175cm'.</p>";
                }
            }, 300);
        }

        function processFinanceQuery() {
            const query = document.getElementById('finance-query').value.toLowerCase().trim();
            const resultsEl = document.getElementById('advanced-ai-results');
            
            if (!query) {
                resultsEl.innerHTML = "<p>Please enter a finance-related query.</p>";
                return;
            }
            
            resultsEl.innerHTML = "<p>Analyzing your financial data...</p>";
            
            setTimeout(() => {
                let result = parseFinanceQuery(query);
                if (result) {
                    displayAdvancedResults(result);
                } else {
                    resultsEl.innerHTML = "<p>I couldn't understand your finance query. Try something like 'Convert 100 USD to EUR' or 'Calculate loan for $10000 at 5% for 5 years'.</p>";
                }
            }, 300);
        }

        function processNutritionQuery() {
            const query = document.getElementById('nutrition-query').value.toLowerCase().trim();
            const resultsEl = document.getElementById('advanced-ai-results');
            
            if (!query) {
                resultsEl.innerHTML = "<p>Please enter a nutrition-related query.</p>";
                return;
            }
            
            resultsEl.innerHTML = "<p>Analyzing your nutritional data...</p>";
            
            setTimeout(() => {
                let result = parseNutritionQuery(query);
                if (result) {
                    displayAdvancedResults(result);
                } else {
                    resultsEl.innerHTML = "<p>I couldn't understand your nutrition query. Try something like 'Calories in 200g chicken breast' or 'Macros for 1500 calorie diet'.</p>";
                }
            }, 300);
        }

        function processEngineeringQuery() {
            const query = document.getElementById('engineering-query').value.toLowerCase().trim();
            const resultsEl = document.getElementById('advanced-ai-results');
            
            if (!query) {
                resultsEl.innerHTML = "<p>Please enter an engineering-related query.</p>";
                return;
            }
            
            resultsEl.innerHTML = "<p>Analyzing your engineering data...</p>";
            
            setTimeout(() => {
                let result = parseEngineeringQuery(query);
                if (result) {
                    displayAdvancedResults(result);
                } else {
                    resultsEl.innerHTML = "<p>I couldn't understand your engineering query. Try something like 'Calculate stress on beam' or 'Convert 5000 psi to MPa'.</p>";
                }
            }, 300);
        }

        function parseAdvancedAIQuery(query) {
            // Try different query types
            let result = parseHealthQuery(query);
            if (result) return result;
            
            result = parseFinanceQuery(query);
            if (result) return result;
            
            result = parseNutritionQuery(query);
            if (result) return result;
            
            result = parseEngineeringQuery(query);
            if (result) return result;
            
            // Regular conversion as fallback
            return parseAIQuery(query);
        }

        function parseHealthQuery(query) {
            // BMI calculation
            if (query.includes('bmi') || query.includes('body mass')) {
                return calculateBMI(query);
            }
            
            // BMR calculation
            if (query.includes('bmr') || query.includes('basal metabolic') || query.includes('metabolism')) {
                return calculateBMR(query);
            }
            
            // Body fat percentage
            if (query.includes('body fat') || query.includes('fat percentage')) {
                return calculateBodyFat(query);
            }
            
            // Ideal weight
            if (query.includes('ideal weight') || query.includes('healthy weight')) {
                return calculateIdealWeight(query);
            }
            
            return null;
        }

        function parseFinanceQuery(query) {
            // Currency conversion
            if (query.includes('convert') && (query.includes('usd') || query.includes('eur') || query.includes('gbp') || 
                query.includes('jpy') || query.includes('cad') || query.includes('aud') || query.includes('chf') || 
                query.includes('cny') || query.includes('inr') || query.includes('bdt') || query.includes('taka'))) {
                return convertCurrencyFromQuery(query);
            }
            
            // Loan calculation
            if (query.includes('loan') || query.includes('mortgage')) {
                return calculateLoan(query);
            }
            
            // Investment calculation
            if (query.includes('investment') || query.includes('compound') || query.includes('interest')) {
                return calculateInvestment(query);
            }
            
            // Retirement planning
            if (query.includes('retirement') || query.includes('pension')) {
                return calculateRetirement(query);
            }
            
            return null;
        }

        function parseNutritionQuery(query) {
            // Calorie calculation
            if (query.includes('calorie') || query.includes('calories')) {
                return calculateCalories(query);
            }
            
            // Macronutrients
            if (query.includes('macro') || query.includes('protein') || query.includes('carb') || query.includes('fat')) {
                return calculateMacros(query);
            }
            
            // Hydration
            if (query.includes('water') || query.includes('hydration') || query.includes('fluid')) {
                return calculateWater(query);
            }
            
            // Meal planning
            if (query.includes('meal') || query.includes('diet') || query.includes('food')) {
                return createMealPlan(query);
            }
            
            return null;
        }

        function parseEngineeringQuery(query) {
            // Stress analysis
            if (query.includes('stress') || query.includes('strain') || query.includes('load')) {
                return calculateStress(query);
            }
            
            // Fluid dynamics
            if (query.includes('fluid') || query.includes('flow') || query.includes('pressure')) {
                return calculateFluid(query);
            }
            
            // Electrical calculations
            if (query.includes('ohm') || query.includes('volt') || query.includes('ampere') || query.includes('watt')) {
                return calculateElectrical(query);
            }
            
            // Structural analysis
            if (query.includes('beam') || query.includes('deflection') || query.includes('structural')) {
                return calculateStructural(query);
            }
            
            return null;
        }

        function calculateBMI(query) {
            // Extract height and weight from query
            const heightMatch = query.match(/(\d+(?:\.\d+)?)\s*(?:cm|centimeter|centimetre)/);
            const weightMatch = query.match(/(\d+(?:\.\d+)?)\s*(?:kg|kilogram|kilo)/);
            
            let height, weight;
            
            if (heightMatch && weightMatch) {
                height = parseFloat(heightMatch[1]) / 100; // Convert cm to m
                weight = parseFloat(weightMatch[1]);
            } else {
                // Try alternative patterns
                const numbers = query.match(/\d+(?:\.\d+)?/g);
                if (numbers && numbers.length >= 2) {
                    height = parseFloat(numbers[0]) / 100;
                    weight = parseFloat(numbers[1]);
                } else {
                    return null;
                }
            }
            
            if (!height || !weight) return null;
            
            const bmi = weight / (height * height);
            let category;
            
            if (bmi < 18.5) category = "Underweight";
            else if (bmi < 25) category = "Normal weight";
            else if (bmi < 30) category = "Overweight";
            else category = "Obese";
            
            return {
                type: "BMI",
                bmi: bmi.toFixed(1),
                category: category,
                height: (height * 100).toFixed(1) + " cm",
                weight: weight.toFixed(1) + " kg",
                note: "BMI is a screening tool, not a diagnostic of body fatness or health."
            };
        }

        function calculateBMR(query) {
            // Extract age, weight, height, and gender from query
            const ageMatch = query.match(/(\d+)\s*(?:years|year|yrs|yr)/);
            const weightMatch = query.match(/(\d+(?:\.\d+)?)\s*(?:kg|kilogram|kilo)/);
            const heightMatch = query.match(/(\d+(?:\.\d+)?)\s*(?:cm|centimeter|centimetre)/);
            const isMale = query.includes('male') || query.includes('man') || query.includes('boy');
            const isFemale = query.includes('female') || query.includes('woman') || query.includes('girl');
            
            let age, weight, height, gender;
            
            if (ageMatch) age = parseInt(ageMatch[1]);
            if (weightMatch) weight = parseFloat(weightMatch[1]);
            if (heightMatch) height = parseFloat(heightMatch[1]);
            
            if (isMale) gender = "male";
            else if (isFemale) gender = "female";
            
            // If we don't have all required data, try to extract from numbers
            if ((!age || !weight || !height) && !gender) {
                const numbers = query.match(/\d+(?:\.\d+)?/g);
                if (numbers && numbers.length >= 3) {
                    if (!age) age = parseInt(numbers[0]);
                    if (!height) height = parseFloat(numbers[1]);
                    if (!weight) weight = parseFloat(numbers[2]);
                }
            }
            
            if (!age || !weight || !height || !gender) return null;
            
            // Calculate BMR using Mifflin-St Jeor Equation
            let bmr;
            if (gender === "male") {
                bmr = 10 * weight + 6.25 * height - 5 * age + 5;
            } else {
                bmr = 10 * weight + 6.25 * height - 5 * age - 161;
            }
            
            return {
                type: "BMR",
                bmr: Math.round(bmr),
                gender: gender,
                age: age + " years",
                weight: weight.toFixed(1) + " kg",
                height: height.toFixed(1) + " cm",
                note: "This is your Basal Metabolic Rate - calories needed at complete rest."
            };
        }

        function calculateBodyFat(query) {
            // This is a simplified estimation
            const bmiResult = calculateBMI(query);
            if (!bmiResult) return null;
            
            const bmi = parseFloat(bmiResult.bmi);
            let bodyFat;
            
            // Very rough estimation based on BMI (not accurate, for demonstration only)
            if (query.includes('male') || query.includes('man') || query.includes('boy')) {
                bodyFat = (1.20 * bmi) + (0.23 * 30) - 16.2; // Using average age of 30
            } else {
                bodyFat = (1.20 * bmi) + (0.23 * 30) - 5.4; // Using average age of 30
            }
            
            let category;
            if (bodyFat < 10) category = "Essential fat";
            else if (bodyFat < 14) category = "Athletic";
            else if (bodyFat < 21) category = "Fitness";
            else if (bodyFat < 25) category = "Average";
            else category = "Obese";
            
            return {
                type: "Body Fat",
                bodyFat: bodyFat.toFixed(1) + "%",
                category: category,
                bmi: bmiResult.bmi,
                note: "Note: This is an estimation. For accurate measurement, consult a healthcare professional."
            };
        }

        function calculateIdealWeight(query) {
            const heightMatch = query.match(/(\d+(?:\.\d+)?)\s*(?:cm|centimeter|centimetre)/);
            let height;
            
            if (heightMatch) {
                height = parseFloat(heightMatch[1]);
            } else {
                const numbers = query.match(/\d+(?:\.\d+)?/g);
                if (numbers && numbers.length >= 1) {
                    height = parseFloat(numbers[0]);
                } else {
                    return null;
                }
            }
            
            if (!height) return null;
            
            // Calculate ideal weight using Devine formula
            const heightInInches = height / 2.54;
            let idealWeightKg;
            
            if (query.includes('male') || query.includes('man') || query.includes('boy')) {
                idealWeightKg = 50 + 2.3 * (heightInInches - 60);
            } else {
                idealWeightKg = 45.5 + 2.3 * (heightInInches - 60);
            }
            
            const lowerRange = idealWeightKg * 0.9;
            const upperRange = idealWeightKg * 1.1;
            
            return {
                type: "Ideal Weight",
                idealWeight: idealWeightKg.toFixed(1) + " kg",
                healthyRange: lowerRange.toFixed(1) + " - " + upperRange.toFixed(1) + " kg",
                height: height.toFixed(1) + " cm",
                note: "Based on Devine formula. Individual factors may vary."
            };
        }

        // Finance calculations
        function convertCurrencyFromQuery(query) {
            // Extract amount and currencies from query
            const amountMatch = query.match(/(\d+(?:\.\d+)?)\s*(usd|eur|gbp|jpy|cad|aud|chf|cny|inr|bdt)/i);
            const toCurrencyMatch = query.match(/to\s*(usd|eur|gbp|jpy|cad|aud|chf|cny|inr|bdt)/i);
            
            if (!amountMatch || !toCurrencyMatch) return null;
            
            const amount = parseFloat(amountMatch[1]);
            const fromCurrency = amountMatch[2].toUpperCase();
            const toCurrency = toCurrencyMatch[1].toUpperCase();
            
            // Mock exchange rates (in a real app, you would fetch these from an API)
            const exchangeRates = {
                'USD': 1,
                'EUR': 0.85,
                'GBP': 0.73,
                'JPY': 110.5,
                'CAD': 1.25,
                'AUD': 1.35,
                'CHF': 0.92,
                'CNY': 6.45,
                'INR': 74.5,
                'BDT': 109.5 // Bangladeshi Taka
            };
            
            if (!exchangeRates[fromCurrency] || !exchangeRates[toCurrency]) return null;
            
            const convertedAmount = amount * (exchangeRates[toCurrency] / exchangeRates[fromCurrency]);
            
            return {
                type: "Currency Conversion",
                amount: amount.toFixed(2) + " " + fromCurrency,
                converted: convertedAmount.toFixed(2) + " " + toCurrency,
                exchangeRate: "1 " + fromCurrency + " = " + (exchangeRates[toCurrency] / exchangeRates[fromCurrency]).toFixed(4) + " " + toCurrency,
                note: "Exchange rates are for demonstration only and may not reflect current market rates."
            };
        }

        function convertCurrency() {
            const amount = parseFloat(document.getElementById('currency-amount').value);
            const fromCurrency = document.getElementById('currency-from').value;
            const toCurrency = document.getElementById('currency-to').value;
            
            if (!amount) {
                document.getElementById('advanced-ai-results').innerHTML = "<p>Please enter an amount to convert.</p>";
                return;
            }
            
            // Mock exchange rates (in a real app, you would fetch these from an API)
            const exchangeRates = {
                'USD': 1,
                'EUR': 0.85,
                'GBP': 0.73,
                'JPY': 110.5,
                'CAD': 1.25,
                'AUD': 1.35,
                'CHF': 0.92,
                'CNY': 6.45,
                'INR': 74.5,
                'BDT': 109.5 // Bangladeshi Taka
            };
            
            const convertedAmount = amount * (exchangeRates[toCurrency] / exchangeRates[fromCurrency]);
            
            const result = {
                type: "Currency Conversion",
                amount: amount.toFixed(2) + " " + fromCurrency,
                converted: convertedAmount.toFixed(2) + " " + toCurrency,
                exchangeRate: "1 " + fromCurrency + " = " + (exchangeRates[toCurrency] / exchangeRates[fromCurrency]).toFixed(4) + " " + toCurrency,
                note: "Exchange rates are for demonstration only and may not reflect current market rates."
            };
            
            displayAdvancedResults(result);
        }

        function calculateLoan(query) {
            // Extract loan amount, interest rate, and term from query
            const amountMatch = query.match(/\$?(\d+(?:\.\d+)?)(?:\s*(?:dollar|usd))?/i);
            const rateMatch = query.match(/(\d+(?:\.\d+)?)\s*%/);
            const termMatch = query.match(/(\d+)\s*(?:year|years|yr|y)/);
            
            let amount, rate, term;
            
            if (amountMatch) amount = parseFloat(amountMatch[1]);
            if (rateMatch) rate = parseFloat(rateMatch[1]);
            if (termMatch) term = parseInt(termMatch[1]);
            
            // If we don't have all required data, try to extract from numbers
            if ((!amount || !rate || !term)) {
                const numbers = query.match(/\d+(?:\.\d+)?/g);
                if (numbers && numbers.length >= 3) {
                    if (!amount) amount = parseFloat(numbers[0]);
                    if (!rate) rate = parseFloat(numbers[1]);
                    if (!term) term = parseInt(numbers[2]);
                } else {
                    return null;
                }
            }
            
            if (!amount || !rate || !term) return null;
            
            // Calculate monthly payment
            const monthlyRate = rate / 100 / 12;
            const numberOfPayments = term * 12;
            const monthlyPayment = amount * monthlyRate * Math.pow(1 + monthlyRate, numberOfPayments) / (Math.pow(1 + monthlyRate, numberOfPayments) - 1);
            const totalPayment = monthlyPayment * numberOfPayments;
            const totalInterest = totalPayment - amount;
            
            return {
                type: "Loan Calculation",
                loanAmount: "$" + amount.toFixed(2),
                interestRate: rate.toFixed(2) + "%",
                loanTerm: term + " years",
                monthlyPayment: "$" + monthlyPayment.toFixed(2),
                totalPayment: "$" + totalPayment.toFixed(2),
                totalInterest: "$" + totalInterest.toFixed(2),
                note: "This calculation assumes a fixed interest rate and monthly payments."
            };
        }

        function calculateInvestment(query) {
            // Extract initial investment, contribution, rate, and term from query
            const initialMatch = query.match(/(\d+(?:\.\d+)?)\s*(?:dollar|usd)/i);
            const contributionMatch = query.match(/(\d+(?:\.\d+)?)\s*(?:per|each)\s*(?:month|year)/i);
            const rateMatch = query.match(/(\d+(?:\.\d+)?)\s*%/);
            const termMatch = query.match(/(\d+)\s*(?:year|years|yr|y)/);
            
            let initial = 0, contribution = 0, rate, term;
            
            if (initialMatch) initial = parseFloat(initialMatch[1]);
            if (contributionMatch) contribution = parseFloat(contributionMatch[1]);
            if (rateMatch) rate = parseFloat(rateMatch[1]);
            if (termMatch) term = parseInt(termMatch[1]);
            
            // If we don't have all required data, try to extract from numbers
            if ((!rate || !term)) {
                const numbers = query.match(/\d+(?:\.\d+)?/g);
                if (numbers && numbers.length >= 2) {
                    if (!rate) rate = parseFloat(numbers[0]);
                    if (!term) term = parseInt(numbers[1]);
                } else {
                    return null;
                }
            }
            
            if (!rate || !term) return null;
            
            // Calculate future value with compound interest
            const monthlyRate = rate / 100 / 12;
            const numberOfMonths = term * 12;
            let futureValue = initial * Math.pow(1 + monthlyRate, numberOfMonths);
            
            if (contribution > 0) {
                futureValue += contribution * (Math.pow(1 + monthlyRate, numberOfMonths) - 1) / monthlyRate;
            }
            
            const totalContributions = initial + (contribution * numberOfMonths);
            const interestEarned = futureValue - totalContributions;
            
            return {
                type: "Investment Growth",
                initialInvestment: "$" + initial.toFixed(2),
                monthlyContribution: "$" + contribution.toFixed(2),
                annualRate: rate.toFixed(2) + "%",
                investmentTerm: term + " years",
                futureValue: "$" + futureValue.toFixed(2),
                totalContributions: "$" + totalContributions.toFixed(2),
                interestEarned: "$" + interestEarned.toFixed(2),
                note: "This calculation assumes compound interest and regular monthly contributions."
            };
        }

        function calculateRetirement(query) {
            // This is a simplified retirement calculation
            const currentAgeMatch = query.match(/(\d+)\s*(?:year|years|yr|y)\s*old/);
            const retirementAgeMatch = query.match(/retire\s*at\s*(\d+)/);
            const savingsMatch = query.match(/\$?(\d+(?:\.\d+)?)(?:\s*(?:dollar|usd))?/i);
            
            let currentAge = 30, retirementAge = 65, currentSavings = 0;
            
            if (currentAgeMatch) currentAge = parseInt(currentAgeMatch[1]);
            if (retirementAgeMatch) retirementAge = parseInt(retirementAgeMatch[1]);
            if (savingsMatch) currentSavings = parseFloat(savingsMatch[1]);
            
            const yearsToRetirement = retirementAge - currentAge;
            if (yearsToRetirement <= 0) return null;
            
            // Simplified calculation (in a real app, this would be more complex)
            const monthlySavingsNeeded = (1000000 - currentSavings) / yearsToRetirement / 12;
            
            return {
                type: "Retirement Planning",
                currentAge: currentAge + " years",
                retirementAge: retirementAge + " years",
                yearsToRetirement: yearsToRetirement + " years",
                currentSavings: "$" + currentSavings.toFixed(2),
                monthlySavingsNeeded: "$" + monthlySavingsNeeded.toFixed(2),
                note: "This is a simplified calculation. Consult a financial advisor for personalized retirement planning."
            };
        }

        // Nutrition calculations
        function calculateCalories(query) {
            // Extract age, weight, height, gender, and activity level from query
            const ageMatch = query.match(/(\d+)\s*(?:years|year|yrs|yr)/);
            const weightMatch = query.match(/(\d+(?:\.\d+)?)\s*(?:kg|kilogram|kilo)/);
            const heightMatch = query.match(/(\d+(?:\.\d+)?)\s*(?:cm|centimeter|centimetre)/);
            const isMale = query.includes('male') || query.includes('man') || query.includes('boy');
            const isFemale = query.includes('female') || query.includes('woman') || query.includes('girl');
            
            let age, weight, height, gender;
            
            if (ageMatch) age = parseInt(ageMatch[1]);
            if (weightMatch) weight = parseFloat(weightMatch[1]);
            if (heightMatch) height = parseFloat(heightMatch[1]);
            
            if (isMale) gender = "male";
            else if (isFemale) gender = "female";
            
            // If we don't have all required data, try to extract from numbers
            if ((!age || !weight || !height) && !gender) {
                const numbers = query.match(/\d+(?:\.\d+)?/g);
                if (numbers && numbers.length >= 3) {
                    if (!age) age = parseInt(numbers[0]);
                    if (!height) height = parseFloat(numbers[1]);
                    if (!weight) weight = parseFloat(numbers[2]);
                } else {
                    return null;
                }
            }
            
            if (!age || !weight || !height || !gender) return null;
            
            // Calculate BMR first
            let bmr;
            if (gender === "male") {
                bmr = 10 * weight + 6.25 * height - 5 * age + 5;
            } else {
                bmr = 10 * weight + 6.25 * height - 5 * age - 161;
            }
            
            // Estimate activity level from query
            let activityFactor = 1.2; // Sedentary default
            if (query.includes('light') || query.includes('lightly')) activityFactor = 1.375;
            if (query.includes('moderate') || query.includes('moderately')) activityFactor = 1.55;
            if (query.includes('active') || query.includes('very')) activityFactor = 1.725;
            if (query.includes('extreme') || query.includes('athlete')) activityFactor = 1.9;
            
            const maintenanceCalories = Math.round(bmr * activityFactor);
            const weightLossCalories = Math.round(maintenanceCalories * 0.85);
            const weightGainCalories = Math.round(maintenanceCalories * 1.15);
            
            return {
                type: "Calorie Needs",
                bmr: Math.round(bmr) + " calories/day",
                maintenance: maintenanceCalories + " calories/day",
                weightLoss: weightLossCalories + " calories/day",
                weightGain: weightGainCalories + " calories/day",
                activityLevel: getActivityLevelDescription(activityFactor),
                note: "These are estimates. Individual needs may vary based on metabolism and other factors."
            };
        }

        function getActivityLevelDescription(factor) {
            if (factor <= 1.2) return "Sedentary (little or no exercise)";
            if (factor <= 1.375) return "Lightly active (light exercise 1-3 days/week)";
            if (factor <= 1.55) return "Moderately active (moderate exercise 3-5 days/week)";
            if (factor <= 1.725) return "Very active (hard exercise 6-7 days/week)";
            return "Extremely active (very hard exercise, physical job)";
        }

        function calculateMacros(query) {
            // Extract calories from query or use default
            const calorieMatch = query.match(/(\d+)\s*calorie/);
            const calories = calorieMatch ? parseInt(calorieMatch[1]) : 2000;
            
            // Calculate macronutrient distribution
            const proteinGrams = Math.round(calories * 0.3 / 4); // 30% of calories from protein
            const carbGrams = Math.round(calories * 0.4 / 4);   // 40% of calories from carbs
            const fatGrams = Math.round(calories * 0.3 / 9);    // 30% of calories from fat
            
            return {
                type: "Macronutrient Distribution",
                calories: calories + " calories/day",
                protein: proteinGrams + " grams (" + Math.round(calories * 0.3) + " calories)",
                carbohydrates: carbGrams + " grams (" + Math.round(calories * 0.4) + " calories)",
                fat: fatGrams + " grams (" + Math.round(calories * 0.3) + " calories)",
                note: "This is a balanced macronutrient distribution. Adjust based on your goals and preferences."
            };
        }

        function calculateWater(query) {
            // Extract weight from query
            const weightMatch = query.match(/(\d+(?:\.\d+)?)\s*(?:kg|kilogram|kilo)/);
            const weight = weightMatch ? parseFloat(weightMatch[1]) : 70;
            
            // Calculate water needs (simplified: 30-35 ml per kg of body weight)
            const waterML = Math.round(weight * 33);
            const waterCups = Math.round(waterML / 240);
            
            return {
                type: "Hydration Needs",
                weight: weight + " kg",
                waterNeeded: waterML + " ml (" + waterCups + " cups) per day",
                note: "This is a general guideline. Increase intake if you're active or in hot weather."
            };
        }

        function createMealPlan(query) {
            // Extract calories from query or use default
            const calorieMatch = query.match(/(\d+)\s*calorie/);
            const calories = calorieMatch ? parseInt(calorieMatch[1]) : 2000;
            
            // Create a sample meal plan
            const breakfastCalories = Math.round(calories * 0.25);
            const lunchCalories = Math.round(calories * 0.35);
            const dinnerCalories = Math.round(calories * 0.30);
            const snacksCalories = Math.round(calories * 0.10);
            
            return {
                type: "Sample Meal Plan",
                totalCalories: calories + " calories/day",
                breakfast: breakfastCalories + " calories",
                lunch: lunchCalories + " calories",
                dinner: dinnerCalories + " calories",
                snacks: snacksCalories + " calories",
                note: "This is a sample distribution. Adjust based on your schedule and preferences."
            };
        }

        // Engineering calculations
        function calculateStress(query) {
            // Extract force and area from query
            const forceMatch = query.match(/(\d+(?:\.\d+)?)\s*(?:n|newton)/i);
            const areaMatch = query.match(/(\d+(?:\.\d+)?)\s*(?:mm²|mm2|square millimeter)/i);
            
            let force = forceMatch ? parseFloat(forceMatch[1]) : 1000;
            let area = areaMatch ? parseFloat(areaMatch[1]) : 100;
            
            const stress = force / area; // Stress in N/mm² (MPa)
            
            return {
                type: "Stress Calculation",
                force: force + " N",
                area: area + " mm²",
                stress: stress.toFixed(2) + " MPa",
                note: "Stress = Force / Area. This is a simplified calculation for demonstration."
            };
        }

        function calculateFluid(query) {
            // Extract flow rate and diameter from query
            const flowMatch = query.match(/(\d+(?:\.\d+)?)\s*(?:l\/s|l\/min|liter)/i);
            const diameterMatch = query.match(/(\d+(?:\.\d+)?)\s*(?:mm|millimeter)/i);
            
            let flowRate = flowMatch ? parseFloat(flowMatch[1]) : 10;
            let diameter = diameterMatch ? parseFloat(diameterMatch[1]) : 50;
            
            // Calculate velocity (simplified)
            const area = Math.PI * Math.pow(diameter/2, 2) / 1000000; // Area in m²
            const velocity = (flowRate / 1000) / area; // Velocity in m/s
            
            return {
                type: "Fluid Flow Calculation",
                flowRate: flowRate + " L/s",
                diameter: diameter + " mm",
                velocity: velocity.toFixed(2) + " m/s",
                note: "Velocity = Flow Rate / Cross-sectional Area. This is a simplified calculation."
            };
        }

        function calculateElectrical(query) {
            // Extract voltage and resistance from query
            const voltageMatch = query.match(/(\d+(?:\.\d+)?)\s*(?:v|volt)/i);
            const resistanceMatch = query.match(/(\d+(?:\.\d+)?)\s*(?:Ω|ohm)/i);
            
            let voltage = voltageMatch ? parseFloat(voltageMatch[1]) : 12;
            let resistance = resistanceMatch ? parseFloat(resistanceMatch[1]) : 100;
            
            // Calculate current and power using Ohm's Law
            const current = voltage / resistance; // Current in Amperes
            const power = voltage * current; // Power in Watts
            
            return {
                type: "Electrical Calculation",
                voltage: voltage + " V",
                resistance: resistance + " Ω",
                current: current.toFixed(3) + " A",
                power: power.toFixed(2) + " W",
                note: "Using Ohm's Law: I = V/R, P = V*I"
            };
        }

        function calculateStructural(query) {
            // Extract load, length, and modulus from query
            const loadMatch = query.match(/(\d+(?:\.\d+)?)\s*(?:n|newton)/i);
            const lengthMatch = query.match(/(\d+(?:\.\d+)?)\s*(?:m|meter)/i);
            
            let load = loadMatch ? parseFloat(loadMatch[1]) : 1000;
            let length = lengthMatch ? parseFloat(lengthMatch[1]) : 2;
            
            // Simplified beam deflection calculation
            const deflection = (load * Math.pow(length, 3)) / (48 * 200000000000 * 0.0001); // Simplified formula
            
            return {
                type: "Structural Analysis",
                load: load + " N",
                length: length + " m",
                deflection: deflection.toFixed(6) + " m",
                note: "This is a simplified beam deflection calculation for demonstration purposes."
            };
        }

        function displayAdvancedResults(result) {
            const resultsEl = document.getElementById('advanced-ai-results');
            let html = `<h4>${result.type} Analysis</h4>`;
            
            if (result.type === "BMI") {
                html += `
                    <div class="ai-result-item">
                        <div class="ai-result-label">BMI Score</div>
                        <div class="ai-result-value">${result.bmi}</div>
                        <div class="ai-result-description">Category: ${result.category}</div>
                    </div>
                    <div class="ai-result-item">
                        <div class="ai-result-label">Height</div>
                        <div class="ai-result-value">${result.height}</div>
                    </div>
                    <div class="ai-result-item">
                        <div class="ai-result-label">Weight</div>
                        <div class="ai-result-value">${result.weight}</div>
                    </div>
                    <div class="ai-result-item">
                        <div class="ai-result-description">${result.note}</div>
                    </div>
                `;
            } else if (result.type === "BMR") {
                html += `
                    <div class="ai-result-item">
                        <div class="ai-result-label">Basal Metabolic Rate</div>
                        <div class="ai-result-value">${result.bmr} calories/day</div>
                        <div class="ai-result-description">This is the number of calories your body needs at rest.</div>
                    </div>
                    <div class="ai-result-item">
                        <div class="ai-result-label">Gender</div>
                        <div class="ai-result-value">${result.gender}</div>
                    </div>
                    <div class="ai-result-item">
                        <div class="ai-result-label">Age</div>
                        <div class="ai-result-value">${result.age}</div>
                    </div>
                    <div class="ai-result-item">
                        <div class="ai-result-label">Weight</div>
                        <div class="ai-result-value">${result.weight}</div>
                    </div>
                    <div class="ai-result-item">
                        <div class="ai-result-label">Height</div>
                        <div class="ai-result-value">${result.height}</div>
                    </div>
                    <div class="ai-result-item">
                        <div class="ai-result-description">${result.note}</div>
                    </div>
                `;
            } else if (result.type === "Body Fat") {
                html += `
                    <div class="ai-result-item">
                        <div class="ai-result-label">Estimated Body Fat</div>
                        <div class="ai-result-value">${result.bodyFat}</div>
                        <div class="ai-result-description">Category: ${result.category}</div>
                    </div>
                    <div class="ai-result-item">
                        <div class="ai-result-label">BMI</div>
                        <div class="ai-result-value">${result.bmi}</div>
                    </div>
                    <div class="ai-result-item">
                        <div class="ai-result-description">${result.note}</div>
                    </div>
                `;
            } else if (result.type === "Ideal Weight") {
                html += `
                    <div class="ai-result-item">
                        <div class="ai-result-label">Ideal Weight</div>
                        <div class="ai-result-value">${result.idealWeight}</div>
                    </div>
                    <div class="ai-result-item">
                        <div class="ai-result-label">Healthy Weight Range</div>
                        <div class="ai-result-value">${result.healthyRange}</div>
                    </div>
                    <div class="ai-result-item">
                        <div class="ai-result-label">Height</div>
                        <div class="ai-result-value">${result.height}</div>
                    </div>
                    <div class="ai-result-item">
                        <div class="ai-result-description">${result.note}</div>
                    </div>
                `;
            } else if (result.type === "Currency Conversion") {
                html += `
                    <div class="ai-result-item">
                        <div class="ai-result-label">Original Amount</div>
                        <div class="ai-result-value">${result.amount}</div>
                    </div>
                    <div class="ai-result-item">
                        <div class="ai-result-label">Converted Amount</div>
                        <div class="ai-result-value">${result.converted}</div>
                    </div>
                    <div class="ai-result-item">
                        <div class="ai-result-label">Exchange Rate</div>
                        <div class="ai-result-value">${result.exchangeRate}</div>
                    </div>
                    <div class="ai-result-item">
                        <div class="ai-result-description">${result.note}</div>
                    </div>
                `;
            } else if (result.type === "Loan Calculation") {
                html += `
                    <div class="ai-result-item">
                        <div class="ai-result-label">Loan Amount</div>
                        <div class="ai-result-value">${result.loanAmount}</div>
                    </div>
                    <div class="ai-result-item">
                        <div class="ai-result-label">Interest Rate</div>
                        <div class="ai-result-value">${result.interestRate}</div>
                    </div>
                    <div class="ai-result-item">
                        <div class="ai-result-label">Loan Term</div>
                        <div class="ai-result-value">${result.loanTerm}</div>
                    </div>
                    <div class="ai-result-item">
                        <div class="ai-result-label">Monthly Payment</div>
                        <div class="ai-result-value">${result.monthlyPayment}</div>
                    </div>
                    <div class="ai-result-item">
                        <div class="ai-result-label">Total Payment</div>
                        <div class="ai-result-value">${result.totalPayment}</div>
                    </div>
                    <div class="ai-result-item">
                        <div class="ai-result-label">Total Interest</div>
                        <div class="ai-result-value">${result.totalInterest}</div>
                    </div>
                    <div class="ai-result-item">
                        <div class="ai-result-description">${result.note}</div>
                    </div>
                `;
            } else if (result.type === "Investment Growth") {
                html += `
                    <div class="ai-result-item">
                        <div class="ai-result-label">Initial Investment</div>
                        <div class="ai-result-value">${result.initialInvestment}</div>
                    </div>
                    <div class="ai-result-item">
                        <div class="ai-result-label">Monthly Contribution</div>
                        <div class="ai-result-value">${result.monthlyContribution}</div>
                    </div>
                    <div class="ai-result-item">
                        <div class="ai-result-label">Annual Rate of Return</div>
                        <div class="ai-result-value">${result.annualRate}</div>
                    </div>
                    <div class="ai-result-item">
                        <div class="ai-result-label">Investment Term</div>
                        <div class="ai-result-value">${result.investmentTerm}</div>
                    </div>
                    <div class="ai-result-item">
                        <div class="ai-result-label">Future Value</div>
                        <div class="ai-result-value">${result.futureValue}</div>
                    </div>
                    <div class="ai-result-item">
                        <div class="ai-result-label">Total Contributions</div>
                        <div class="ai-result-value">${result.totalContributions}</div>
                    </div>
                    <div class="ai-result-item">
                        <div class="ai-result-label">Interest Earned</div>
                        <div class="ai-result-value">${result.interestEarned}</div>
                    </div>
                    <div class="ai-result-item">
                        <div class="ai-result-description">${result.note}</div>
                    </div>
                `;
            } else if (result.type === "Retirement Planning") {
                html += `
                    <div class="ai-result-item">
                        <div class="ai-result-label">Current Age</div>
                        <div class="ai-result-value">${result.currentAge}</div>
                    </div>
                    <div class="ai-result-item">
                        <div class="ai-result-label">Retirement Age</div>
                        <div class="ai-result-value">${result.retirementAge}</div>
                    </div>
                    <div class="ai-result-item">
                        <div class="ai-result-label">Years to Retirement</div>
                        <div class="ai-result-value">${result.yearsToRetirement}</div>
                    </div>
                    <div class="ai-result-item">
                        <div class="ai-result-label">Current Savings</div>
                        <div class="ai-result-value">${result.currentSavings}</div>
                    </div>
                    <div class="ai-result-item">
                        <div class="ai-result-label">Monthly Savings Needed</div>
                        <div class="ai-result-value">${result.monthlySavingsNeeded}</div>
                    </div>
                    <div class="ai-result-item">
                        <div class="ai-result-description">${result.note}</div>
                    </div>
                `;
            } else if (result.type === "Calorie Needs") {
                html += `
                    <div class="ai-result-item">
                        <div class="ai-result-label">Basal Metabolic Rate (BMR)</div>
                        <div class="ai-result-value">${result.bmr}</div>
                    </div>
                    <div class="ai-result-item">
                        <div class="ai-result-label">Maintenance Calories</div>
                        <div class="ai-result-value">${result.maintenance}</div>
                    </div>
                    <div class="ai-result-item">
                        <div class="ai-result-label">Weight Loss Calories</div>
                        <div class="ai-result-value">${result.weightLoss}</div>
                    </div>
                    <div class="ai-result-item">
                        <div class="ai-result-label">Weight Gain Calories</div>
                        <div class="ai-result-value">${result.weightGain}</div>
                    </div>
                    <div class="ai-result-item">
                        <div class="ai-result-label">Activity Level</div>
                        <div class="ai-result-value">${result.activityLevel}</div>
                    </div>
                    <div class="ai-result-item">
                        <div class="ai-result-description">${result.note}</div>
                    </div>
                `;
            } else if (result.type === "Macronutrient Distribution") {
                html += `
                    <div class="ai-result-item">
                        <div class="ai-result-label">Daily Calories</div>
                        <div class="ai-result-value">${result.calories}</div>
                    </div>
                    <div class="ai-result-item">
                        <div class="ai-result-label">Protein</div>
                        <div class="ai-result-value">${result.protein}</div>
                    </div>
                    <div class="ai-result-item">
                        <div class="ai-result-label">Carbohydrates</div>
                        <div class="ai-result-value">${result.carbohydrates}</div>
                    </div>
                    <div class="ai-result-item">
                        <div class="ai-result-label">Fat</div>
                        <div class="ai-result-value">${result.fat}</div>
                    </div>
                    <div class="ai-result-item">
                        <div class="ai-result-description">${result.note}</div>
                    </div>
                `;
            } else if (result.type === "Hydration Needs") {
                html += `
                    <div class="ai-result-item">
                        <div class="ai-result-label">Body Weight</div>
                        <div class="ai-result-value">${result.weight}</div>
                    </div>
                    <div class="ai-result-item">
                        <div class="ai-result-label">Daily Water Needs</div>
                        <div class="ai-result-value">${result.waterNeeded}</div>
                    </div>
                    <div class="ai-result-item">
                        <div class="ai-result-description">${result.note}</div>
                    </div>
                `;
            } else if (result.type === "Sample Meal Plan") {
                html += `
                    <div class="ai-result-item">
                        <div class="ai-result-label">Total Daily Calories</div>
                        <div class="ai-result-value">${result.totalCalories}</div>
                    </div>
                    <div class="ai-result-item">
                        <div class="ai-result-label">Breakfast</div>
                        <div class="ai-result-value">${result.breakfast}</div>
                    </div>
                    <div class="ai-result-item">
                        <div class="ai-result-label">Lunch</div>
                        <div class="ai-result-value">${result.lunch}</div>
                    </div>
                    <div class="ai-result-item">
                        <div class="ai-result-label">Dinner</div>
                        <div class="ai-result-value">${result.dinner}</div>
                    </div>
                    <div class="ai-result-item">
                        <div class="ai-result-label">Snacks</div>
                        <div class="ai-result-value">${result.snacks}</div>
                    </div>
                    <div class="ai-result-item">
                        <div class="ai-result-description">${result.note}</div>
                    </div>
                `;
            } else if (result.type === "Stress Calculation") {
                html += `
                    <div class="ai-result-item">
                        <div class="ai-result-label">Force</div>
                        <div class="ai-result-value">${result.force}</div>
                    </div>
                    <div class="ai-result-item">
                        <div class="ai-result-label">Cross-sectional Area</div>
                        <div class="ai-result-value">${result.area}</div>
                    </div>
                    <div class="ai-result-item">
                        <div class="ai-result-label">Stress</div>
                        <div class="ai-result-value">${result.stress}</div>
                    </div>
                    <div class="ai-result-item">
                        <div class="ai-result-description">${result.note}</div>
                    </div>
                `;
            } else if (result.type === "Fluid Flow Calculation") {
                html += `
                    <div class="ai-result-item">
                        <div class="ai-result-label">Flow Rate</div>
                        <div class="ai-result-value">${result.flowRate}</div>
                    </div>
                    <div class="ai-result-item">
                        <div class="ai-result-label">Pipe Diameter</div>
                        <div class="ai-result-value">${result.diameter}</div>
                    </div>
                    <div class="ai-result-item">
                        <div class="ai-result-label">Fluid Velocity</div>
                        <div class="ai-result-value">${result.velocity}</div>
                    </div>
                    <div class="ai-result-item">
                        <div class="ai-result-description">${result.note}</div>
                    </div>
                `;
            } else if (result.type === "Electrical Calculation") {
                html += `
                    <div class="ai-result-item">
                        <div class="ai-result-label">Voltage</div>
                        <div class="ai-result-value">${result.voltage}</div>
                    </div>
                    <div class="ai-result-item">
                        <div class="ai-result-label">Resistance</div>
                        <div class="ai-result-value">${result.resistance}</div>
                    </div>
                    <div class="ai-result-item">
                        <div class="ai-result-label">Current</div>
                        <div class="ai-result-value">${result.current}</div>
                    </div>
                    <div class="ai-result-item">
                        <div class="ai-result-label">Power</div>
                        <div class="ai-result-value">${result.power}</div>
                    </div>
                    <div class="ai-result-item">
                        <div class="ai-result-description">${result.note}</div>
                    </div>
                `;
            } else if (result.type === "Structural Analysis") {
                html += `
                    <div class="ai-result-item">
                        <div class="ai-result-label">Load</div>
                        <div class="ai-result-value">${result.load}</div>
                    </div>
                    <div class="ai-result-item">
                        <div class="ai-result-label">Beam Length</div>
                        <div class="ai-result-value">${result.length}</div>
                    </div>
                    <div class="ai-result-item">
                        <div class="ai-result-label">Deflection</div>
                        <div class="ai-result-value">${result.deflection}</div>
                    </div>
                    <div class="ai-result-item">
                        <div class="ai-result-description">${result.note}</div>
                    </div>
                `;
            } else {
                // Regular conversion result
                html += `
                    <div class="ai-result-item">
                        <div class="ai-result-label">Conversion Result</div>
                        <div class="ai-result-value">${result.value} ${result.from} = ${result.converted} ${result.to}</div>
                    </div>
                `;
            }
            
            resultsEl.innerHTML = html;
        }

        function quickAction(action) {
            const queryInput = document.getElementById('advanced-ai-query');
            
            switch(action) {
                case 'bmi':
                    queryInput.value = "BMI for 175cm and 70kg";
                    break;
                case 'bmr':
                    queryInput.value = "BMR for male 30 years 70kg 175cm";
                    break;
                case 'bodyfat':
                    queryInput.value = "Body fat percentage for male 175cm 70kg";
                    break;
                case 'idealweight':
                    queryInput.value = "Ideal weight for 175cm male";
                    break;
                case 'currency':
                    queryInput.value = "Convert 100 USD to BDT";
                    break;
                case 'loan':
                    queryInput.value = "Calculate loan for $10000 at 5% for 5 years";
                    break;
                case 'investment':
                    queryInput.value = "Investment growth for $5000 at 7% for 10 years";
                    break;
                case 'retirement':
                    queryInput.value = "Retirement planning for 35 year old with $50000 savings";
                    break;
                case 'calories':
                    queryInput.value = "Calorie needs for male 30 years 70kg 175cm moderately active";
                    break;
                case 'macros':
                    queryInput.value = "Macronutrients for 2000 calorie diet";
                    break;
                case 'water':
                    queryInput.value = "Water needs for 70kg person";
                    break;
                case 'mealplan':
                    queryInput.value = "Meal plan for 2000 calories";
                    break;
                case 'stress':
                    queryInput.value = "Stress calculation for 1000N force on 100mm² area";
                    break;
                case 'fluid':
                    queryInput.value = "Fluid velocity for 10 L/s flow in 50mm pipe";
                    break;
                case 'electrical':
                    queryInput.value = "Current for 12V circuit with 100Ω resistance";
                    break;
                case 'structural':
                    queryInput.value = "Beam deflection for 1000N load on 2m beam";
                    break;
            }
            
            processAdvancedAIQuery();
        }

        // Calculator functionality
        function appendToDisplay(value) {
            const display = document.getElementById('calc-display');
            if (display.textContent === '0' || display.textContent === 'Error') {
                display.textContent = value;
            } else {
                display.textContent += value;
            }
        }

        function clearCalculator() {
            document.getElementById('calc-display').textContent = '0';
        }

        function backspace() {
            const display = document.getElementById('calc-display');
            if (display.textContent.length > 1) {
                display.textContent = display.textContent.slice(0, -1);
            } else {
                display.textContent = '0';
            }
        }

        function calculate() {
            const display = document.getElementById('calc-display');
            try {
                // Replace × with * for evaluation
                let expression = display.textContent.replace(/×/g, '*');
                // Handle percentage
                expression = expression.replace(/(\d+)%/g, '($1/100)');
                
                // Evaluate the expression
                const result = eval(expression);
                
                if (isNaN(result) || !isFinite(result)) {
                    display.textContent = 'Error';
                } else {
                    display.textContent = parseFloat(result.toPrecision(10)).toString();
                }
            } catch (error) {
                display.textContent = 'Error';
            }
        }

        // Allow pressing Enter in AI inputs
        document.getElementById('ai-query').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                processAIQuery();
            }
        });
        
        document.getElementById('advanced-ai-query').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                processAdvancedAIQuery();
            }
        });
        
        document.getElementById('health-query').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                processHealthQuery();
            }
        });
        
        document.getElementById('finance-query').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                processFinanceQuery();
            }
        });
        
        document.getElementById('nutrition-query').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                processNutritionQuery();
            }
        });
        
        document.getElementById('engineering-query').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                processEngineeringQuery();
            }
        });
    </script>
</body>
</html>
