<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Typo Master - Professional Typing Test</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1e40af;
            --primary-light: #3b82f6;
            --secondary: #f59e0b;
            --background: #ffffff;
            --background-alt: #f8fafc;
            --text: #1f2937;
            --text-light: #64748b;
            --correct: #10b981;
            --incorrect: #ef4444;
            --card-bg: #ffffff;
            --shadow: rgba(0, 0, 0, 0.08);
            --shadow-hover: rgba(0, 0, 0, 0.12);
            --transition: all 0.3s ease;
            --border-radius: 12px;
        }

        [data-theme="dark"] {
            --primary: #3b82f6;
            --primary-dark: #2563eb;
            --primary-light: #60a5fa;
            --secondary: #f59e0b;
            --background: #1f2937;
            --background-alt: #111827;
            --text: #f3f4f6;
            --text-light: #9ca3af;
            --card-bg: #374151;
            --shadow: rgba(0, 0, 0, 0.2);
            --shadow-hover: rgba(0, 0, 0, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f0f4ff 0%, #e6f0ff 100%);
            color: var(--text);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: var(--transition);
        }

        [data-theme="dark"] body {
            background: linear-gradient(135deg, #111827 0%, #1f2937 100%);
        }

        .container {
            width: 100%;
            max-width: 1000px;
            background: var(--background);
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: 0 12px 40px var(--shadow);
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 20px;
            transition: var(--transition);
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: var(--background-alt);
            border-radius: var(--border-radius);
            box-shadow: 0 4px 6px var(--shadow);
            transition: var(--transition);
            position: relative;
        }

        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 15px;
        }

        .logo-icon {
            font-size: 2.2rem;
            color: var(--primary);
            transition: var(--transition);
        }

        h1 {
            font-size: 2.4rem;
            margin-bottom: 10px;
            color: var(--primary);
            font-weight: 700;
            transition: var(--transition);
        }

        .tagline {
            font-size: 1.1rem;
            color: var(--text-light);
            max-width: 600px;
            margin: 0 auto;
            transition: var(--transition);
        }

        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: var(--card-bg);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 4px var(--shadow);
            transition: var(--transition);
        }

        .theme-toggle:hover {
            transform: rotate(15deg);
        }

        nav {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .nav-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            background: var(--card-bg);
            color: var(--text);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 2px 4px var(--shadow);
            border: 1px solid transparent;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-btn:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px var(--shadow-hover);
        }

        .nav-btn.active {
            background: var(--primary);
            color: white;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Test Configuration */
        .test-config {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 25px 0;
            flex-wrap: wrap;
        }

        .config-card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 6px var(--shadow);
            text-align: center;
            min-width: 180px;
            border: 1px solid transparent;
            transition: var(--transition);
        }

        .config-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px var(--shadow-hover);
        }

        .config-card h3 {
            margin-bottom: 15px;
            color: var(--primary);
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .time-options {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .time-option {
            padding: 8px 15px;
            border-radius: 6px;
            background: var(--background-alt);
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
        }

        .time-option.active {
            background: var(--primary);
            color: white;
        }

        /* Test Area */
        .timer-container {
            position: relative;
            margin: 25px 0;
        }

        .timer {
            font-size: 3.2rem;
            text-align: center;
            font-weight: 700;
            color: var(--primary);
            font-variant-numeric: tabular-nums;
            transition: var(--transition);
        }

        .progress-ring {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .progress-ring__circle {
            transition: stroke-dashoffset 0.5s linear;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }

        .text-display-container {
            position: relative;
            margin-bottom: 25px;
        }

        .text-display {
            background: var(--card-bg);
            padding: 30px;
            border-radius: var(--border-radius);
            min-height: 180px;
            font-size: 1.5rem;
            line-height: 1.6;
            box-shadow: 0 4px 6px var(--shadow);
            border: 1px solid transparent;
            text-align: left;
            transition: var(--transition);
            overflow: hidden;
            position: relative;
        }

        .current-word {
            background: var(--primary);
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            transition: var(--transition);
        }

        .cursor {
            display: inline-block;
            width: 2px;
            height: 1.2em;
            background: var(--primary);
            vertical-align: middle;
            margin-left: 1px;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }

        .input-area {
            width: 100%;
            margin-bottom: 25px;
            position: relative;
        }

        #typing-input {
            width: 100%;
            padding: 18px;
            border-radius: var(--border-radius);
            border: 2px solid var(--background-alt);
            background: var(--card-bg);
            color: var(--text);
            font-size: 1.3rem;
            outline: none;
            transition: var(--transition);
            box-shadow: 0 2px 4px var(--shadow);
        }

        #typing-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }

        .input-hint {
            text-align: center;
            color: var(--text-light);
            margin-top: 10px;
            font-size: 0.9rem;
            transition: var(--transition);
        }

        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
        }

        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px var(--shadow-hover);
        }

        .btn-secondary {
            background: var(--card-bg);
            color: var(--text);
            border: 1px solid var(--background-alt);
        }

        .btn-secondary:hover {
            background: var(--background-alt);
            transform: translateY(-2px);
        }

        .results {
            text-align: center;
            padding: 25px;
            background: var(--background-alt);
            border-radius: var(--border-radius);
            box-shadow: 0 4px 6px var(--shadow);
            margin-top: 20px;
            display: none;
            transition: var(--transition);
        }

        .results.show {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .metrics {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .metric {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .value {
            font-size: 2.8rem;
            font-weight: 700;
            color: var(--primary);
            transition: var(--transition);
        }

        .label {
            font-size: 1rem;
            color: var(--text-light);
            margin-top: 5px;
            transition: var(--transition);
        }

        .result-details {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .result-card {
            background: var(--card-bg);
            padding: 15px;
            border-radius: var(--border-radius);
            min-width: 120px;
            box-shadow: 0 2px 4px var(--shadow);
            transition: var(--transition);
        }

        .result-card h4 {
            color: var(--text-light);
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .result-card p {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text);
        }

        /* Practice Section */
        .practice-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .practice-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 25px;
        }

        .practice-card {
            background: var(--card-bg);
            padding: 25px;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 6px var(--shadow);
            transition: var(--transition);
            border: 1px solid transparent;
        }

        .practice-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px var(--shadow-hover);
        }

        .practice-card h3 {
            margin-bottom: 15px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .practice-card i {
            font-size: 1.4rem;
            color: var(--primary);
        }

        /* Stats Section */
        .stats-container {
            margin-top: 30px;
        }

        .stats-chart {
            background: var(--card-bg);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 6px var(--shadow);
            margin-bottom: 20px;
        }

        .stats-history {
            display: flex;
            gap: 15px;
            overflow-x: auto;
            padding: 10px 0;
        }

        .history-item {
            background: var(--background-alt);
            padding: 15px;
            border-radius: var(--border-radius);
            min-width: 150px;
            text-align: center;
            box-shadow: 0 2px 4px var(--shadow);
        }

        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: var(--text-light);
            font-size: 0.9rem;
            transition: var(--transition);
        }

        .correct {
            color: var(--correct);
            font-weight: 600;
        }

        .incorrect {
            color: var(--incorrect);
            text-decoration: underline;
            background: rgba(239, 68, 68, 0.1);
        }

        /* Keyboard Visualization */
        .keyboard-container {
            margin-top: 30px;
            background: var(--card-bg);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 6px var(--shadow);
        }

        .keyboard-row {
            display: flex;
            justify-content: center;
            margin-bottom: 8px;
        }

        .key {
            width: 40px;
            height: 40px;
            margin: 0 4px;
            background: var(--background-alt);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            box-shadow: 0 2px 0px rgba(0, 0, 0, 0.1);
            transition: var(--transition);
        }

        .key-wide {
            width: 70px;
        }

        .key-extra-wide {
            width: 100px;
        }

        .key-space {
            width: 250px;
        }

        .key-active {
            background: var(--primary);
            color: white;
            transform: translateY(2px);
            box-shadow: 0 0 0px rgba(0, 0, 0, 0.1);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .text-display {
                font-size: 1.3rem;
                padding: 20px;
            }
            
            .metrics {
                gap: 20px;
            }
            
            .value {
                font-size: 2.2rem;
            }
            
            .timer {
                font-size: 2.8rem;
            }
        }

        @media (max-width: 480px) {
            .test-config {
                flex-direction: column;
                align-items: center;
            }
            
            .config-card {
                width: 100%;
            }
            
            .timer {
                font-size: 2.5rem;
            }
            
            .text-display {
                font-size: 1.1rem;
            }
            
            #typing-input {
                font-size: 1.1rem;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-keyboard logo-icon"></i>
                <h1>Typo Master</h1>
            </div>
            <p class="tagline">Professional typing speed test and practice platform to enhance your productivity</p>
            <button class="theme-toggle" id="theme-toggle">
                <i class="fas fa-moon"></i>
            </button>
        </header>

        <nav>
            <button class="nav-btn active" data-target="test">
                <i class="fas fa-tachometer-alt"></i> Speed Test
            </button>
            <button class="nav-btn" data-target="practice">
                <i class="fas fa-graduation-cap"></i> Practice
            </button>
            <button class="nav-btn" data-target="stats">
                <i class="fas fa-chart-line"></i> Statistics
            </button>
        </nav>

        <!-- Speed Test Section -->
        <section id="test" class="section active">
            <div class="test-config">
                <div class="config-card">
                    <h3><i class="fas fa-clock"></i> Test Duration</h3>
                    <div class="time-options">
                        <div class="time-option active" data-time="1">1 min</div>
                        <div class="time-option" data-time="2">2 min</div>
                        <div class="time-option" data-time="5">5 min</div>
                    </div>
                </div>
                <div class="config-card">
                    <h3><i class="fas fa-file-alt"></i> Text Difficulty</h3>
                    <div class="time-options">
                        <div class="time-option active" data-difficulty="easy">Easy</div>
                        <div class="time-option" data-difficulty="medium">Medium</div>
                        <div class="time-option" data-difficulty="hard">Hard</div>
                    </div>
                </div>
            </div>

            <div class="timer-container">
                <svg class="progress-ring" width="120" height="120">
                    <circle class="progress-ring__circle" stroke="var(--primary-light)" stroke-width="4" fill="transparent" r="52" cx="60" cy="60"/>
                </svg>
                <div class="timer">01:00</div>
            </div>
            
            <div class="text-display-container">
                <div class="text-display">
                    Press start to begin the test. You'll have one minute to type as many words as possible. Focus on accuracy as well as speed!
                </div>
            </div>
            
            <div class="input-area">
                <input type="text" id="typing-input" placeholder="Click here and press start to begin..." disabled>
                <p class="input-hint">Press Space after each word | Press Ctrl+Enter to restart</p>
            </div>
            
            <div class="action-buttons">
                <button id="start-btn" class="btn btn-primary">
                    <i class="fas fa-play"></i> Start Test
                </button>
                <button id="reset-btn" class="btn btn-secondary" disabled>
                    <i class="fas fa-redo"></i> Reset
                </button>
            </div>
            
            <div class="keyboard-container" id="keyboard">
                <!-- Keyboard will be generated by JavaScript -->
            </div>
            
            <div class="results" id="results">
                <h2><i class="fas fa-medal"></i> Test Results</h2>
                <div class="metrics">
                    <div class="metric">
                        <div class="value" id="wpm">0</div>
                        <div class="label">Words Per Minute</div>
                    </div>
                    <div class="metric">
                        <div class="value" id="accuracy">0%</div>
                        <div class="label">Accuracy</div>
                    </div>
                    <div class="metric">
                        <div class="value" id="errors">0</div>
                        <div class="label">Errors</div>
                    </div>
                </div>
                
                <div class="result-details">
                    <div class="result-card">
                        <h4>Time</h4>
                        <p id="result-time">1:00</p>
                    </div>
                    <div class="result-card">
                        <h4>Characters</h4>
                        <p id="result-chars">0</p>
                    </div>
                    <div class="result-card">
                        <h4>Words</h4>
                        <p id="result-words">0</p>
                    </div>
                </div>
                
                <button id="new-test-btn" class="btn btn-primary">
                    <i class="fas fa-plus"></i> New Test
                </button>
            </div>
        </section>

        <!-- Practice Tips Section -->
        <section id="practice" class="section">
            <div class="practice-header">
                <h2><i class="fas fa-graduation-cap"></i> Typing Practice & Techniques</h2>
                <p>Improve your typing speed and accuracy with these professional techniques</p>
            </div>
            <div class="practice-grid">
                <div class="practice-card">
                    <h3><i class="fas fa-hands"></i> Proper Posture</h3>
                    <p>Sit up straight with your feet flat on the floor. Keep your elbows at a 90-degree angle and your wrists slightly elevated. This position reduces strain and improves typing efficiency.</p>
                </div>
                <div class="practice-card">
                    <h3><i class="fas fa-home"></i> Home Row Position</h3>
                    <p>Always return your fingers to the home row (ASDF for left hand, JKL; for right hand). This is your anchor point for efficient keyboard navigation without looking.</p>
                </div>
                <div class="practice-card">
                    <h3><i class="fas fa-sync-alt"></i> Consistent Practice</h3>
                    <p>Regular practice is essential for muscle memory. Even 15-20 minutes daily can significantly improve your typing speed and accuracy over time.</p>
                </div>
                <div class="practice-card">
                    <h3><i class="fas fa-blind"></i> Touch Typing</h3>
                    <p>Develop the skill of typing without looking at the keyboard. Use the tactile markers on the F and J keys to position your fingers correctly.</p>
                </div>
                <div class="practice-card">
                    <h3><i class="fas fa-hands-helping"></i> Use All Fingers</h3>
                    <p>Assign each finger specific keys to press. This distributes the work evenly and increases typing efficiency and speed.</p>
                </div>
                <div class="practice-card">
                    <h3><i class="fas fa-couch"></i> Take Breaks</h3>
                    <p>Avoid strain by taking regular breaks during long typing sessions. Practice the 20-20-20 rule: every 20 minutes, look at something 20 feet away for 20 seconds.</p>
                </div>
            </div>
        </section>

        <!-- Statistics Section -->
        <section id="stats" class="section">
            <div class="practice-header">
                <h2><i class="fas fa-chart-line"></i> Your Typing Statistics</h2>
                <p>Track your progress and identify areas for improvement</p>
            </div>
            
            <div class="stats-container">
                <div class="stats-chart">
                    <canvas id="stats-chart" height="150"></canvas>
                </div>
                
                <h3>Recent Tests</h3>
                <div class="stats-history" id="stats-history">
                    <div class="history-item">
                        <h4>WPM</h4>
                        <p class="value">42</p>
                        <p class="label">Accuracy: 95%</p>
                    </div>
                    <div class="history-item">
                        <h4>WPM</h4>
                        <p class="value">48</p>
                        <p class="label">Accuracy: 92%</p>
                    </div>
                    <div class="history-item">
                        <h4>WPM</h4>
                        <p class="value">52</p>
                        <p class="label">Accuracy: 96%</p>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <footer>
        <p>© 2023 Typo Master | Professional Typing Test Platform</p>
    </footer>

    <script>
        // Enhanced sample texts for different difficulty levels
        const sampleTexts = {
            easy: [
                "The quick brown fox jumps over the lazy dog. Programming is both an art and a science. Typing quickly and accurately is an essential skill for developers.",
                "Practice makes perfect when it comes to improving your typing speed. Consistency is key to developing muscle memory. Keep your eyes on the text and not on your keyboard.",
                "Coding is the language of the future. Every developer should focus on typing accuracy and speed. The more you practice the better you become at typing code.",
                "Web development requires precision and attention to detail. Typing speed matters when working on tight deadlines. Always strive to improve your skills every day.",
                "JavaScript is the programming language of the web. HTML and CSS are essential for frontend development. React and Vue are popular frameworks for building user interfaces."
            ],
            medium: [
                "Algorithmic thinking is crucial for problem solving in software development. Data structures like arrays and linked lists form the foundation of computer science.",
                "Asynchronous programming allows JavaScript to handle multiple operations without blocking the execution thread. Promises and async/await are modern solutions to callback hell.",
                "Responsive web design ensures that applications render well on a variety of devices and window sizes. CSS Flexbox and Grid are powerful layout modules for creating adaptive UIs.",
                "Version control systems like Git enable developers to collaborate on projects efficiently. Branching strategies and pull requests facilitate code review and integration.",
                "RESTful APIs provide a standardized way for systems to communicate over HTTP. JSON has become the ubiquitous data format for web API payloads due to its simplicity."
            ],
            hard: [
                "Quantum computing leverages quantum mechanics to process information in fundamentally new ways. Qubits can exist in superposition states enabling parallel computation.",
                "Machine learning algorithms can identify patterns in data without being explicitly programmed. Neural networks with multiple hidden layers constitute deep learning architectures.",
                "Containerization with Docker provides lightweight virtualization by packaging applications with their dependencies. Kubernetes orchestrates container deployment across clusters.",
                "Functional programming paradigms emphasize immutable data and pure functions without side effects. Higher-order functions and recursion replace iterative looping constructs.",
                "GraphQL provides a query language for APIs that allows clients to request exactly the data they need. This eliminates over-fetching and under-fetching common in REST implementations."
            ]
        };

        // DOM Elements
        const navBtns = document.querySelectorAll('.nav-btn');
        const sections = document.querySelectorAll('.section');
        const startBtn = document.getElementById('start-btn');
        const resetBtn = document.getElementById('reset-btn');
        const newTestBtn = document.getElementById('new-test-btn');
        const typingInput = document.getElementById('typing-input');
        const textDisplay = document.querySelector('.text-display');
        const timerDisplay = document.querySelector('.timer');
        const resultsDiv = document.getElementById('results');
        const timeOptions = document.querySelectorAll('.time-option');
        const difficultyOptions = document.querySelectorAll('.time-option[data-difficulty]');
        const themeToggle = document.getElementById('theme-toggle');
        const progressCircle = document.querySelector('.progress-ring__circle');
        const keyboardContainer = document.getElementById('keyboard');
        const wpmElement = document.getElementById('wpm');
        const accuracyElement = document.getElementById('accuracy');
        const errorsElement = document.getElementById('errors');
        const resultTimeElement = document.getElementById('result-time');
        const resultCharsElement = document.getElementById('result-chars');
        const resultWordsElement = document.getElementById('result-words');

        // Variables for test
        let timer;
        let timeLeft = 60;
        let selectedTime = 60;
        let selectedDifficulty = 'easy';
        let words = [];
        let currentWordIndex = 0;
        let correctChars = 0;
        let totalChars = 0;
        let started = false;
        let currentTextSet = 0;
        let startTime = 0;
        let endTime = 0;
        let testHistory = [];
        let progressInterval;
        let radius = 52;
        let circumference = 2 * Math.PI * radius;

        // Initialize progress ring
        if (progressCircle) {
            progressCircle.style.strokeDasharray = `${circumference} ${circumference}`;
            progressCircle.style.strokeDashoffset = `${circumference}`;
        }

        // Initialize
        function init() {
            loadNewText();
            setupEventListeners();
            generateKeyboard();
            loadTestHistory();
            setTheme(localStorage.getItem('theme') || 'light');
        }

        // Set theme
        function setTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
            
            if (theme === 'dark') {
                themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
            } else {
                themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
            }
        }

        // Generate keyboard visualization
        function generateKeyboard() {
            if (!keyboardContainer) return;
            
            const keyboardLayout = [
                ['1', '2', '3', '4', '5', '6', '7', '8', '9', '0', 'Backspace'],
                ['q', 'w', 'e', 'r', 't', 'y', 'u', 'i', 'o', 'p'],
                ['a', 's', 'd', 'f', 'g', 'h', 'j', 'k', 'l', 'Enter'],
                ['z', 'x', 'c', 'v', 'b', 'n', 'm', ',', '.', '?'],
                ['Space']
            ];
            
            keyboardContainer.innerHTML = '';
            
            keyboardLayout.forEach(row => {
                const rowElement = document.createElement('div');
                rowElement.className = 'keyboard-row';
                
                row.forEach(key => {
                    const keyElement = document.createElement('div');
                    keyElement.className = 'key';
                    keyElement.textContent = key;
                    
                    if (key === 'Backspace') keyElement.className += ' key-wide';
                    if (key === 'Enter') keyElement.className += ' key-wide';
                    if (key === 'Space') keyElement.className += ' key-space';
                    
                    keyElement.setAttribute('data-key', key.toLowerCase());
                    rowElement.appendChild(keyElement);
                });
                
                keyboardContainer.appendChild(rowElement);
            });
        }

        // Update keyboard visualization
        function updateKeyboard(key, isActive) {
            const keyElement = document.querySelector(`.key[data-key="${key.toLowerCase()}"]`);
            if (keyElement) {
                if (isActive) {
                    keyElement.classList.add('key-active');
                } else {
                    keyElement.classList.remove('key-active');
                }
            }
        }

        // Load new text for typing
        function loadNewText() {
            // Cycle through text sets for variety
            currentTextSet = (currentTextSet + 1) % sampleTexts[selectedDifficulty].length;
            const text = sampleTexts[selectedDifficulty][currentTextSet];
            words = text.split(' ');
            renderWords();
        }

        // Render words for typing
        function renderWords() {
            textDisplay.innerHTML = words.map((word, index) => {
                return `<span class="word" id="word-${index}">${word} </span>`;
            }).join('');
            
            // Highlight the first word
            if (words.length > 0) {
                document.getElementById(`word-0`).classList.add('current-word');
            }
        }

        // Set up event listeners
        function setupEventListeners() {
            // Navigation
            navBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const target = btn.getAttribute('data-target');
                    
                    // Update active button
                    navBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    
                    // Show target section
                    sections.forEach(section => {
                        section.classList.remove('active');
                        if (section.id === target) {
                            section.classList.add('active');
                        }
                    });
                });
            });

            // Theme toggle
            themeToggle.addEventListener('click', () => {
                const currentTheme = document.documentElement.getAttribute('data-theme');
                setTheme(currentTheme === 'dark' ? 'light' : 'dark');
            });

            // Time options
            timeOptions.forEach(option => {
                option.addEventListener('click', function() {
                    const time = this.getAttribute('data-time');
                    const difficulty = this.getAttribute('data-difficulty');
                    
                    if (time) {
                        // Update time options
                        document.querySelectorAll('.time-option[data-time]').forEach(opt => {
                            opt.classList.remove('active');
                        });
                        this.classList.add('active');
                        
                        // Update selected time
                        selectedTime = parseInt(time) * 60;
                        timeLeft = selectedTime;
                        timerDisplay.textContent = formatTime(timeLeft);
                    }
                    
                    if (difficulty) {
                        // Update difficulty options
                        document.querySelectorAll('.time-option[data-difficulty]').forEach(opt => {
                            opt.classList.remove('active');
                        });
                        this.classList.add('active');
                        
                        // Update selected difficulty and load new text
                        selectedDifficulty = difficulty;
                        loadNewText();
                    }
                });
            });

            // Start test
            startBtn.addEventListener('click', startTest);

            // Reset test
            resetBtn.addEventListener('click', resetTest);

            // New test
            newTestBtn.addEventListener('click', newTest);

            // Typing input
            typingInput.addEventListener('input', handleTyping);
            
            // Keydown events for keyboard visualization
            typingInput.addEventListener('keydown', (e) => {
                updateKeyboard(e.key, true);
            });
            
            typingInput.addEventListener('keyup', (e) => {
                updateKeyboard(e.key, false);
            });

            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                // Ctrl + Enter to restart test
                if (e.ctrlKey && e.key === 'Enter') {
                    resetTest();
                }
                
                // Escape to focus input
                if (e.key === 'Escape') {
                    typingInput.focus();
                }
            });
        }

        // Start the test
        function startTest() {
            if (started) return;
            
            started = true;
            startBtn.disabled = true;
            resetBtn.disabled = false;
            typingInput.disabled = false;
            typingInput.focus();
            startTime = Date.now();
            
            // Set progress ring
            if (progressCircle) {
                progressCircle.style.strokeDashoffset = 0;
            }
            
            // Start timer
            timer = setInterval(() => {
                timeLeft--;
                timerDisplay.textContent = formatTime(timeLeft);
                
                // Update progress ring
                if (progressCircle) {
                    const offset = circumference - (timeLeft / selectedTime) * circumference;
                    progressCircle.style.strokeDashoffset = offset;
                }
                
                if (timeLeft <= 0) {
                    endTest();
                }
            }, 1000);
        }

        // Format time as MM:SS
        function formatTime(seconds) {
            return `${Math.floor(seconds / 60).toString().padStart(2, '0')}:${(seconds % 60).toString().padStart(2, '0')}`;
        }

        // Handle typing input
        function handleTyping() {
            if (!started) return;
            
            const typedValue = typingInput.value;
            const currentWord = words[currentWordIndex];
            
            // Check if space was pressed (word completed)
            if (typedValue.endsWith(' ')) {
                // Move to next word
                typingInput.value = '';
                currentWordIndex++;
                totalChars += currentWord.length;
                
                // Update word highlighting
                document.querySelectorAll('.word').forEach(word => {
                    word.classList.remove('current-word');
                });
                
                if (currentWordIndex < words.length) {
                    document.getElementById(`word-${currentWordIndex}`).classList.add('current-word');
                }
                
                // If we've reached the end of the text, load new text
                if (currentWordIndex >= words.length) {
                    loadNewText();
                    currentWordIndex = 0;
                    document.getElementById(`word-0`).classList.add('current-word');
                }
            }
            
            // Update character highlighting
            highlightChars(typedValue, currentWord);
            
            // Calculate WPM and accuracy in real-time
            updateMetrics();
        }

        // Highlight correct/incorrect characters
        function highlightChars(typed, target) {
            if (!target) return;
            
            const currentWordElement = document.getElementById(`word-${currentWordIndex}`);
            if (!currentWordElement) return;
            
            let html = '';
            
            for (let i = 0; i < target.length; i++) {
                if (i < typed.length) {
                    if (typed[i] === target[i]) {
                        html += `<span class="correct">${target[i]}</span>`;
                    } else {
                        html += `<span class="incorrect">${target[i]}</span>`;
                    }
                } else {
                    html += target[i];
                }
            }
            
            // Add space for word separation
            currentWordElement.innerHTML = html + ' ';
        }

        // Update WPM and accuracy metrics
        function updateMetrics() {
            // Calculate WPM (assuming 5 characters per word)
            const minutesPassed = (selectedTime - timeLeft) / 60;
            const wpm = minutesPassed > 0 ? Math.round((correctChars / 5) / minutesPassed) : 0;
            
            // Calculate accuracy
            const accuracy = totalChars > 0 ? Math.round((correctChars / totalChars) * 100) : 0;
            
            // Update display
            wpmElement.textContent = wpm;
            accuracyElement.textContent = `${accuracy}%`;
            errorsElement.textContent = totalChars - correctChars;
        }

        // End the test
        function endTest() {
            clearInterval(timer);
            started = false;
            typingInput.disabled = true;
            startBtn.disabled = false;
            endTime = Date.now();
            
            // Final metrics calculation
            updateMetrics();
            
            // Update result details
            resultTimeElement.textContent = formatTime(selectedTime);
            resultCharsElement.textContent = totalChars;
            resultWordsElement.textContent = Math.round(totalChars / 5);
            
            // Save test results
            saveTestResult();
            
            // Show results
            resultsDiv.classList.add('show');
        }

        // Save test result to history
        function saveTestResult() {
            const result = {
                wpm: parseInt(wpmElement.textContent),
                accuracy: parseInt(accuracyElement.textContent),
                errors: parseInt(errorsElement.textContent),
                timestamp: Date.now(),
                duration: selectedTime,
                difficulty: selectedDifficulty
            };
            
            testHistory.push(result);
            localStorage.setItem('typingTestHistory', JSON.stringify(testHistory));
            updateTestHistory();
        }

        // Load test history from localStorage
        function loadTestHistory() {
            const history = localStorage.getItem('typingTestHistory');
            if (history) {
                testHistory = JSON.parse(history);
                updateTestHistory();
            }
        }

        // Update test history display
        function updateTestHistory() {
            const historyContainer = document.getElementById('stats-history');
            if (!historyContainer) return;
            
            // Clear existing history
            historyContainer.innerHTML = '';
            
            // Add recent tests (last 5)
            const recentTests = testHistory.slice(-5);
            
            recentTests.forEach(test => {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                
                const date = new Date(test.timestamp);
                const formattedDate = `${date.getMonth()+1}/${date.getDate()}`;
                
                historyItem.innerHTML = `
                    <h4>${formattedDate}</h4>
                    <p class="value">${test.wpm} WPM</p>
                    <p class="label">Accuracy: ${test.accuracy}%</p>
                `;
                
                historyContainer.appendChild(historyItem);
            });
        }

        // Reset the test
        function resetTest() {
            clearInterval(timer);
            timeLeft = selectedTime;
            timerDisplay.textContent = formatTime(timeLeft);
            currentWordIndex = 0;
            correctChars = 0;
            totalChars = 0;
            started = false;
            
            typingInput.value = '';
            typingInput.disabled = true;
            startBtn.disabled = false;
            resetBtn.disabled = true;
            
            // Reset progress ring
            if (progressCircle) {
                progressCircle.style.strokeDashoffset = `${circumference}`;
            }
            
            // Hide results
            resultsDiv.classList.remove('show');
            
            // Load new text for a fresh experience
            loadNewText();
        }

        // Start a new test
        function newTest() {
            resetTest();
            resultsDiv.classList.remove('show');
        }

        // Initialize the app
        init();
    </script>
</body>
</html>
