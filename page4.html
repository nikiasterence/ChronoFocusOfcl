<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notes App with OptiChain AI</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #007AFF;
            --background-color: #f5f5f7;
            --text-color: #1d1d1f;
            --sidebar-bg: #f2f2f7;
            --note-bg: #ffffff;
            --border-color: #c6c6c8;
            --radius: 16px;
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            --glass-bg: rgba(255, 255, 255, 0.25);
            --glass-border: 1px solid rgba(255, 255, 255, 0.18);
        }

        /* Theme Variables */
        .theme-cotton-candy {
            --primary-color: #FF9FF3;
            --background-color: #F8F9FA;
            --text-color: #2C2C54;
            --sidebar-bg: #FDEBF7;
            --note-bg: #FFFFFF;
            --border-color: #FFC8F0;
            --glass-bg: rgba(255, 255, 255, 0.7);
        }

        .theme-midnight {
            --primary-color: #5DADE2;
            --background-color: #1C2833;
            --text-color: #EAECEE;
            --sidebar-bg: #2C3E50;
            --note-bg: #34495E;
            --border-color: #5D6D7E;
            --glass-bg: rgba(44, 62, 80, 0.7);
        }

        .theme-golden {
            --primary-color: #D4AF37;
            --background-color: #FEF9E7;
            --text-color: #5D4037;
            --sidebar-bg: #FFF8E1;
            --note-bg: #FFFFFF;
            --border-color: #FFD54F;
            --glass-bg: rgba(255, 255, 255, 0.7);
        }

        .theme-extra-dark {
            --primary-color: #BB86FC;
            --background-color: #121212;
            --text-color: #E1E1E1;
            --sidebar-bg: #1E1E1E;
            --note-bg: #2D2D2D;
            --border-color: #383838;
            --glass-bg: rgba(45, 45, 45, 0.7);
        }

        .theme-white-blue {
            --primary-color: #007AFF;
            --background-color: #FFFFFF;
            --text-color: #1D1D1F;
            --sidebar-bg: #F2F2F7;
            --note-bg: #FFFFFF;
            --border-color: #C6C6C8;
            --glass-bg: rgba(255, 255, 255, 0.7);
        }

        .theme-blue {
            --primary-color: #0056CC;
            --background-color: #E6F2FF;
            --text-color: #003366;
            --sidebar-bg: #D1E7FF;
            --note-bg: #FFFFFF;
            --border-color: #99CCFF;
            --glass-bg: rgba(255, 255, 255, 0.7);
        }

        .theme-nature {
            --primary-color: #4CAF50;
            --background-color: #E8F5E9;
            --text-color: #1B5E20;
            --sidebar-bg: #C8E6C9;
            --note-bg: #FFFFFF;
            --border-color: #81C784;
            --glass-bg: rgba(255, 255, 255, 0.7);
        }

        .theme-sunset {
            --primary-color: #FF6B6B;
            --background-color: #FFF5F5;
            --text-color: #C53030;
            --sidebar-bg: #FFE6E6;
            --note-bg: #FFFFFF;
            --border-color: #FC8181;
            --glass-bg: rgba(255, 255, 255, 0.7);
        }

        .theme-ocean {
            --primary-color: #4FC3F7;
            --background-color: #E1F5FE;
            --text-color: #0277BD;
            --sidebar-bg: #B3E5FC;
            --note-bg: #FFFFFF;
            --border-color: #4FC3F7;
            --glass-bg: rgba(255, 255, 255, 0.7);
        }

        .theme-lavender {
            --primary-color: #9C27B0;
            --background-color: #F3E5F5;
            --text-color: #4A148C;
            --sidebar-bg: #E1BEE7;
            --note-bg: #FFFFFF;
            --border-color: #BA68C8;
            --glass-bg: rgba(255, 255, 255, 0.7);
        }

        .theme-forest {
            --primary-color: #388E3C;
            --background-color: #E8F5E9;
            --text-color: #1B5E20;
            --sidebar-bg: #C8E6C9;
            --note-bg: #FFFFFF;
            --border-color: #81C784;
            --glass-bg: rgba(255, 255, 255, 0.7);
        }

        .theme-rose {
            --primary-color: #E91E63;
            --background-color: #FCE4EC;
            --text-color: #880E4F;
            --sidebar-bg: #F8BBD0;
            --note-bg: #FFFFFF;
            --border-color: #F48FB1;
            --glass-bg: rgba(255, 255, 255, 0.7);
        }

        .theme-coffee {
            --primary-color: #795548;
            --background-color: #EFEBE9;
            --text-color: #3E2723;
            --sidebar-bg: #D7CCC8;
            --note-bg: #FFFFFF;
            --border-color: #A1887F;
            --glass-bg: rgba(255, 255, 255, 0.7);
        }

        .theme-space {
            --primary-color: #7E57C2;
            --background-color: #0D0D1A;
            --text-color: #E1E1FF;
            --sidebar-bg: #1A1A2E;
            --note-bg: #2D2D44;
            --border-color: #4A4A6A;
            --glass-bg: rgba(45, 45, 68, 0.7);
        }

        .theme-crimson {
            --primary-color: #DC143C;
            --background-color: #FFF0F5;
            --text-color: #8B0000;
            --sidebar-bg: #FFE4E1;
            --note-bg: #FFFFFF;
            --border-color: #F08080;
            --glass-bg: rgba(255, 255, 255, 0.7);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }

        body {
            background-color: var(--background-color);
            color: var(--text-color);
            height: 100vh;
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .app-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 20px;
            border-bottom: 1px solid var(--border-color);
            background-color: var(--note-bg);
            border-radius: 0 0 var(--radius) var(--radius);
            box-shadow: var(--shadow);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            background: var(--glass-bg);
            border: var(--glass-border);
        }

        .app-title {
            font-size: 22px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .app-title i {
            color: var(--primary-color);
        }

        .header-controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .settings-btn, .ai-toggle-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: var(--radius);
            cursor: pointer;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .settings-btn:hover, .ai-toggle-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .app-container {
            display: flex;
            flex: 1;
            overflow: hidden;
            padding: 10px;
            gap: 10px;
        }

        .sidebar {
            width: 300px;
            background-color: var(--sidebar-bg);
            border-radius: var(--radius);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: var(--shadow);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            background: var(--glass-bg);
            border: var(--glass-border);
        }

        .sidebar-header {
            padding: 15px 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .new-note-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: var(--radius);
            cursor: pointer;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .new-note-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .notes-list {
            flex: 1;
            overflow-y: auto;
            padding: 10px 0;
        }

        .note-item {
            padding: 15px 20px;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 0;
        }

        .note-item:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }

        .note-item.active {
            background-color: rgba(0, 122, 255, 0.1);
            border-left: 3px solid var(--primary-color);
        }

        .note-item-content {
            flex: 1;
            overflow: hidden;
        }

        .note-title {
            font-weight: 600;
            margin-bottom: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .note-preview {
            font-size: 13px;
            color: #8E8E93;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .note-actions {
            display: flex;
            gap: 5px;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .note-item:hover .note-actions {
            opacity: 1;
        }

        .delete-btn, .lock-btn {
            background: none;
            border: none;
            color: #8E8E93;
            cursor: pointer;
            padding: 5px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .lock-btn.locked {
            color: var(--primary-color);
        }

        .delete-btn:hover {
            background-color: rgba(255, 59, 48, 0.1);
            color: #FF3B30;
        }

        .lock-btn:hover {
            background-color: rgba(0, 122, 255, 0.1);
            color: var(--primary-color);
        }

        .note-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            background: var(--glass-bg);
            border: var(--glass-border);
        }

        .note-header {
            padding: 15px 25px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .note-title-input {
            flex: 1;
            background: transparent;
            border: none;
            font-size: 20px;
            font-weight: 600;
            color: var(--text-color);
            outline: none;
        }

        .note-title-input::placeholder {
            color: #8E8E93;
        }

        .writing-tools {
            display: flex;
            gap: 10px;
            padding: 10px 25px;
            border-bottom: 1px solid var(--border-color);
            background-color: var(--note-bg);
            flex-wrap: wrap;
        }

        .tool-group {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 5px 10px;
            border-radius: var(--radius);
            background-color: var(--sidebar-bg);
        }

        .tool-btn {
            background: none;
            border: none;
            color: var(--text-color);
            cursor: pointer;
            padding: 5px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .tool-btn:hover {
            background-color: rgba(0, 0, 0, 0.1);
            transform: scale(1.05);
        }

        .tool-btn.active {
            background-color: var(--primary-color);
            color: white;
        }

        .font-select, .size-select {
            background-color: var(--sidebar-bg);
            border: 1px solid var(--border-color);
            color: var(--text-color);
            border-radius: 8px;
            padding: 4px 8px;
            outline: none;
        }

        .note-editor {
            flex: 1;
            padding: 20px 25px;
            overflow-y: auto;
            background-color: var(--note-bg);
        }

        .note-editor-content {
            min-height: 100%;
            outline: none;
            line-height: 1.6;
            font-size: 16px;
        }

        .note-editor-content img {
            max-width: 100%;
            border-radius: 8px;
            margin: 10px 0;
        }

        .highlight {
            background-color: yellow;
            padding: 2px;
            border-radius: 3px;
        }

        .ai-panel {
            width: 350px;
            background-color: var(--sidebar-bg);
            border-radius: var(--radius);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: all 0.3s ease;
            box-shadow: var(--shadow);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            background: var(--glass-bg);
            border: var(--glass-border);
        }

        .ai-panel.hidden {
            transform: translateX(100%);
            width: 0;
            border-left: none;
        }

        .ai-header {
            padding: 15px 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .ai-title {
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .ai-badge {
            background-color: var(--primary-color);
            color: white;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
        }

        .ai-actions {
            padding: 15px 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-height: 200px;
            overflow-y: auto;
        }

        .ai-action-btn {
            background-color: var(--note-bg);
            border: 1px solid var(--border-color);
            color: var(--text-color);
            padding: 10px 15px;
            border-radius: var(--radius);
            cursor: pointer;
            text-align: left;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.2s;
        }

        .ai-action-btn:hover {
            background-color: rgba(0, 0, 0, 0.05);
            transform: translateX(5px);
        }

        .ai-output {
            flex: 1;
            padding: 15px 20px;
            overflow-y: auto;
            border-top: 1px solid var(--border-color);
        }

        .ai-response {
            background-color: var(--note-bg);
            padding: 15px;
            border-radius: var(--radius);
            margin-bottom: 15px;
            font-size: 14px;
            line-height: 1.5;
            white-space: pre-line;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .ai-prompt {
            display: flex;
            gap: 10px;
            padding: 15px 20px;
            border-top: 1px solid var(--border-color);
        }

        .ai-input {
            flex: 1;
            background-color: var(--note-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            padding: 10px 15px;
            color: var(--text-color);
            outline: none;
        }

        .ai-send-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--radius);
            padding: 10px 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .ai-send-btn:hover {
            transform: scale(1.05);
        }

        .hidden {
            display: none;
        }

        .emoji-picker {
            position: absolute;
            background: var(--note-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            padding: 10px;
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 5px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 100;
            box-shadow: var(--shadow);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            background: var(--glass-bg);
            border: var(--glass-border);
        }

        .emoji-option {
            padding: 5px;
            cursor: pointer;
            text-align: center;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .emoji-option:hover {
            background-color: var(--sidebar-bg);
            transform: scale(1.1);
        }

        /* Settings Panel */
        .settings-panel {
            position: fixed;
            top: 0;
            right: 0;
            bottom: 0;
            width: 400px;
            background-color: var(--sidebar-bg);
            border-left: 1px solid var(--border-color);
            z-index: 2000;
            display: flex;
            flex-direction: column;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            box-shadow: var(--shadow);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            background: var(--glass-bg);
            border: var(--glass-border);
        }

        .settings-panel.show {
            transform: translateX(0);
        }

        .settings-header {
            padding: 15px 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .settings-title {
            font-weight: 600;
            font-size: 20px;
        }

        .close-settings {
            background: none;
            border: none;
            color: var(--text-color);
            cursor: pointer;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .settings-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .settings-section {
            margin-bottom: 30px;
        }

        .settings-section-title {
            font-weight: 600;
            margin-bottom: 15px;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .settings-section-title i {
            color: var(--primary-color);
        }

        .theme-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }

        .theme-option {
            height: 80px;
            border-radius: var(--radius);
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            padding: 10px;
            position: relative;
        }

        .theme-option:hover {
            transform: scale(1.05);
        }

        .theme-option.active {
            border-color: var(--primary-color);
        }

        .theme-option-name {
            font-size: 12px;
            font-weight: 600;
            color: white;
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
        }

        .theme-cotton-candy-option {
            background: linear-gradient(135deg, #FF9FF3, #F368E0);
        }

        .theme-midnight-option {
            background: linear-gradient(135deg, #1C2833, #2C3E50);
        }

        .theme-golden-option {
            background: linear-gradient(135deg, #D4AF37, #B8860B);
        }

        .theme-extra-dark-option {
            background: linear-gradient(135deg, #121212, #2D2D2D);
        }

        .theme-white-blue-option {
            background: linear-gradient(135deg, #FFFFFF, #007AFF);
        }

        .theme-blue-option {
            background: linear-gradient(135deg, #0056CC, #003366);
        }

        .theme-nature-option {
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
        }

        .theme-sunset-option {
            background: linear-gradient(135deg, #FF6B6B, #C53030);
        }

        .theme-ocean-option {
            background: linear-gradient(135deg, #4FC3F7, #0288D1);
        }

        .theme-lavender-option {
            background: linear-gradient(135deg, #9C27B0, #6A1B9A);
        }

        .theme-forest-option {
            background: linear-gradient(135deg, #388E3C, #1B5E20);
        }

        .theme-rose-option {
            background: linear-gradient(135deg, #E91E63, #AD1457);
        }

        .theme-coffee-option {
            background: linear-gradient(135deg, #795548, #4E342E);
        }

        .theme-space-option {
            background: linear-gradient(135deg, #7E57C2, #4527A0);
        }

        .theme-crimson-option {
            background: linear-gradient(135deg, #DC143C, #8B0000);
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .setting-label {
            font-weight: 500;
        }

        .setting-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: var(--primary-color);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }

        .password-input {
            width: 150px;
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            background-color: var(--note-bg);
            color: var(--text-color);
            outline: none;
        }

        .set-password-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: var(--radius);
            cursor: pointer;
            font-weight: 500;
        }

        .password-prompt {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 3000;
        }

        .password-form {
            background-color: var(--note-bg);
            padding: 30px;
            border-radius: var(--radius);
            width: 90%;
            max-width: 400px;
            box-shadow: var(--shadow);
        }

        .password-title {
            font-weight: 600;
            margin-bottom: 20px;
            font-size: 20px;
            text-align: center;
        }

        .password-field {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            margin-bottom: 20px;
            background-color: var(--sidebar-bg);
            color: var(--text-color);
            outline: none;
        }

        .password-buttons {
            display: flex;
            gap: 10px;
        }

        .password-submit, .password-cancel {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: var(--radius);
            cursor: pointer;
            font-weight: 500;
        }

        .password-submit {
            background-color: var(--primary-color);
            color: white;
        }

        .password-cancel {
            background-color: var(--sidebar-bg);
            color: var(--text-color);
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .ai-panel {
                width: 300px;
            }
            
            .settings-panel {
                width: 350px;
            }
        }

        @media (max-width: 768px) {
            .app-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: 200px;
            }
            
            .ai-panel {
                position: fixed;
                top: 0;
                right: 0;
                bottom: 0;
                width: 100%;
                height: 100%;
                z-index: 1000;
                border-radius: 0;
            }
            
            .ai-panel.hidden {
                transform: translateX(100%);
            }
            
            .writing-tools {
                overflow-x: auto;
            }
            
            .settings-panel {
                width: 100%;
            }
            
            .theme-options {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 480px) {
            .app-header {
                padding: 10px 15px;
            }
            
            .app-title {
                font-size: 18px;
            }
            
            .settings-btn, .ai-toggle-btn {
                padding: 6px 12px;
                font-size: 14px;
            }
            
            .note-header {
                padding: 10px 15px;
            }
            
            .writing-tools {
                padding: 8px 15px;
            }
            
            .note-editor {
                padding: 15px;
            }
            
            .theme-options {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .setting-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .setting-control {
                width: 100%;
                justify-content: space-between;
            }
        }
    </style>
</head>
<body class="theme-cotton-candy">
    <div class="app-header">
        <div class="app-title">
            <i class="fas fa-sticky-note"></i> Notes with OptiChain AI
        </div>
        <div class="header-controls">
            <button class="settings-btn" id="settingsBtn">
                <i class="fas fa-cog"></i> Settings
            </button>
            <button class="ai-toggle-btn" id="aiToggleBtn">
                <i class="fas fa-robot"></i> AI Assistant
            </button>
        </div>
    </div>

    <div class="app-container">
        <div class="sidebar">
            <div class="sidebar-header">
                <h3>All Notes</h3>
                <button class="new-note-btn" id="newNoteBtn">
                    <i class="fas fa-plus"></i> New Note
                </button>
            </div>
            <div class="notes-list" id="notesList">
                <!-- Notes will be dynamically added here -->
            </div>
        </div>

        <div class="note-content">
            <div class="note-header">
                <input type="text" class="note-title-input" id="noteTitle" placeholder="Note Title">
            </div>
            <div class="writing-tools">
                <div class="tool-group">
                    <select class="font-select" id="fontSelect">
                        <option value="Arial">Arial</option>
                        <option value="Georgia">Georgia</option>
                        <option value="Courier New">Courier New</option>
                        <option value="Times New Roman">Times New Roman</option>
                        <option value="Verdana">Verdana</option>
                    </select>
                </div>
                <div class="tool-group">
                    <select class="size-select" id="sizeSelect">
                        <option value="12px">Small</option>
                        <option value="16px" selected>Medium</option>
                        <option value="20px">Large</option>
                        <option value="24px">X-Large</option>
                    </select>
                </div>
                <div class="tool-group">
                    <button class="tool-btn" data-command="bold" title="Bold">
                        <i class="fas fa-bold"></i>
                    </button>
                    <button class="tool-btn" data-command="italic" title="Italic">
                        <i class="fas fa-italic"></i>
                    </button>
                    <button class="tool-btn" data-command="underline" title="Underline">
                        <i class="fas fa-underline"></i>
                    </button>
                </div>
                <div class="tool-group">
                    <button class="tool-btn" data-command="justifyLeft" title="Align Left">
                        <i class="fas fa-align-left"></i>
                    </button>
                    <button class="tool-btn" data-command="justifyCenter" title="Align Center">
                        <i class="fas fa-align-center"></i>
                    </button>
                    <button class="tool-btn" data-command="justifyRight" title="Align Right">
                        <i class="fas fa-align-right"></i>
                    </button>
                </div>
                <div class="tool-group">
                    <button class="tool-btn" data-command="insertUnorderedList" title="Bullet List">
                        <i class="fas fa-list-ul"></i>
                    </button>
                    <button class="tool-btn" data-command="insertOrderedList" title="Numbered List">
                        <i class="fas fa-list-ol"></i>
                    </button>
                    <button class="tool-btn" data-command="outdent" title="Decrease Indent">
                        <i class="fas fa-outdent"></i>
                    </button>
                    <button class="tool-btn" data-command="indent" title="Increase Indent">
                        <i class="fas fa-indent"></i>
                    </button>
                </div>
                <div class="tool-group">
                    <button class="tool-btn" id="insertImage" title="Insert Image">
                        <i class="fas fa-image"></i>
                    </button>
                    <button class="tool-btn" id="insertEmoji" title="Insert Emoji">
                        <i class="fas fa-smile"></i>
                    </button>
                    <button class="tool-btn" data-command="createLink" title="Insert Link">
                        <i class="fas fa-link"></i>
                    </button>
                </div>
            </div>
            <div class="note-editor">
                <div class="note-editor-content" id="noteEditor" contenteditable="true">
                    <!-- Note content will be edited here -->
                </div>
            </div>
        </div>

        <div class="ai-panel hidden" id="aiPanel">
            <div class="ai-header">
                <div class="ai-title">
                    <i class="fas fa-robot"></i> OptiChain AI <span class="ai-badge">Pro 3.0</span>
                </div>
            </div>
            <div class="ai-actions">
                <button class="ai-action-btn" data-action="find">
                    <i class="fas fa-search"></i> Find in Note
                </button>
                <button class="ai-action-btn" data-action="grammar">
                    <i class="fas fa-edit"></i> Fix Grammar
                </button>
                <button class="ai-action-btn" data-action="keynotes">
                    <i class="fas fa-clipboard-list"></i> Create Key Notes
                </button>
                <button class="ai-action-btn" data-action="summarize-small">
                    <i class="fas fa-file-alt"></i> Summarize (Small)
                </button>
                <button class="ai-action-btn" data-action="summarize-medium">
                    <i class="fas fa-file-alt"></i> Summarize (Medium)
                </button>
                <button class="ai-action-btn" data-action="summarize-large">
                    <i class="fas fa-file-alt"></i> Summarize (Large)
                </button>
                <button class="ai-action-btn" data-action="sentiment">
                    <i class="fas fa-smile"></i> Analyze Sentiment
                </button>
                <button class="ai-action-btn" data-action="improve">
                    <i class="fas fa-magic"></i> Improve Writing
                </button>
                <button class="ai-action-btn" data-action="translate">
                    <i class="fas fa-language"></i> Translate
                </button>
            </div>
            <div class="ai-output" id="aiOutput">
                <!-- AI responses will appear here -->
            </div>
            <div class="ai-prompt">
                <input type="text" class="ai-input" id="aiInput" placeholder="Ask OptiChain AI...">
                <button class="ai-send-btn" id="aiSendBtn">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Settings Panel -->
    <div class="settings-panel" id="settingsPanel">
        <div class="settings-header">
            <div class="settings-title">Settings</div>
            <button class="close-settings" id="closeSettings">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="settings-content">
            <div class="settings-section">
                <div class="settings-section-title">
                    <i class="fas fa-palette"></i> Theme
                </div>
                <div class="theme-options">
                    <div class="theme-option theme-cotton-candy-option active" data-theme="cotton-candy">
                        <div class="theme-option-name">Cotton Candy</div>
                    </div>
                    <div class="theme-option theme-midnight-option" data-theme="midnight">
                        <div class="theme-option-name">Midnight</div>
                    </div>
                    <div class="theme-option theme-golden-option" data-theme="golden">
                        <div class="theme-option-name">Golden</div>
                    </div>
                    <div class="theme-option theme-extra-dark-option" data-theme="extra-dark">
                        <div class="theme-option-name">Extra Dark</div>
                    </div>
                    <div class="theme-option theme-white-blue-option" data-theme="white-blue">
                        <div class="theme-option-name">White & Blue</div>
                    </div>
                    <div class="theme-option theme-blue-option" data-theme="blue">
                        <div class="theme-option-name">Blue</div>
                    </div>
                    <div class="theme-option theme-nature-option" data-theme="nature">
                        <div class="theme-option-name">Nature</div>
                    </div>
                    <div class="theme-option theme-sunset-option" data-theme="sunset">
                        <div class="theme-option-name">Sunset</div>
                    </div>
                    <div class="theme-option theme-ocean-option" data-theme="ocean">
                        <div class="theme-option-name">Ocean</div>
                    </div>
                    <div class="theme-option theme-lavender-option" data-theme="lavender">
                        <div class="theme-option-name">Lavender</div>
                    </div>
                    <div class="theme-option theme-forest-option" data-theme="forest">
                        <div class="theme-option-name">Forest</div>
                    </div>
                    <div class="theme-option theme-rose-option" data-theme="rose">
                        <div class="theme-option-name">Rose</div>
                    </div>
                    <div class="theme-option theme-coffee-option" data-theme="coffee">
                        <div class="theme-option-name">Coffee</div>
                    </div>
                    <div class="theme-option theme-space-option" data-theme="space">
                        <div class="theme-option-name">Space</div>
                    </div>
                    <div class="theme-option theme-crimson-option" data-theme="crimson">
                        <div class="theme-option-name">Crimson</div>
                    </div>
                </div>
            </div>
            
            <div class="settings-section">
                <div class="settings-section-title">
                    <i class="fas fa-lock"></i> Security
                </div>
                <div class="setting-item">
                    <div class="setting-label">Set App Password</div>
                    <div class="setting-control">
                        <input type="password" class="password-input" id="appPassword" placeholder="Enter password">
                        <button class="set-password-btn" id="setAppPassword">Set</button>
                    </div>
                </div>
                <div class="setting-item">
                    <div class="setting-label">Hide Locked Notes</div>
                    <div class="setting-control">
                        <label class="toggle-switch">
                            <input type="checkbox" id="hideLockedNotes">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
            </div>
            
            <div class="settings-section">
                <div class="settings-section-title">
                    <i class="fas fa-robot"></i> AI Assistant
                </div>
                <div class="setting-item">
                    <div class="setting-label">Enhanced AI Mode</div>
                    <div class="setting-control">
                        <label class="toggle-switch">
                            <input type="checkbox" id="enhancedAIMode" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
                <div class="setting-item">
                    <div class="setting-label">Auto Grammar Check</div>
                    <div class="setting-control">
                        <label class="toggle-switch">
                            <input type="checkbox" id="autoGrammarCheck">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Password Prompt -->
    <div class="password-prompt hidden" id="passwordPrompt">
        <div class="password-form">
            <div class="password-title">Enter Password</div>
            <input type="password" class="password-field" id="passwordField" placeholder="Enter your password">
            <div class="password-buttons">
                <button class="password-submit" id="passwordSubmit">Submit</button>
                <button class="password-cancel" id="passwordCancel">Cancel</button>
            </div>
        </div>
    </div>

    <audio id="clickSound" src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQQAAAAAAA=="></audio>
    <audio id="deleteSound" src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQQAAAAAAA=="></audio>

    <script>
        // Notes data structure
        let notes = JSON.parse(localStorage.getItem('notes')) || [];
        let currentNoteId = null;
        let aiPanelVisible = false;
        let settingsVisible = false;
        let appPassword = localStorage.getItem('appPassword') || '';
        let hideLockedNotes = localStorage.getItem('hideLockedNotes') === 'true';
        let enhancedAIMode = localStorage.getItem('enhancedAIMode') !== 'false';
        let autoGrammarCheck = localStorage.getItem('autoGrammarCheck') === 'true';

        // DOM Elements
        const notesList = document.getElementById('notesList');
        const noteTitle = document.getElementById('noteTitle');
        const noteEditor = document.getElementById('noteEditor');
        const newNoteBtn = document.getElementById('newNoteBtn');
        const settingsBtn = document.getElementById('settingsBtn');
        const settingsPanel = document.getElementById('settingsPanel');
        const closeSettings = document.getElementById('closeSettings');
        const themeOptions = document.querySelectorAll('.theme-option');
        const aiToggleBtn = document.getElementById('aiToggleBtn');
        const aiPanel = document.getElementById('aiPanel');
        const toolBtns = document.querySelectorAll('.tool-btn');
        const fontSelect = document.getElementById('fontSelect');
        const sizeSelect = document.getElementById('sizeSelect');
        const insertImageBtn = document.getElementById('insertImage');
        const insertEmojiBtn = document.getElementById('insertEmoji');
        const aiActionBtns = document.querySelectorAll('.ai-action-btn');
        const aiOutput = document.getElementById('aiOutput');
        const aiInput = document.getElementById('aiInput');
        const aiSendBtn = document.getElementById('aiSendBtn');
        const appPasswordInput = document.getElementById('appPassword');
        const setAppPasswordBtn = document.getElementById('setAppPassword');
        const hideLockedNotesToggle = document.getElementById('hideLockedNotes');
        const enhancedAIModeToggle = document.getElementById('enhancedAIMode');
        const autoGrammarCheckToggle = document.getElementById('autoGrammarCheck');
        const passwordPrompt = document.getElementById('passwordPrompt');
        const passwordField = document.getElementById('passwordField');
        const passwordSubmit = document.getElementById('passwordSubmit');
        const passwordCancel = document.getElementById('passwordCancel');
        const clickSound = document.getElementById('clickSound');
        const deleteSound = document.getElementById('deleteSound');

        // Initialize the app
        function init() {
            // Load settings
            hideLockedNotesToggle.checked = hideLockedNotes;
            enhancedAIModeToggle.checked = enhancedAIMode;
            autoGrammarCheckToggle.checked = autoGrammarCheck;
            
            renderNotesList();
            setupEventListeners();
            
            // Check if app is locked
            if (appPassword) {
                showPasswordPrompt();
            } else {
                // Select first note if available
                if (notes.length > 0) {
                    selectNote(notes[0].id);
                } else {
                    createNewNote();
                }
            }
        }

        // Set up event listeners
        function setupEventListeners() {
            // Settings
            settingsBtn.addEventListener('click', toggleSettings);
            closeSettings.addEventListener('click', toggleSettings);

            // Theme selection
            themeOptions.forEach(option => {
                option.addEventListener('click', () => {
                    const theme = option.getAttribute('data-theme');
                    document.body.className = `theme-${theme}`;
                    
                    // Update active theme indicator
                    themeOptions.forEach(opt => opt.classList.remove('active'));
                    option.classList.add('active');
                    
                    playSound('click');
                });
            });

            // AI toggle button
            aiToggleBtn.addEventListener('click', toggleAIPanel);

            // New note button
            newNoteBtn.addEventListener('click', createNewNote);

            // Note title input
            noteTitle.addEventListener('input', saveNote);

            // Note editor content
            noteEditor.addEventListener('input', saveNote);

            // Text formatting buttons
            toolBtns.forEach(btn => {
                if (btn.getAttribute('data-command')) {
                    btn.addEventListener('click', () => {
                        const command = btn.getAttribute('data-command');
                        if (command === 'createLink') {
                            const url = prompt('Enter URL:');
                            if (url) {
                                document.execCommand(command, false, url);
                            }
                        } else {
                            document.execCommand(command, false, null);
                        }
                        noteEditor.focus();
                        playSound('click');
                    });
                }
            });

            // Font and size selection
            fontSelect.addEventListener('change', () => {
                document.execCommand('fontName', false, fontSelect.value);
                noteEditor.focus();
                playSound('click');
            });

            sizeSelect.addEventListener('change', () => {
                document.execCommand('fontSize', false, '7'); // This is a hack for font size
                // Apply the actual size via CSS
                const selection = window.getSelection();
                if (selection.rangeCount > 0) {
                    const range = selection.getRangeAt(0);
                    const selectedText = range.extractContents();
                    const span = document.createElement('span');
                    span.style.fontSize = sizeSelect.value;
                    span.appendChild(selectedText);
                    range.insertNode(span);
                }
                noteEditor.focus();
                playSound('click');
            });

            // Insert image
            insertImageBtn.addEventListener('click', () => {
                const url = prompt('Enter image URL:');
                if (url) {
                    document.execCommand('insertImage', false, url);
                    playSound('click');
                }
            });

            // Insert emoji
            insertEmojiBtn.addEventListener('click', showEmojiPicker);

            // AI actions
            aiActionBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const action = btn.getAttribute('data-action');
                    handleAIAction(action);
                    playSound('click');
                });
            });

            // AI send button
            aiSendBtn.addEventListener('click', handleAIChat);
            aiInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    handleAIChat();
                }
            });

            // Settings controls
            setAppPasswordBtn.addEventListener('click', setAppPassword);
            hideLockedNotesToggle.addEventListener('change', toggleHideLockedNotes);
            enhancedAIModeToggle.addEventListener('change', toggleEnhancedAIMode);
            autoGrammarCheckToggle.addEventListener('change', toggleAutoGrammarCheck);

            // Password prompt
            passwordSubmit.addEventListener('click', checkPassword);
            passwordCancel.addEventListener('click', hidePasswordPrompt);
            passwordField.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    checkPassword();
                }
            });
        }

        // Play sound effects
        function playSound(type) {
            if (type === 'click') {
                clickSound.currentTime = 0;
                clickSound.play().catch(e => console.log("Audio play failed:", e));
            } else if (type === 'delete') {
                deleteSound.currentTime = 0;
                deleteSound.play().catch(e => console.log("Audio play failed:", e));
            }
        }

        // Toggle settings panel
        function toggleSettings() {
            settingsVisible = !settingsVisible;
            if (settingsVisible) {
                settingsPanel.classList.add('show');
            } else {
                settingsPanel.classList.remove('show');
            }
            playSound('click');
        }

        // Toggle AI panel visibility
        function toggleAIPanel() {
            aiPanelVisible = !aiPanelVisible;
            if (aiPanelVisible) {
                aiPanel.classList.remove('hidden');
                aiToggleBtn.innerHTML = '<i class="fas fa-robot"></i> Hide AI';
            } else {
                aiPanel.classList.add('hidden');
                aiToggleBtn.innerHTML = '<i class="fas fa-robot"></i> AI Assistant';
            }
            playSound('click');
        }

        // Show emoji picker
        function showEmojiPicker() {
            // Remove existing emoji picker if any
            const existingPicker = document.querySelector('.emoji-picker');
            if (existingPicker) {
                existingPicker.remove();
                return;
            }

            // Create emoji picker
            const emojiPicker = document.createElement('div');
            emojiPicker.className = 'emoji-picker';
            
            // Position the picker near the emoji button
            const emojiBtnRect = insertEmojiBtn.getBoundingClientRect();
            emojiPicker.style.position = 'absolute';
            emojiPicker.style.top = `${emojiBtnRect.bottom + window.scrollY}px`;
            emojiPicker.style.left = `${emojiBtnRect.left + window.scrollX}px`;
            
            // Common emojis
            const emojis = ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', ''];
            
            // Add emojis to picker
            emojis.forEach(emoji => {
                const emojiOption = document.createElement('div');
                emojiOption.className = 'emoji-option';
                emojiOption.textContent = emoji;
                emojiOption.addEventListener('click', () => {
                    insertEmoji(emoji);
                    emojiPicker.remove();
                    playSound('click');
                });
                emojiPicker.appendChild(emojiOption);
            });
            
            document.body.appendChild(emojiPicker);
            
            // Close picker when clicking outside
            document.addEventListener('click', function closePicker(e) {
                if (!emojiPicker.contains(e.target) && e.target !== insertEmojiBtn) {
                    emojiPicker.remove();
                    document.removeEventListener('click', closePicker);
                }
            });
        }

        // Insert emoji at cursor position
        function insertEmoji(emoji) {
            const selection = window.getSelection();
            if (selection.rangeCount > 0) {
                const range = selection.getRangeAt(0);
                range.deleteContents();
                const textNode = document.createTextNode(emoji);
                range.insertNode(textNode);
                range.setStartAfter(textNode);
                range.setEndAfter(textNode);
                selection.removeAllRanges();
                selection.addRange(range);
            }
            noteEditor.focus();
        }

        // Create a new note
        function createNewNote() {
            const newNote = {
                id: Date.now().toString(),
                title: 'Untitled Note',
                content: '',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString(),
                locked: false,
                password: ''
            };
            
            notes.unshift(newNote);
            saveNotesToStorage();
            renderNotesList();
            selectNote(newNote.id);
            playSound('click');
        }

        // Delete a note
        function deleteNote(noteId) {
            if (confirm('Are you sure you want to delete this note?')) {
                notes = notes.filter(note => note.id !== noteId);
                saveNotesToStorage();
                renderNotesList();
                
                // Select another note if available
                if (notes.length > 0) {
                    selectNote(notes[0].id);
                } else {
                    createNewNote();
                }
                
                playSound('delete');
            }
        }

        // Toggle note lock
        function toggleNoteLock(noteId) {
            const noteIndex = notes.findIndex(n => n.id === noteId);
            if (noteIndex !== -1) {
                if (notes[noteIndex].locked) {
                    // Unlock note
                    notes[noteIndex].locked = false;
                    notes[noteIndex].password = '';
                } else {
                    // Lock note - prompt for password
                    const password = prompt('Set a password for this note:');
                    if (password) {
                        notes[noteIndex].locked = true;
                        notes[noteIndex].password = password;
                    } else {
                        return; // Cancel if no password provided
                    }
                }
                
                saveNotesToStorage();
                renderNotesList();
                playSound('click');
            }
        }

        // Select a note to edit
        function selectNote(noteId) {
            const note = notes.find(n => n.id === noteId);
            
            if (note) {
                // Check if note is locked
                if (note.locked) {
                    const password = prompt('This note is locked. Enter password:');
                    if (password !== note.password) {
                        alert('Incorrect password!');
                        return;
                    }
                }
                
                currentNoteId = noteId;
                noteTitle.value = note.title;
                noteEditor.innerHTML = note.content;
                
                // Update active note in list
                document.querySelectorAll('.note-item').forEach(item => {
                    item.classList.remove('active');
                    if (item.getAttribute('data-id') === noteId) {
                        item.classList.add('active');
                    }
                });
            }
        }

        // Save the current note
        function saveNote() {
            if (!currentNoteId) return;
            
            const noteIndex = notes.findIndex(n => n.id === currentNoteId);
            if (noteIndex !== -1) {
                notes[noteIndex].title = noteTitle.value;
                notes[noteIndex].content = noteEditor.innerHTML;
                notes[noteIndex].updatedAt = new Date().toISOString();
                
                saveNotesToStorage();
                renderNotesList();
                
                // Auto grammar check if enabled
                if (autoGrammarCheck) {
                    setTimeout(() => {
                        handleAIAction('grammar');
                    }, 1000);
                }
            }
        }

        // Save notes to localStorage
        function saveNotesToStorage() {
            localStorage.setItem('notes', JSON.stringify(notes));
        }

        // Render the notes list
        function renderNotesList() {
            notesList.innerHTML = '';
            
            const filteredNotes = hideLockedNotes ? notes.filter(note => !note.locked) : notes;
            
            if (filteredNotes.length === 0) {
                const emptyMessage = document.createElement('div');
                emptyMessage.className = 'note-item';
                emptyMessage.innerHTML = `
                    <div class="note-item-content">
                        <div class="note-title">No notes available</div>
                        <div class="note-preview">Create a new note to get started</div>
                    </div>
                `;
                notesList.appendChild(emptyMessage);
                return;
            }
            
            filteredNotes.forEach(note => {
                const noteItem = document.createElement('div');
                noteItem.className = 'note-item';
                noteItem.setAttribute('data-id', note.id);
                
                // Create a preview of the content (text only)
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = note.content;
                const textContent = tempDiv.textContent || tempDiv.innerText || '';
                const preview = textContent.substring(0, 50) + (textContent.length > 50 ? '...' : '');
                
                noteItem.innerHTML = `
                    <div class="note-item-content">
                        <div class="note-title">
                            ${note.locked ? '<i class="fas fa-lock"></i>' : ''}
                            ${note.title || 'Untitled Note'}
                        </div>
                        <div class="note-preview">${preview || 'Empty note'}</div>
                    </div>
                    <div class="note-actions">
                        <button class="lock-btn ${note.locked ? 'locked' : ''}" title="${note.locked ? 'Unlock Note' : 'Lock Note'}">
                            <i class="fas ${note.locked ? 'fa-lock' : 'fa-lock-open'}"></i>
                        </button>
                        <button class="delete-btn" title="Delete Note">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                
                noteItem.addEventListener('click', (e) => {
                    if (!e.target.closest('.delete-btn') && !e.target.closest('.lock-btn')) {
                        selectNote(note.id);
                        playSound('click');
                    }
                });
                
                const deleteBtn = noteItem.querySelector('.delete-btn');
                deleteBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    deleteNote(note.id);
                });
                
                const lockBtn = noteItem.querySelector('.lock-btn');
                lockBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    toggleNoteLock(note.id);
                });
                
                notesList.appendChild(noteItem);
            });
        }

        // Set app password
        function setAppPassword() {
            const password = appPasswordInput.value;
            if (password) {
                appPassword = password;
                localStorage.setItem('appPassword', appPassword);
                appPasswordInput.value = '';
                alert('App password set successfully!');
                playSound('click');
            }
        }

        // Toggle hide locked notes
        function toggleHideLockedNotes() {
            hideLockedNotes = hideLockedNotesToggle.checked;
            localStorage.setItem('hideLockedNotes', hideLockedNotes);
            renderNotesList();
            playSound('click');
        }

        // Toggle enhanced AI mode
        function toggleEnhancedAIMode() {
            enhancedAIMode = enhancedAIModeToggle.checked;
            localStorage.setItem('enhancedAIMode', enhancedAIMode);
            playSound('click');
        }

        // Toggle auto grammar check
        function toggleAutoGrammarCheck() {
            autoGrammarCheck = autoGrammarCheckToggle.checked;
            localStorage.setItem('autoGrammarCheck', autoGrammarCheck);
            playSound('click');
        }

        // Show password prompt
        function showPasswordPrompt() {
            passwordPrompt.classList.remove('hidden');
            passwordField.focus();
        }

        // Hide password prompt
        function hidePasswordPrompt() {
            passwordPrompt.classList.add('hidden');
            passwordField.value = '';
        }

        // Check password
        function checkPassword() {
            if (passwordField.value === appPassword) {
                hidePasswordPrompt();
                // Select first note if available
                if (notes.length > 0) {
                    selectNote(notes[0].id);
                } else {
                    createNewNote();
                }
            } else {
                alert('Incorrect password!');
                passwordField.value = '';
                passwordField.focus();
            }
        }

        // Handle AI actions
        function handleAIAction(action) {
            const noteContent = noteEditor.textContent || noteEditor.innerText;
            
            if (!noteContent.trim()) {
                addAIResponse('Please add some content to your note first.');
                return;
            }
            
            let response = '';
            
            switch(action) {
                case 'find':
                    const searchTerm = prompt('What would you like to find in your note?');
                    if (searchTerm) {
                        // Count occurrences and highlight them
                        const regex = new RegExp(searchTerm, 'gi');
                        const matches = noteContent.match(regex);
                        const count = matches ? matches.length : 0;
                        
                        if (count > 0) {
                            // Highlight the text in the editor
                            const htmlContent = noteEditor.innerHTML;
                            const highlightedContent = htmlContent.replace(
                                new RegExp(searchTerm, 'gi'),
                                match => `<span class="highlight">${match}</span>`
                            );
                            noteEditor.innerHTML = highlightedContent;
                            
                            response = `I found "${searchTerm}" ${count} time(s) in your note. I've highlighted them for you.`;
                        } else {
                            response = `I couldn't find "${searchTerm}" in your note.`;
                        }
                    }
                    break;
                    
                case 'grammar':
                    response = enhancedAIMode ? 
                        enhancedGrammarCheck(noteContent) : 
                        basicGrammarCheck(noteContent);
                    break;
                    
                case 'keynotes':
                    response = enhancedAIMode ? 
                        enhancedKeyNotes(noteContent) : 
                        basicKeyNotes(noteContent);
                    break;
                    
                case 'summarize-small':
                    response = generateSummary(noteContent, 1);
                    break;
                    
                case 'summarize-medium':
                    response = generateSummary(noteContent, 2);
                    break;
                    
                case 'summarize-large':
                    response = generateSummary(noteContent, 3);
                    break;
                    
                case 'sentiment':
                    response = analyzeSentiment(noteContent);
                    break;
                    
                case 'improve':
                    response = improveWriting(noteContent);
                    break;
                    
                case 'translate':
                    const language = prompt('Which language would you like to translate to? (e.g., Spanish, French, German)');
                    if (language) {
                        response = translateText(noteContent, language);
                    }
                    break;
            }
            
            if (response) {
                addAIResponse(response);
            }
        }

        // Basic grammar check
        function basicGrammarCheck(content) {
            const sentences = content.split(/[.!?]+/).filter(s => s.trim().length > 0);
            const issues = [];
            
            if (sentences.length > 0) {
                // Check for capitalization
                sentences.forEach((sentence, index) => {
                    if (sentence.trim() && !/^[A-Z]/.test(sentence.trim())) {
                        issues.push(`Sentence ${index + 1} should start with a capital letter`);
                    }
                });
                
                // Check for common issues
                if (content.match(/\balot\b/gi)) {
                    issues.push("Use 'a lot' instead of 'alot'");
                }
                
                if (content.match(/\byour\s+(?=\w+ing\b)/gi)) {
                    issues.push("Check usage of 'your' vs 'you're'");
                }
                
                if (content.match(/\bits\b/gi) && !content.match(/\bit's\b/gi)) {
                    issues.push("Check usage of 'its' vs 'it's'");
                }
                
                // Check for repeated words
                const words = content.split(/\s+/);
                for (let i = 0; i < words.length - 1; i++) {
                    if (words[i].toLowerCase() === words[i+1].toLowerCase()) {
                        issues.push(`Repeated word: "${words[i]}"`);
                        break;
                    }
                }
                
                // Check for long sentences
                sentences.forEach((sentence, index) => {
                    if (sentence.split(/\s+/).length > 25) {
                        issues.push(`Sentence ${index + 1} might be too long. Consider breaking it up.`);
                    }
                });
                
                if (issues.length === 0) {
                    issues.push("No major grammar issues found. Your writing looks good!");
                }
            } else {
                issues.push("Not enough content to analyze grammar");
            }
            
            return "Grammar Check Results:\n\n" + issues.map((issue, i) => `${i+1}. ${issue}`).join('\n');
        }

        // Enhanced grammar check
        function enhancedGrammarCheck(content) {
            const sentences = content.split(/[.!?]+/).filter(s => s.trim().length > 0);
            const issues = [];
            
            if (sentences.length > 0) {
                // Check for capitalization
                sentences.forEach((sentence, index) => {
                    if (sentence.trim() && !/^[A-Z]/.test(sentence.trim())) {
                        issues.push(`Sentence ${index + 1} should start with a capital letter`);
                    }
                });
                
                // Check for common issues with enhanced detection
                const commonMistakes = [
                    { pattern: /\balot\b/gi, correction: "a lot" },
                    { pattern: /\bcould of\b/gi, correction: "could have" },
                    { pattern: /\bshould of\b/gi, correction: "should have" },
                    { pattern: /\bwould of\b/gi, correction: "would have" },
                    { pattern: /\btheir\s+are\b/gi, correction: "there are" },
                    { pattern: /\byour\s+welcome\b/gi, correction: "you're welcome" },
                    { pattern: /\bit's\s+your\b/gi, correction: "it's you're" }
                ];
                
                commonMistakes.forEach(mistake => {
                    if (content.match(mistake.pattern)) {
                        issues.push(`Consider using "${mistake.correction}" instead`);
                    }
                });
                
                // Check for passive voice
                const passiveVoiceRegex = /\b(am|is|are|was|were|be|being|been)\s+[a-z]+ed\b/gi;
                if (content.match(passiveVoiceRegex)) {
                    issues.push("Consider using active voice instead of passive voice for clearer writing");
                }
                
                // Check for weak words
                const weakWords = /\b(very|really|quite|somewhat|rather)\b/gi;
                if (content.match(weakWords)) {
                    issues.push("Try to replace weak modifiers (very, really, etc.) with stronger words");
                }
                
                // Check for repeated words
                const words = content.split(/\s+/);
                for (let i = 0; i < words.length - 1; i++) {
                    if (words[i].toLowerCase() === words[i+1].toLowerCase()) {
                        issues.push(`Repeated word: "${words[i]}"`);
                        break;
                    }
                }
                
                // Check for long sentences
                sentences.forEach((sentence, index) => {
                    const wordCount = sentence.split(/\s+/).length;
                    if (wordCount > 25) {
                        issues.push(`Sentence ${index + 1} might be too long (${wordCount} words). Consider breaking it up.`);
                    }
                });
                
                // Check for paragraph length
                const paragraphs = content.split(/\n\s*\n/);
                paragraphs.forEach((paragraph, index) => {
                    const sentenceCount = paragraph.split(/[.!?]+/).length - 1;
                    if (sentenceCount > 8) {
                        issues.push(`Paragraph ${index + 1} might be too long. Consider breaking it into smaller paragraphs.`);
                    }
                });
                
                if (issues.length === 0) {
                    issues.push("Excellent! No grammar issues found. Your writing is clear and effective.");
                } else {
                    issues.unshift("I found some areas for improvement in your writing:");
                }
            } else {
                issues.push("Not enough content to analyze grammar");
            }
            
            return "Enhanced Grammar Analysis:\n\n" + issues.join('\n');
        }

        // Basic key notes
        function basicKeyNotes(content) {
            const lines = content.split('\n').filter(line => line.trim().length > 10);
            const bulletPoints = content.match(/\s*[-*]\s*(.+)/g) || [];
            
            let keyPoints = [];
            
            // Use bullet points if available
            if (bulletPoints.length > 0) {
                keyPoints = bulletPoints.slice(0, 7).map(point => 
                    ` ${point.replace(/^\s*[-*]\s*/, '')}`
                );
            } else {
                // Otherwise use the first few sentences
                const sentences = content.split(/[.!?]+/).filter(s => s.trim().length > 0);
                const firstSentences = sentences.slice(0, 5);
                keyPoints = firstSentences.map(sentence => 
                    ` ${sentence.trim().substring(0, 60)}${sentence.trim().length > 60 ? '...' : ''}`
                );
            }
            
            if (keyPoints.length > 0) {
                return "Key Points from Your Note:\n\n" + keyPoints.join('\n');
            } else {
                return "I couldn't identify clear key points. Try adding more content or structure to your note.";
            }
        }

        // Enhanced key notes
        function enhancedKeyNotes(content) {
            const sentences = content.split(/[.!?]+/).filter(s => s.trim().length > 0);
            
            if (sentences.length === 0) {
                return "I couldn't identify clear key points. Try adding more content to your note.";
            }
            
            // Score sentences by importance (longer sentences with keywords)
            const scoredSentences = sentences.map((sentence, index) => {
                const words = sentence.trim().split(/\s+/);
                let score = words.length; // Base score on length
                
                // Increase score for sentences with important keywords
                const importantKeywords = ['important', 'key', 'essential', 'critical', 'main', 'primary', 'crucial', 'vital'];
                importantKeywords.forEach(keyword => {
                    if (sentence.toLowerCase().includes(keyword)) {
                        score += 5;
                    }
                });
                
                // Increase score for sentences that seem to be headings
                if (words.length <= 10 && /^[A-Z][a-z]/.test(sentence.trim())) {
                    score += 3;
                }
                
                return {
                    sentence: sentence.trim(),
                    score: score,
                    index: index
                };
            });
            
            // Sort by score (descending) and take the top ones
            scoredSentences.sort((a, b) => b.score - a.score);
            const topSentences = scoredSentences.slice(0, Math.min(7, scoredSentences.length));
            
            // Sort by original order
            topSentences.sort((a, b) => a.index - b.index);
            
            const keyPoints = topSentences.map(item => ` ${item.sentence}`);
            
            return "Enhanced Key Points:\n\n" + keyPoints.join('\n') + 
                   `\n\nI identified ${keyPoints.length} key points from your ${sentences.length} sentences.`;
        }

        // Generate a summary based on content length
        function generateSummary(content, level) {
            const sentences = content.split(/[.!?]+/).filter(s => s.trim().length > 0);
            
            if (sentences.length === 0) {
                return "Not enough content to summarize.";
            }
            
            let summaryLength;
            switch(level) {
                case 1: summaryLength = Math.min(2, Math.max(1, Math.floor(sentences.length / 5))); break;
                case 2: summaryLength = Math.min(4, Math.max(2, Math.floor(sentences.length / 3))); break;
                case 3: summaryLength = Math.min(8, Math.max(3, Math.floor(sentences.length / 2))); break;
                default: summaryLength = 2;
            }
            
            // Try to pick the most important sentences (simple heuristic: longer sentences)
            const scoredSentences = sentences.map((sentence, index) => {
                return {
                    sentence: sentence.trim(),
                    score: sentence.split(/\s+/).length, // Use length as importance score
                    index: index
                };
            });
            
            // Sort by score (descending) and take the top ones
            scoredSentences.sort((a, b) => b.score - a.score);
            const topSentences = scoredSentences.slice(0, summaryLength);
            
            // Sort by original order
            topSentences.sort((a, b) => a.index - b.index);
            
            const summaryType = level === 1 ? "Brief Summary" : level === 2 ? "Medium Summary" : "Detailed Summary";
            
            return `${summaryType}:\n\n` + topSentences.map(item => ` ${item.sentence}`).join('\n') + 
                   `\n\nThis summary captures the main points from your ${sentences.length} sentences.`;
        }

        // Analyze sentiment
        function analyzeSentiment(content) {
            const positiveWords = ['good', 'great', 'excellent', 'amazing', 'wonderful', 'fantastic', 'awesome', 'happy', 'joy', 'love', 'like', 'positive', 'beautiful', 'perfect', 'best'];
            const negativeWords = ['bad', 'terrible', 'awful', 'horrible', 'hate', 'dislike', 'negative', 'sad', 'angry', 'frustrated', 'annoying', 'problem', 'issue', 'worst'];
            
            const words = content.toLowerCase().split(/\s+/);
            
            let positiveCount = 0;
            let negativeCount = 0;
            
            words.forEach(word => {
                if (positiveWords.includes(word)) positiveCount++;
                if (negativeWords.includes(word)) negativeCount++;
            });
            
            let sentiment = "neutral";
            if (positiveCount > negativeCount) {
                sentiment = "positive";
            } else if (negativeCount > positiveCount) {
                sentiment = "negative";
            }
            
            return `Sentiment Analysis:\n\nYour note has a ${sentiment} tone.\n\nPositive words: ${positiveCount}\nNegative words: ${negativeCount}\n\n${positiveCount > negativeCount ? 
                "The overall tone is uplifting and positive!" : 
                negativeCount > positiveCount ? 
                "The tone seems somewhat negative. Consider adding more positive language." : 
                "The tone is fairly neutral and balanced."}`;
        }

        // Improve writing
        function improveWriting(content) {
            const sentences = content.split(/[.!?]+/).filter(s => s.trim().length > 0);
            
            if (sentences.length === 0) {
                return "Not enough content to analyze for improvements.";
            }
            
            const suggestions = [];
            
            // Check for sentence variety
            const sentenceLengths = sentences.map(s => s.split(/\s+/).length);
            const avgLength = sentenceLengths.reduce((a, b) => a + b, 0) / sentenceLengths.length;
            const lengthVariance = Math.max(...sentenceLengths) - Math.min(...sentenceLengths);
            
            if (lengthVariance < 5) {
                suggestions.push("Try varying your sentence lengths for more engaging writing");
            }
            
            // Check for transition words
            const transitionWords = ['however', 'therefore', 'furthermore', 'moreover', 'consequently', 'additionally', 'likewise', 'similarly', 'nonetheless', 'otherwise'];
            let transitionCount = 0;
            
            sentences.forEach(sentence => {
                transitionWords.forEach(word => {
                    if (sentence.toLowerCase().includes(word)) {
                        transitionCount++;
                    }
                });
            });
            
            if (transitionCount < sentences.length / 5) {
                suggestions.push("Consider adding more transition words to improve flow between ideas");
            }
            
            // Check for strong verbs
            const weakVerbs = ['is', 'are', 'was', 'were', 'be', 'being', 'been', 'have', 'has', 'had', 'do', 'does', 'did'];
            let weakVerbCount = 0;
            
            sentences.forEach(sentence => {
                const words = sentence.split(/\s+/);
                words.forEach(word => {
                    if (weakVerbs.includes(word.toLowerCase())) {
                        weakVerbCount++;
                    }
                });
            });
            
            if (weakVerbCount > sentences.length * 2) {
                suggestions.push("Try replacing some weak verbs with stronger, more descriptive ones");
            }
            
            // Check for adverb overuse
            const adverbRegex = /\w+ly\b/gi;
            const adverbs = content.match(adverbRegex) || [];
            
            if (adverbs.length > sentences.length) {
                suggestions.push("Consider reducing adverb usage and using stronger verbs instead");
            }
            
            if (suggestions.length === 0) {
                suggestions.push("Your writing is already strong! Keep up the good work.");
            } else {
                suggestions.unshift("Here are some suggestions to enhance your writing:");
            }
            
            return "Writing Improvement Suggestions:\n\n" + suggestions.join('\n');
        }

        // Translate text
        function translateText(content, language) {
            // This is a simulation - in a real app, you would use a translation API
            const languageMap = {
                'spanish': 'espaol',
                'french': 'franais',
                'german': 'Deutsch',
                'italian': 'italiano',
                'portuguese': 'portugus',
                'russian': '',
                'japanese': '',
                'chinese': '',
                'korean': '',
                'arabic': ''
            };
            
            const langCode = languageMap[language.toLowerCase()] || language;
            
            return `Translation to ${langCode}:\n\n[This is a simulated translation. In a real application, this would connect to a translation API.]\n\nFor now, I recommend using Google Translate or DeepL for accurate translations of your content.`;
        }

        // Handle AI chat
        function handleAIChat() {
            const prompt = aiInput.value.trim();
            if (!prompt) return;
            
            addAIResponse(`You: ${prompt}`, 'user');
            aiInput.value = '';
            
            // Show typing indicator
            const typingIndicator = document.createElement('div');
            typingIndicator.className = 'ai-response';
            typingIndicator.textContent = 'OptiChain AI is thinking...';
            typingIndicator.style.fontStyle = 'italic';
            typingIndicator.style.color = '#8E8E93';
            aiOutput.appendChild(typingIndicator);
            aiOutput.scrollTop = aiOutput.scrollHeight;
            
            // Get note content for context
            const noteContent = noteEditor.textContent || noteEditor.innerText;
            
            // Simulate AI thinking
            setTimeout(() => {
                typingIndicator.remove();
                
                let response = "I'm OptiChain AI Pro 3.0. I can help you with your notes by finding information, fixing grammar, creating key notes, summarizing content, analyzing sentiment, improving writing, and translating text. How can I assist you with your current note?";
                
                const lowerPrompt = prompt.toLowerCase();
                const lowerNoteContent = noteContent.toLowerCase();
                
                // Enhanced AI responses based on prompt
                if (enhancedAIMode) {
                    // Check if the prompt is about content in the note
                    if (noteContent && lowerNoteContent.includes(lowerPrompt)) {
                        // Find the context around the prompt in the note
                        const index = lowerNoteContent.indexOf(lowerPrompt);
                        if (index !== -1) {
                            const start = Math.max(0, index - 50);
                            const end = Math.min(noteContent.length, index + lowerPrompt.length + 50);
                            const context = noteContent.substring(start, end);
                            
                            response = `Based on your note, here's the context for "${prompt}":\n\n"${context}"\n\nWould you like me to help you expand on this topic or analyze it further?`;
                            
                            // Highlight the text in the editor
                            const htmlContent = noteEditor.innerHTML;
                            const highlightedContent = htmlContent.replace(
                                new RegExp(prompt, 'gi'),
                                match => `<span class="highlight">${match}</span>`
                            );
                            noteEditor.innerHTML = highlightedContent;
                        }
                    } else if (lowerPrompt.includes('hello') || lowerPrompt.includes('hi') || lowerPrompt.includes('hey')) {
                        response = "Hello! I'm OptiChain AI Pro 3.0. How can I help you with your notes today?";
                    } else if (lowerPrompt.includes('thank')) {
                        response = "You're welcome! Is there anything else I can help you with?";
                    } else if (lowerPrompt.includes('note') && lowerPrompt.includes('create')) {
                        response = "To create a new note, click the 'New Note' button in the sidebar. You can then give it a title and start adding content. You can also lock notes with passwords for added security.";
                    } else if (lowerPrompt.includes('theme') || lowerPrompt.includes('color')) {
                        response = "You can change the theme in the Settings panel. We have 15 beautiful themes including Cotton Candy, Midnight, Golden, Extra Dark, White & Blue, Blue, Nature, Sunset, Ocean, Lavender, Forest, Rose, Coffee, Space, and Crimson.";
                    } else if (lowerPrompt.includes('emoji')) {
                        response = "To insert emojis, click the smiley face button in the writing tools. A picker will appear with various emojis you can add to your note to make it more expressive.";
                    } else if (lowerPrompt.includes('help')) {
                        response = "I can help you with:\n Finding text in your notes\n Checking and improving grammar\n Creating key points and summaries\n Analyzing sentiment and tone\n Improving writing style\n Translating content\n Answering questions about the app\n Answering questions about content in your notes\n\nJust ask or use one of the action buttons!";
                    } else if (lowerPrompt.includes('how are you')) {
                        response = "I'm functioning at peak performance, thank you for asking! Ready to help you with your notes.";
                    } else if (lowerPrompt.includes('what can you do')) {
                        response = "I can help you with various note-related tasks:\n Find specific text in your notes\n Check grammar and suggest improvements\n Extract key points from your content\n Create summaries of different lengths\n Analyze the sentiment and tone of your writing\n Suggest improvements to make your writing more effective\n Translate content to different languages\n Answer questions about using the app\n Answer questions about content in your notes\n\nTry one of the action buttons or ask me anything!";
                    } else if (noteContent) {
                        // If we have note content but the prompt isn't directly in it, try to give a general response
                        response = "I've reviewed your note. Based on its content, I can help you with summarizing, improving grammar, extracting key points, or analyzing the tone. Would you like me to perform any of these actions on your note?";
                    }
                } else {
                    // Basic AI mode responses
                    if (noteContent && lowerNoteContent.includes(lowerPrompt)) {
                        response = `I found "${prompt}" in your note. Would you like me to help you with this topic?`;
                    } else if (lowerPrompt.includes('hello') || lowerPrompt.includes('hi')) {
                        response = "Hello! How can I help you with your notes today?";
                    } else if (lowerPrompt.includes('thank')) {
                        response = "You're welcome!";
                    } else {
                        response = "I'm here to help with your notes. You can ask me to find text, check grammar, create summaries, or use the action buttons for specific tasks.";
                    }
                }
                
                addAIResponse(`OptiChain AI: ${response}`, 'ai');
            }, enhancedAIMode ? 1000 : 500);
        }

        // Add AI response to the output area
        function addAIResponse(text, type = 'ai') {
            const responseEl = document.createElement('div');
            responseEl.className = 'ai-response';
            
            if (type === 'user') {
                responseEl.style.backgroundColor = 'var(--primary-color)';
                responseEl.style.color = 'white';
                responseEl.textContent = text;
            } else {
                responseEl.innerHTML = text.replace(/\n/g, '<br>');
            }
            
            aiOutput.appendChild(responseEl);
            aiOutput.scrollTop = aiOutput.scrollHeight;
        }

        // Initialize the app when the page loads
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
