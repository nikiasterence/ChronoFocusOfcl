<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Draw Calculator Pro</title>
    <!-- Importing Math.js library for safe and powerful calculations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.7.0/math.min.js"></script>
    <style>
        :root {
            --bg-dark: #0f172a;
            --surface-dark: rgba(30, 41, 59, 0.5);
            --text-dark: #e2e8f0;
            --muted-dark: #94a3b8;
            --accent1-dark: #60a5fa;
            --accent2-dark: #38bdf8;

            --bg-light: #f0f9ff;
            --surface-light: rgba(255, 255, 255, 0.6);
            --text-light: #0c4a6e;
            --muted-light: #60a5fa;
            --accent1-light: #0ea5e9;
            --accent2-light: #0284c7;

            --font-main: 'Segoe UI', -apple-system, BlinkMacSystemFont, 'Helvetica Neue', sans-serif;
            --shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            --border-radius-main: 20px;
        }
        
        [data-theme="dark"] {
            --bg: var(--bg-dark);
            --surface: var(--surface-dark);
            --text: var(--text-dark);
            --muted: var(--muted-dark);
            --accent1: var(--accent1-dark);
            --accent2: var(--accent2-dark);
        }

        [data-theme="light"] {
            --bg: var(--bg-light);
            --surface: var(--surface-light);
            --text: var(--text-light);
            --muted: var(--muted-light);
            --accent1: var(--accent1-light);
            --accent2: var(--accent2-light);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background-color: var(--bg);
            background-image: linear-gradient(135deg, var(--accent1), var(--accent2));
            font-family: var(--font-main);
            color: var(--text);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            transition: background-color 0.3s ease;
        }

        /* --- App Container --- */
        .app-container {
            width: 100%;
            max-width: 1100px;
            height: 90vh;
            max-height: 800px;
            background: var(--surface);
            border-radius: var(--border-radius-main);
            box-shadow: var(--shadow);
            border: 1px solid rgba(255, 255, 255, 0.18);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            transition: background-color 0.3s ease;
        }

        .app-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 25px;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .app-header h1 {
            font-size: 24px;
            color: var(--text);
        }
        
        .theme-switcher {
            cursor: pointer; background: none; border: none;
            color: var(--text); font-size: 24px;
        }

        .navigation {
            display: flex;
            background: rgba(255, 255, 255, 0.1);
        }

        .nav-item {
            flex: 1; padding: 15px; text-align: center; cursor: pointer;
            font-weight: 600; border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            color: var(--muted);
        }
        .nav-item:hover { background: rgba(255, 255, 255, 0.1); }
        .nav-item.active { border-bottom-color: var(--accent1); color: var(--text); }

        .content {
            flex-grow: 1;
            padding: 25px;
            overflow-y: auto;
        }

        .page { display: none; }
        .page.active {
            display: block;
            animation: fadeIn 0.4s ease;
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); }}

        /* --- Calculator Page Layout --- */
        .calculator-layout {
            display: flex;
            gap: 25px;
            height: 100%;
        }

        .calculator { flex: 2; display: flex; flex-direction: column; gap: 15px; }
        .display {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px; padding: 20px; text-align: right;
            min-height: 100px;
            display: flex; flex-direction: column; justify-content: space-between;
            word-break: break-all;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .calculation { font-size: 16px; color: var(--muted); min-height: 24px; }
        .result { font-size: 36px; font-weight: 600; color: var(--text); }
        
        .buttons { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; }
        .btn {
            height: 55px; border-radius: 12px; border: none; font-size: 18px;
            background: rgba(255, 255, 255, 0.15); color: var(--text); cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .btn:hover { background: rgba(255, 255, 255, 0.25); transform: translateY(-2px); }
        .btn:active { transform: translateY(0); }
        
        .btn.operator { background-color: rgba(14, 165, 233, 0.4); color: var(--text); }
        .btn.scientific { background-color: rgba(2, 132, 199, 0.3); }
        .btn.equals { background-color: var(--accent1); color: #fff; grid-column: span 2; }

        /* History Panel */
        .history-container {
            flex: 1;
            background: rgba(0, 0, 0, 0.15);
            border-radius: 12px;
            display: flex; flex-direction: column;
            padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .history-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .history-header h3 { font-size: 18px; }
        #clear-history { background: none; border: none; color: var(--muted); cursor: pointer; }
        .history-list {
            flex-grow: 1; overflow-y: auto; list-style-type: none;
            padding: 0; margin: 0;
        }
        .history-list li {
            padding: 10px; border-radius: 8px; cursor: pointer;
            margin-bottom: 5px; transition: background 0.2s ease;
            font-size: 14px;
        }
        .history-list li:hover { background: rgba(255, 255, 255, 0.1); }
        .history-expr { display: block; color: var(--muted); font-size: 12px; }

        /* --- Math Notes Page --- */
        .notes-container { display: flex; flex-direction: column; gap: 15px; }
        textarea#math-notes {
            width: 100%; min-height: 400px;
            background: rgba(0, 0, 0, 0.2); border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px; color: var(--text); font-size: 16px;
            resize: vertical;
        }
        .notes-actions button {
            padding: 12px 20px; border-radius: 10px; border: none;
            background: var(--accent1); color: #fff; cursor: pointer; font-weight: 600;
        }
        .toast-notification {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            background: #2E8B57; color: white; padding: 15px 25px;
            border-radius: 10px; z-index: 1000;
            opacity: 0; transition: opacity 0.3s, bottom 0.3s;
        }
        .toast-notification.show { opacity: 1; bottom: 50px; }

        /* --- Graph Page --- */
        .graph-page { display: flex; flex-direction: column; gap: 20px; }
        .graph-controls { display: flex; gap: 15px; flex-wrap: wrap; }
        .graph-controls input {
            flex: 1; min-width: 200px; padding: 14px;
            border-radius: 10px; border: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(0, 0, 0, 0.2); color: var(--text); font-size: 16px;
        }
        .graph-controls button {
             padding: 14px 25px; border-radius: 10px; border: none;
             background: var(--accent1); color: #fff; cursor: pointer; font-weight: 600;
        }
        .graph-container {
            background: rgba(0, 0, 0, 0.2); border-radius: 15px;
            min-height: 400px; position: relative;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        #graph-canvas { width: 100%; height: 100%; position: absolute; }
        
        @media (max-width: 900px) {
            .calculator-layout { flex-direction: column; }
            .history-container { max-height: 200px; }
            .buttons { grid-template-columns: repeat(4, 1fr); }
        }
        @media (max-width: 600px) {
            body { padding: 0; }
            .app-container { height: 100vh; max-height: none; border-radius: 0; }
            .buttons { grid-template-columns: repeat(4, 1fr); gap: 5px; }
        }

    </style>
</head>
<body>
    <div class="app-container">
        <header class="app-header">
            <h1>Draw Calculator</h1>
            <button class="theme-switcher" id="theme-switcher">â—‘</button>
        </header>
        
        <nav class="navigation">
            <div class="nav-item active" data-page="calculator">Calculator</div>
            <div class="nav-item" data-page="math-notes">Math Notes</div>
            <div class="nav-item" data-page="graph">Graph</div>
        </nav>
        
        <main class="content">
            <!-- Calculator Page -->
            <section class="page active" id="calculator-page">
                <div class="calculator-layout">
                    <div class="calculator">
                        <div class="display">
                            <div class="calculation" id="calculation"></div>
                            <div class="result" id="display">0</div>
                        </div>
                        <div class="buttons">
                            <!-- Scientific Functions -->
                            <button class="btn scientific" onclick="appendFunction('sin(')">sin</button>
                            <button class="btn scientific" onclick="appendFunction('cos(')">cos</button>
                            <button class="btn scientific" onclick="appendFunction('tan(')">tan</button>
                            <button class="btn scientific" onclick="appendInput('pi')">Ï€</button>
                            <button class="btn scientific" onclick="appendFunction('sqrt(')">âˆš</button>

                            <button class="btn" onclick="appendInput('7')">7</button>
                            <button class="btn" onclick="appendInput('8')">8</button>
                            <button class="btn" onclick="appendInput('9')">9</button>
                            <button class="btn operator" onclick="appendInput('/')">Ã·</button>
                            <button class="btn operator" onclick="clearAll()">C</button>
                            
                            <button class="btn" onclick="appendInput('4')">4</button>
                            <button class="btn" onclick="appendInput('5')">5</button>
                            <button class="btn" onclick="appendInput('6')">6</button>
                            <button class="btn operator" onclick="appendInput('*')">Ã—</button>
                            <button class="btn" onclick="backspace()">âŒ«</button>

                            <button class="btn" onclick="appendInput('1')">1</button>
                            <button class="btn" onclick="appendInput('2')">2</button>
                            <button class="btn" onclick="appendInput('3')">3</button>
                            <button class="btn operator" onclick="appendInput('-')">-</button>
                            <button class="btn" onclick="appendInput('(')">(</button>

                            <button class="btn" onclick="appendInput('0')">0</button>
                            <button class="btn" onclick="appendInput('.')">.</button>
                            <button class="btn operator" onclick="appendInput('%')">%</button>
                            <button class="btn operator" onclick="appendInput('+')">+</button>
                            <button class="btn" onclick="appendInput(')')">)</button>
                            
                            <button class="btn scientific" onclick="appendInput('^')">x^y</button>
                            <button class="btn scientific" onclick="appendInput('e')">e</button>
                            <button class="btn scientific" onclick="appendFunction('log10(')">log</button>
                            <button class="btn equals" onclick="calculate()">=</button>
                        </div>
                    </div>
                    <div class="history-container">
                        <div class="history-header">
                            <h3>History</h3>
                            <button id="clear-history" onclick="clearHistory()">Clear</button>
                        </div>
                        <ul class="history-list" id="history-list"></ul>
                    </div>
                </div>
            </section>
            
            <!-- Math Notes Page -->
            <section class="page" id="math-notes-page">
                 <div class="notes-container">
                    <h2>Math Notes</h2>
                    <p>Record your mathematical thoughts, formulas, and equations here.</p>
                    <textarea id="math-notes" placeholder="e.g., The quadratic formula: x = [-b Â± sqrt(b^2-4ac)] / (2a)"></textarea>
                    <div class="notes-actions">
                        <button onclick="saveNotes()">Save Notes</button>
                        <button onclick="clearNotes()">Clear Notes</button>
                    </div>
                </div>
            </section>
            
            <!-- Graph Calculator Page -->
            <section class="page" id="graph-page">
                <div class="graph-page">
                    <h2>Graph Calculator</h2>
                    <p>Enter one or more functions to graph, separated by a comma (e.g., x^2, sin(x)).</p>
                    <div class="graph-controls">
                        <input type="text" id="function-input" placeholder="e.g., x^3 - 6*x, 2*cos(x)">
                        <button onclick="plotFunction()">Plot Graph</button>
                    </div>
                    <div class="graph-container">
                        <canvas id="graph-canvas"></canvas>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script>
        // --- Core App Logic (Navigation & Theming) ---
        const navItems = document.querySelectorAll('.nav-item');
        const pages = document.querySelectorAll('.page');
        const themeSwitcher = document.getElementById('theme-switcher');

        navItems.forEach(item => {
            item.addEventListener('click', () => {
                navItems.forEach(i => i.classList.remove('active'));
                pages.forEach(p => p.classList.remove('active'));
                
                item.classList.add('active');
                document.getElementById(`${item.dataset.page}-page`).classList.add('active');
            });
        });

        themeSwitcher.addEventListener('click', () => {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
        });

        // Load saved theme
        document.addEventListener('DOMContentLoaded', () => {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
        });

        // --- Calculator Logic ---
        const display = document.getElementById('display');
        const calculationDisplay = document.getElementById('calculation');
        let currentInput = '0';
        let isResultDisplayed = false;
        let history = JSON.parse(localStorage.getItem('calculatorHistory')) || [];

        function updateDisplay() {
            display.textContent = currentInput;
        }

        function appendInput(value) {
            if (currentInput === '0' || isResultDisplayed) {
                currentInput = '';
                isResultDisplayed = false;
            }
            currentInput += value;
            updateDisplay();
        }
        
        function appendFunction(func) {
            if (currentInput === '0' || isResultDisplayed) {
                currentInput = '';
                isResultDisplayed = false;
            }
            currentInput += func;
            updateDisplay();
        }

        function clearAll() {
            currentInput = '0';
            calculationDisplay.textContent = '';
            updateDisplay();
        }

        function backspace() {
            if (isResultDisplayed) return;
            currentInput = currentInput.slice(0, -1) || '0';
            updateDisplay();
        }

        function calculate() {
            if (currentInput === '') return;
            try {
                const expression = currentInput;
                const result = math.evaluate(expression);
                
                calculationDisplay.textContent = expression + ' =';
                currentInput = result.toString();
                isResultDisplayed = true;
                
                // Add to history
                addToHistory(expression, currentInput);
                
                updateDisplay();
            } catch (error) {
                calculationDisplay.textContent = '';
                currentInput = 'Error';
                isResultDisplayed = true;
                updateDisplay();
            }
        }
        
        function addToHistory(expression, result) {
            history.unshift({ expression, result });
            if (history.length > 20) history.pop(); // Keep history to a reasonable size
            localStorage.setItem('calculatorHistory', JSON.stringify(history));
            renderHistory();
        }
        
        function renderHistory() {
            const historyList = document.getElementById('history-list');
            historyList.innerHTML = '';
            history.forEach(item => {
                const li = document.createElement('li');
                li.innerHTML = `<strong>${item.result}</strong><span class="history-expr">${item.expression}</span>`;
                li.addEventListener('click', () => {
                    currentInput = item.expression;
                    isResultDisplayed = false;
                    calculationDisplay.textContent = '';
                    updateDisplay();
                });
                historyList.appendChild(li);
            });
        }
        
        function clearHistory() {
            history = [];
            localStorage.removeItem('calculatorHistory');
            renderHistory();
        }

        // --- Math Notes Logic ---
        const notesArea = document.getElementById('math-notes');

        function saveNotes() {
            localStorage.setItem('mathNotes', notesArea.value);
            showToast('Notes saved successfully!');
        }

        function clearNotes() {
            notesArea.value = '';
            localStorage.removeItem('mathNotes');
            showToast('Notes cleared.');
        }

        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'toast-notification';
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => toast.classList.add('show'), 10);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => document.body.removeChild(toast), 300);
            }, 3000);
        }

        // Load saved notes
        notesArea.value = localStorage.getItem('mathNotes') || '';

        // --- Graphing Logic ---
        const canvas = document.getElementById('graph-canvas');
        const ctx = canvas.getContext('2d');
        const functionInput = document.getElementById('function-input');
        const graphColors = ['#bb9af7', '#7aa2f7', '#73daca', '#f7768e', '#e0af68'];


        function plotFunction() {
            const expressions = functionInput.value.split(',').map(e => e.trim());
            if (!expressions || expressions[0] === '') return;
            drawGraph(expressions);
        }

        function drawGraph(expressions) {
            const container = canvas.parentElement;
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;

            const width = canvas.width, height = canvas.height;
            const padding = 20;
            const xMin = -10, xMax = 10, yMin = -10, yMax = 10;
            
            ctx.clearRect(0, 0, width, height);

            // Draw axes and grid
            drawGrid();

            const compiledFunctions = expressions.map(expr => {
                try {
                    return math.compile(expr);
                } catch {
                    return null;
                }
            });
            
            compiledFunctions.forEach((func, index) => {
                if (!func) return;
                
                ctx.strokeStyle = graphColors[index % graphColors.length];
                ctx.lineWidth = 2;
                ctx.beginPath();
                let firstPoint = true;

                for (let px = 0; px <= width; px++) {
                    const x = (px / width) * (xMax - xMin) + xMin;
                    try {
                        const y = func.evaluate({ x });
                        if (isNaN(y) || !isFinite(y)) {
                            firstPoint = true; continue;
                        }
                        const py = height - ((y - yMin) / (yMax - yMin)) * height;

                        if (firstPoint) {
                            ctx.moveTo(px, py);
                            firstPoint = false;
                        } else {
                            ctx.lineTo(px, py);
                        }
                    } catch { /* ignore eval errors for specific points */ }
                }
                ctx.stroke();
            });
        }
        
        function drawGrid() {
            // Simplified grid logic
            ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--muted');
            ctx.lineWidth = 0.5;

            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            
            // Axes
            ctx.beginPath();
            ctx.moveTo(0, centerY); ctx.lineTo(canvas.width, centerY); // X-axis
            ctx.moveTo(centerX, 0); ctx.lineTo(centerX, canvas.height); // Y-axis
            ctx.stroke();
        }

        // Initial render on load
        document.addEventListener('DOMContentLoaded', () => {
            updateDisplay();
            renderHistory();
        });

    </script>
</body>
</html>
