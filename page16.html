<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" href="Chronofocus.png" type="image/x-icon">
<title>Chrono Focus Pro - Advanced Task & Calendar Manager</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  /* Material Design 3 Color Palette */
  --md-primary: #6750A4;
  --md-primary-rgb: 103, 80, 164;
  --md-on-primary: #FFFFFF;
  --md-primary-container: #EADDFF;
  --md-on-primary-container: #21005D;
  
  --md-secondary: #625B71;
  --md-secondary-rgb: 98, 91, 113;
  --md-on-secondary: #FFFFFF;
  --md-secondary-container: #E8DEF8;
  --md-on-secondary-container: #1D192B;
  
  --md-tertiary: #7D5260;
  --md-tertiary-rgb: 125, 82, 96;
  --md-on-tertiary: #FFFFFF;
  --md-tertiary-container: #FFD8E4;
  --md-on-tertiary-container: #31111D;
  
  --md-error: #B3261E;
  --md-error-rgb: 179, 38, 30;
  --md-on-error: #FFFFFF;
  --md-error-container: #F9DEDC;
  --md-on-error-container: #410E0B;
  
  --md-background: #FFFBFE;
  --md-on-background: #1C1B1F;
  --md-surface: #FFFBFE;
  --md-on-surface: #1C1B1F;
  --md-surface-variant: #E7E0EC;
  --md-on-surface-variant: #49454F;
  --md-outline: #79747E;
  --md-outline-variant: #CAC4D0;
  
  --md-shadow-color: #000000;
  
  /* Custom variables */
  --background: var(--md-background);
  --surface: var(--md-surface);
  --surface-elevated: var(--md-surface);
  --primary: var(--md-primary);
  --primary-rgb: var(--md-primary-rgb);
  --primary-light: var(--md-primary-container);
  --secondary: var(--md-secondary);
  --text-primary: var(--md-on-surface);
  --text-secondary: var(--md-on-surface-variant);
  --text-disabled: var(--md-outline);
  --border-color: var(--md-outline-variant);
  --success: #0D7377;
  --warning: #FFB740;
  --danger: var(--md-error);
  --hover-overlay: rgba(103, 80, 164, 0.08);
  --active-overlay: rgba(103, 80, 164, 0.12);
  
  /* Rounded corners */
  --border-radius-sm: 8px;
  --border-radius: 16px;
  --border-radius-lg: 24px;
  --border-radius-xl: 28px;
  
  /* Shadows */
  --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
  --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
  --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
  --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
  
  /* Task Priority Colors */
  --priority-high: #FF5252;
  --priority-medium: #FFB740;
  --priority-low: #0D7377;
  
  /* Calendar Colors */
  --today-bg: var(--md-primary-container);
  --today-text: var(--md-on-primary-container);
  --weekend-bg: #F5F5F5;
  --weekend-text: var(--md-on-surface-variant);
}

/* Dark Mode */
body.theme-dark {
  --md-primary: #D0BCFF;
  --md-primary-rgb: 208, 188, 255;
  --md-on-primary: #381E72;
  --md-primary-container: #4F378B;
  --md-on-primary-container: #EADDFF;
  
  --md-secondary: #CCC2DC;
  --md-secondary-rgb: 204, 194, 220;
  --md-on-secondary: #332D41;
  --md-secondary-container: #4A4458;
  --md-on-secondary-container: #E8DEF8;
  
  --md-tertiary: #EFB8C8;
  --md-tertiary-rgb: 239, 184, 200;
  --md-on-tertiary: #492532;
  --md-tertiary-container: #633B48;
  --md-on-tertiary-container: #FFD8E4;
  
  --md-error: #F2B8B5;
  --md-error-rgb: 242, 184, 181;
  --md-on-error: #601410;
  --md-error-container: #8C1D18;
  --md-on-error-container: #F9DEDC;
  
  --md-background: #141218;
  --md-on-background: #E6E1E5;
  --md-surface: #141218;
  --md-on-surface: #E6E1E5;
  --md-surface-variant: #49454F;
  --md-on-surface-variant: #CAC4D0;
  --md-outline: #938F99;
  --md-outline-variant: #49454F;
  
  --background: var(--md-background);
  --surface: var(--md-surface);
  --surface-elevated: #1D1B20;
  --primary: var(--md-primary);
  --primary-rgb: var(--md-primary-rgb);
  --primary-light: var(--md-primary-container);
  --text-primary: var(--md-on-surface);
  --text-secondary: var(--md-on-surface-variant);
  --text-disabled: var(--md-outline);
  --border-color: var(--md-outline-variant);
  --hover-overlay: rgba(208, 188, 255, 0.08);
  --active-overlay: rgba(208, 188, 255, 0.12);
  --today-bg: var(--md-primary-container);
  --today-text: var(--md-on-primary-container);
  --weekend-bg: #2A2A2A;
}

/* Additional Theme Variations */
body.theme-sunset {
  --md-primary: #FF8C42;
  --md-primary-rgb: 255, 140, 66;
  --md-on-primary: #FFFFFF;
  --md-primary-container: #FFE0B2;
  --md-on-primary-container: #311E00;
  --md-secondary: #FF6B6B;
  --md-background: linear-gradient(135deg, #0F0C29, #302B63, #24243E);
  --md-surface: rgba(44, 33, 92, 0.8);
  --md-on-surface: #FAD0C4;
  --md-surface-variant: rgba(60, 46, 107, 0.8);
  --md-on-surface-variant: #AFA6C3;
  --border-color: rgba(255, 255, 255, 0.2);
}

body.theme-forest {
  --md-primary: #4ECDC4;
  --md-primary-rgb: 78, 205, 196;
  --md-on-primary: #00332F;
  --md-primary-container: #004F49;
  --md-on-primary-container: #6FF7EE;
  --md-secondary: #B2CC92;
  --md-background: #0F2027;
  --md-surface: #203A43;
  --md-on-surface: #F7F7F7;
  --md-surface-variant: #2C5364;
  --md-on-surface-variant: #A4B0BE;
  --border-color: #34495E;
}

/* Global Styles */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  background-color: var(--background);
  color: var(--text-primary);
  line-height: 1.5;
  transition: var(--transition);
  overflow-x: hidden;
  background-image: var(--background-image, none);
  background-size: cover;
  background-attachment: fixed;
  background-repeat: no-repeat;
  scroll-behavior: smooth;
}

/* App Layout */
.app-container {
  display: flex;
  min-height: 100vh;
  overflow: auto;
}

/* Sidebar */
.sidebar {
  width: 280px;
  background: var(--surface);
  border-right: 1px solid var(--border-color);
  display: flex;
  flex-direction: column;
  transition: var(--transition);
  box-shadow: var(--shadow-sm);
  z-index: 100;
  flex-shrink: 0;
  border-radius: 0 var(--border-radius-lg) var(--border-radius-lg) 0;
  overflow: hidden;
}

.sidebar.collapsed {
  width: 0;
  padding: 0;
  overflow: hidden;
  border-right: none;
}

.sidebar-header {
  padding: 24px;
  border-bottom: 1px solid var(--border-color);
  background: var(--surface-elevated);
  border-radius: 0 var(--border-radius-lg) 0 0;
}

.app-title {
  font-size: 1.6rem;
  font-weight: 700;
  color: var(--primary);
  margin: 0;
  display: flex;
  align-items: center;
  gap: 12px;
}

.sidebar-nav {
  padding: 16px 0;
  flex: 1;
}

.nav-item {
  display: flex;
  align-items: center;
  padding: 14px 24px;
  cursor: pointer;
  transition: var(--transition);
  border: none;
  background: none;
  width: 100%;
  text-align: left;
  font-size: 0.95rem;
  font-weight: 500;
  color: var(--text-primary);
  gap: 15px;
  border-left: 3px solid transparent;
  border-radius: 0 var(--border-radius) var(--border-radius) 0;
}

.nav-item:hover {
  background: var(--hover-overlay);
}

.nav-item.active {
  background: var(--primary-light);
  color: var(--primary);
  border-left-color: var(--primary);
}

.nav-item i {
  width: 22px;
  text-align: center;
  font-size: 1rem;
}

/* Main Content */
.main-content {
  flex-grow: 1;
  display: flex;
  flex-direction: column;
  overflow: auto;
  min-height: 100vh;
}

.main-header {
  padding: 20px 24px;
  background: var(--surface);
  border-bottom: 1px solid var(--border-color);
  display: flex;
  align-items: center;
  justify-content: space-between;
  flex-wrap: wrap;
  gap: 16px;
  box-shadow: var(--shadow-sm);
  z-index: 50;
  border-radius: 0 0 var(--border-radius-lg) var(--border-radius-lg);
  margin: 0 8px 8px 8px;
}

.header-title {
  font-size: 1.75rem;
  font-weight: 600;
  color: var(--text-primary);
  display: flex;
  align-items: center;
  gap: 12px;
}

.header-controls {
  display: flex;
  align-items: center;
  gap: 12px;
}

.toggle-sidebar-btn,
.calendar-back-btn {
  display: none;
  background: none;
  border: none;
  color: var(--text-secondary);
  font-size: 1.25rem;
  cursor: pointer;
  padding: 8px;
  border-radius: var(--border-radius);
  transition: var(--transition);
}

.toggle-sidebar-btn:hover,
.calendar-back-btn:hover {
  background: var(--hover-overlay);
}

/* Content Area */
.content-area {
  flex: 1;
  display: flex;
  overflow: auto;
  padding: 8px;
}

.calendar-section {
  width: 350px;
  background: var(--surface);
  border-right: 1px solid var(--border-color);
  display: flex;
  flex-direction: column;
  transition: var(--transition);
  flex-shrink: 0;
  border-radius: var(--border-radius-lg);
  margin-right: 8px;
  overflow: hidden;
}

.calendar-section.hidden {
  width: 0;
  overflow: hidden;
  border-right: none;
  margin-right: 0;
}

.tasks-section {
  flex: 1;
  background: var(--surface);
  display: flex;
  flex-direction: column;
  overflow: hidden;
  border-radius: var(--border-radius-lg);
  box-shadow: var(--shadow-sm);
}

/* Calendar Styles */
.calendar-header {
  padding: 20px;
  border-bottom: 1px solid var(--border-color);
  text-align: center;
  background: var(--surface-elevated);
  border-radius: var(--border-radius-lg) var(--border-radius-lg) 0 0;
}

.calendar-top-controls {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
}

.calendar-nav {
  display: flex;
  align-items: center;
  justify-content: space-between;
  flex-grow: 1;
}

.calendar-nav button {
  background: none;
  border: none;
  color: var(--text-secondary);
  cursor: pointer;
  padding: 8px;
  border-radius: var(--border-radius);
  transition: var(--transition);
  font-size: 1.1rem;
}

.calendar-nav button:hover {
  background: var(--hover-overlay);
  color: var(--text-primary);
}

.calendar-title {
  font-size: 1.1rem;
  font-weight: 600;
  color: var(--text-primary);
}

.calendar-grid {
  padding: 20px;
  overflow-y: auto;
  flex: 1;
}

.calendar-weekdays {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 4px;
  margin-bottom: 8px;
}

.calendar-weekday {
  padding: 8px 4px;
  text-align: center;
  font-size: 0.75rem;
  font-weight: 600;
  color: var(--text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.calendar-days {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 4px;
}

.calendar-day {
  aspect-ratio: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  border-radius: var(--border-radius);
  transition: var(--transition);
  position: relative;
  font-size: 0.875rem;
  font-weight: 500;
  background: transparent;
  border: 1px solid transparent;
}

.calendar-day:hover {
  background: var(--hover-overlay);
}

.calendar-day.today {
  background: var(--today-bg);
  color: var(--today-text);
  font-weight: 600;
}

.calendar-day.selected {
  background: var(--primary);
  color: white;
}

.calendar-day.other-month {
  color: var(--text-disabled);
}

.calendar-day.has-tasks::after {
  content: '';
  width: 6px;
  height: 6px;
  background: var(--primary);
  border-radius: 50%;
  position: absolute;
  bottom: 2px;
  left: 50%;
  transform: translateX(-50%);
}

/* Task Section Styles */
.tasks-header {
  padding: 20px 24px;
  border-bottom: 1px solid var(--border-color);
  background: var(--surface);
  border-radius: var(--border-radius-lg) var(--border-radius-lg) 0 0;
}

.task-input-container {
  display: flex;
  gap: 12px;
  align-items: flex-start;
  margin-bottom: 20px;
}

.task-input-wrapper {
  flex: 1;
  position: relative;
}

.task-input {
  width: 100%;
  padding: 16px 20px;
  border: 2px solid var(--border-color);
  border-radius: var(--border-radius-lg);
  font-size: 1rem;
  background: var(--surface-elevated);
  color: var(--text-primary);
  transition: var(--transition);
  resize: none;
  font-family: inherit;
  line-height: 1.5;
  min-height: 56px;
  max-height: 120px;
}

.task-input:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 4px rgba(var(--primary-rgb), 0.1);
}

.task-input::placeholder {
  color: var(--text-secondary);
}

.add-task-btn {
  padding: 16px 24px;
  background: var(--primary);
  color: white;
  border: none;
  border-radius: var(--border-radius-lg);
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition);
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 1rem;
  box-shadow: var(--shadow-sm);
}

.add-task-btn:hover {
  opacity: 0.9;
  transform: translateY(-1px);
  box-shadow: var(--shadow-md);
}

.add-task-btn:active {
  transform: translateY(0);
}

.task-options {
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
}

.task-option-select {
  padding: 8px 16px;
  border: 1px solid var(--border-color);
  border-radius: var(--border-radius);
  background: var(--surface);
  color: var(--text-primary);
  font-size: 0.875rem;
  cursor: pointer;
  transition: var(--transition);
}

.task-option-select:focus {
  outline: none;
  border-color: var(--primary);
}

/* Task List */
.tasks-content {
  flex: 1;
  overflow-y: auto;
  padding: 0 24px 24px;
}

.task-list-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 20px;
  padding-top: 20px;
  position: sticky;
  top: 0;
  background: var(--surface);
  z-index: 10;
  padding-bottom: 10px;
}

.task-count {
  color: var(--text-secondary);
  font-size: 0.875rem;
  font-weight: 500;
}

.task-filters {
  display: flex;
  gap: 8px;
}

.filter-btn {
  padding: 6px 12px;
  background: none;
  border: 1px solid var(--border-color);
  border-radius: var(--border-radius);
  color: var(--text-secondary);
  font-size: 0.875rem;
  cursor: pointer;
  transition: var(--transition);
}

.filter-btn:hover {
  background: var(--hover-overlay);
}

.filter-btn.active {
  background: var(--primary);
  color: white;
  border-color: var(--primary);
}

.tasks-list {
  list-style: none;
}

.task-item {
  display: flex;
  align-items: flex-start;
  gap: 16px;
  padding: 16px;
  background: var(--surface);
  border: 1px solid var(--border-color);
  border-radius: var(--border-radius-lg);
  margin-bottom: 12px;
  transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
  cursor: pointer;
  opacity: 0;
  animation: slideInUp 0.5s cubic-bezier(0.25, 0.8, 0.25, 1) forwards;
}

.task-item:nth-child(1) { animation-delay: 0.05s; }
.task-item:nth-child(2) { animation-delay: 0.1s; }
.task-item:nth-child(3) { animation-delay: 0.15s; }
.task-item:nth-child(4) { animation-delay: 0.2s; }
.task-item:nth-child(5) { animation-delay: 0.25s; }

.task-item.fade-out {
  animation: fadeOut 0.4s forwards;
}

.task-item:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-lg);
  border-color: rgba(var(--primary-rgb), 0.3);
}

.task-item.completed {
  opacity: 0.7;
  background: rgba(128,128,128,0.05);
}

.task-item.completed .task-text-content {
  text-decoration: line-through;
  color: var(--text-secondary);
}

.task-item.dragging {
  transform: rotate(5deg) scale(1.05);
  box-shadow: var(--shadow-xl);
  z-index: 1000;
}

.task-checkbox {
  width: 20px;
  height: 20px;
  border: 2px solid var(--border-color);
  border-radius: 50%;
  cursor: pointer;
  transition: var(--transition);
  flex-shrink: 0;
  position: relative;
  margin-top: 2px;
}

.task-checkbox:hover {
  border-color: var(--primary);
}

.task-checkbox.checked {
  background: var(--primary);
  border-color: var(--primary);
}

.task-checkbox.checked::after {
  content: '✓';
  color: white;
  font-size: 12px;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-weight: bold;
}

.task-content {
  flex: 1;
  min-width: 0;
}

.task-text-content {
  display: flex;
  align-items: center;
  gap: 10px;
}

.task-icon {
  font-size: 1.1rem;
  color: var(--text-secondary);
  transition: color 0.3s;
  cursor: pointer;
}

.task-item:hover .task-icon {
  color: var(--primary);
}

.task-item.completed .task-icon {
  color: var(--text-disabled);
}

.task-text {
  font-size: 1rem;
  color: var(--text-primary);
  line-height: 1.5;
  word-wrap: break-word;
  margin-bottom: 4px;
}

.task-meta {
  display: flex;
  align-items: center;
  gap: 12px;
  font-size: 0.75rem;
  color: var(--text-secondary);
  flex-wrap: wrap;
  margin-top: 8px;
}

.task-priority {
  padding: 2px 8px;
  border-radius: 12px;
  font-weight: 500;
  font-size: 0.7rem;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.task-priority.high {
  background: rgba(255, 82, 82, 0.1);
  color: var(--priority-high);
}

.task-priority.medium {
  background: rgba(255, 183, 64, 0.1);
  color: var(--priority-medium);
}

.task-priority.low {
  background: rgba(13, 115, 119, 0.1);
  color: var(--priority-low);
}

.task-date {
  display: flex;
  align-items: center;
  gap: 4px;
}

.task-actions {
  display: flex;
  gap: 8px;
  opacity: 0;
  transition: var(--transition);
}

.task-item:hover .task-actions {
  opacity: 1;
}

.task-action-btn {
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: none;
  border: none;
  border-radius: var(--border-radius);
  color: var(--text-secondary);
  cursor: pointer;
  transition: var(--transition);
  font-size: 0.875rem;
}

.task-action-btn:hover {
  background: var(--hover-overlay);
  color: var(--text-primary);
}

.task-action-btn.edit:hover {
  color: var(--primary);
}

.task-action-btn.delete:hover {
  color: var(--danger);
}

/* Theme Selector */
.theme-selector {
  position: relative;
}

.theme-btn {
  background: none;
  border: none;
  color: var(--text-secondary);
  cursor: pointer;
  padding: 8px;
  border-radius: var(--border-radius);
  transition: var(--transition);
  font-size: 1.1rem;
}

.theme-btn:hover {
  background: var(--hover-overlay);
  color: var(--text-primary);
}

.theme-modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(0, 0, 0, 0.5);
  z-index: 999;
  opacity: 0;
  visibility: hidden;
  transition: opacity 0.3s ease, visibility 0.3s;
}

.theme-modal-overlay.visible {
  opacity: 1;
  visibility: visible;
}

.theme-dropdown {
  position: fixed;
  top: 50%;
  left: 50%;
  background: var(--surface-elevated);
  border: 1px solid var(--border-color);
  border-radius: var(--border-radius-lg);
  box-shadow: var(--shadow-xl);
  padding: 8px;
  min-width: 250px;
  z-index: 1000;
  opacity: 0;
  visibility: hidden;
  transform: translate(-50%, -50%) scale(0.9);
  transition: opacity 0.3s ease, transform 0.3s ease, visibility 0.3s;
}

.theme-dropdown.visible {
  opacity: 1;
  visibility: visible;
  transform: translate(-50%, -50%) scale(1);
}

.theme-option {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px;
  cursor: pointer;
  border-radius: var(--border-radius);
  transition: var(--transition);
}

.theme-option:hover {
  background: var(--hover-overlay);
}

.theme-color {
  width: 20px;
  height: 20px;
  border-radius: 50%;
  border: 1px solid var(--border-color);
}

/* Toast Notifications */
.toast-container {
  position: fixed;
  bottom: 20px;
  right: 20px;
  z-index: 2000;
}

.toast {
  background: var(--surface-elevated);
  color: var(--text-primary);
  padding: 16px 20px;
  border-radius: var(--border-radius-lg);
  box-shadow: var(--shadow-xl);
  border: 1px solid var(--border-color);
  margin-bottom: 12px;
  transform: translateX(120%);
  opacity: 0;
  transition: all 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
  max-width: 320px;
  display: flex;
  align-items: center;
  gap: 12px;
}

.toast::before {
  font-family: "Font Awesome 6 Free";
  font-weight: 900;
  font-size: 1.2rem;
}

.toast.show {
  transform: translateX(0);
  opacity: 1;
}

.toast.success {
  border-left: 4px solid var(--success);
}

.toast.success::before {
  content: "\f058";
  color: var(--success);
}

.toast.error {
  border-left: 4px solid var(--danger);
}

.toast.error::before {
  content: "\f071";
  color: var(--danger);
}

/* Animations */
@keyframes slideInUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes fadeOut {
  from {
    opacity: 0.7;
    transform: scale(1);
  }
  to {
    opacity: 0;
    transform: scale(0.9);
    height: 0;
    padding: 0;
    margin: 0;
    border: 0;
  }
}

/* Icon Selector Modal */
.icon-modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 3000;
  opacity: 0;
  visibility: hidden;
  transition: opacity 0.3s, visibility 0.3s;
}

.icon-modal.visible {
  opacity: 1;
  visibility: visible;
}

.icon-modal-content {
  background: var(--surface);
  border-radius: var(--border-radius-lg);
  padding: 24px;
  width: 90%;
  max-width: 500px;
  max-height: 80vh;
  overflow-y: auto;
  box-shadow: var(--shadow-xl);
}

.icon-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 12px;
  margin-top: 16px;
}

.icon-option {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 12px;
  border-radius: var(--border-radius);
  background: var(--surface-elevated);
  cursor: pointer;
  transition: var(--transition);
  font-size: 1.2rem;
}

.icon-option:hover {
  background: var(--hover-overlay);
  transform: scale(1.1);
}

.icon-option.selected {
  background: var(--primary-light);
  color: var(--primary);
}

/* Recurring Task Options */
.recurring-options {
  display: flex;
  gap: 8px;
  margin-top: 12px;
  flex-wrap: wrap;
}

.recurring-option {
  padding: 6px 12px;
  border: 1px solid var(--border-color);
  border-radius: var(--border-radius);
  background: var(--surface);
  color: var(--text-primary);
  font-size: 0.8rem;
  cursor: pointer;
  transition: var(--transition);
}

.recurring-option:hover {
  background: var(--hover-overlay);
}

.recurring-option.active {
  background: var(--primary);
  color: white;
  border-color: var(--primary);
}

/* Task Suggestion */
.task-suggestion {
  background: var(--surface-elevated);
  border: 1px solid var(--border-color);
  border-radius: var(--border-radius);
  padding: 12px;
  margin-top: 12px;
  display: none;
}

.suggestion-title {
  font-size: 0.9rem;
  font-weight: 600;
  margin-bottom: 8px;
  color: var(--text-primary);
}

.suggestion-list {
  list-style: none;
}

.suggestion-item {
  padding: 8px 0;
  border-bottom: 1px solid var(--border-color);
  cursor: pointer;
  transition: var(--transition);
  display: flex;
  align-items: center;
  gap: 8px;
}

.suggestion-item:last-child {
  border-bottom: none;
}

.suggestion-item:hover {
  color: var(--primary);
}

/* Responsive Design */
@media (max-width: 992px) {
  .sidebar {
    position: fixed;
    left: 0;
    top: 0;
    height: 100vh;
    z-index: 200;
    transform: translateX(-100%);
    width: 280px;
    transition: transform 0.3s ease-in-out;
  }

  .sidebar.visible {
    transform: translateX(0);
  }

  .sidebar.collapsed {
    width: 280px;
    transform: translateX(-100%);
  }

  .toggle-sidebar-btn {
    display: block;
  }
}

@media (max-width: 768px) {
  .calendar-section {
    width: 100%;
    position: fixed;
    left: 0;
    top: 0;
    height: 100vh;
    z-index: 150;
    transform: translateX(-100%);
    transition: transform 0.3s ease-in-out;
    border-right: none;
  }

  .calendar-section.visible {
    transform: translateX(0);
  }

  .calendar-section.hidden {
    width: 100%;
    transform: translateX(-100%);
  }
  
  .calendar-back-btn {
    display: block;
  }
  
  .main-header {
    padding: 16px 20px;
  }

  .header-title {
    font-size: 1.5rem;
  }

  .tasks-header, .tasks-content {
    padding-left: 20px;
    padding-right: 20px;
  }

  .task-input-container {
    flex-direction: column;
    align-items: stretch;
  }

  .app-container {
    flex-direction: column;
  }
  
  .content-area {
    flex-direction: column;
  }
  
  .calendar-section {
    width: 100%;
    margin-right: 0;
    margin-bottom: 8px;
  }
}

@media (max-width: 480px) {
  .task-item {
    padding: 12px;
  }

  .task-input {
    font-size: 16px;
  }

  .calendar-day {
    font-size: 0.75rem;
  }
  
  .icon-grid {
    grid-template-columns: repeat(4, 1fr);
  }
}

/* Scrollbar Styling */
::-webkit-scrollbar {
  width: 6px;
}

::-webkit-scrollbar-track {
  background: var(--background);
}

::-webkit-scrollbar-thumb {
  background: var(--border-color);
  border-radius: 3px;
}

::-webkit-scrollbar-thumb:hover {
  background: var(--text-secondary);
}

/* Drag and Drop */
.drag-over {
  background: var(--primary-light);
  border-color: var(--primary);
}

.drop-zone {
  min-height: 60px;
  border: 2px dashed var(--border-color);
  border-radius: var(--border-radius-lg);
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--text-secondary);
  font-size: 0.875rem;
  margin: 12px 0;
  transition: var(--transition);
}

.drop-zone.active {
  border-color: var(--primary);
  background: var(--primary-light);
  color: var(--primary);
}

/* Empty State */
.empty-state {
  text-align: center;
  padding: 60px 20px;
  color: var(--text-secondary);
  display: none;
}

.empty-state i {
  font-size: 3rem;
  margin-bottom: 16px;
  color: var(--text-disabled);
}

.empty-state h3 {
  font-size: 1.25rem;
  font-weight: 600;
  margin-bottom: 8px;
  color: var(--text-primary);
}

.empty-state p {
  font-size: 0.875rem;
  line-height: 1.5;
}

/* Focus Styles for Accessibility */
a, button, input, select, .task-item, .calendar-day {
  --focus-ring-color: var(--primary);
}

:is(a, button, input, select, .task-item, .calendar-day):focus-visible {
  outline: 2px solid var(--focus-ring-color);
  outline-offset: 2px;
  box-shadow: 0 0 0 4px rgba(var(--primary-rgb), 0.2);
}

/* Print Styles */
@media print {
  .sidebar,
  .theme-selector,
  .task-actions,
  .calendar-nav,
  .main-header {
    display: none;
  }
  
  .main-content {
    margin-left: 0;
  }
  
  .task-item {
    break-inside: avoid;
    border: 1px solid #ccc;
    box-shadow: none;
  }
}
</style>
</head>
<body class="theme-dark">
<div class="app-container">
  <!-- Sidebar -->
  <div class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <h1 class="app-title">
        <i class="fas fa-check-circle"></i>
        Chrono Focus Pro
      </h1>
    </div>
    <nav class="sidebar-nav">
      <button class="nav-item active" data-view="today">
        <i class="fas fa-calendar-day"></i>
        Today
      </button>
      <button class="nav-item" data-view="upcoming">
        <i class="fas fa-calendar-week"></i>
        Upcoming
      </button>
      <button class="nav-item" data-view="all">
        <i class="fas fa-list"></i>
        All Tasks
      </button>
      <button class="nav-item" data-view="completed">
        <i class="fas fa-check-double"></i>
        Completed
      </button>
      <button class="nav-item" data-view="priority">
        <i class="fas fa-star"></i>
        Priority
      </button>
    </nav>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Header -->
    <header class="main-header">
      <div style="display: flex; align-items: center; gap: 12px;">
        <button class="toggle-sidebar-btn" id="toggleSidebar" aria-label="Toggle Sidebar">
          <i class="fas fa-bars"></i>
        </button>
        <h2 class="header-title" id="pageTitle">
          <i class="fas fa-calendar-day"></i>
          Today
        </h2>
      </div>
      <div class="header-controls">
        <button class="theme-btn" id="toggleCalendar" title="Toggle Calendar" aria-label="Toggle Calendar">
          <i class="fas fa-calendar"></i>
        </button>
        <div class="theme-selector">
          <button class="theme-btn" id="themeButton" title="Change Theme" aria-label="Change Theme">
            <i class="fas fa-palette"></i>
          </button>
        </div>
      </div>
    </header>

    <!-- Content Area -->
    <main class="content-area">
      <!-- Calendar Section -->
      <section class="calendar-section" id="calendarSection">
        <div class="calendar-header">
          <div class="calendar-top-controls">
              <a href="#" class="calendar-back-btn" id="calendarBackBtn" aria-label="Go Back">
                  <i class="fas fa-arrow-left"></i>
              </a>
              <div class="calendar-nav">
                <button id="prevMonth" aria-label="Previous Month"><i class="fas fa-chevron-left"></i></button>
                <div class="calendar-title" id="calendarTitle"></div>
                <button id="nextMonth" aria-label="Next Month"><i class="fas fa-chevron-right"></i></button>
              </div>
          </div>
          <button style="padding: 8px 16px; background: var(--primary); color: white; border: none; border-radius: var(--border-radius); font-size: 0.875rem; cursor: pointer;" id="todayBtn">Today</button>
        </div>
        <div class="calendar-grid">
          <div class="calendar-weekdays">
            <div class="calendar-weekday">Sun</div>
            <div class="calendar-weekday">Mon</div>
            <div class="calendar-weekday">Tue</div>
            <div class="calendar-weekday">Wed</div>
            <div class="calendar-weekday">Thu</div>
            <div class="calendar-weekday">Fri</div>
            <div class="calendar-weekday">Sat</div>
          </div>
          <div class="calendar-days" id="calendarDays"></div>
        </div>
      </section>

      <!-- Tasks Section -->
      <section class="tasks-section">
        <div class="tasks-header">
          <div class="task-input-container">
            <div class="task-input-wrapper">
              <textarea
                class="task-input"
                id="taskInput"
                placeholder="Add a task for Today..."
                rows="1"
              ></textarea>
            </div>
            <button class="add-task-btn" id="addTaskBtn">
              <i class="fas fa-plus"></i>
              Add
            </button>
          </div>
          <div class="task-options">
            <select class="task-option-select" id="taskPriority" aria-label="Task Priority">
              <option value="low">Low Priority</option>
              <option value="medium" selected>Medium Priority</option>
              <option value="high">High Priority</option>
            </select>
            <select class="task-option-select" id="taskCategory" aria-label="Task Category">
              <option value="general">📋 General</option>
              <option value="work">💼 Work</option>
              <option value="personal">👤 Personal</option>
              <option value="shopping">🛒 Shopping</option>
              <option value="health">❤️ Health</option>
              <option value="learning">📚 Learning</option>
            </select>
            <button class="task-option-select" id="customIconBtn" title="Select Custom Icon">
              <i class="fas fa-icons"></i> Icon
            </button>
          </div>
          <div class="recurring-options" id="recurringOptions">
            <div class="recurring-option" data-recurring="none">One-time</div>
            <div class="recurring-option" data-recurring="daily">Daily</div>
            <div class="recurring-option" data-recurring="weekly">Weekly</div>
            <div class="recurring-option" data-recurring="monthly">Monthly</div>
          </div>
          <div class="task-suggestion" id="taskSuggestion">
            <div class="suggestion-title">Suggested Tasks</div>
            <ul class="suggestion-list" id="suggestionList"></ul>
          </div>
        </div>

        <div class="tasks-content">
          <div class="task-list-header">
            <div class="task-count" id="taskCount">0 tasks</div>
            <div class="task-filters">
              <button class="filter-btn active" data-filter="all">All</button>
              <button class="filter-btn" data-filter="pending">Active</button>
              <button class="filter-btn" data-filter="completed">Done</button>
            </div>
          </div>

          <div class="drop-zone" id="dropZone" style="display: none;">
            Drop task here to move to this date
          </div>

          <ul class="tasks-list" id="tasksList"></ul>

          <div class="empty-state" id="emptyState">
            <i class="fas fa-clipboard-list"></i>
            <h3>No tasks here</h3>
            <p>Add a new task or select a different date!</p>
          </div>
        </div>
      </section>
    </main>
  </div>
</div>

<!-- Toast Container -->
<div class="toast-container" id="toastContainer"></div>

<!-- Theme Modal -->
<div class="theme-modal-overlay" id="themeModalOverlay"></div>
<div class="theme-dropdown" id="themeDropdown">
  <div class="theme-option" data-theme="default">
    <div class="theme-color" style="background: #6750A4;"></div>
    <span>Light</span>
  </div>
  <div class="theme-option" data-theme="theme-dark">
    <div class="theme-color" style="background: #D0BCFF;"></div>
    <span>Dark</span>
  </div>
  <div class="theme-option" data-theme="theme-sunset">
    <div class="theme-color" style="background: linear-gradient(to right, #FF8C42, #FF6B6B);"></div>
    <span>Sunset</span>
  </div>
  <div class="theme-option" data-theme="theme-forest">
    <div class="theme-color" style="background: #4ECDC4;"></div>
    <span>Forest</span>
  </div>
</div>

<!-- Icon Selector Modal -->
<div class="icon-modal" id="iconModal">
  <div class="icon-modal-content">
    <h3>Select Task Icon</h3>
    <div class="icon-grid" id="iconGrid">
      <!-- Icons will be populated by JavaScript -->
    </div>
    <div style="display: flex; justify-content: flex-end; margin-top: 20px; gap: 12px;">
      <button class="task-option-select" id="cancelIconBtn">Cancel</button>
      <button class="add-task-btn" id="confirmIconBtn" style="padding: 8px 16px;">Confirm</button>
    </div>
  </div>
</div>

<!-- Audio for task completion sound -->
<audio id="taskCompleteSound" preload="auto">
  <source src="https://assets.mixkit.co/sfx/preview/mixkit-unlock-game-notification-253.mp3" type="audio/mpeg">
</audio>

<script>
class ChronoFocusPro {
  constructor() {
    this.currentDate = new Date();
    this.selectedDate = new Date();
    this.currentView = 'today';
    this.currentFilter = 'all';
    this.draggedTask = null;
    this.selectedIcon = 'fas fa-check';
    this.selectedRecurring = 'none';
    this.taskCompleteSound = document.getElementById('taskCompleteSound');

    this.initializeElements();
    this.setupEventListeners();
    this.loadTheme();
    this.renderCalendar();
    this.updateView();
    this.autoResizeTextarea();
    this.populateIconGrid();
    this.setupRecurringOptions();
    this.setupTaskSuggestions();
  }

  initializeElements() {
    this.elements = {
      // Body
      body: document.body,
      // Sidebar
      sidebar: document.getElementById('sidebar'),
      toggleSidebar: document.getElementById('toggleSidebar'),
      navItems: document.querySelectorAll('.nav-item'),

      // Header
      pageTitle: document.getElementById('pageTitle'),
      toggleCalendar: document.getElementById('toggleCalendar'),
      themeButton: document.getElementById('themeButton'),
      themeDropdown: document.getElementById('themeDropdown'),
      themeModalOverlay: document.getElementById('themeModalOverlay'),

      // Calendar
      calendarSection: document.getElementById('calendarSection'),
      calendarTitle: document.getElementById('calendarTitle'),
      calendarDays: document.getElementById('calendarDays'),
      prevMonth: document.getElementById('prevMonth'),
      nextMonth: document.getElementById('nextMonth'),
      todayBtn: document.getElementById('todayBtn'),
      calendarBackBtn: document.getElementById('calendarBackBtn'),

      // Tasks
      taskInput: document.getElementById('taskInput'),
      addTaskBtn: document.getElementById('addTaskBtn'),
      taskPriority: document.getElementById('taskPriority'),
      taskCategory: document.getElementById('taskCategory'),
      tasksList: document.getElementById('tasksList'),
      taskCount: document.getElementById('taskCount'),
      filterBtns: document.querySelectorAll('.filter-btn'),
      dropZone: document.getElementById('dropZone'),
      emptyState: document.getElementById('emptyState'),

      // Custom Icon
      customIconBtn: document.getElementById('customIconBtn'),
      iconModal: document.getElementById('iconModal'),
      iconGrid: document.getElementById('iconGrid'),
      cancelIconBtn: document.getElementById('cancelIconBtn'),
      confirmIconBtn: document.getElementById('confirmIconBtn'),

      // Recurring Tasks
      recurringOptions: document.getElementById('recurringOptions'),

      // Task Suggestions
      taskSuggestion: document.getElementById('taskSuggestion'),
      suggestionList: document.getElementById('suggestionList'),

      // Toast
      toastContainer: document.getElementById('toastContainer')
    };
  }

  setupEventListeners() {
    // Sidebar & Calendar visibility
    this.elements.toggleSidebar.addEventListener('click', () => this.toggleSidebar());
    this.elements.toggleCalendar.addEventListener('click', () => this.toggleCalendar());
    
    // Navigation
    this.elements.navItems.forEach(item => {
      item.addEventListener('click', () => this.switchView(item.dataset.view));
    });

    // Calendar controls
    this.elements.prevMonth.addEventListener('click', () => this.changeMonth(-1));
    this.elements.nextMonth.addEventListener('click', () => this.changeMonth(1));
    this.elements.todayBtn.addEventListener('click', () => this.goToToday());
    this.elements.calendarBackBtn.addEventListener('click', (e) => {
        e.preventDefault();
        this.closeCalendarOnMobile();
    });

    // Task input and actions
    this.elements.taskInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        this.addTask();
      }
    });
    this.elements.addTaskBtn.addEventListener('click', () => this.addTask());

    // Filters
    this.elements.filterBtns.forEach(btn => {
      btn.addEventListener('click', () => this.setFilter(btn.dataset.filter));
    });

    // Theme selector
    this.elements.themeButton.addEventListener('click', (e) => {
        e.stopPropagation();
        this.toggleThemeDropdown();
    });
    this.elements.themeModalOverlay.addEventListener('click', () => this.toggleThemeDropdown());
    this.elements.themeDropdown.addEventListener('click', (e) => e.stopPropagation());
    document.querySelectorAll('.theme-option').forEach(option => {
      option.addEventListener('click', () => {
        this.setTheme(option.dataset.theme);
        this.toggleThemeDropdown();
      });
    });

    // Custom icon selector
    this.elements.customIconBtn.addEventListener('click', () => this.showIconModal());
    this.elements.cancelIconBtn.addEventListener('click', () => this.hideIconModal());
    this.elements.confirmIconBtn.addEventListener('click', () => this.hideIconModal());

    // Task suggestions
    this.elements.taskInput.addEventListener('input', () => this.showTaskSuggestions());

    // Drag and drop for tasks
    this.elements.dropZone.addEventListener('dragover', (e) => {
      e.preventDefault();
      this.elements.dropZone.classList.add('active');
    });
    this.elements.dropZone.addEventListener('dragleave', () => this.elements.dropZone.classList.remove('active'));
    this.elements.dropZone.addEventListener('drop', (e) => {
      e.preventDefault();
      this.elements.dropZone.classList.remove('active');
      if (this.draggedTask) {
        this.moveTaskToDate(this.draggedTask.id, this.selectedDate);
      }
    });
    
    // Window resize handler
    window.addEventListener('resize', () => this.handleResize());
    this.handleResize();
  }

  setupRecurringOptions() {
    const options = this.elements.recurringOptions.querySelectorAll('.recurring-option');
    options.forEach(option => {
      option.addEventListener('click', () => {
        options.forEach(opt => opt.classList.remove('active'));
        option.classList.add('active');
        this.selectedRecurring = option.dataset.recurring;
      });
    });
    // Set default
    this.elements.recurringOptions.querySelector('.recurring-option[data-recurring="none"]').classList.add('active');
  }

  setupTaskSuggestions() {
    // Add click listeners to suggestion items
    this.elements.suggestionList.addEventListener('click', (e) => {
      if (e.target.classList.contains('suggestion-item')) {
        this.elements.taskInput.value = e.target.textContent;
        this.hideTaskSuggestions();
      }
    });
  }

  showTaskSuggestions() {
    const text = this.elements.taskInput.value.trim().toLowerCase();
    if (text.length < 2) {
      this.hideTaskSuggestions();
      return;
    }

    const suggestions = this.getTaskSuggestions(text);
    if (suggestions.length > 0) {
      this.elements.suggestionList.innerHTML = '';
      suggestions.forEach(suggestion => {
        const li = document.createElement('li');
        li.className = 'suggestion-item';
        li.textContent = suggestion;
        this.elements.suggestionList.appendChild(li);
      });
      this.elements.taskSuggestion.style.display = 'block';
    } else {
      this.hideTaskSuggestions();
    }
  }

  hideTaskSuggestions() {
    this.elements.taskSuggestion.style.display = 'none';
  }

  getTaskSuggestions(text) {
    const commonTasks = [
      "Complete project report",
      "Schedule team meeting",
      "Review monthly budget",
      "Update portfolio",
      "Plan weekly meals",
      "Organize workspace",
      "Call client for feedback",
      "Research new tools",
      "Backup important files",
      "Clean inbox",
      "Exercise for 30 minutes",
      "Read industry news",
      "Plan weekend activities",
      "Update resume",
      "Learn new skill",
      "Network with colleagues",
      "Review goals for the month",
      "Organize digital files",
      "Meditate for 10 minutes",
      "Write in journal"
    ];

    return commonTasks.filter(task => 
      task.toLowerCase().includes(text)
    ).slice(0, 5);
  }

  populateIconGrid() {
    const icons = [
      'fas fa-check', 'fas fa-envelope', 'fas fa-users', 'fas fa-shopping-cart',
      'fas fa-book-open', 'fas fa-dumbbell', 'fas fa-code', 'fas fa-plane',
      'fas fa-utensils', 'fas fa-briefcase-medical', 'fas fa-file-invoice-dollar',
      'fas fa-lightbulb', 'fas fa-broom', 'fas fa-car', 'fas fa-home',
      'fas fa-graduation-cap', 'fas fa-music', 'fas fa-paint-brush',
      'fas fa-camera', 'fas fa-heart', 'fas fa-star', 'fas fa-flag',
      'fas fa-bell', 'fas fa-calendar', 'fas fa-clock', 'fas fa-map-marker-alt',
      'fas fa-phone', 'fas fa-laptop', 'fas fa-tablet', 'fas fa-mobile-alt'
    ];

    this.elements.iconGrid.innerHTML = '';
    icons.forEach(icon => {
      const iconElement = document.createElement('div');
      iconElement.className = 'icon-option';
      if (icon === this.selectedIcon) {
        iconElement.classList.add('selected');
      }
      iconElement.innerHTML = `<i class="${icon}"></i>`;
      iconElement.addEventListener('click', () => {
        this.elements.iconGrid.querySelectorAll('.icon-option').forEach(opt => {
          opt.classList.remove('selected');
        });
        iconElement.classList.add('selected');
        this.selectedIcon = icon;
      });
      this.elements.iconGrid.appendChild(iconElement);
    });
  }

  showIconModal() {
    this.elements.iconModal.classList.add('visible');
  }

  hideIconModal() {
    this.elements.iconModal.classList.remove('visible');
  }

  // Calendar Methods
  renderCalendar() {
    const year = this.currentDate.getFullYear();
    const month = this.currentDate.getMonth();
    this.elements.calendarTitle.textContent = new Date(year, month).toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
    this.elements.calendarDays.innerHTML = '';
    const firstDay = new Date(year, month, 1).getDay();
    const daysInMonth = new Date(year, month + 1, 0).getDate();
    const daysInPrevMonth = new Date(year, month, 0).getDate();

    for (let i = firstDay; i > 0; i--) {
        const day = daysInPrevMonth - i + 1;
        this.elements.calendarDays.appendChild(this.createCalendarDay(day, true, new Date(year, month - 1, day)));
    }
    for (let day = 1; day <= daysInMonth; day++) {
        this.elements.calendarDays.appendChild(this.createCalendarDay(day, false, new Date(year, month, day)));
    }
    const gridCells = this.elements.calendarDays.children.length;
    const remainingCells = gridCells > 35 ? 42 - gridCells : 35 - gridCells;
    for (let day = 1; day <= remainingCells; day++) {
      this.elements.calendarDays.appendChild(this.createCalendarDay(day, true, new Date(year, month + 1, day)));
    }
  }

  createCalendarDay(day, isOtherMonth, fullDate) {
    const dayElement = document.createElement('div');
    dayElement.className = 'calendar-day';
    dayElement.textContent = day;

    if (isOtherMonth) dayElement.classList.add('other-month');

    const today = new Date();
    if (this.isSameDate(fullDate, today)) dayElement.classList.add('today');
    if (this.isSameDate(fullDate, this.selectedDate)) dayElement.classList.add('selected');

    if (this.getTasksForDate(fullDate).length > 0) dayElement.classList.add('has-tasks');

    dayElement.addEventListener('click', () => {
      this.selectDate(fullDate);
    });

    return dayElement;
  }

  selectDate(date) {
    this.selectedDate = new Date(date);
    const dateString = this.isSameDate(this.selectedDate, new Date()) ? 'Today' : this.selectedDate.toLocaleDateString('en-US', { month: 'long', day: 'numeric' });
    this.elements.taskInput.placeholder = `Add a task for ${dateString}...`;

    if (this.currentView === 'today') this.switchView('all');
    else this.updateView();
    
    this.renderCalendar();
    this.closeCalendarOnMobile();
  }

  changeMonth(delta) {
    this.currentDate.setMonth(this.currentDate.getMonth() + delta);
    this.renderCalendar();
  }

  goToToday() {
    this.currentDate = new Date();
    this.selectedDate = new Date();
    this.elements.taskInput.placeholder = 'Add a task for Today...';
    if (this.currentView !== 'today') this.switchView('today');
    else this.updateView();
    
    this.renderCalendar();
    this.closeCalendarOnMobile();
  }
  
  // Task Methods
  addTask() {
    const text = this.elements.taskInput.value.trim();
    if (!text) {
      this.showToast('Please enter a task', 'error');
      return;
    }
    
    const task = {
      id: `task_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
      text,
      completed: false,
      priority: this.elements.taskPriority.value,
      category: this.elements.taskCategory.value,
      date: this.formatDate(this.selectedDate),
      icon: this.selectedIcon,
      recurring: this.selectedRecurring,
      createdAt: new Date().toISOString()
    };
    
    const tasks = this.getTasks();
    tasks.push(task);
    this.saveTasks(tasks);
    
    // If it's a recurring task, create future instances
    if (this.selectedRecurring !== 'none') {
      this.createRecurringTasks(task);
    }
    
    this.elements.taskInput.value = '';
    this.elements.taskInput.style.height = 'auto';
    this.updateView();
    this.renderCalendar();
    this.hideTaskSuggestions();
    this.showToast('Task added!', 'success');
  }

  createRecurringTasks(originalTask) {
    const tasks = this.getTasks();
    const today = new Date();
    let nextDate = new Date(originalTask.date);
    
    // Create instances for the next 30 days
    for (let i = 1; i <= 30; i++) {
      if (this.selectedRecurring === 'daily') {
        nextDate.setDate(nextDate.getDate() + 1);
      } else if (this.selectedRecurring === 'weekly') {
        nextDate.setDate(nextDate.getDate() + 7);
      } else if (this.selectedRecurring === 'monthly') {
        nextDate.setMonth(nextDate.getMonth() + 1);
      }
      
      // Stop if we've gone too far into the future
      if (nextDate > new Date(today.getFullYear(), today.getMonth() + 3, today.getDate())) {
        break;
      }
      
      const recurringTask = {
        ...originalTask,
        id: `task_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
        date: this.formatDate(nextDate),
        isRecurringInstance: true,
        originalTaskId: originalTask.id
      };
      
      tasks.push(recurringTask);
    }
    
    this.saveTasks(tasks);
  }

  toggleTask(taskId) {
    const tasks = this.getTasks();
    const task = tasks.find(t => t.id === taskId);
    if (task) {
      task.completed = !task.completed;
      task.completedAt = task.completed ? new Date().toISOString() : null;
      this.saveTasks(tasks);
      this.updateView();
      
      if(task.completed) {
        // Play completion sound
        this.taskCompleteSound.play().catch(e => console.log("Audio play failed:", e));
        this.showToast('Task completed! 🎉', 'success');
      }
    }
  }

  deleteTask(taskId, taskElement) {
    if (confirm('Are you sure you want to delete this task?')) {
        taskElement.classList.add('fade-out');
        taskElement.addEventListener('animationend', () => {
            let tasks = this.getTasks();
            tasks = tasks.filter(t => t.id !== taskId);
            this.saveTasks(tasks);
            this.updateView();
            this.renderCalendar();
            this.showToast('Task deleted', 'success');
        }, { once: true });
    }
  }

  editTask(taskId) {
    const tasks = this.getTasks();
    const task = tasks.find(t => t.id === taskId);
    if (task && !task.completed) {
      const newText = prompt('Edit task:', task.text);
      if (newText && newText.trim() && newText.trim() !== task.text) {
        task.text = newText.trim();
        this.saveTasks(tasks);
        this.updateView();
        this.showToast('Task updated!', 'success');
      }
    }
  }

  moveTaskToDate(taskId, newDate) {
    const tasks = this.getTasks();
    const task = tasks.find(t => t.id === taskId);
    if (task) {
      task.date = this.formatDate(newDate);
      this.saveTasks(tasks);
      this.updateView();
      this.renderCalendar();
      this.hideDropZone();
      this.showToast(`Task moved to ${newDate.toLocaleDateString()}`, 'success');
    }
  }

  // View Methods
  switchView(view) {
    this.currentView = view;
    this.elements.navItems.forEach(item => {
      item.classList.toggle('active', item.dataset.view === view);
    });

    const titles = {
      today: { icon: 'fas fa-calendar-day', text: 'Today' },
      upcoming: { icon: 'fas fa-calendar-week', text: 'Upcoming' },
      all: { icon: 'fas fa-list', text: 'All Tasks' },
      completed: { icon: 'fas fa-check-double', text: 'Completed' },
      priority: { icon: 'fas fa-star', text: 'Priority Tasks' }
    };

    const title = titles[view];
    this.elements.pageTitle.innerHTML = `<i class="${title.icon}"></i> ${title.text}`;

    if (view === 'today') {
      this.selectedDate = new Date();
      this.currentDate = new Date();
      this.renderCalendar();
      this.elements.taskInput.placeholder = 'Add a task for Today...';
    } else {
        const dateString = this.selectedDate.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
        this.elements.taskInput.placeholder = `Add a task for ${dateString}...`;
    }
    
    this.updateView();
    this.closeSidebarOnMobile();
  }

  updateView() {
    const tasks = this.getFilteredTasks();
    this.renderTasks(tasks);
  }

  getFilteredTasks() {
    let tasks = this.getTasks();
    const todayStr = this.formatDate(new Date());

    switch (this.currentView) {
      case 'today':
        tasks = tasks.filter(task => task.date === todayStr);
        break;
      case 'upcoming':
        tasks = tasks.filter(task => task.date >= todayStr && !task.completed).sort((a,b) => new Date(a.date) - new Date(b.date));
        break;
      case 'completed':
        tasks = tasks.filter(task => task.completed);
        break;
      case 'priority':
        tasks = tasks.filter(task => task.priority === 'high' && !task.completed);
        break;
      case 'all':
        const selectedStr = this.formatDate(this.selectedDate);
        tasks = tasks.filter(task => task.date === selectedStr);
        break;
    }

    if (this.currentFilter === 'pending') tasks = tasks.filter(task => !task.completed);
    else if (this.currentFilter === 'completed') tasks = tasks.filter(task => task.completed);
    
    tasks.sort((a, b) => {
        if (a.completed !== b.completed) return a.completed - b.completed;
        const priorityOrder = { high: 0, medium: 1, low: 2 };
        if (priorityOrder[a.priority] !== priorityOrder[b.priority]) return priorityOrder[a.priority] - priorityOrder[b.priority];
        return new Date(b.createdAt) - new Date(a.createdAt);
    });
    return tasks;
  }
  
  renderTasks(tasks) {
    this.elements.tasksList.innerHTML = '';
    this.updateTaskCount(tasks.length);

    if (tasks.length === 0) {
      this.elements.emptyState.style.display = 'block';
    } else {
      this.elements.emptyState.style.display = 'none';
      tasks.forEach(task => {
        this.elements.tasksList.appendChild(this.createTaskElement(task));
      });
    }
  }

  createTaskElement(task) {
    const li = document.createElement('li');
    li.className = 'task-item';
    li.dataset.taskId = task.id;
    li.draggable = true;
    if (task.completed) li.classList.add('completed');
    const categoryIcons = { general: '📋', work: '💼', personal: '👤', shopping: '🛒', health: '❤️', learning: '📚' };

    li.innerHTML = `
      <div class="task-checkbox ${task.completed ? 'checked' : ''}" data-action="toggle"></div>
      <div class="task-content">
        <div class="task-text-content">
          <i class="task-icon ${task.icon}" data-action="change-icon" title="Change icon"></i>
          <div class="task-text">${task.text}</div>
        </div>
        <div class="task-meta">
          <span class="task-priority ${task.priority}">${task.priority}</span>
          <span class="task-date"><i class="fas fa-calendar-alt"></i> ${new Date(task.date.replace(/-/g, '/')).toLocaleDateString()}</span>
          <span>${categoryIcons[task.category]} ${task.category.charAt(0).toUpperCase() + task.category.slice(1)}</span>
          ${task.recurring !== 'none' ? `<span><i class="fas fa-repeat"></i> ${task.recurring}</span>` : ''}
        </div>
      </div>
      <div class="task-actions">
        <button class="task-action-btn edit" data-action="edit" title="Edit"><i class="fas fa-edit"></i></button>
        <button class="task-action-btn delete" data-action="delete" title="Delete"><i class="fas fa-trash"></i></button>
      </div>
    `;

    li.addEventListener('click', (e) => {
        const actionTarget = e.target.closest('[data-action]');
        if (!actionTarget) return;
        const action = actionTarget.dataset.action;
        
        if (action === 'toggle') this.toggleTask(task.id);
        else if (action === 'edit') this.editTask(task.id);
        else if (action === 'delete') this.deleteTask(task.id, li);
        else if (action === 'change-icon') {
          this.selectedIcon = task.icon;
          this.showIconModal();
          // Store the task ID to update after icon selection
          this.iconChangeTaskId = task.id;
        }
    });

    li.addEventListener('dragstart', (e) => {
      this.draggedTask = task;
      li.classList.add('dragging');
      this.showDropZone();
    });
    li.addEventListener('dragend', () => {
      li.classList.remove('dragging');
      this.draggedTask = null;
      this.hideDropZone();
    });
    return li;
  }

  setFilter(filter) {
    this.currentFilter = filter;
    this.elements.filterBtns.forEach(btn => btn.classList.toggle('active', btn.dataset.filter === filter));
    this.updateView();
  }

  // UI Helper Methods
  toggleSidebar() { this.elements.sidebar.classList.toggle('visible'); }
  closeSidebarOnMobile() { if (window.innerWidth <= 992) this.elements.sidebar.classList.remove('visible'); }
  toggleCalendar() {
    if(window.innerWidth <= 768) this.elements.calendarSection.classList.toggle('visible');
    else this.elements.calendarSection.classList.toggle('hidden');
  }
  closeCalendarOnMobile() { if (window.innerWidth <= 768) this.elements.calendarSection.classList.remove('visible'); }
  showDropZone() { if (this.draggedTask && this.currentView === 'all') this.elements.dropZone.style.display = 'flex'; }
  hideDropZone() { this.elements.dropZone.style.display = 'none'; }
  updateTaskCount(count) { this.elements.taskCount.textContent = `${count} task${count !== 1 ? 's' : ''}`; }
  autoResizeTextarea() {
    this.elements.taskInput.addEventListener('input', () => {
      this.elements.taskInput.style.height = 'auto';
      this.elements.taskInput.style.height = `${Math.min(this.elements.taskInput.scrollHeight, 120)}px`;
    });
  }
  handleResize() {
    if (window.innerWidth > 992) this.elements.sidebar.classList.remove('visible');
    if (window.innerWidth > 768) {
      this.elements.calendarSection.classList.remove('visible');
    } else {
      this.elements.calendarSection.classList.remove('hidden');
    }
  }

  // Theme Methods
  toggleThemeDropdown() {
      this.elements.themeDropdown.classList.toggle('visible');
      this.elements.themeModalOverlay.classList.toggle('visible');
  }
  setTheme(theme) {
    this.elements.body.className = theme === 'default' ? '' : theme;
    localStorage.setItem('chronoFocusProTheme', theme);
  }
  loadTheme() {
    const savedTheme = localStorage.getItem('chronoFocusProTheme') || 'theme-dark';
    this.setTheme(savedTheme);
  }

  // Toast Methods
  showToast(message, type = 'success') {
    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    toast.textContent = message;
    this.elements.toastContainer.appendChild(toast);
    setTimeout(() => toast.classList.add('show'), 10);
    setTimeout(() => {
      toast.classList.remove('show');
      toast.addEventListener('transitionend', () => toast.remove(), { once: true });
    }, 3000);
  }
  
  // Data Methods
  getTasks() { return JSON.parse(localStorage.getItem('chronoFocusProTasks') || '[]'); }
  saveTasks(tasks) { localStorage.setItem('chronoFocusProTasks', JSON.stringify(tasks)); }
  getTasksForDate(date) {
    const dateStr = this.formatDate(date);
    return this.getTasks().filter(task => task.date === dateStr);
  }

  // Utility Methods
  formatDate(date) { return date.toISOString().split('T')[0]; }
  isSameDate(d1, d2) { return this.formatDate(d1) === this.formatDate(d2); }
}

document.addEventListener('DOMContentLoaded', () => {
  window.chronoFocusPro = new ChronoFocusPro();
});
</script>

</body>
</html>
