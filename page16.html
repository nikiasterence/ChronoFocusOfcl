<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chrono Focus Pro - Advanced Task & Calendar Manager</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root {
  /* Glass Theme (Default) */
  --primary: #6366F1;
  --primary-light: rgba(99, 102, 241, 0.1);
  --primary-dark: #4F46E5;
  --secondary: #8B5CF6;
  --accent: #10B981;
  --background: linear-gradient(135deg, #F0F9FF 0%, #E0F2FE 100%);
  --surface: rgba(255, 255, 255, 0.7);
  --surface-elevated: rgba(255, 255, 255, 0.9);
  --text-primary: #1E293B;
  --text-secondary: #64748B;
  --text-disabled: #94A3B8;
  --border-color: rgba(226, 232, 240, 0.6);
  --success: #10B981;
  --warning: #F59E0B;
  --danger: #EF4444;
  --hover-overlay: rgba(99, 102, 241, 0.08);
  --active-overlay: rgba(99, 102, 241, 0.12);
  
  /* Task Priority Colors */
  --priority-high: #EF4444;
  --priority-medium: #F59E0B;
  --priority-low: #10B981;
  
  /* Calendar Colors */
  --today-bg: rgba(99, 102, 241, 0.1);
  --today-text: var(--primary-dark);
  --weekend-bg: rgba(241, 245, 249, 0.5);
  --weekend-text: var(--text-secondary);
  
  /* Rounded corners */
  --border-radius-sm: 8px;
  --border-radius: 16px;
  --border-radius-lg: 20px;
  --border-radius-xl: 24px;
  
  /* Shadows */
  --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.05);
  --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
  --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
  --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
  
  /* Transition */
  --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  
  /* Glass effect */
  --glass-bg: rgba(255, 255, 255, 0.25);
  --glass-border: rgba(255, 255, 255, 0.18);
  --glass-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
  --backdrop-blur: blur(10px);
}

/* Midnight Glass Theme */
body.theme-midnight-glass {
  --primary: #818CF8;
  --primary-light: rgba(129, 140, 248, 0.15);
  --primary-dark: #6366F1;
  --secondary: #A78BFA;
  --accent: #34D399;
  --background: linear-gradient(135deg, #0F172A 0%, #1E293B 100%);
  --surface: rgba(30, 41, 59, 0.7);
  --surface-elevated: rgba(30, 41, 59, 0.9);
  --text-primary: #F1F5F9;
  --text-secondary: #CBD5E1;
  --text-disabled: #64748B;
  --border-color: rgba(71, 85, 105, 0.5);
  --hover-overlay: rgba(129, 140, 248, 0.1);
  --active-overlay: rgba(129, 140, 248, 0.15);
  --today-bg: rgba(129, 140, 248, 0.2);
  --today-text: #818CF8;
  --weekend-bg: rgba(30, 41, 59, 0.8);
  --glass-bg: rgba(15, 23, 42, 0.3);
  --glass-border: rgba(255, 255, 255, 0.1);
}

/* Sunset Glass Theme */
body.theme-sunset-glass {
  --primary: #F97316;
  --primary-light: rgba(249, 115, 22, 0.1);
  --primary-dark: #EA580C;
  --secondary: #FB923C;
  --accent: #F59E0B;
  --background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%);
  --surface: rgba(255, 255, 255, 0.7);
  --surface-elevated: rgba(255, 255, 255, 0.9);
  --text-primary: #431407;
  --text-secondary: #92400E;
  --text-disabled: #D97706;
  --border-color: rgba(251, 191, 36, 0.4);
  --hover-overlay: rgba(249, 115, 22, 0.08);
  --active-overlay: rgba(249, 115, 22, 0.12);
  --today-bg: rgba(249, 115, 22, 0.1);
  --today-text: #EA580C;
  --weekend-bg: rgba(254, 243, 199, 0.5);
}

/* Forest Glass Theme */
body.theme-forest-glass {
  --primary: #059669;
  --primary-light: rgba(5, 150, 105, 0.1);
  --primary-dark: #047857;
  --secondary: #10B981;
  --accent: #34D399;
  --background: linear-gradient(135deg, #D1FAE5 0%, #A7F3D0 100%);
  --surface: rgba(255, 255, 255, 0.7);
  --surface-elevated: rgba(255, 255, 255, 0.9);
  --text-primary: #064E3B;
  --text-secondary: #065F46;
  --text-disabled: #059669;
  --border-color: rgba(16, 185, 129, 0.4);
  --hover-overlay: rgba(5, 150, 105, 0.08);
  --active-overlay: rgba(5, 150, 105, 0.12);
  --today-bg: rgba(5, 150, 105, 0.1);
  --today-text: #047857;
  --weekend-bg: rgba(209, 250, 229, 0.5);
}

/* Ocean Glass Theme */
body.theme-ocean-glass {
  --primary: #0EA5E9;
  --primary-light: rgba(14, 165, 233, 0.1);
  --primary-dark: #0284C7;
  --secondary: #38BDF8;
  --accent: #22D3EE;
  --background: linear-gradient(135deg, #E0F2FE 0%, #BAE6FD 100%);
  --surface: rgba(255, 255, 255, 0.7);
  --surface-elevated: rgba(255, 255, 255, 0.9);
  --text-primary: #0C4A6E;
  --text-secondary: #075985;
  --text-disabled: #0EA5E9;
  --border-color: rgba(56, 189, 248, 0.4);
  --hover-overlay: rgba(14, 165, 233, 0.08);
  --active-overlay: rgba(14, 165, 233, 0.12);
  --today-bg: rgba(14, 165, 233, 0.1);
  --today-text: #0284C7;
  --weekend-bg: rgba(224, 242, 254, 0.5);
}

/* Additional glass themes would be defined here... */

/* Global Styles */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  background: var(--background);
  color: var(--text-primary);
  line-height: 1.5;
  transition: var(--transition);
  overflow-x: hidden;
  background-size: cover;
  background-attachment: fixed;
  background-repeat: no-repeat;
  scroll-behavior: smooth;
}

/* App Layout */
.app-container {
  display: flex;
  min-height: 100vh;
  overflow: auto;
}

/* Sidebar */
.sidebar {
  width: 280px;
  background: var(--surface);
  backdrop-filter: var(--backdrop-blur);
  -webkit-backdrop-filter: var(--backdrop-blur);
  border-right: 1px solid var(--border-color);
  padding: 24px 0;
  position: fixed;
  height: 100vh;
  z-index: 50;
  overflow-y: auto;
}

.sidebar-header {
  padding: 0 24px 24px;
  border-bottom: 1px solid var(--border-color);
  margin-bottom: 24px;
}

.sidebar-title {
  font-size: 1.5rem;
  font-weight: 700;
  color: var(--primary);
  display: flex;
  align-items: center;
  gap: 12px;
}

.sidebar-nav {
  list-style: none;
  padding: 0 16px;
}

.sidebar-item {
  margin-bottom: 8px;
}

.sidebar-link {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px 16px;
  border-radius: var(--border-radius);
  color: var(--text-secondary);
  text-decoration: none;
  transition: var(--transition);
  font-weight: 500;
}

.sidebar-link:hover {
  background: var(--hover-overlay);
  color: var(--text-primary);
}

.sidebar-link.active {
  background: var(--primary-light);
  color: var(--primary);
}

.sidebar-section {
  margin-top: 24px;
  padding-top: 16px;
  border-top: 1px solid var(--border-color);
}

.sidebar-section-title {
  font-size: 0.75rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  color: var(--text-disabled);
  margin-bottom: 16px;
  padding: 0 24px;
}

/* Header */
.main-header {
  position: fixed;
  top: 0;
  left: 280px;
  right: 0;
  padding: 16px 24px;
  background: var(--surface);
  backdrop-filter: var(--backdrop-blur);
  -webkit-backdrop-filter: var(--backdrop-blur);
  border-bottom: 1px solid var(--border-color);
  display: flex;
  align-items: center;
  justify-content: space-between;
  z-index: 100;
}

.header-title {
  font-size: 1.5rem;
  font-weight: 700;
  color: var(--text-primary);
}

.header-date {
  font-size: 0.875rem;
  color: var(--text-secondary);
  margin-top: 4px;
}

.header-controls {
  display: flex;
  align-items: center;
  gap: 12px;
}

.header-btn {
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: none;
  border: none;
  border-radius: var(--border-radius);
  color: var(--text-secondary);
  cursor: pointer;
  transition: var(--transition);
  font-size: 1.1rem;
}

.header-btn:hover {
  background: var(--hover-overlay);
  color: var(--text-primary);
}

.floating-add-btn {
  width: 56px;
  height: 56px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--primary);
  color: white;
  border: none;
  border-radius: 50%;
  cursor: pointer;
  transition: var(--transition);
  font-size: 1.2rem;
  box-shadow: var(--shadow-lg);
  position: fixed;
  bottom: 24px;
  right: 24px;
  z-index: 90;
}

.floating-add-btn:hover {
  transform: translateY(-2px) scale(1.05);
  box-shadow: var(--shadow-xl);
}

/* Main Content */
.main-content {
  margin-top: 80px;
  margin-left: 280px;
  padding: 24px;
  width: calc(100% - 280px);
  max-width: 1200px;
}

.content-grid {
  display: grid;
  grid-template-columns: 1fr 350px;
  gap: 24px;
}

/* Tasks Section */
.tasks-section {
  background: var(--surface);
  backdrop-filter: var(--backdrop-blur);
  -webkit-backdrop-filter: var(--backdrop-blur);
  border-radius: var(--border-radius-lg);
  box-shadow: var(--shadow-sm);
  overflow: hidden;
}

.tasks-header {
  padding: 24px;
  border-bottom: 1px solid var(--border-color);
  background: var(--surface-elevated);
}

.task-input-container {
  display: flex;
  gap: 12px;
  align-items: flex-start;
  margin-bottom: 20px;
}

.task-input-wrapper {
  flex: 1;
  position: relative;
}

.task-input {
  width: 100%;
  padding: 16px 20px;
  border: 2px solid var(--border-color);
  border-radius: var(--border-radius-lg);
  font-size: 1rem;
  background: var(--surface-elevated);
  color: var(--text-primary);
  transition: var(--transition);
  resize: none;
  font-family: inherit;
  line-height: 1.5;
  min-height: 56px;
  max-height: 120px;
}

.task-input:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
}

.task-input::placeholder {
  color: var(--text-secondary);
}

.add-task-btn {
  padding: 16px 24px;
  background: var(--primary);
  color: white;
  border: none;
  border-radius: var(--border-radius-lg);
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition);
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 1rem;
  box-shadow: var(--shadow-sm);
}

.add-task-btn:hover {
  opacity: 0.9;
  transform: translateY(-1px);
  box-shadow: var(--shadow-md);
}

.add-task-btn:active {
  transform: translateY(0);
}

.task-options {
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
}

.task-option-select {
  padding: 8px 16px;
  border: 1px solid var(--border-color);
  border-radius: var(--border-radius);
  background: var(--surface);
  color: var(--text-primary);
  font-size: 0.875rem;
  cursor: pointer;
  transition: var(--transition);
}

.task-option-select:focus {
  outline: none;
  border-color: var(--primary);
}

/* Task List */
.tasks-content {
  padding: 0 24px 24px;
}

.task-list-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 20px;
  padding-top: 20px;
  position: sticky;
  top: 0;
  background: var(--surface);
  z-index: 10;
  padding-bottom: 10px;
}

.task-count {
  color: var(--text-secondary);
  font-size: 0.875rem;
  font-weight: 500;
}

.task-filters {
  display: flex;
  gap: 8px;
}

.filter-btn {
  padding: 6px 12px;
  background: none;
  border: 1px solid var(--border-color);
  border-radius: var(--border-radius);
  color: var(--text-secondary);
  font-size: 0.875rem;
  cursor: pointer;
  transition: var(--transition);
}

.filter-btn:hover {
  background: var(--hover-overlay);
}

.filter-btn.active {
  background: var(--primary);
  color: white;
  border-color: var(--primary);
}

.tasks-list {
  list-style: none;
}

.task-item {
  display: flex;
  align-items: flex-start;
  gap: 16px;
  padding: 16px;
  background: var(--surface-elevated);
  border: 1px solid var(--border-color);
  border-radius: var(--border-radius-lg);
  margin-bottom: 12px;
  transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
  cursor: pointer;
  opacity: 0;
  animation: slideInUp 0.5s cubic-bezier(0.25, 0.8, 0.25, 1) forwards;
  backdrop-filter: var(--backdrop-blur);
  -webkit-backdrop-filter: var(--backdrop-blur);
}

.task-item:nth-child(1) { animation-delay: 0.05s; }
.task-item:nth-child(2) { animation-delay: 0.1s; }
.task-item:nth-child(3) { animation-delay: 0.15s; }
.task-item:nth-child(4) { animation-delay: 0.2s; }
.task-item:nth-child(5) { animation-delay: 0.25s; }

.task-item.fade-out {
  animation: fadeOut 0.4s forwards;
}

.task-item:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-lg);
  border-color: rgba(99, 102, 241, 0.3);
}

.task-item.completed {
  opacity: 0.7;
  background: rgba(128,128,128,0.05);
}

.task-item.completed .task-text-content {
  text-decoration: line-through;
  color: var(--text-secondary);
}

.task-item.dragging {
  transform: rotate(5deg) scale(1.05);
  box-shadow: var(--shadow-xl);
  z-index: 1000;
}

.task-checkbox {
  width: 20px;
  height: 20px;
  border: 2px solid var(--border-color);
  border-radius: 50%;
  cursor: pointer;
  transition: var(--transition);
  flex-shrink: 0;
  position: relative;
  margin-top: 2px;
}

.task-checkbox:hover {
  border-color: var(--primary);
}

.task-checkbox.checked {
  background: var(--primary);
  border-color: var(--primary);
}

.task-checkbox.checked::after {
  content: '‚úì';
  color: white;
  font-size: 12px;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-weight: bold;
}

.task-content {
  flex: 1;
  min-width: 0;
}

.task-text-content {
  display: flex;
  align-items: center;
  gap: 10px;
}

.task-icon {
  font-size: 1.1rem;
  color: var(--text-secondary);
  transition: color 0.3s;
  cursor: pointer;
}

.task-item:hover .task-icon {
  color: var(--primary);
}

.task-item.completed .task-icon {
  color: var(--text-disabled);
}

.task-text {
  font-size: 1rem;
  color: var(--text-primary);
  line-height: 1.5;
  word-wrap: break-word;
  margin-bottom: 4px;
}

.task-notes {
  font-size: 0.875rem;
  color: var(--text-secondary);
  margin-top: 8px;
  padding: 8px 12px;
  background: rgba(99, 102, 241, 0.05);
  border-radius: var(--border-radius-sm);
  border-left: 3px solid var(--primary);
}

.task-meta {
  display: flex;
  align-items: center;
  gap: 12px;
  font-size: 0.75rem;
  color: var(--text-secondary);
  flex-wrap: wrap;
  margin-top: 8px;
}

.task-priority {
  padding: 2px 8px;
  border-radius: 12px;
  font-weight: 500;
  font-size: 0.7rem;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.task-priority.high {
  background: rgba(239, 68, 68, 0.1);
  color: var(--priority-high);
}

.task-priority.medium {
  background: rgba(245, 158, 11, 0.1);
  color: var(--priority-medium);
}

.task-priority.low {
  background: rgba(16, 185, 129, 0.1);
  color: var(--priority-low);
}

.task-date {
  display: flex;
  align-items: center;
  gap: 4px;
}

.task-actions {
  display: flex;
  gap: 8px;
  opacity: 0;
  transition: var(--transition);
}

.task-item:hover .task-actions {
  opacity: 1;
}

.task-action-btn {
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: none;
  border: none;
  border-radius: var(--border-radius);
  color: var(--text-secondary);
  cursor: pointer;
  transition: var(--transition);
  font-size: 0.875rem;
}

.task-action-btn:hover {
  background: var(--hover-overlay);
  color: var(--text-primary);
}

.task-action-btn.edit:hover {
  color: var(--primary);
}

.task-action-btn.delete:hover {
  color: var(--danger);
}

.task-action-btn.notes:hover {
  color: var(--success);
}

/* Calendar Section */
.calendar-section {
  background: var(--surface);
  backdrop-filter: var(--backdrop-blur);
  -webkit-backdrop-filter: var(--backdrop-blur);
  border-radius: var(--border-radius-lg);
  box-shadow: var(--shadow-sm);
  overflow: hidden;
  height: fit-content;
}

.calendar-header {
  padding: 20px;
  border-bottom: 1px solid var(--border-color);
  text-align: center;
  background: var(--surface-elevated);
}

.calendar-top-controls {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
}

.calendar-nav {
  display: flex;
  align-items: center;
  justify-content: space-between;
  flex-grow: 1;
}

.calendar-nav button {
  background: none;
  border: none;
  color: var(--text-secondary);
  cursor: pointer;
  padding: 8px;
  border-radius: var(--border-radius);
  transition: var(--transition);
  font-size: 1.1rem;
}

.calendar-nav button:hover {
  background: var(--hover-overlay);
  color: var(--text-primary);
}

.calendar-title {
  font-size: 1.1rem;
  font-weight: 600;
  color: var(--text-primary);
}

.calendar-grid {
  padding: 20px;
}

.calendar-weekdays {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 4px;
  margin-bottom: 8px;
}

.calendar-weekday {
  padding: 8px 4px;
  text-align: center;
  font-size: 0.75rem;
  font-weight: 600;
  color: var(--text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.calendar-days {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 4px;
}

.calendar-day {
  aspect-ratio: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  border-radius: var(--border-radius);
  transition: var(--transition);
  position: relative;
  font-size: 0.875rem;
  font-weight: 500;
  background: transparent;
  border: 1px solid transparent;
  backdrop-filter: var(--backdrop-blur);
  -webkit-backdrop-filter: var(--backdrop-blur);
}

.calendar-day:hover {
  background: var(--hover-overlay);
}

.calendar-day.today {
  background: var(--today-bg);
  color: var(--today-text);
  font-weight: 600;
}

.calendar-day.selected {
  background: var(--primary);
  color: white;
}

.calendar-day.other-month {
  color: var(--text-disabled);
}

.calendar-day.has-tasks::after {
  content: '';
  width: 6px;
  height: 6px;
  background: var(--primary);
  border-radius: 50%;
  position: absolute;
  bottom: 2px;
  left: 50%;
  transform: translateX(-50%);
}

/* Settings Panel */
.settings-panel {
  position: fixed;
  top: 0;
  right: -400px;
  width: 400px;
  height: 100vh;
  background: var(--surface);
  backdrop-filter: var(--backdrop-blur);
  -webkit-backdrop-filter: var(--backdrop-blur);
  border-left: 1px solid var(--border-color);
  box-shadow: var(--shadow-xl);
  z-index: 200;
  transition: var(--transition);
  overflow-y: auto;
  padding: 24px;
}

.settings-panel.open {
  right: 0;
}

.settings-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 24px;
  padding-bottom: 16px;
  border-bottom: 1px solid var(--border-color);
}

.settings-title {
  font-size: 1.5rem;
  font-weight: 600;
  color: var(--text-primary);
}

.close-settings {
  background: none;
  border: none;
  color: var(--text-secondary);
  cursor: pointer;
  font-size: 1.2rem;
  padding: 8px;
  border-radius: var(--border-radius);
  transition: var(--transition);
}

.close-settings:hover {
  background: var(--hover-overlay);
  color: var(--text-primary);
}

.settings-section {
  margin-bottom: 32px;
}

.settings-section-title {
  font-size: 1.1rem;
  font-weight: 600;
  margin-bottom: 16px;
  color: var(--text-primary);
}

.theme-options {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 12px;
}

.theme-option {
  padding: 16px;
  border: 2px solid var(--border-color);
  border-radius: var(--border-radius);
  cursor: pointer;
  transition: var(--transition);
  text-align: center;
  backdrop-filter: var(--backdrop-blur);
  -webkit-backdrop-filter: var(--backdrop-blur);
}

.theme-option:hover {
  border-color: var(--primary);
}

.theme-option.active {
  border-color: var(--primary);
  background: var(--primary-light);
}

.theme-preview {
  width: 100%;
  height: 60px;
  border-radius: var(--border-radius-sm);
  margin-bottom: 8px;
}

.theme-name {
  font-size: 0.875rem;
  font-weight: 500;
}

/* AI Panel */
.ai-panel {
  position: fixed;
  bottom: 100px;
  right: 24px;
  width: 400px;
  max-width: calc(100vw - 48px);
  background: var(--surface);
  backdrop-filter: var(--backdrop-blur);
  -webkit-backdrop-filter: var(--backdrop-blur);
  border: 1px solid var(--border-color);
  border-radius: var(--border-radius-lg);
  box-shadow: var(--shadow-xl);
  padding: 20px;
  z-index: 99;
  transform: translateY(20px);
  opacity: 0;
  visibility: hidden;
  transition: var(--transition);
  display: flex;
  flex-direction: column;
  max-height: 70vh;
}

.ai-panel.visible {
  transform: translateY(0);
  opacity: 1;
  visibility: visible;
}

.ai-header {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 16px;
  padding-bottom: 12px;
  border-bottom: 1px solid var(--border-color);
}

.ai-title {
  font-size: 1.1rem;
  font-weight: 600;
  color: var(--text-primary);
}

.ai-status {
  font-size: 0.75rem;
  padding: 2px 8px;
  background: var(--success);
  color: white;
  border-radius: 12px;
}

.ai-messages {
  flex: 1;
  overflow-y: auto;
  margin-bottom: 16px;
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.ai-message {
  padding: 12px;
  border-radius: var(--border-radius);
  font-size: 0.9rem;
  line-height: 1.4;
  max-width: 85%;
  backdrop-filter: var(--backdrop-blur);
  -webkit-backdrop-filter: var(--backdrop-blur);
}

.ai-message.user {
  background: var(--primary-light);
  color: var(--primary);
  align-self: flex-end;
}

.ai-message.assistant {
  background: var(--surface-elevated);
  color: var(--text-primary);
  align-self: flex-start;
}

.ai-input-container {
  display: flex;
  gap: 8px;
}

.ai-input {
  flex: 1;
  padding: 12px;
  border: 1px solid var(--border-color);
  border-radius: var(--border-radius);
  background: var(--surface);
  color: var(--text-primary);
  font-size: 0.9rem;
  resize: none;
  font-family: inherit;
}

.ai-input:focus {
  outline: none;
  border-color: var(--primary);
}

.ai-send {
  padding: 12px 16px;
  background: var(--primary);
  color: white;
  border: none;
  border-radius: var(--border-radius);
  cursor: pointer;
  transition: var(--transition);
}

.ai-send:hover {
  opacity: 0.9;
}

.ai-commands {
  margin-top: 12px;
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

.ai-command {
  padding: 6px 12px;
  background: var(--surface-elevated);
  border: 1px solid var(--border-color);
  border-radius: var(--border-radius);
  font-size: 0.8rem;
  cursor: pointer;
  transition: var(--transition);
}

.ai-command:hover {
  background: var(--hover-overlay);
}

/* Toast Notifications */
.toast-container {
  position: fixed;
  bottom: 100px;
  right: 24px;
  z-index: 2000;
}

.toast {
  background: var(--surface-elevated);
  color: var(--text-primary);
  padding: 16px 20px;
  border-radius: var(--border-radius-lg);
  box-shadow: var(--shadow-xl);
  border: 1px solid var(--border-color);
  margin-bottom: 12px;
  transform: translateX(120%);
  opacity: 0;
  transition: all 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
  max-width: 320px;
  display: flex;
  align-items: center;
  gap: 12px;
  backdrop-filter: var(--backdrop-blur);
  -webkit-backdrop-filter: var(--backdrop-blur);
}

.toast::before {
  font-family: "Font Awesome 6 Free";
  font-weight: 900;
  font-size: 1.2rem;
}

.toast.show {
  transform: translateX(0);
  opacity: 1;
}

.toast.success {
  border-left: 4px solid var(--success);
}

.toast.success::before {
  content: "\f058";
  color: var(--success);
}

.toast.error {
  border-left: 4px solid var(--danger);
}

.toast.error::before {
  content: "\f071";
  color: var(--danger);
}

/* Animations */
@keyframes slideInUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes fadeOut {
  from {
    opacity: 0.7;
    transform: scale(1);
  }
  to {
    opacity: 0;
    transform: scale(0.9);
    height: 0;
    padding: 0;
    margin: 0;
    border: 0;
  }
}

@keyframes completeTask {
  0% {
    transform: scale(1);
  }
  50% {
    transform: scale(1.05);
  }
  100% {
    transform: scale(1);
  }
}

/* Empty State */
.empty-state {
  text-align: center;
  padding: 60px 20px;
  color: var(--text-secondary);
  display: none;
}

.empty-state i {
  font-size: 3rem;
  margin-bottom: 16px;
  color: var(--text-disabled);
}

.empty-state h3 {
  font-size: 1.25rem;
  font-weight: 600;
  margin-bottom: 8px;
  color: var(--text-primary);
}

.empty-state p {
  font-size: 0.875rem;
  line-height: 1.5;
}

/* Stats Section */
.stats-section {
  background: var(--surface);
  backdrop-filter: var(--backdrop-blur);
  -webkit-backdrop-filter: var(--backdrop-blur);
  border-radius: var(--border-radius-lg);
  box-shadow: var(--shadow-sm);
  overflow: hidden;
  padding: 24px;
  margin-top: 24px;
}

.stats-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 20px;
}

.stats-title {
  font-size: 1.25rem;
  font-weight: 600;
  color: var(--text-primary);
}

.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 16px;
  margin-bottom: 24px;
}

.stat-card {
  background: var(--surface-elevated);
  border-radius: var(--border-radius);
  padding: 20px;
  text-align: center;
  box-shadow: var(--shadow-sm);
  backdrop-filter: var(--backdrop-blur);
  -webkit-backdrop-filter: var(--backdrop-blur);
}

.stat-value {
  font-size: 2rem;
  font-weight: 700;
  color: var(--primary);
  margin-bottom: 8px;
}

.stat-label {
  font-size: 0.875rem;
  color: var(--text-secondary);
}

.chart-container {
  background: var(--surface-elevated);
  border-radius: var(--border-radius);
  padding: 20px;
  box-shadow: var(--shadow-sm);
  margin-top: 16px;
  backdrop-filter: var(--backdrop-blur);
  -webkit-backdrop-filter: var(--backdrop-blur);
}

/* Task Description Modal */
.modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 300;
  opacity: 0;
  visibility: hidden;
  transition: var(--transition);
  backdrop-filter: blur(5px);
  -webkit-backdrop-filter: blur(5px);
}

.modal.open {
  opacity: 1;
  visibility: visible;
}

.modal-content {
  background: var(--surface);
  border-radius: var(--border-radius-lg);
  box-shadow: var(--shadow-xl);
  width: 90%;
  max-width: 500px;
  max-height: 90vh;
  overflow-y: auto;
  padding: 24px;
  transform: translateY(20px);
  transition: var(--transition);
  backdrop-filter: var(--backdrop-blur);
  -webkit-backdrop-filter: var(--backdrop-blur);
}

.modal.open .modal-content {
  transform: translateY(0);
}

.modal-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 20px;
  padding-bottom: 16px;
  border-bottom: 1px solid var(--border-color);
}

.modal-title {
  font-size: 1.25rem;
  font-weight: 600;
  color: var(--text-primary);
}

.close-modal {
  background: none;
  border: none;
  color: var(--text-secondary);
  cursor: pointer;
  font-size: 1.2rem;
  padding: 8px;
  border-radius: var(--border-radius);
  transition: var(--transition);
}

.close-modal:hover {
  background: var(--hover-overlay);
  color: var(--text-primary);
}

.modal-body {
  margin-bottom: 20px;
}

.modal-footer {
  display: flex;
  justify-content: flex-end;
  gap: 12px;
}

/* Responsive Design */
@media (max-width: 992px) {
  .content-grid {
    grid-template-columns: 1fr;
  }
  
  .calendar-section {
    order: 2;
  }
  
  .tasks-section {
    order: 1;
  }
  
  .sidebar {
    width: 240px;
  }
  
  .main-content {
    margin-left: 240px;
    width: calc(100% - 240px);
  }
  
  .main-header {
    left: 240px;
  }
  
  .settings-panel {
    width: 100%;
    right: -100%;
  }
}

@media (max-width: 768px) {
  .main-content {
    padding: 16px;
    margin-top: 70px;
  }
  
  .tasks-header, .tasks-content {
    padding-left: 16px;
    padding-right: 16px;
  }
  
  .task-input-container {
    flex-direction: column;
    align-items: stretch;
  }
  
  .task-options {
    flex-direction: column;
    align-items: stretch;
  }
  
  .task-option-select {
    width: 100%;
  }
  
  .theme-options {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .ai-panel {
    width: calc(100vw - 32px);
    right: 16px;
    bottom: 90px;
  }
  
  .sidebar {
    width: 100%;
    transform: translateX(-100%);
    transition: transform 0.3s ease;
  }
  
  .sidebar.open {
    transform: translateX(0);
  }
  
  .main-content {
    margin-left: 0;
    width: 100%;
  }
  
  .main-header {
    left: 0;
  }
  
  .floating-add-btn {
    bottom: 16px;
    right: 16px;
  }
}

@media (max-width: 480px) {
  .main-header {
    padding: 12px 16px;
  }
  
  .header-title {
    font-size: 1.3rem;
  }
  
  .header-btn {
    width: 36px;
    height: 36px;
  }
  
  .task-item {
    padding: 12px;
  }
  
  .task-input {
    font-size: 16px;
  }
  
  .calendar-day {
    font-size: 0.75rem;
  }
  
  .theme-options {
    grid-template-columns: 1fr;
  }
  
  .ai-panel {
    width: calc(100vw - 20px);
    right: 10px;
  }
  
  .floating-add-btn {
    width: 48px;
    height: 48px;
    font-size: 1rem;
  }
}

/* Scrollbar Styling */
::-webkit-scrollbar {
  width: 6px;
}

::-webkit-scrollbar-track {
  background: transparent;
}

::-webkit-scrollbar-thumb {
  background: var(--border-color);
  border-radius: 3px;
}

::-webkit-scrollbar-thumb:hover {
  background: var(--text-secondary);
}

/* Focus Styles for Accessibility */
a, button, input, select, .task-item, .calendar-day {
  --focus-ring-color: var(--primary);
}

:is(a, button, input, select, .task-item, .calendar-day):focus-visible {
  outline: 2px solid var(--focus-ring-color);
  outline-offset: 2px;
  box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.2);
}

/* Natural Language Input Styles */
.natural-language-hint {
  font-size: 0.75rem;
  color: var(--text-secondary);
  margin-top: 8px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.natural-language-hint i {
  color: var(--primary);
}

/* Sound Feedback */
@keyframes chime {
  0% { transform: scale(1); }
  50% { transform: scale(1.1); }
  100% { transform: scale(1); }
}

.chime-animation {
  animation: chime 0.3s ease;
}

/* Mobile Menu Button */
.mobile-menu-btn {
  display: none;
  background: none;
  border: none;
  color: var(--text-secondary);
  font-size: 1.2rem;
  cursor: pointer;
  padding: 8px;
  border-radius: var(--border-radius);
  transition: var(--transition);
}

.mobile-menu-btn:hover {
  background: var(--hover-overlay);
  color: var(--text-primary);
}

@media (max-width: 768px) {
  .mobile-menu-btn {
    display: block;
  }
}
</style>
</head>
<body class="theme-glass">
<div class="app-container">
  <!-- Sidebar -->
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <h1 class="sidebar-title">
        <i class="fas fa-check-circle"></i>
        Chrono Focus Pro
      </h1>
    </div>
    <ul class="sidebar-nav">
      <li class="sidebar-item">
        <a href="#" class="sidebar-link active" data-view="today">
          <i class="fas fa-inbox"></i>
          <span>Today</span>
        </a>
      </li>
      <li class="sidebar-item">
        <a href="#" class="sidebar-link" data-view="upcoming">
          <i class="fas fa-calendar-alt"></i>
          <span>Upcoming</span>
        </a>
      </li>
      <li class="sidebar-item">
        <a href="#" class="sidebar-link" data-view="projects">
          <i class="fas fa-folder"></i>
          <span>Projects</span>
        </a>
      </li>
      <li class="sidebar-item">
        <a href="#" class="sidebar-link" data-view="history">
          <i class="fas fa-history"></i>
          <span>History</span>
        </a>
      </li>
    </ul>
    
    <div class="sidebar-section">
      <div class="sidebar-section-title">Filters & Labels</div>
      <ul class="sidebar-nav">
        <li class="sidebar-item">
          <a href="#" class="sidebar-link" data-filter="priority-high">
            <i class="fas fa-flag" style="color: var(--priority-high)"></i>
            <span>High Priority</span>
          </a>
        </li>
        <li class="sidebar-item">
          <a href="#" class="sidebar-link" data-filter="priority-medium">
            <i class="fas fa-flag" style="color: var(--priority-medium)"></i>
            <span>Medium Priority</span>
          </a>
        </li>
        <li class="sidebar-item">
          <a href="#" class="sidebar-link" data-filter="priority-low">
            <i class="fas fa-flag" style="color: var(--priority-low)"></i>
            <span>Low Priority</span>
          </a>
        </li>
      </ul>
    </div>
  </aside>

  <!-- Header -->
  <header class="main-header">
    <div>
      <h1 class="header-title" id="viewTitle">Today</h1>
      <div class="header-date" id="currentDate"></div>
    </div>
    <div class="header-controls">
      <button class="header-btn" id="searchBtn" title="Search">
        <i class="fas fa-search"></i>
      </button>
      <button class="header-btn" id="notificationsBtn" title="Notifications">
        <i class="fas fa-bell"></i>
      </button>
      <button class="header-btn" id="profileBtn" title="Profile">
        <i class="fas fa-user"></i>
      </button>
      <button class="mobile-menu-btn" id="mobileMenuBtn">
        <i class="fas fa-bars"></i>
      </button>
    </div>
  </header>

  <!-- Main Content -->
  <main class="main-content">
    <div class="content-grid">
      <!-- Tasks Section -->
      <section class="tasks-section">
        <div class="tasks-header">
          <div class="task-input-container">
            <div class="task-input-wrapper">
              <textarea
                class="task-input"
                id="taskInput"
                placeholder="Add a new task (try natural language like 'meeting at 5 pm tomorrow')..."
                rows="1"
              ></textarea>
            </div>
            <button class="add-task-btn" id="addTaskBtn">
              <i class="fas fa-plus"></i>
              Add
            </button>
          </div>
          <div class="task-options">
            <select class="task-option-select" id="taskPriority" aria-label="Task Priority">
              <option value="low">Low Priority</option>
              <option value="medium" selected>Medium Priority</option>
              <option value="high">High Priority</option>
            </select>
            <select class="task-option-select" id="taskCategory" aria-label="Task Category">
              <option value="general">üìã General</option>
              <option value="work">üíº Work</option>
              <option value="personal">üë§ Personal</option>
              <option value="shopping">üõí Shopping</option>
              <option value="health">‚ù§Ô∏è Health</option>
              <option value="learning">üìö Learning</option>
            </select>
            <input type="date" class="task-option-select" id="taskDate" aria-label="Task Date">
          </div>
          <div class="natural-language-hint">
            <i class="fas fa-lightbulb"></i>
            <span>Try: "meeting tomorrow at 3pm" or "buy groceries on Friday"</span>
          </div>
        </div>

        <div class="tasks-content">
          <div class="task-list-header">
            <div class="task-count" id="taskCount">0 tasks</div>
            <div class="task-filters">
              <button class="filter-btn active" data-filter="all">All</button>
              <button class="filter-btn" data-filter="pending">Active</button>
              <button class="filter-btn" data-filter="completed">Done</button>
            </div>
          </div>

          <ul class="tasks-list" id="tasksList"></ul>

          <div class="empty-state" id="emptyState">
            <i class="fas fa-clipboard-list"></i>
            <h3>No tasks yet</h3>
            <p>Add your first task to get started!</p>
          </div>
        </div>
      </section>

      <!-- Calendar Section -->
      <section class="calendar-section">
        <div class="calendar-header">
          <div class="calendar-top-controls">
            <div class="calendar-nav">
              <button id="prevMonth" aria-label="Previous Month"><i class="fas fa-chevron-left"></i></button>
              <div class="calendar-title" id="calendarTitle"></div>
              <button id="nextMonth" aria-label="Next Month"><i class="fas fa-chevron-right"></i></button>
            </div>
          </div>
          <button class="add-task-btn" id="todayBtn" style="padding: 8px 16px; font-size: 0.875rem;">Today</button>
        </div>
        <div class="calendar-grid">
          <div class="calendar-weekdays">
            <div class="calendar-weekday">Sun</div>
            <div class="calendar-weekday">Mon</div>
            <div class="calendar-weekday">Tue</div>
            <div class="calendar-weekday">Wed</div>
            <div class="calendar-weekday">Thu</div>
            <div class="calendar-weekday">Fri</div>
            <div class="calendar-weekday">Sat</div>
          </div>
          <div class="calendar-days" id="calendarDays"></div>
        </div>
      </section>
    </div>
    
    <!-- Stats Section -->
    <section class="stats-section">
      <div class="stats-header">
        <h2 class="stats-title">Your Productivity</h2>
        <button class="add-task-btn" id="refreshStats" style="padding: 8px 16px; font-size: 0.875rem;">Refresh</button>
      </div>
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-value" id="totalTasks">0</div>
          <div class="stat-label">Total Tasks</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="completedTasks">0</div>
          <div class="stat-label">Completed</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="pendingTasks">0</div>
          <div class="stat-label">Pending</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="completionRate">0%</div>
          <div class="stat-label">Completion Rate</div>
        </div>
      </div>
      <div class="chart-container">
        <canvas id="productivityChart"></canvas>
      </div>
    </section>
  </main>
</div>

<!-- Floating Add Button -->
<button class="floating-add-btn" id="floatingAddBtn" title="Add Task">
  <i class="fas fa-plus"></i>
</button>

<!-- Settings Panel -->
<div class="settings-panel" id="settingsPanel">
  <div class="settings-header">
    <h2 class="settings-title">Settings</h2>
    <button class="close-settings" id="closeSettings">
      <i class="fas fa-times"></i>
    </button>
  </div>
  
  <div class="settings-section">
    <h3 class="settings-section-title">Appearance</h3>
    <div class="theme-options">
      <div class="theme-option active" data-theme="theme-glass">
        <div class="theme-preview" style="background: linear-gradient(135deg, #F0F9FF 0%, #E0F2FE 100%);"></div>
        <div class="theme-name">Glass</div>
      </div>
      <div class="theme-option" data-theme="theme-midnight-glass">
        <div class="theme-preview" style="background: linear-gradient(135deg, #0F172A 0%, #1E293B 100%);"></div>
        <div class="theme-name">Midnight Glass</div>
      </div>
      <div class="theme-option" data-theme="theme-sunset-glass">
        <div class="theme-preview" style="background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%);"></div>
        <div class="theme-name">Sunset Glass</div>
      </div>
      <div class="theme-option" data-theme="theme-forest-glass">
        <div class="theme-preview" style="background: linear-gradient(135deg, #D1FAE5 0%, #A7F3D0 100%);"></div>
        <div class="theme-name">Forest Glass</div>
      </div>
      <div class="theme-option" data-theme="theme-ocean-glass">
        <div class="theme-preview" style="background: linear-gradient(135deg, #E0F2FE 0%, #BAE6FD 100%);"></div>
        <div class="theme-name">Ocean Glass</div>
      </div>
    </div>
  </div>
  
  <div class="settings-section">
    <h3 class="settings-section-title">Notifications</h3>
    <div style="display: flex; flex-direction: column; gap: 12px;">
      <label style="display: flex; align-items: center; gap: 12px;">
        <input type="checkbox" id="taskNotifications" checked>
        <span>Task reminders</span>
      </label>
      <label style="display: flex; align-items: center; gap: 12px;">
        <input type="checkbox" id="dailyDigest" checked>
        <span>Daily digest</span>
      </label>
      <label style="display: flex; align-items: center; gap: 12px;">
        <input type="checkbox" id="soundEffects" checked>
        <span>Sound effects</span>
      </label>
    </div>
  </div>
  
  <div class="settings-section">
    <h3 class="settings-section-title">Data</h3>
    <div style="display: flex; flex-direction: column; gap: 12px;">
      <button class="task-option-select" id="exportData">Export Data</button>
      <button class="task-option-select" id="importData">Import Data</button>
      <button class="task-option-select" id="clearData" style="color: var(--danger);">Clear All Data</button>
    </div>
  </div>
</div>

<!-- AI Panel -->
<div class="ai-panel" id="aiPanel">
  <div class="ai-header">
    <h3 class="ai-title">Optichain Ultra</h3>
    <span class="ai-status">Online</span>
  </div>
  <div class="ai-messages" id="aiMessages">
    <div class="ai-message assistant">
      Hello! I'm Optichain Ultra, your AI assistant. I can help you manage tasks, analyze productivity, suggest improvements, and much more. How can I assist you today?
    </div>
  </div>
  <div class="ai-input-container">
    <input type="text" class="ai-input" id="aiInput" placeholder="Ask me anything...">
    <button class="ai-send" id="aiSend">
      <i class="fas fa-paper-plane"></i>
    </button>
  </div>
  <div class="ai-commands">
    <div class="ai-command" data-command="find task">Find a task</div>
    <div class="ai-command" data-command="suggest tasks">Suggest tasks</div>
    <div class="ai-command" data-command="add task">Add a task</div>
    <div class="ai-command" data-command="stats">Show stats</div>
    <div class="ai-command" data-command="productivity tips">Productivity tips</div>
    <div class="ai-command" data-command="schedule help">Schedule help</div>
  </div>
</div>

<!-- Task Description Modal -->
<div class="modal" id="taskDescriptionModal">
  <div class="modal-content">
    <div class="modal-header">
      <h2 class="modal-title">Task Description</h2>
      <button class="close-modal" id="closeTaskDescriptionModal">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="modal-body">
      <textarea class="task-input" id="taskDescriptionInput" placeholder="Add a detailed description for this task..." rows="6"></textarea>
    </div>
    <div class="modal-footer">
      <button class="task-option-select" id="cancelTaskDescription">Cancel</button>
      <button class="add-task-btn" id="saveTaskDescription">Save</button>
    </div>
  </div>
</div>

<!-- Toast Container -->
<div class="toast-container" id="toastContainer"></div>

<script>
class ChronoFocusPro {
  constructor() {
    this.currentDate = new Date();
    this.selectedDate = new Date();
    this.currentFilter = 'all';
    this.currentView = 'today';
    this.draggedTask = null;
    this.aiActive = false;
    this.currentEditingTaskId = null;
    this.productivityChart = null;

    this.initializeElements();
    this.setupEventListeners();
    this.loadTheme();
    this.renderCalendar();
    this.updateTasksView();
    this.autoResizeTextarea();
    this.updateCurrentDate();
    this.loadHistory();
  }

  initializeElements() {
    this.elements = {
      // Body
      body: document.body,
      
      // Sidebar
      sidebar: document.getElementById('sidebar'),
      sidebarLinks: document.querySelectorAll('.sidebar-link'),
      mobileMenuBtn: document.getElementById('mobileMenuBtn'),
      
      // Header
      viewTitle: document.getElementById('viewTitle'),
      currentDate: document.getElementById('currentDate'),
      searchBtn: document.getElementById('searchBtn'),
      notificationsBtn: document.getElementById('notificationsBtn'),
      profileBtn: document.getElementById('profileBtn'),
      
      // Tasks
      taskInput: document.getElementById('taskInput'),
      addTaskBtn: document.getElementById('addTaskBtn'),
      floatingAddBtn: document.getElementById('floatingAddBtn'),
      taskPriority: document.getElementById('taskPriority'),
      taskCategory: document.getElementById('taskCategory'),
      taskDate: document.getElementById('taskDate'),
      tasksList: document.getElementById('tasksList'),
      taskCount: document.getElementById('taskCount'),
      filterBtns: document.querySelectorAll('.filter-btn'),
      emptyState: document.getElementById('emptyState'),
      
      // Calendar
      calendarTitle: document.getElementById('calendarTitle'),
      calendarDays: document.getElementById('calendarDays'),
      prevMonth: document.getElementById('prevMonth'),
      nextMonth: document.getElementById('nextMonth'),
      todayBtn: document.getElementById('todayBtn'),
      
      // Settings
      settingsPanel: document.getElementById('settingsPanel'),
      closeSettings: document.getElementById('closeSettings'),
      themeOptions: document.querySelectorAll('.theme-option'),
      
      // AI
      aiPanel: document.getElementById('aiPanel'),
      aiMessages: document.getElementById('aiMessages'),
      aiInput: document.getElementById('aiInput'),
      aiSend: document.getElementById('aiSend'),
      aiCommands: document.querySelectorAll('.ai-command'),
      
      // Stats
      totalTasks: document.getElementById('totalTasks'),
      completedTasks: document.getElementById('completedTasks'),
      pendingTasks: document.getElementById('pendingTasks'),
      completionRate: document.getElementById('completionRate'),
      refreshStats: document.getElementById('refreshStats'),
      productivityChart: document.getElementById('productivityChart'),
      
      // Task Description Modal
      taskDescriptionModal: document.getElementById('taskDescriptionModal'),
      taskDescriptionInput: document.getElementById('taskDescriptionInput'),
      closeTaskDescriptionModal: document.getElementById('closeTaskDescriptionModal'),
      cancelTaskDescription: document.getElementById('cancelTaskDescription'),
      saveTaskDescription: document.getElementById('saveTaskDescription'),
      
      // Toast
      toastContainer: document.getElementById('toastContainer')
    };
    
    // Set default date to today
    this.elements.taskDate.value = this.formatDate(new Date());
  }

  setupEventListeners() {
    // Mobile menu
    this.elements.mobileMenuBtn.addEventListener('click', () => this.toggleSidebar());
    
    // Sidebar navigation
    this.elements.sidebarLinks.forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const view = e.currentTarget.dataset.view;
        const filter = e.currentTarget.dataset.filter;
        
        if (view) {
          this.setView(view);
        } else if (filter) {
          this.setFilterByPriority(filter);
        }
        
        // Close sidebar on mobile after selection
        if (window.innerWidth < 768) {
          this.toggleSidebar();
        }
      });
    });

    // Task input and actions
    this.elements.taskInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        this.addTask();
      }
    });
    this.elements.addTaskBtn.addEventListener('click', () => this.addTask());
    this.elements.floatingAddBtn.addEventListener('click', () => this.focusTaskInput());

    // Filters
    this.elements.filterBtns.forEach(btn => {
      btn.addEventListener('click', () => this.setFilter(btn.dataset.filter));
    });

    // Calendar controls
    this.elements.prevMonth.addEventListener('click', () => this.changeMonth(-1));
    this.elements.nextMonth.addEventListener('click', () => this.changeMonth(1));
    this.elements.todayBtn.addEventListener('click', () => this.goToToday());

    // Header buttons
    this.elements.searchBtn.addEventListener('click', () => this.showSearch());
    this.elements.notificationsBtn.addEventListener('click', () => this.showNotifications());
    this.elements.profileBtn.addEventListener('click', () => this.showProfile());

    // Settings
    this.elements.closeSettings.addEventListener('click', () => this.toggleSettings());
    
    // Theme options
    this.elements.themeOptions.forEach(option => {
      option.addEventListener('click', () => {
        this.elements.themeOptions.forEach(opt => opt.classList.remove('active'));
        option.classList.add('active');
        this.setTheme(option.dataset.theme);
      });
    });

    // AI Assistant
    this.elements.aiSend.addEventListener('click', () => this.sendAIMessage());
    this.elements.aiInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        this.sendAIMessage();
      }
    });
    
    // AI commands
    this.elements.aiCommands.forEach(command => {
      command.addEventListener('click', () => {
        const cmd = command.dataset.command;
        this.handleAICommand(cmd);
      });
    });

    // Stats
    this.elements.refreshStats.addEventListener('click', () => this.updateStats());

    // Task Description Modal
    this.elements.closeTaskDescriptionModal.addEventListener('click', () => this.closeTaskDescriptionModal());
    this.elements.cancelTaskDescription.addEventListener('click', () => this.closeTaskDescriptionModal());
    this.elements.saveTaskDescription.addEventListener('click', () => this.saveTaskDescription());
  }

  toggleSidebar() {
    this.elements.sidebar.classList.toggle('open');
  }

  setView(view) {
    this.currentView = view;
    
    // Update active state in sidebar
    this.elements.sidebarLinks.forEach(link => {
      link.classList.remove('active');
      if (link.dataset.view === view) {
        link.classList.add('active');
      }
    });
    
    // Update view title
    const viewTitles = {
      'today': 'Today',
      'upcoming': 'Upcoming',
      'projects': 'Projects',
      'history': 'History'
    };
    
    this.elements.viewTitle.textContent = viewTitles[view] || 'Today';
    
    // Update tasks view based on selected view
    this.updateTasksView();
  }

  setFilterByPriority(priorityFilter) {
    // Set active state in sidebar
    this.elements.sidebarLinks.forEach(link => {
      if (link.dataset.filter) {
        link.classList.remove('active');
        if (link.dataset.filter === priorityFilter) {
          link.classList.add('active');
        }
      }
    });
    
    // Update tasks view with priority filter
    this.updateTasksView(priorityFilter);
  }

  // Task Methods
  addTask() {
    const text = this.elements.taskInput.value.trim();
    if (!text) {
      this.showToast('Please enter a task', 'error');
      return;
    }
    
    // Parse natural language for date and time
    const parsedTask = this.parseNaturalLanguage(text);
    
    const task = {
      id: `task_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
      text: parsedTask.text,
      completed: false,
      priority: this.elements.taskPriority.value,
      category: this.elements.taskCategory.value,
      date: parsedTask.date || this.elements.taskDate.value || this.formatDate(new Date()),
      time: parsedTask.time,
      createdAt: new Date().toISOString(),
      description: '',
      notes: ''
    };
    
    const tasks = this.getTasks();
    tasks.push(task);
    this.saveTasks(tasks);
    
    this.elements.taskInput.value = '';
    this.elements.taskInput.style.height = 'auto';
    this.updateTasksView();
    this.renderCalendar();
    this.updateStats();
    this.showToast('Task added!', 'success');
    
    // Play sound if enabled
    this.playSound('add');
  }

  parseNaturalLanguage(text) {
    const result = { text, date: null, time: null };
    
    // Common date patterns
    const today = new Date();
    const tomorrow = new Date(today);
    tomorrow.setDate(tomorrow.getDate() + 1);
    
    // Remove date/time indicators from the text
    const patterns = [
      { regex: /\b(today|now)\b/i, date: this.formatDate(today) },
      { regex: /\btomorrow\b/i, date: this.formatDate(tomorrow) },
      { regex: /\b(monday|tuesday|wednesday|thursday|friday|saturday|sunday)\b/i, 
        handler: (day) => {
          const days = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'];
          const targetDay = days.indexOf(day.toLowerCase());
          const currentDay = today.getDay();
          let diff = targetDay - currentDay;
          if (diff <= 0) diff += 7;
          const date = new Date(today);
          date.setDate(date.getDate() + diff);
          return this.formatDate(date);
        }
      },
      { regex: /\b(\d{1,2})(:\d{2})?\s*(am|pm)\b/i, 
        handler: (match) => {
          result.time = match[0].toUpperCase();
          return null;
        }
      },
      { regex: /\bat\s+(\d{1,2})(:\d{2})?\s*(am|pm)\b/i, 
        handler: (match) => {
          result.time = match[1] + (match[2] || ':00') + ' ' + match[3].toUpperCase();
          return null;
        }
      }
    ];
    
    for (const pattern of patterns) {
      const match = text.match(pattern.regex);
      if (match) {
        if (pattern.handler) {
          const date = pattern.handler(match);
          if (date) result.date = date;
        } else {
          result.date = pattern.date;
        }
        
        // Remove the matched text from the task description
        result.text = result.text.replace(pattern.regex, '').trim();
      }
    }
    
    return result;
  }

  toggleTask(taskId) {
    const tasks = this.getTasks();
    const task = tasks.find(t => t.id === taskId);
    if (task) {
      task.completed = !task.completed;
      task.completedAt = task.completed ? new Date().toISOString() : null;
      
      // Move to history if completed
      if (task.completed) {
        this.addToHistory(task);
      }
      
      this.saveTasks(tasks);
      this.updateTasksView();
      this.updateStats();
      
      if(task.completed) {
        this.showToast('Task completed! üéâ', 'success');
        this.playSound('complete');
        
        // Add chime animation
        const taskElement = document.querySelector(`[data-task-id="${taskId}"]`);
        if (taskElement) {
          taskElement.classList.add('chime-animation');
          setTimeout(() => {
            taskElement.classList.remove('chime-animation');
          }, 300);
        }
      } else {
        this.playSound('undo');
      }
    }
  }

  deleteTask(taskId, taskElement) {
    if (confirm('Are you sure you want to delete this task?')) {
        taskElement.classList.add('fade-out');
        taskElement.addEventListener('animationend', () => {
            let tasks = this.getTasks();
            tasks = tasks.filter(t => t.id !== taskId);
            this.saveTasks(tasks);
            this.updateTasksView();
            this.renderCalendar();
            this.updateStats();
            this.showToast('Task deleted', 'success');
            this.playSound('delete');
        }, { once: true });
    }
  }

  editTask(taskId) {
    const tasks = this.getTasks();
    const task = tasks.find(t => t.id === taskId);
    if (task && !task.completed) {
      const newText = prompt('Edit task:', task.text);
      if (newText && newText.trim() && newText.trim() !== task.text) {
        task.text = newText.trim();
        this.saveTasks(tasks);
        this.updateTasksView();
        this.showToast('Task updated!', 'success');
        this.playSound('edit');
      }
    }
  }

  editTaskDescription(taskId) {
    const tasks = this.getTasks();
    const task = tasks.find(t => t.id === taskId);
    if (task) {
      this.currentEditingTaskId = taskId;
      this.elements.taskDescriptionInput.value = task.description || '';
      this.elements.taskDescriptionModal.classList.add('open');
    }
  }

  saveTaskDescription() {
    if (!this.currentEditingTaskId) return;
    
    const tasks = this.getTasks();
    const task = tasks.find(t => t.id === this.currentEditingTaskId);
    if (task) {
      task.description = this.elements.taskDescriptionInput.value.trim();
      this.saveTasks(tasks);
      this.updateTasksView();
      this.closeTaskDescriptionModal();
      this.showToast('Description saved!', 'success');
      this.playSound('edit');
    }
  }

  closeTaskDescriptionModal() {
    this.elements.taskDescriptionModal.classList.remove('open');
    this.currentEditingTaskId = null;
  }

  // View Methods
  updateTasksView(priorityFilter = null) {
    let tasks = this.getFilteredTasks();
    
    // Apply priority filter if specified
    if (priorityFilter) {
      const priority = priorityFilter.replace('priority-', '');
      tasks = tasks.filter(task => task.priority === priority);
    }
    
    this.renderTasks(tasks);
  }

  getFilteredTasks() {
    let tasks = this.getTasks();
    
    // Filter by view
    if (this.currentView === 'today') {
      const today = this.formatDate(new Date());
      tasks = tasks.filter(task => task.date === today);
    } else if (this.currentView === 'upcoming') {
      const today = this.formatDate(new Date());
      tasks = tasks.filter(task => task.date >= today);
    } else if (this.currentView === 'history') {
      return this.getHistory();
    }
    
    // Filter by status
    if (this.currentFilter === 'pending') tasks = tasks.filter(task => !task.completed);
    else if (this.currentFilter === 'completed') tasks = tasks.filter(task => task.completed);
    
    // Sort tasks
    tasks.sort((a, b) => {
        if (a.completed !== b.completed) return a.completed - b.completed;
        const priorityOrder = { high: 0, medium: 1, low: 2 };
        if (priorityOrder[a.priority] !== priorityOrder[b.priority]) return priorityOrder[a.priority] - priorityOrder[b.priority];
        return new Date(a.date) - new Date(b.date);
    });
    
    return tasks;
  }
  
  renderTasks(tasks) {
    this.elements.tasksList.innerHTML = '';
    this.updateTaskCount(tasks.length);

    if (tasks.length === 0) {
      this.elements.emptyState.style.display = 'block';
    } else {
      this.elements.emptyState.style.display = 'none';
      tasks.forEach(task => {
        this.elements.tasksList.appendChild(this.createTaskElement(task));
      });
    }
  }

  createTaskElement(task) {
    const li = document.createElement('li');
    li.className = 'task-item';
    li.dataset.taskId = task.id;
    if (task.completed) li.classList.add('completed');
    const categoryIcons = { general: 'üìã', work: 'üíº', personal: 'üë§', shopping: 'üõí', health: '‚ù§Ô∏è', learning: 'üìö' };

    li.innerHTML = `
      <div class="task-checkbox ${task.completed ? 'checked' : ''}" data-action="toggle"></div>
      <div class="task-content">
        <div class="task-text-content">
          <div class="task-text">${task.text}</div>
          ${task.time ? `<span class="task-time" style="font-size: 0.875rem; color: var(--text-secondary);">${task.time}</span>` : ''}
        </div>
        ${task.description ? `<div class="task-notes">${task.description}</div>` : ''}
        ${task.notes ? `<div class="task-notes">${task.notes}</div>` : ''}
        <div class="task-meta">
          <span class="task-priority ${task.priority}">${task.priority}</span>
          <span class="task-date"><i class="fas fa-calendar-alt"></i> ${new Date(task.date.replace(/-/g, '/')).toLocaleDateString()}</span>
          <span>${categoryIcons[task.category]} ${task.category.charAt(0).toUpperCase() + task.category.slice(1)}</span>
        </div>
      </div>
      <div class="task-actions">
        <button class="task-action-btn edit" data-action="edit" title="Edit"><i class="fas fa-edit"></i></button>
        <button class="task-action-btn notes" data-action="description" title="Description"><i class="fas fa-align-left"></i></button>
        <button class="task-action-btn delete" data-action="delete" title="Delete"><i class="fas fa-trash"></i></button>
      </div>
    `;

    li.addEventListener('click', (e) => {
        const actionTarget = e.target.closest('[data-action]');
        if (!actionTarget) return;
        const action = actionTarget.dataset.action;
        
        if (action === 'toggle') this.toggleTask(task.id);
        else if (action === 'edit') this.editTask(task.id);
        else if (action === 'description') this.editTaskDescription(task.id);
        else if (action === 'delete') this.deleteTask(task.id, li);
    });

    return li;
  }

  setFilter(filter) {
    this.currentFilter = filter;
    this.elements.filterBtns.forEach(btn => btn.classList.toggle('active', btn.dataset.filter === filter));
    this.updateTasksView();
  }

  // Calendar Methods
  renderCalendar() {
    const year = this.currentDate.getFullYear();
    const month = this.currentDate.getMonth();
    this.elements.calendarTitle.textContent = new Date(year, month).toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
    this.elements.calendarDays.innerHTML = '';
    const firstDay = new Date(year, month, 1).getDay();
    const daysInMonth = new Date(year, month + 1, 0).getDate();
    const daysInPrevMonth = new Date(year, month, 0).getDate();

    for (let i = firstDay; i > 0; i--) {
        const day = daysInPrevMonth - i + 1;
        this.elements.calendarDays.appendChild(this.createCalendarDay(day, true, new Date(year, month - 1, day)));
    }
    for (let day = 1; day <= daysInMonth; day++) {
        this.elements.calendarDays.appendChild(this.createCalendarDay(day, false, new Date(year, month, day)));
    }
    const gridCells = this.elements.calendarDays.children.length;
    const remainingCells = gridCells > 35 ? 42 - gridCells : 35 - gridCells;
    for (let day = 1; day <= remainingCells; day++) {
      this.elements.calendarDays.appendChild(this.createCalendarDay(day, true, new Date(year, month + 1, day)));
    }
  }

  createCalendarDay(day, isOtherMonth, fullDate) {
    const dayElement = document.createElement('div');
    dayElement.className = 'calendar-day';
    dayElement.textContent = day;

    if (isOtherMonth) dayElement.classList.add('other-month');

    const today = new Date();
    if (this.isSameDate(fullDate, today)) dayElement.classList.add('today');
    if (this.isSameDate(fullDate, this.selectedDate)) dayElement.classList.add('selected');

    if (this.getTasksForDate(fullDate).length > 0) dayElement.classList.add('has-tasks');

    dayElement.addEventListener('click', () => {
      this.selectDate(fullDate);
    });

    return dayElement;
  }

  selectDate(date) {
    this.selectedDate = new Date(date);
    this.elements.taskDate.value = this.formatDate(this.selectedDate);
    this.updateTasksView();
    this.renderCalendar();
  }

  changeMonth(delta) {
    this.currentDate.setMonth(this.currentDate.getMonth() + delta);
    this.renderCalendar();
  }

  goToToday() {
    this.currentDate = new Date();
    this.selectedDate = new Date();
    this.elements.taskDate.value = this.formatDate(new Date());
    this.updateTasksView();
    this.renderCalendar();
  }

  // Header Methods
  updateCurrentDate() {
    const now = new Date();
    const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
    this.elements.currentDate.textContent = now.toLocaleDateString('en-US', options);
  }

  showSearch() {
    const query = prompt('Search tasks:');
    if (query) {
      this.searchTasks(query);
    }
  }

  searchTasks(query) {
    const tasks = this.getTasks();
    const filteredTasks = tasks.filter(task => 
      task.text.toLowerCase().includes(query.toLowerCase()) ||
      (task.description && task.description.toLowerCase().includes(query.toLowerCase()))
    );
    
    this.renderTasks(filteredTasks);
    this.showToast(`Found ${filteredTasks.length} tasks matching "${query}"`, 'success');
  }

  showNotifications() {
    this.showToast('No new notifications', 'success');
  }

  showProfile() {
    this.toggleSettings();
  }

  focusTaskInput() {
    this.elements.taskInput.focus();
  }

  // Stats Methods
  updateStats() {
    const tasks = this.getTasks();
    const total = tasks.length;
    const completed = tasks.filter(t => t.completed).length;
    const pending = total - completed;
    const completionRate = total > 0 ? Math.round((completed / total) * 100) : 0;
    
    this.elements.totalTasks.textContent = total;
    this.elements.completedTasks.textContent = completed;
    this.elements.pendingTasks.textContent = pending;
    this.elements.completionRate.textContent = `${completionRate}%`;
    
    this.renderProductivityChart();
  }

  renderProductivityChart() {
    const tasks = this.getTasks();
    const last7Days = [];
    for (let i = 6; i >= 0; i--) {
      const date = new Date();
      date.setDate(date.getDate() - i);
      last7Days.push(this.formatDate(date));
    }
    
    const completedByDay = last7Days.map(date => {
      return tasks.filter(task => task.completed && task.completedAt && 
        task.completedAt.startsWith(date)).length;
    });
    
    const createdByDay = last7Days.map(date => {
      return tasks.filter(task => task.createdAt.startsWith(date)).length;
    });
    
    const ctx = this.elements.productivityChart.getContext('2d');
    
    // Destroy existing chart if it exists
    if (this.productivityChart) {
      this.productivityChart.destroy();
    }
    
    this.productivityChart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: last7Days.map(date => {
          const d = new Date(date);
          return d.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
        }),
        datasets: [
          {
            label: 'Tasks Completed',
            data: completedByDay,
            backgroundColor: 'rgba(99, 102, 241, 0.7)',
            borderColor: 'rgba(99, 102, 241, 1)',
            borderWidth: 1
          },
          {
            label: 'Tasks Created',
            data: createdByDay,
            backgroundColor: 'rgba(16, 185, 129, 0.7)',
            borderColor: 'rgba(16, 185, 129, 1)',
            borderWidth: 1
          }
        ]
      },
      options: {
        responsive: true,
        scales: {
          y: {
            beginAtZero: true,
            ticks: {
              stepSize: 1
            }
          }
        },
        plugins: {
          title: {
            display: true,
            text: 'Productivity Last 7 Days'
          }
        }
      }
    });
  }

  // History Methods
  addToHistory(task) {
    const history = this.getHistory();
    history.push({
      ...task,
      archivedAt: new Date().toISOString()
    });
    this.saveHistory(history);
  }

  loadHistory() {
    // This is called on initialization
    // History is loaded when the history view is selected
  }

  // AI Assistant Methods
  toggleAIPanel() {
    this.elements.aiPanel.classList.toggle('visible');
    this.aiActive = !this.aiActive;
    
    if (this.aiActive) {
      this.elements.aiInput.focus();
    }
  }

  sendAIMessage() {
    const message = this.elements.aiInput.value.trim();
    if (!message) return;
    
    // Add user message
    this.addAIMessage(message, 'user');
    this.elements.aiInput.value = '';
    
    // Process and respond
    setTimeout(() => {
      this.processAIMessage(message);
    }, 500);
  }

  addAIMessage(text, sender) {
    const messageDiv = document.createElement('div');
    messageDiv.className = `ai-message ${sender}`;
    messageDiv.textContent = text;
    this.elements.aiMessages.appendChild(messageDiv);
    this.elements.aiMessages.scrollTop = this.elements.aiMessages.scrollHeight;
  }

  processAIMessage(message) {
    const lowerMessage = message.toLowerCase();
    let response = "I'm not sure how to help with that. Try asking me to find a task, suggest tasks, add a task, show stats, or get productivity tips.";
    
    if (lowerMessage.includes('find') || lowerMessage.includes('search') || lowerMessage.includes('look')) {
      response = this.handleFindTask(message);
    } else if (lowerMessage.includes('suggest') || lowerMessage.includes('recommend')) {
      response = this.handleSuggestTasks(message);
    } else if (lowerMessage.includes('add') || lowerMessage.includes('create') || lowerMessage.includes('new task')) {
      response = this.handleAddTask(message);
    } else if (lowerMessage.includes('stat') || lowerMessage.includes('progress')) {
      response = this.handleShowStats(message);
    } else if (lowerMessage.includes('productivity') || lowerMessage.includes('tip') || lowerMessage.includes('advice')) {
      response = this.handleProductivityTips(message);
    } else if (lowerMessage.includes('schedule') || lowerMessage.includes('plan') || lowerMessage.includes('organize')) {
      response = this.handleScheduleHelp(message);
    } else if (lowerMessage.includes('help') || lowerMessage.includes('what can you do')) {
      response = "I can help you:\n- Find tasks by name or date\n- Suggest tasks based on your habits\n- Add new tasks\n- Show your task statistics\n- Provide productivity tips\n- Help with scheduling and organization\n- And more! Just ask!";
    }
    
    this.addAIMessage(response, 'assistant');
  }

  handleAICommand(command) {
    let message = "";
    
    switch(command) {
      case 'find task':
        message = "Find tasks for today";
        break;
      case 'suggest tasks':
        message = "Suggest some tasks";
        break;
      case 'add task':
        message = "Add a task to exercise";
        break;
      case 'stats':
        message = "Show my stats";
        break;
      case 'productivity tips':
        message = "Give me productivity tips";
        break;
      case 'schedule help':
        message = "Help me organize my schedule";
        break;
    }
    
    this.elements.aiInput.value = message;
    this.sendAIMessage();
  }

  handleFindTask(message) {
    const tasks = this.getTasks();
    const lowerMessage = message.toLowerCase();
    
    // Try to extract date information
    let dateFilter = null;
    if (lowerMessage.includes('today')) {
      dateFilter = this.formatDate(new Date());
    } else if (lowerMessage.includes('yesterday')) {
      const yesterday = new Date();
      yesterday.setDate(yesterday.getDate() - 1);
      dateFilter = this.formatDate(yesterday);
    } else if (lowerMessage.includes('tomorrow')) {
      const tomorrow = new Date();
      tomorrow.setDate(tomorrow.getDate() + 1);
      dateFilter = this.formatDate(tomorrow);
    } else if (lowerMessage.includes('this week')) {
      // This week logic would be more complex
    }
    
    // Filter tasks
    let filteredTasks = tasks;
    if (dateFilter) {
      filteredTasks = tasks.filter(task => task.date === dateFilter);
    }
    
    // Also filter by text if present
    const textParts = message.split(' ').filter(word => 
      !['find', 'search', 'look', 'for', 'task', 'tasks', 'today', 'yesterday', 'tomorrow', 'this', 'week'].includes(word.toLowerCase())
    );
    
    if (textParts.length > 0) {
      const searchText = textParts.join(' ').toLowerCase();
      filteredTasks = filteredTasks.filter(task => 
        task.text.toLowerCase().includes(searchText) ||
        (task.description && task.description.toLowerCase().includes(searchText))
      );
    }
    
    if (filteredTasks.length === 0) {
      return "I couldn't find any tasks matching your search.";
    }
    
    let response = `I found ${filteredTasks.length} task(s):\n`;
    filteredTasks.slice(0, 5).forEach(task => {
      const status = task.completed ? "‚úì Completed" : "‚óã Pending";
      response += `- "${task.text}" (${status}, ${task.date})\n`;
    });
    
    if (filteredTasks.length > 5) {
      response += `... and ${filteredTasks.length - 5} more tasks.`;
    }
    
    return response;
  }

  handleSuggestTasks(message) {
    const tasks = this.getTasks();
    const categories = [...new Set(tasks.map(t => t.category))];
    
    let suggestions = [];
    
    // Suggest based on user's common categories
    if (categories.includes('health')) {
      suggestions.push("Go for a 30-minute walk");
      suggestions.push("Drink 8 glasses of water today");
    }
    
    if (categories.includes('learning')) {
      suggestions.push("Read a chapter of a book");
      suggestions.push("Watch an educational video");
    }
    
    if (categories.includes('work')) {
      suggestions.push("Review your weekly goals");
      suggestions.push("Organize your workspace");
    }
    
    // Add general suggestions if we don't have enough
    const generalSuggestions = [
      "Plan meals for the next few days",
      "Backup important files",
      "Clean out your email inbox",
      "Update your resume or portfolio",
      "Learn something new for 15 minutes",
      "Call a friend or family member",
      "Meditate for 10 minutes",
      "Review your budget",
      "Declutter one area of your home"
    ];
    
    suggestions = [...suggestions, ...generalSuggestions].slice(0, 8);
    
    let response = "Here are some task suggestions based on your habits:\n";
    suggestions.forEach((suggestion, index) => {
      response += `${index + 1}. ${suggestion}\n`;
    });
    
    return response;
  }

  handleAddTask(message) {
    // Extract task text from message
    const taskText = message.replace(/add|create|new task|task/gi, '').trim();
    
    if (!taskText) {
      return "Please specify what task you'd like to add.";
    }
    
    // Try to detect category
    let category = 'general';
    const lowerText = taskText.toLowerCase();
    if (lowerText.includes('work') || lowerText.includes('meeting') || lowerText.includes('project')) {
      category = 'work';
    } else if (lowerText.includes('exercise') || lowerText.includes('walk') || lowerText.includes('health')) {
      category = 'health';
    } else if (lowerText.includes('learn') || lowerText.includes('read') || lowerText.includes('study')) {
      category = 'learning';
    } else if (lowerText.includes('buy') || lowerText.includes('shop') || lowerText.includes('grocery')) {
      category = 'shopping';
    }
    
    // Create the task
    const task = {
      id: `task_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
      text: taskText,
      completed: false,
      priority: 'medium',
      category: category,
      date: this.formatDate(new Date()),
      createdAt: new Date().toISOString(),
      description: '',
      notes: ''
    };
    
    const tasks = this.getTasks();
    tasks.push(task);
    this.saveTasks(tasks);
    this.updateTasksView();
    this.renderCalendar();
    this.updateStats();
    
    return `Added task: "${taskText}" for today in the ${category} category`;
  }

  handleShowStats(message) {
    const tasks = this.getTasks();
    const completed = tasks.filter(t => t.completed).length;
    const pending = tasks.filter(t => !t.completed).length;
    const total = tasks.length;
    
    const completionRate = total > 0 ? Math.round((completed / total) * 100) : 0;
    
    // Calculate tasks by priority
    const highPriority = tasks.filter(t => t.priority === 'high').length;
    const mediumPriority = tasks.filter(t => t.priority === 'medium').length;
    const lowPriority = tasks.filter(t => t.priority === 'low').length;
    
    // Calculate tasks by category
    const categories = {};
    tasks.forEach(task => {
      categories[task.category] = (categories[task.category] || 0) + 1;
    });
    
    let response = `Your task statistics:\n`;
    response += `- Total tasks: ${total}\n`;
    response += `- Completed: ${completed}\n`;
    response += `- Pending: ${pending}\n`;
    response += `- Completion rate: ${completionRate}%\n\n`;
    response += `By priority:\n`;
    response += `- High: ${highPriority}\n`;
    response += `- Medium: ${mediumPriority}\n`;
    response += `- Low: ${lowPriority}\n\n`;
    response += `By category:\n`;
    Object.entries(categories).forEach(([category, count]) => {
      response += `- ${category}: ${count}\n`;
    });
    
    if (pending > 0) {
      const highPriorityPending = tasks.filter(t => !t.completed && t.priority === 'high').length;
      if (highPriorityPending > 0) {
        response += `\nYou have ${highPriorityPending} high priority tasks pending. Consider focusing on those first!`;
      }
    }
    
    return response;
  }

  handleProductivityTips(message) {
    const tips = [
      "Break large tasks into smaller, manageable steps",
      "Use the Pomodoro Technique: 25 minutes focused work, 5 minutes break",
      "Prioritize tasks using the Eisenhower Matrix (urgent/important)",
      "Schedule your most important tasks for when you have the most energy",
      "Minimize distractions by turning off notifications during focused work",
      "Set specific, measurable goals for each task",
      "Review your tasks at the end of each day and plan for tomorrow",
      "Take regular breaks to maintain focus and prevent burnout",
      "Use time blocking to allocate specific time slots for different activities",
      "Learn to say no to tasks that don't align with your priorities"
    ];
    
    let response = "Here are some productivity tips that might help you:\n\n";
    tips.forEach((tip, index) => {
      response += `${index + 1}. ${tip}\n`;
    });
    
    return response;
  }

  handleScheduleHelp(message) {
    const tasks = this.getTasks();
    const pendingTasks = tasks.filter(t => !t.completed);
    
    if (pendingTasks.length === 0) {
      return "You don't have any pending tasks! Great job staying on top of things.";
    }
    
    // Sort by priority and due date
    const priorityOrder = { high: 0, medium: 1, low: 2 };
    pendingTasks.sort((a, b) => {
      if (priorityOrder[a.priority] !== priorityOrder[b.priority]) {
        return priorityOrder[a.priority] - priorityOrder[b.priority];
      }
      return new Date(a.date) - new Date(b.date);
    });
    
    let response = "Here's how I suggest organizing your schedule:\n\n";
    response += "High priority tasks to focus on first:\n";
    
    const highPriority = pendingTasks.filter(t => t.priority === 'high');
    if (highPriority.length > 0) {
      highPriority.forEach(task => {
        response += `- ${task.text} (due: ${task.date})\n`;
      });
    } else {
      response += "- None! Great job keeping high priority tasks under control.\n";
    }
    
    response += "\nMedium priority tasks:\n";
    const mediumPriority = pendingTasks.filter(t => t.priority === 'medium');
    if (mediumPriority.length > 0) {
      mediumPriority.slice(0, 3).forEach(task => {
        response += `- ${task.text} (due: ${task.date})\n`;
      });
      if (mediumPriority.length > 3) {
        response += `- ... and ${mediumPriority.length - 3} more medium priority tasks\n`;
      }
    } else {
      response += "- None at the moment.\n";
    }
    
    response += "\nConsider scheduling specific time blocks for your high priority tasks and batch similar medium priority tasks together.";
    
    return response;
  }

  // Settings Methods
  toggleSettings() {
    this.elements.settingsPanel.classList.toggle('open');
  }

  // Theme Methods
  setTheme(theme) {
    this.elements.body.className = theme;
    localStorage.setItem('chronoFocusProTheme', theme);
  }

  loadTheme() {
    const savedTheme = localStorage.getItem('chronoFocusProTheme') || 'theme-glass';
    this.setTheme(savedTheme);
    
    // Update theme option active state
    this.elements.themeOptions.forEach(option => {
      option.classList.toggle('active', option.dataset.theme === savedTheme);
    });
  }

  // Sound Methods
  playSound(type) {
    // Check if sound effects are enabled
    const soundEnabled = localStorage.getItem('chronoFocusProSound') !== 'false';
    if (!soundEnabled) return;
    
    // In a real app, you would play actual sound files
    // For this demo, we'll just log the sound type
    console.log(`Playing sound: ${type}`);
    
    // Haptic feedback simulation
    if (navigator.vibrate) {
      navigator.vibrate(50);
    }
  }

  // UI Helper Methods
  updateTaskCount(count) { this.elements.taskCount.textContent = `${count} task${count !== 1 ? 's' : ''}`; }
  autoResizeTextarea() {
    this.elements.taskInput.addEventListener('input', () => {
      this.elements.taskInput.style.height = 'auto';
      this.elements.taskInput.style.height = `${Math.min(this.elements.taskInput.scrollHeight, 120)}px`;
    });
  }

  // Toast Methods
  showToast(message, type = 'success') {
    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    toast.textContent = message;
    this.elements.toastContainer.appendChild(toast);
    setTimeout(() => toast.classList.add('show'), 10);
    setTimeout(() => {
      toast.classList.remove('show');
      toast.addEventListener('transitionend', () => toast.remove(), { once: true });
    }, 3000);
  }
  
  // Data Methods
  getTasks() { return JSON.parse(localStorage.getItem('chronoFocusProTasks') || '[]'); }
  saveTasks(tasks) { localStorage.setItem('chronoFocusProTasks', JSON.stringify(tasks)); }
  
  getHistory() { return JSON.parse(localStorage.getItem('chronoFocusProHistory') || '[]'); }
  saveHistory(history) { localStorage.setItem('chronoFocusProHistory', JSON.stringify(history)); }
  
  getTasksForDate(date) {
    const dateStr = this.formatDate(date);
    return this.getTasks().filter(task => task.date === dateStr);
  }

  // Utility Methods
  formatDate(date) { return date.toISOString().split('T')[0]; }
  isSameDate(d1, d2) { return this.formatDate(d1) === this.formatDate(d2); }
}

document.addEventListener('DOMContentLoaded', () => {
  window.chronoFocusPro = new ChronoFocusPro();
});
</script>
</body>
</html>
