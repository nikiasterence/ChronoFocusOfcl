<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" href="Chronofocus.png" type="image/x-icon">
<title>Chrono Focus - Zenith Edition</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
/* --- Default Cozy Mocha Palette --- */
--background: #F9F5F0;
--surface: #FFFFFF;
--primary: #8D6E63;
--primary-rgb: 141, 110, 99;
--primary-light: #EFEBE9;
--secondary: #BCAAA4;
--text-primary: #5D4037;
--text-secondary: #9E8D86;
--border-color: #E7E0D9;
--success: #4CAF50;
--danger: #F44336;
--warning: #FF9800;
/* --- LAYOUT ENHANCEMENT: Increased roundness for a softer, modern feel --- */
--border-radius: 28px;
--transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
/* --- LAYOUT ENHANCEMENT: Softer, more sophisticated shadows --- */
--shadow-sm: 0 4px 20px rgba(var(--primary-rgb), 0.07);
--shadow-md: 0 8px 35px rgba(var(--primary-rgb), 0.10);
--shadow-lg: 0 12px 45px rgba(var(--primary-rgb), 0.15);

/* Task Colors */
--task-color-red: #F44336;
--task-color-blue: #2196F3;
--task-color-green: #4CAF50;
--task-color-yellow: #FFC107;
--task-color-purple: #9C27B0;
--task-color-orange: #FF5722;
}

/* --- THEME PALETTES --- */
/* Cozy */
body.theme-sage { --background: #F1F5F1; --primary: #799975; --primary-rgb: 121, 153, 117; --primary-light: #E6EEE5; --text-primary: #445742; --text-secondary: #7E8C7D; --border-color: #E3E9E2; }
body.theme-rose { --background: #FDF4F6; --primary: #D4A6B2; --primary-rgb: 212, 166, 178; --primary-light: #F9EBEF; --text-primary: #85616B; --text-secondary: #A99299; --border-color: #F3E6E9; }
body.theme-mist { --background: #F0F4F8; --primary: #94AEC3; --primary-rgb: 148, 174, 195; --primary-light: #E9EFF4; --text-primary: #566879; --text-secondary: #93A0AC; --border-color: #E2E8ED; }
body.theme-sand { --background: #FBF5EA; --primary: #D6BA9A; --primary-rgb: 214, 186, 154; --primary-light: #F8F2E7; --text-primary: #705D47; --text-secondary: #A89782; --border-color: #EEE6D9; }
body.theme-lavender { --background: #F8F6FC; --primary: #9E8FB2; --primary-rgb: 158, 143, 178; --primary-light: #EFECF5; --text-primary: #5A4E6B; --text-secondary: #8C819D; --border-color: #E8E4F0; }
body.theme-ocean { --background: #F0F7FC; --primary: #7AB3D0; --primary-rgb: 122, 179, 208; --primary-light: #E5F1F8; --text-primary: #3E6378; --text-secondary: #7A9BAD; --border-color: #DDEBF3; }
body.theme-citrus { --background: #FEFBF0; --primary: #E3C567; --primary-rgb: 227, 197, 103; --primary-light: #FBF5E1; --text-primary: #756235; --text-secondary: #B09D6C; --border-color: #F5EED9; }
body.theme-berry { --background: #FDF2F8; --primary: #D6729B; --primary-rgb: 214, 114, 155; --primary-light: #FAE6EF; --text-primary: #7E4059; --text-secondary: #B27D95; --border-color: #F4DAE6; }
body.theme-honey { --background: #FFF8E1; --primary: #FFB74D; --primary-rgb: 255, 183, 77; --primary-light: #FFF3E0; --text-primary: #8D6E63; --text-secondary: #A1887F; --border-color: #FBE9E7; }
body.theme-spearmint { --background: #E0F2F1; --primary: #4DB6AC; --primary-rgb: 77, 182, 172; --primary-light: #E0F2F1; --text-primary: #00695C; --text-secondary: #00897B; --border-color: #B2DFDB; }
body.theme-peach { --background: #FFF3E0; --primary: #FF8A65; --primary-rgb: 255, 138, 101; --primary-light: #FBE9E7; --text-primary: #795548; --text-secondary: #A1887F; --border-color: #FFCCBC; }
body.theme-sky { --background: #E3F2FD; --primary: #64B5F6; --primary-rgb: 100, 181, 246; --primary-light: #E3F2FD; --text-primary: #1976D2; --text-secondary: #42A5F5; --border-color: #BBDEFB; }
body.theme-autumn { --background: #FBEAE0; --primary: #D57A66; --primary-rgb: 213, 122, 102; --primary-light: #F9EBE8; --text-primary: #784439; --text-secondary: #A37C72; --border-color: #F1DCD6; }

/* Vibrant */
body.theme-vibrant-cherry { --background: #FFF0F5; --primary: #EC407A; --primary-rgb: 236, 64, 122; --primary-light: #FCE4EC; --text-primary: #880E4F; --text-secondary: #C2185B; --border-color: #F8BBD0; }
body.theme-vibrant-lime { --background: #F9FBE7; --primary: #9CCC65; --primary-rgb: 156, 204, 101; --primary-light: #F0F4C3; --text-primary: #33691E; --text-secondary: #558B2F; --border-color: #E6EE9C; }
body.theme-vibrant-tangerine { --background: #FFF8E1; --primary: #FFA726; --primary-rgb: 255, 167, 38; --primary-light: #FFECB3; --text-primary: #E65100; --text-secondary: #F57C00; --border-color: #FFE082; }
body.theme-vibrant-grape { --background: #F3E5F5; --primary: #AB47BC; --primary-rgb: 171, 71, 188; --primary-light: #E1BEE7; --text-primary: #4A148C; --text-secondary: #6A1B9A; --border-color: #CE93D8; }
body.theme-vibrant-aqua { --background: #E0F7FA; --primary: #26C6DA; --primary-rgb: 38, 198, 218; --primary-light: #B2EBF2; --text-primary: #006064; --text-secondary: #00838F; --border-color: #80DEEA; }

/* Dark & Elements */
body.theme-elements-earth { --background: #261D1D; --surface: #3E3232; --primary: #A1683A; --primary-rgb: 161, 104, 58; --primary-light: rgba(161, 104, 58, 0.2); --text-primary: #EFEBE9; --text-secondary: #BEA595; --border-color: rgba(161, 104, 58, 0.3); }
body.theme-elements-water { --background: #152238; --surface: #22334c; --primary: #5292C1; --primary-rgb: 82, 146, 193; --primary-light: rgba(82, 146, 193, 0.2); --text-primary: #E0F5FF; --text-secondary: #A0B8D0; --border-color: rgba(82, 146, 193, 0.3); }
body.theme-elements-air { --background: #f5f5f5; --surface: #ffffff; --primary: #A7C0D1; --primary-rgb: 167, 192, 209; --primary-light: #e3e9ed; --text-primary: #526B7A; --text-secondary: #88A2B3; --border-color: #D6E0E7; }
body.theme-elements-fire { --background: #2C1818; --surface: #422525; --primary: #E55B3C; --primary-rgb: 229, 91, 60; --primary-light: rgba(229, 91, 60, 0.2); --text-primary: #FFDCC8; --text-secondary: #EFA291; --border-color: rgba(229, 91, 60, 0.3); }
body.theme-mono-graphite { --background: #1C1C1C; --surface: #2A2A2A; --primary: #E0E0E0; --primary-rgb: 224, 224, 224; --primary-light: #3A3A3A; --text-primary: #F5F5F5; --text-secondary: #BDBDBD; --border-color: #4A4A4A; }
body.theme-mono-slate { --background: #455A64; --surface: #546E7A; --primary: #ECEFF1; --primary-rgb: 236, 239, 241; --primary-light: rgba(236, 239, 241, 0.15); --text-primary: #CFD8DC; --text-secondary: #B0BEC5; --border-color: #78909C; }
body.theme-mono-ink { --background: #1a1a2e; --surface: #25283d; --primary: #e0fbfc; --primary-rgb: 224, 251, 252; --primary-light: rgba(224, 251, 252, 0.15); --text-primary: #c9d6f3; --text-secondary: #8d98bd; --border-color: #4a4e69; }
body.theme-mono-ivory { --background: #FFFFF0; --surface: #FFFFFF; --primary: #5D4037; --primary-rgb: 93, 64, 55; --primary-light: #D7CCC8; --text-primary: #4E342E; --text-secondary: #6D4C41; --border-color: #EFEBE9; }
body.theme-onyx { --background: #000000; --surface: #121212; --primary: #00CFE8; --primary-rgb: 0, 207, 232; --primary-light: rgba(0, 207, 232, 0.1); --text-primary: #EAEAEA; --text-secondary: #A0A0A0; --border-color: #2F2F2F; }

/* Retro */
body.theme-retro-diner { --background: #FDF1E6; --surface: #fff; --primary: #EF6060; --primary-rgb: 239, 96, 96; --primary-light: rgba(239, 96, 96, 0.15); --text-primary: #325A6A; --text-secondary: #8AA4AE; --border-color: #e5e5e5; }
body.theme-retro-arcade { --background: #111111; --surface: rgba(17,17,17,0.8); --primary: #ff00ff; --primary-rgb: 255,0,255; --primary-light: rgba(255, 0, 255, 0.1); --text-primary: #00ffff; --text-secondary: #f0f0f0; --border-color: rgba(0, 255, 255, 0.4); }
body.theme-retro-vinyl { --background: #e6e2df; --surface: #f9f9f9; --primary: #C70039; --primary-rgb: 199, 0, 57; --primary-light: rgba(199, 0, 57, 0.1); --text-primary: #2C3E50; --text-secondary: #7F8C8D; --border-color: #d1ccc9; }

/* Animated Aurora */
@keyframes auroraGradient { 0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%} }
body.theme-aurora-boreal { --background: #0d1a26; --surface: rgba(22, 34, 48, 0.85); --primary: #50E3C2; --primary-rgb: 80, 227, 194; --primary-light: rgba(80, 227, 194, 0.15); --text-primary: #E0F5FF; --text-secondary: #A0B8D0; --border-color: rgba(80, 227, 194, 0.2); background: linear-gradient(-45deg, #0d1a26, #1a3a52, #3c164f, #1a233b); background-size: 400% 400%; animation: auroraGradient 20s ease infinite; }
body.theme-aurora-sunrise { --background: #fff8f0; --surface: rgba(255, 255, 255, 0.9); --primary: #FF7B54; --primary-rgb: 255, 123, 84; --primary-light: #FFF0EB; --text-primary: #6B3E2E; --text-secondary: #A87E70; --border-color: #FCE8E0; background: linear-gradient(-45deg, #FFDAB9, #FFA07A, #FFFFE0, #FFC0CB); background-size: 400% 400%; animation: auroraGradient 25s ease infinite; }
body.theme-aurora-twilight { --background: #1e1e2f; --surface: rgba(38, 38, 59, 0.9); --primary: #C792EA; --primary-rgb: 199, 146, 234; --primary-light: rgba(199, 146, 234, 0.15); --text-primary: #E6E0FF; --text-secondary: #9E93B3; --border-color: rgba(199, 146, 234, 0.2); background: linear-gradient(-45deg, #1e1e2f, #3a2e5d, #6a538d, #2f274a); background-size: 400% 400%; animation: auroraGradient 20s ease infinite; }
body.theme-aurora-cosmos { --background: #000428; --surface: rgba(10, 15, 52, 0.85); --primary: #00AEEF; --primary-rgb: 0, 174, 239; --primary-light: rgba(0, 174, 239, 0.15); --text-primary: #FFFFFF; --text-secondary: #A3B0E1; --border-color: rgba(0, 174, 239, 0.25); background: linear-gradient(-45deg, #000428, #004e92, #072a4f, #000a3a); background-size: 400% 400%; animation: auroraGradient 22s ease infinite; }
body.theme-aurora-nebula { --background: #2a0a4a; --surface: rgba(40, 15, 70, 0.9); --primary: #F050C5; --primary-rgb: 240, 80, 197; --primary-light: rgba(240, 80, 197, 0.15); --text-primary: #F5E8FF; --text-secondary: #B59AC9; --border-color: rgba(240, 80, 197, 0.2); background: linear-gradient(-45deg, #2a0a4a, #da2a9a, #751a75, #411059); background-size: 400% 400%; animation: auroraGradient 18s ease infinite; }
body.theme-aurora-forest { --background: #0d2618; --surface: rgba(23, 45, 32, 0.85); --primary: #4CAF50; --primary-rgb: 76, 175, 80; --primary-light: rgba(76, 175, 80, 0.15); --text-primary: #E8F5E9; --text-secondary: #A5D6A7; --border-color: rgba(76, 175, 80, 0.2); background: linear-gradient(-45deg, #0d2618, #1b5e20, #2e7d32, #1b5e20); background-size: 400% 400%; animation: auroraGradient 20s ease infinite; }
body.theme-aurora-sunset { --background: #2c0d2c; --surface: rgba(54, 20, 54, 0.85); --primary: #FF8A65; --primary-rgb: 255, 138, 101; --primary-light: rgba(255, 138, 101, 0.15); --text-primary: #FFEBEE; --text-secondary: #E1BEE7; --border-color: rgba(255, 138, 101, 0.2); background: linear-gradient(-45deg, #2c0d2c, #6a1b9a, #ad1457, #8e24aa); background-size: 400% 400%; animation: auroraGradient 20s ease infinite; }
body.theme-aurora-midnight { --background: #0a0a1a; --surface: rgba(20, 20, 40, 0.85); --primary: #7986CB; --primary-rgb: 121, 134, 203; --primary-light: rgba(121, 134, 203, 0.15); --text-primary: #E8EAF6; --text-secondary: #C5CAE9; --border-color: rgba(121, 134, 203, 0.2); background: linear-gradient(-45deg, #0a0a1a, #283593, #3949AB, #1A237E); background-size: 400% 400%; animation: auroraGradient 20s ease infinite; }
body.theme-aurora-cottoncandy { --background: #fce4ec; --surface: rgba(255, 255, 255, 0.9); --primary: #F8BBD0; --primary-rgb: 248, 187, 208; --primary-light: rgba(248, 187, 208, 0.15); --text-primary: #880E4F; --text-secondary: #AD1457; --border-color: rgba(248, 187, 208, 0.3); background: linear-gradient(-45deg, #fce4ec, #f8bbd0, #f48fb1, #ff80ab); background-size: 400% 400%; animation: auroraGradient 20s ease infinite; }
body.theme-aurora-golden { --background: #fffde7; --surface: rgba(255, 253, 231, 0.9); --primary: #FFD54F; --primary-rgb: 255, 213, 79; --primary-light: rgba(255, 213, 79, 0.15); --text-primary: #5D4037; --text-secondary: #8D6E63; --border-color: rgba(255, 213, 79, 0.3); background: linear-gradient(-45deg, #fffde7, #fff9c4, #fff59d, #ffeb3b); background-size: 400% 400%; animation: auroraGradient 20s ease infinite; }
body.theme-aurora-dream { --background: #F3E5F5; --surface: rgba(243, 229, 245, 0.9); --primary: #BA68C8; --primary-rgb: 186, 104, 200; --primary-light: rgba(186, 104, 200, 0.15); --text-primary: #6A1B9A; --text-secondary: #8E44AD; --border-color: #E1BEE7; background: linear-gradient(-45deg, #F3E5F5, #E1BEE7, #CE93D8, #BA68C8); background-size: 400% 400%; animation: auroraGradient 20s ease infinite; }
body.theme-aurora-lagoon { --background: #E0F7FA; --surface: rgba(224, 247, 250, 0.9); --primary: #4DD0E1; --primary-rgb: 77, 208, 225; --primary-light: rgba(77, 208, 225, 0.15); --text-primary: #006064; --text-secondary: #00838F; --border-color: #B2EBF2; background: linear-gradient(-45deg, #E0F7FA, #B2EBF2, #80DEEA, #4DD0E1); background-size: 400% 400%; animation: auroraGradient 20s ease infinite; }

/* Special & Liquid Glass Themes */
body.theme-serenity { --background: #D4E2F4; --surface: #FFFFFF; --primary: #A2BFE0; --primary-rgb: 162, 191, 224; --primary-light: #E9F1FA; --text-primary: #485A70; --text-secondary: #7F93AC; --border-color: #C9D8EA; }
body.theme-serenity .section, body.theme-serenity .dock-button { box-shadow: 0 10px 30px rgba(0,0,0,0.07); }
/* Sapphire */
body.theme-liquid-glass { --background: #1a1a2e; --surface: rgba(37, 40, 61, 0.6); --primary: #82aaff; --primary-rgb: 130, 170, 255; --primary-light: rgba(130, 170, 255, 0.15); --secondary: #c792ea; --text-primary: #e0fbfc; --text-secondary: #8d98bd; --border-color: rgba(130, 170, 255, 0.3); background: linear-gradient(135deg, #1a1a2e, #162238); }
/* Emerald */
body.theme-liquid-glass-emerald { --background: #0f2027; --surface: rgba(34, 53, 61, 0.6); --primary: #2ed573; --primary-rgb: 46, 213, 115; --primary-light: rgba(46, 213, 115, 0.15); --secondary: #1e90ff; --text-primary: #f1f2f6; --text-secondary: #a4b0be; --border-color: rgba(46, 213, 115, 0.3); background: linear-gradient(135deg, #0f2027, #203a43, #2c5364); }
/* Amethyst */
body.theme-liquid-glass-amethyst { --background: #23074d; --surface: rgba(56, 36, 92, 0.6); --primary: #c84e89; --primary-rgb: 200, 78, 137; --primary-light: rgba(200, 78, 137, 0.15); --secondary: #f15f79; --text-primary: #fdeff9; --text-secondary: #d3bccc; --border-color: rgba(200, 78, 137, 0.3); background: linear-gradient(135deg, #23074d, #4c2c72); }
/* Ruby */
body.theme-liquid-glass-ruby { --background: #3c1053; --surface: rgba(69, 36, 92, 0.6); --primary: #ff0099; --primary-rgb: 255, 0, 153; --primary-light: rgba(255, 0, 153, 0.15); --secondary: #e65c00; --text-primary: #fff0f5; --text-secondary: #e8d9e2; --border-color: rgba(255, 0, 153, 0.3); background: linear-gradient(135deg, #3c1053, #ad5389); }
/* Topaz */
body.theme-liquid-glass-topaz { --background: #141e30; --surface: rgba(36, 49, 74, 0.6); --primary: #f2994a; --primary-rgb: 242, 153, 74; --primary-light: rgba(242, 153, 74, 0.15); --secondary: #f2c94c; --text-primary: #fcf9f4; --text-secondary: #d3c7b6; --border-color: rgba(242, 153, 74, 0.3); background: linear-gradient(135deg, #141e30, #243b55); }

/* This is the key style for the glass effect. It applies to any theme class that STARTS with "theme-liquid-glass" */
[class*="theme-liquid-glass"] .section,
[class*="theme-liquid-glass"] .dock-button,
[class*="theme-liquid-glass"] .theme-modal-content {
    backdrop-filter: blur(18px); -webkit-backdrop-filter: blur(18px);
    border: 1px solid rgba(255, 255, 255, 0.12);
}

/* --- GLOBAL & WORLD-CLASS LAYOUT --- */
* { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
body { background-color: var(--background); color: var(--text-primary); min-height: 100vh; padding: 40px; overflow-x: hidden; transition: background-color 0.5s ease; }

/* LAYOUT ENHANCEMENT: A wider, centered main container with a sophisticated grid layout on larger screens */
.app {
    max-width: 1200px;
    margin: 0 auto;
    display: grid;
    grid-template-columns: 1fr;
    gap: 35px; /* Increased gap for better spacing */
}

.app > * { opacity: 0; transform: translateY(30px); animation: sweetFadeIn 0.8s cubic-bezier(0.165, 0.84, 0.44, 1) forwards; }
/* Staggered animation */
.app-header { animation-delay: 0.1s; }
.main-dock { animation-delay: 0.2s; }
.task-section { animation-delay: 0.3s; }
.content-grid { animation-delay: 0.4s; }
.app-footer { animation-delay: 0.6s; }

.app-header { text-align: center; margin-bottom: 20px; }
.app-header h1 { font-size: 3.5rem; font-weight: 700; color: var(--text-primary); letter-spacing: -2px; }
.app-header p { color: var(--text-secondary); font-size: 1.25rem; margin-top: 5px; }

/* LAYOUT ENHANCEMENT: A grid for secondary sections to sit side-by-side on desktop */
.content-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 35px;
}

/* On screens wider than 900px, create a two-column layout */
@media (min-width: 900px) {
    .content-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}


/* Dock Navigation */
.main-dock {
    display: grid;
    /* LAYOUT ENHANCEMENT: Dock now gracefully adapts to 4 items */
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 25px;
}
.dock-button { padding: 30px; background: var(--surface); backdrop-filter: blur(10px); border-radius: var(--border-radius); text-align: center; border: 1px solid var(--border-color); transition: var(--transition); box-shadow: var(--shadow-sm); cursor: pointer; color: var(--text-primary); text-decoration: none; position: relative; overflow: hidden; }
.dock-button:hover { transform: translateY(-12px); box-shadow: var(--shadow-lg); border-color: rgba(var(--primary-rgb), 0.4); }
.dock-button i { font-size: 2.5rem; margin-bottom: 18px; color: var(--primary); background-color: var(--primary-light); width: 70px; height: 70px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; transition: var(--transition); }
.dock-button:hover i { transform: scale(1.15) rotate(-10deg); box-shadow: 0 0 25px rgba(var(--primary-rgb), 0.5); }
.dock-button h2 { font-size: 1.2rem; font-weight: 600; margin: 0; }
.dock-button p { font-size: 0.9rem; color: var(--text-secondary); }

/* Glow Effect */
.study-tools { animation: pulseGlow 2.5s infinite ease-out; }
@keyframes pulseGlow { 0%, 100% { box-shadow: var(--shadow-md); } 50% { box-shadow: 0 0 30px 10px rgba(var(--primary-rgb), 0.35); } }

/* Section Styling */
.section { background: var(--surface); backdrop-filter: blur(12px); padding: 40px; border-radius: var(--border-radius); border: 1px solid var(--border-color); box-shadow: var(--shadow-md); transition: var(--transition); }
.section-header { display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; gap: 15px; margin-bottom: 30px; }
.section-header h2 { color: var(--text-primary); font-size: 1.8rem; display: flex; align-items: center; gap: 15px; font-weight: 600; margin:0; }

/* Buttons & Inputs */
button { padding: 14px 25px; background: var(--primary); color: #fff; border: none; border-radius: 18px; cursor: pointer; font-weight: 500; font-size: 1rem; transition: var(--transition); display: inline-flex; align-items: center; justify-content: center; gap: 8px; box-shadow: var(--shadow-sm); }
button:hover:not(:disabled) { background: var(--text-primary); box-shadow: var(--shadow-lg); transform: translateY(-4px); }
button:active:not(:disabled) { transform: translateY(-1px) scale(0.98); }
button:disabled { opacity: 0.6; cursor: not-allowed; }
input, select { padding: 14px 22px; background: var(--background); border: 1px solid var(--border-color); border-radius: 18px; font-size: 1rem; color: var(--text-primary); transition: var(--transition); width: 100%; -webkit-appearance: none; appearance: none; }
input::placeholder { color: var(--text-secondary); }
input:focus, select:focus { border-color: rgba(var(--primary-rgb), 0.5); outline: none; background: var(--surface); box-shadow: 0 0 0 5px rgba(var(--primary-rgb), 0.1); }
select { background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%2020%2020%22%20fill%3D%22%239E8D86%22%3E%3Cpath%20d%3D%22M10%2012l-6-6h12l-6%206z%22%2F%3E%3C%2Fsvg%3E'); background-repeat: no-repeat; background-position: right 18px center; background-size: 12px; padding-right: 40px;}

/* Task Manager Enhanced */
.task-input-form { display: grid; gap: 18px; margin-bottom: 30px; grid-template-columns: 1fr; }
.task-main-input { display: grid; grid-template-columns: 1fr auto; gap: 18px; }
.task-options { display: grid; grid-template-columns: repeat(3, 1fr); gap: 18px; }
.task-filters { display: flex; gap: 12px; flex-wrap: wrap; } /* Added flex-wrap */
.task-filters button { background: none; color: var(--text-secondary); box-shadow: none; padding: 10px 18px; font-weight: 500; border: 1px solid var(--border-color); }
.task-filters button:hover { background-color: var(--primary-light); color: var(--primary); }
.task-filters button.active { background: var(--primary); color: #fff; border-color: var(--primary); }
#taskList { list-style-type: none; }
#taskList li { display: flex; align-items: center; padding: 18px; border-radius: 20px; margin-bottom: 15px; border: 1px solid var(--border-color); border-left: 6px solid transparent; transition: all 0.4s ease; gap: 18px; background: rgba(var(--primary-rgb), 0.02); overflow: hidden; opacity: 0; }
#taskList li { animation: slideFadeIn 0.5s cubic-bezier(0.165, 0.84, 0.44, 1) forwards; }
#taskList li:nth-child(1) { animation-delay: 0.05s; }
#taskList li:nth-child(2) { animation-delay: 0.1s; }
#taskList li:nth-child(3) { animation-delay: 0.15s; }
#taskList li:nth-child(4) { animation-delay: 0.2s; }
#taskList li:nth-child(5) { animation-delay: 0.25s; }
#taskList li:hover { background: var(--surface); border-color: rgba(var(--primary-rgb), 0.3); transform: scale(1.02); box-shadow: var(--shadow-sm); }
li.completed { opacity: 0.6; background: transparent; }
.completed .task-text { text-decoration: line-through; color: var(--text-secondary); }
li.priority-important { background: var(--primary-light); font-weight: 500; border-left-color: var(--warning)!important;}
.important-star { color: var(--warning); margin-right: 8px; }
li.deleting { animation: fadeOutShrink 0.5s ease forwards; }
.task-content { display: flex; align-items: center; gap: 15px; flex-grow: 1; word-break: break-word; } /* Added word-break */
.task-icon { width: 44px; height: 44px; border-radius: 16px; display: inline-flex; align-items: center; justify-content: center; flex-shrink: 0; font-size: 1.3rem; background-color: var(--primary-light); color: var(--primary); }
.task-actions { display: flex; gap: 10px; margin-left: auto; }
.task-actions button { background: none; box-shadow: none; color: var(--secondary); width: 40px; height: 40px; padding: 0; font-size: 1.1rem; border-radius: 14px; }
.task-actions .complete-btn:hover { background: rgba(var(--success), 0.1); color: var(--success); }
.task-actions .edit-btn:hover { background: var(--primary-light); color: var(--primary); }
.task-actions .delete-btn:hover { background: rgba(var(--danger), 0.1); color: var(--danger); }

/* Calendar */
.calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 12px; }
.calendar-day-name { font-weight: 600; color: var(--text-secondary); padding: 12px 0; text-align: center; font-size: 0.9em; }
.calendar-day { height: 50px; border-radius: 18px; cursor: pointer; transition: var(--transition); border: 2px solid transparent; position: relative; display: flex; justify-content: center; align-items: center; font-weight: 500; }
.calendar-day.other-month { opacity: 0.4; pointer-events: none; }
.calendar-day:not(.other-month):hover { background-color: var(--primary-light); transform: scale(1.05); }
.calendar-day.today { font-weight: 700; color: var(--primary); border-color: var(--primary); }
.calendar-day.selected { background-color: var(--primary); color: #fff; box-shadow: var(--shadow-lg); transform: scale(1.1); }
.calendar-day.has-task::after { content: ''; position: absolute; bottom: 8px; left: 50%; transform: translateX(-50%); width: 7px; height: 7px; border-radius: 50%; background-color: var(--primary); }
.calendar-day.selected.has-task::after { background-color: #fff; }
.calendar-nav { display: flex; gap: 5px; align-items: center;}
#monthYear { margin: 0 10px; } /* Added margin for spacing */
.calendar-nav button { padding: 0; width: 38px; height: 38px; border-radius: 50%; }

/* --- Pomodoro Timer: ENHANCED --- */
.pomodoro-section { text-align: center; }
.pomodoro-modes { display: flex; justify-content: center; gap: 12px; margin-bottom: 20px; flex-wrap: wrap; }
.pomodoro-modes button { background: none; color: var(--text-secondary); box-shadow: none; padding: 10px 20px; font-weight: 500; border: 1px solid var(--border-color); }
.pomodoro-modes button:hover { background-color: var(--primary-light); color: var(--primary); }
.pomodoro-modes button.active { background: var(--primary); color: #fff; border-color: var(--primary); }
.pomodoro-timer-circle { position: relative; width: 240px; height: 240px; margin: 35px auto; }
.pomodoro-progress-ring { transform: rotate(-90deg); }
.pomodoro-progress-ring__track { stroke: var(--border-color); }
.pomodoro-progress-ring__progress { stroke: var(--primary); stroke-linecap: round; transition: stroke-dashoffset 0.5s cubic-bezier(0.65, 0, 0.35, 1); }
.pomodoro-timer-display { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 4rem; font-weight: 600; color: var(--text-primary); margin: 0; letter-spacing: -1.5px; transition: var(--transition); }
.pomodoro-timer-circle.running .pomodoro-progress-ring__progress { animation: slowPulse 2s infinite ease-in-out; }
@keyframes slowPulse { 50% { stroke: var(--text-primary); } }
.pomodoro-controls { display: flex; justify-content: center; align-items: center; gap: 22px; }
.pomodoro-controls button { font-size: 1.3rem; width: 70px; height: 70px; border-radius: 50%; padding: 0; box-shadow: var(--shadow-md); }
.pomodoro-controls #pomodoro-start-pause i { font-size: 2rem; }
/* --- End of Pomodoro Timer CSS --- */


/* Theme Customizer */
.theme-fab { position: fixed; bottom: 30px; right: 30px; width: 64px; height: 64px; background: var(--primary); color: white; border-radius: 50%; border: none; font-size: 1.6rem; cursor: pointer; z-index: 1000; box-shadow: var(--shadow-lg); transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
.theme-fab:hover { transform: scale(1.1) rotate(25deg); box-shadow: 0 12px 35px rgba(var(--primary-rgb), 0.5); }
.theme-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); backdrop-filter: blur(10px); z-index: 1001; display: flex; align-items: center; justify-content: center; opacity: 0; visibility: hidden; transition: opacity 0.4s ease, visibility 0.4s ease; }
.theme-modal.visible { opacity: 1; visibility: visible; }
.theme-modal-content { background: var(--surface); padding: 35px; border-radius: var(--border-radius); width: 90%; max-width: 800px; transform: scale(0.9) translateY(20px); transition: transform 0.4s cubic-bezier(0.165, 0.84, 0.44, 1); position: relative; max-height: 85vh; overflow-y: auto; }
.theme-modal.visible .theme-modal-content { transform: scale(1) translateY(0); }
.theme-modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
.theme-modal-header h2 { font-weight: 600; color: var(--text-primary); font-size: 1.5rem;}
.close-modal-btn { background: none; border: none; font-size: 1.8rem; color: var(--text-secondary); cursor: pointer; padding: 5px; box-shadow: none; line-height: 1; }
.theme-group h3 { font-size: 1.2rem; font-weight: 500; color: var(--text-secondary); margin: 30px 0 18px; text-align: left; border-bottom: 1px solid var(--border-color); padding-bottom: 12px; }
.theme-palette { display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 18px; }
.theme-card { cursor: pointer; text-align: center; transition: transform 0.2s ease; }
.theme-card:hover { transform: translateY(-6px); }
.theme-card-swatch { width: 100%; height: 65px; border-radius: 20px; transition: var(--transition); border: 3px solid transparent; position: relative; background-clip: padding-box; }
.theme-card-swatch.active { border-color: var(--primary); transform: scale(1.05); box-shadow: var(--shadow-lg); }
.theme-card-swatch.active::after { content: '\f00c'; font-family: 'Font Awesome 6 Free'; font-weight: 900; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white; font-size: 1.6rem; text-shadow: 0 0 12px rgba(0,0,0,0.8); }
.theme-card span { font-size: 0.95rem; color: var(--text-primary); font-weight: 500; margin-top: 12px; display: block; }

/* Footer */
.app-footer { text-align: center; margin-top: 40px; padding: 20px 0; color: var(--text-secondary); }
.app-footer p { font-weight: 500; }
.app-footer span { font-weight: 600; background-color: var(--primary-light); color: var(--primary); padding: 5px 12px; border-radius: 12px; }

/* Toast & Animations */
.toast { position: fixed; bottom: 25px; left: 50%; padding: 16px 28px; background: var(--surface); backdrop-filter: blur(10px); color: var(--text-primary); border-radius: 18px; box-shadow: var(--shadow-lg); border: 1px solid var(--border-color); transform: translate(-50%, 200%); opacity: 0; transition: all 0.5s cubic-bezier(0.25, 1, 0.5, 1); z-index: 1002; font-weight: 500; }
.toast.show { transform: translate(-50%, 0); opacity: 1; }

@keyframes sweetFadeIn { from { opacity: 0; transform: translateY(30px) scale(0.98); } to { opacity: 1; transform: translateY(0) scale(1); } }
@keyframes slideFadeIn { from { opacity: 0; transform: translateX(-20px); } to { opacity: 1; transform: translateX(0); } }
@keyframes fadeOutShrink { from { opacity: 1; transform: scale(1); } to { opacity: 0; transform: scale(0.9); height: 0; padding: 0; margin: 0; border: 0;} }

/* --- RESPONSIVE: ENHANCED FOR MOBILE --- */
@media (max-width: 768px) {
  body { padding: 20px; }
  .app { gap: 25px; }
  .app-header h1 { font-size: 2.5rem; letter-spacing: -1px;}
  .app-header p { font-size: 1.1rem; }
  .section { padding: 25px; }
  .section-header { flex-direction: column; align-items: flex-start; gap: 10px; margin-bottom: 20px; }
  .section-header h2 { font-size: 1.5rem; }

  /* Dock Navigation optimized for mobile */
  .main-dock { grid-template-columns: repeat(2, 1fr); gap: 18px; }
  .dock-button { padding: 20px 15px; }
  .dock-button i { font-size: 2rem; width: 55px; height: 55px; margin-bottom: 12px; }
  .dock-button h2 { font-size: 1rem; }
  .dock-button p { font-size: 0.8rem; }
 
  /* Task Section Compact Layout */
  .task-main-input { grid-template-columns: 1fr; }
  .task-options { grid-template-columns: 1fr; }
  button, input, select { font-size: 0.95rem; }
  #taskList li { padding: 15px; gap: 12px; border-radius: 16px; flex-direction: column; align-items: stretch; } /* Make task list items stack */
  .task-content { flex-direction: row; }
  .task-actions { margin-left: 0; justify-content: flex-end; } /* Align buttons to the right */

  .task-icon { width: 38px; height: 38px; font-size: 1.1rem; border-radius: 12px;}
  .task-actions button { width: 36px; height: 36px; font-size: 0.9rem; }
 
  /* Calendar Compact Layout */
  .calendar-grid { gap: 5px; }
  .calendar-day-name { font-size: 0.8em; padding: 8px 0; }
  .calendar-day { height: 42px; font-size: 0.9rem; border-radius: 14px;}
  .calendar-day.has-task::after { width: 5px; height: 5px; bottom: 5px;}

  /* Pomodoro Timer smaller elements */
  .pomodoro-timer-circle { width: 200px; height: 200px; margin: 25px auto; }
  .pomodoro-progress-ring { width: 200px; height: 200px; }
  .pomodoro-progress-ring circle { r: 92; cx: 100; cy: 100; }
  .pomodoro-timer-display { font-size: 3.2rem; }
  .pomodoro-controls button { width: 60px; height: 60px; }
  .pomodoro-controls #pomodoro-start-pause i { font-size: 1.6rem; }
  .pomodoro-modes button { padding: 8px 16px; font-size: 0.9em; }

  /* Floating button adjustment */
  .theme-fab { bottom: 20px; right: 20px; width: 60px; height: 60px; }

  /* Theme Modal compact view */
  .theme-modal-content { padding: 20px; }
  .theme-palette { grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 12px; }
  .theme-card-swatch { height: 55px; }
}


@media (max-width: 480px) {
  body { padding: 15px; }
  .app-header h1 { font-size: 2.2rem; }
  .app-header p { font-size: 1rem; }

  .task-filters { gap: 8px; justify-content: center; }
  .task-filters button { padding: 8px 12px; font-size: 0.9rem; }
  .section-header h2 { font-size: 1.3rem; gap: 10px; }

  .calendar-grid { gap: 3px; }
  .calendar-day { height: 38px; font-size: 0.8rem; border-radius: 10px; border-width: 1px; }

  .pomodoro-timer-circle { width: 180px; height: 180px; }
  .pomodoro-progress-ring { width: 180px; height: 180px; }
  .pomodoro-progress-ring circle { r: 82; cx: 90; cy: 90; }
  .pomodoro-timer-display { font-size: 2.8rem; }
  
  #taskInput, #addTaskBtn, .task-options select { padding-top: 12px; padding-bottom: 12px; }

}


</style>
</head>
<!-- THEME ENHANCEMENT: Set the new "best in the world" default theme to Aurora Twilight -->
<body class="theme-aurora-twilight">

<div class="app">

    <header class="app-header">
        <h1>Chrono Focus</h1>
        <p>Your calm and cozy productivity partner.</p>
    </header>

    <nav class="main-dock">
        <a href="page16.html" class="dock-button">
            <i class="fa-solid fa-list-check"></i>
            <div>
                <h2>Task Manager</h2>
                <p>Organize Your Day</p>
            </div>
        </a>
        <a href="page2.html" class="dock-button study-tools">
            <i class="fa-solid fa-book-open-reader"></i>
            <div>
                <h2>Study Materials</h2>
                <p>Tools & Resources</p>
            </div>
        </a>
        <!-- NEW FEATURE: Added the Optichain AI Tools button as requested -->
        <a href="page22.html" class="dock-button">
            <i class="fa-solid fa-wand-magic-sparkles"></i>
            <div>
                <h2>Optichain AI Tools</h2>
                <p>Boost Your Workflow</p>
            </div>
        </a>
        <a href="page9.html" class="dock-button">
            <i class="fa-solid fa-brain"></i>
            <div>
                <h2>Deep Focus</h2>
                <p>Zen Mode</p>
            </div>
        </a>
    </nav>

    <section class="section task-section">
        <div class="section-header">
            <h2><i class="fa-solid fa-clipboard-list"></i> Task Manager</h2>
            <div class="task-filters" id="taskFilters">
                <button class="active" data-filter="all">All</button>
                <button data-filter="active">Active</button>
                <button data-filter="completed">Completed</button>
            </div>
        </div>
        <div class="task-input-form">
             <div class="task-main-input">
                <input id="taskInput" type="text" placeholder="e.g., Read a chapter of a book..." autocomplete="off" />
                <button id="addTaskBtn"><i class="fa-solid fa-plus"></i> Add Task</button>
             </div>
             <div class="task-options">
                 <select id="taskIcon" title="Task Category">
                     <option value="fa-solid fa-thumbtack">üìå General</option>
                     <option value="fa-solid fa-book-open">üìñ Study</option>
                     <option value="fa-solid fa-briefcase">üíº Work</option>
                     <option value="fa-solid fa-heart-pulse">‚ù§Ô∏è Health</option>
                     <option value="fa-solid fa-cart-shopping">üõí Shopping</option>
                     <option value="fa-solid fa-house-user">üè† Home</option>
                 </select>
                 <select id="taskPriority" title="Task Priority">
                    <option value="normal">Normal Priority</option>
                    <option value="important">‚≠ê Very Important</option>
                </select>
                <select id="taskColor" title="Task Color">
                    <option value="default">Default Color</option>
                    <option value="red" style="color:var(--task-color-red)">üî¥ Red</option>
                    <option value="blue" style="color:var(--task-color-blue)">üîµ Blue</option>
                    <option value="green" style="color:var(--task-color-green)">üü¢ Green</option>
                    <option value="yellow" style="color:var(--task-color-yellow)">üü° Yellow</option>
                    <option value="purple" style="color:var(--task-color-purple)">üü£ Purple</option>
                     <option value="orange" style="color:var(--task-color-orange)">üü† Orange</option>
                </select>
             </div>
        </div>
        <ul id="taskList"></ul>
    </section>

    <!-- LAYOUT ENHANCEMENT: New grid container for the Calendar and Focus Timer -->
    <div class="content-grid">
        <section class="section calendar-section">
            <div class="section-header">
                <h2><i class="fa-solid fa-calendar-days"></i> Calendar</h2>
                <div class="calendar-nav">
                    <button id="prevMonthBtn" aria-label="Previous month"><i class="fa-solid fa-chevron-left"></i></button>
                    <h3 id="monthYear"></h3>
                    <button id="nextMonthBtn" aria-label="Next month"><i class="fa-solid fa-chevron-right"></i></button>
                </div>
            </div>
            <div class="calendar-grid" id="dayNames"></div>
            <div class="calendar-grid" id="calendarGrid"></div>
        </section>

        <section class="section pomodoro-section">
            <div class="section-header" style="justify-content: center;">
                <h2><i class="fa-solid fa-clock"></i> Focus Timer</h2>
            </div>
            <div class="pomodoro-modes" id="pomodoro-modes">
                <button class="active" data-mode="pomodoro">Pomodoro</button>
                <button data-mode="shortBreak">Short Break</button>
                <button data-mode="longBreak">Long Break</button>
            </div>
            
            <div class="pomodoro-timer-circle">
                <svg class="pomodoro-progress-ring" width="240" height="240">
                    <circle class="pomodoro-progress-ring__track" stroke-width="10" fill="transparent" r="110" cx="120" cy="120"/>
                    <circle class="pomodoro-progress-ring__progress" stroke-width="10" fill="transparent" r="110" cx="120" cy="120"/>
                </svg>
                <div id="pomodoro-timer-display" class="pomodoro-timer-display">25:00</div>
            </div>
            
            <div class="pomodoro-controls">
                <button id="pomodoro-start-pause" aria-label="Start or pause the timer"><i class="fa-solid fa-play"></i></button>
                <button id="pomodoro-reset" aria-label="Reset the timer"><i class="fa-solid fa-rotate-right"></i></button>
            </div>
        </section>
    </div>
   
    <footer class="app-footer">
        <p>Your journey to focus begins now.</p>
        <span>Zenith 1.0 Beta 7</span>
    </footer>

</div>

<!-- Theme Customizer FAB and Modal -->
<button id="theme-fab" class="theme-fab" aria-label="Customize Theme">
    <i class="fa-solid fa-palette"></i>
</button>

<div id="themeModal" class="theme-modal" role="dialog" aria-modal="true" aria-labelledby="theme-modal-title">
    <div class="theme-modal-content">
        <div class="theme-modal-header">
            <h2 id="theme-modal-title">Customize Your Experience</h2>
            <button class="close-modal-btn" aria-label="Close theme selector">&times;</button>
        </div>
        <div id="theme-modal-body"></div>
    </div>
</div>

<div id="toast" class="toast"></div>

<script>
class ChronoFocusApp {
    constructor() {
        // --- CACHE DOM ELEMENTS ---
        this.dom = {
            taskInput: document.getElementById('taskInput'),
            addTaskBtn: document.getElementById('addTaskBtn'),
            taskList: document.getElementById('taskList'),
            taskFilters: document.getElementById('taskFilters'),
            taskIcon: document.getElementById('taskIcon'),
            taskPriority: document.getElementById('taskPriority'),
            taskColor: document.getElementById('taskColor'),
            calendarGrid: document.getElementById('calendarGrid'),
            dayNames: document.getElementById('dayNames'),
            monthYear: document.getElementById('monthYear'),
            prevMonthBtn: document.getElementById('prevMonthBtn'),
            nextMonthBtn: document.getElementById('nextMonthBtn'),
            pomodoroDisplay: document.getElementById('pomodoro-timer-display'),
            pomodoroCircle: document.querySelector('.pomodoro-timer-circle'),
            progressRing: document.querySelector('.pomodoro-progress-ring__progress'),
            pomodoroStartPause: document.getElementById('pomodoro-start-pause'),
            pomodoroReset: document.getElementById('pomodoro-reset'),
            pomodoroModes: document.getElementById('pomodoro-modes'),
            themeFab: document.getElementById('theme-fab'),
            themeModal: document.getElementById('themeModal'),
            themeModalBody: document.getElementById('theme-modal-body'),
            toast: document.getElementById('toast'),
        };

        if (this.dom.progressRing) {
            this.radius = this.dom.progressRing.r.baseVal.value;
            this.circumference = this.radius * 2 * Math.PI;
            this.dom.progressRing.style.strokeDasharray = `${this.circumference} ${this.circumference}`;
            this.dom.progressRing.style.strokeDashoffset = this.circumference;
        }

        // --- APPLICATION STATE ---
        this.state = {
            currentFilter: 'all',
            currentDate: new Date(),
            selectedDate: null,
            pomodoro: {
                timerId: null,
                mode: 'pomodoro',
                timeRemaining: 25 * 60,
                isRunning: false,
                modes: { pomodoro: 25 * 60, shortBreak: 5 * 60, longBreak: 15 * 60 }
            }
        };

        this.finishSound = new Audio('https://cdn.jsdelivr.net/gh/k-fari/sounds/notification.mp3');
    }

    // --- INITIALIZATION ---
    init() {
        this.ThemeManager.init(this);
        this.setupEventListeners();
        this.renderDayNames();
        this.renderCalendar();
        this.loadTasks();
        this.updatePomodoroDisplay();
        console.log("Chrono Focus Zenith Initialized!");
    }
   
    // --- THEME MANAGEMENT ---
    ThemeManager = {
        themes: [
             // Special
            { id: 'theme-aurora-twilight', name: 'Twilight', gradient: 'linear-gradient(-45deg, #1e1e2f, #6a538d)', group: 'special' },
            { id: 'theme-liquid-glass', name: 'Sapphire', gradient: 'linear-gradient(135deg, #1a1a2e, #162238)', group: 'special' },
            { id: 'theme-aurora-boreal', name: 'Boreal', gradient: 'linear-gradient(-45deg, #0d1a26, #3c164f)', group: 'special' },
            { id: 'theme-aurora-nebula', name: 'Nebula', gradient: 'linear-gradient(-45deg, #2a0a4a, #da2a9a)', group: 'special' },
            { id: 'theme-onyx', name: 'Onyx', color: '#00CFE8', group: 'special' },
            { id: 'serenity', name: 'Serenity', color: '#A2BFE0', group: 'special' },

            // Cozy
            { id: 'default', name: 'Mocha', color: '#8D6E63', group: 'cozy' },
            { id: 'theme-autumn', name: 'Autumn', color: '#D57A66', group: 'cozy' },
            { id: 'theme-sage', name: 'Sage', color: '#799975', group: 'cozy' }, { id: 'theme-rose', name: 'Rose', color: '#D4A6B2', group: 'cozy' }, { id: 'theme-mist', name: 'Mist', color: '#94AEC3', group: 'cozy' }, { id: 'theme-sand', name: 'Sand', color: '#D6BA9A', group: 'cozy' }, { id: 'theme-lavender', name: 'Lavender', color: '#9E8FB2', group: 'cozy' }, { id: 'theme-ocean', name: 'Ocean', color: '#7AB3D0', group: 'cozy' }, { id: 'theme-citrus', name: 'Citrus', color: '#E3C567', group: 'cozy' }, { id: 'theme-berry', name: 'Berry', color: '#D6729B', group: 'cozy' }, { id: 'theme-honey', name: 'Honey', color: '#FFB74D', group: 'cozy' }, { id: 'theme-spearmint', name: 'Spearmint', color: '#4DB6AC', group: 'cozy' }, { id: 'theme-peach', name: 'Peach', color: '#FF8A65', group: 'cozy' }, { id: 'theme-sky', name: 'Sky', color: '#64B5F6', group: 'cozy' },

            // Vibrant
            { id: 'theme-vibrant-cherry', name: 'Cherry', color: '#EC407A', group: 'vibrant' }, { id: 'theme-vibrant-lime', name: 'Lime', color: '#9CCC65', group: 'vibrant' }, { id: 'theme-vibrant-tangerine', name: 'Tangerine', color: '#FFA726', group: 'vibrant' }, { id: 'theme-vibrant-grape', name: 'Grape', color: '#AB47BC', group: 'vibrant' }, { id: 'theme-vibrant-aqua', name: 'Aqua', color: '#26C6DA', group: 'vibrant' },
            { id: 'theme-aurora-sunrise', name: 'Sunrise', gradient: 'linear-gradient(-45deg, #FFDAB9, #FFA07A)', group: 'vibrant' },

            // Dark
            { id: 'theme-mono-graphite', name: 'Graphite', color: '#E0E0E0', group: 'dark' }, { id: 'theme-elements-earth', name: 'Earth', color: '#A1683A', group: 'dark' }, { id: 'theme-mono-ink', name: 'Ink', color: '#e0fbfc', group: 'dark' }, { id: 'theme-elements-fire', name: 'Fire', color: '#E55B3C', group: 'dark' }, { id: 'theme-elements-water', name: 'Water', color: '#5292C1', group: 'dark' },
          
            // Retro
            { id: 'theme-retro-diner', name: 'Diner', color: '#EF6060', group: 'retro' }, { id: 'theme-retro-arcade', name: 'Arcade', color: '#ff00ff', group: 'retro' }, { id: 'theme-retro-vinyl', name: 'Vinyl', color: '#C70039', group: 'retro' },
        ],
        init(app) {
            this.app = app;
            this.createModalContent();
            // Get saved theme, or use the new default 'theme-aurora-twilight'
            const savedTheme = localStorage.getItem('chronoFocusTheme') || 'theme-aurora-twilight';
            this.set(savedTheme);
        },
        set(themeId) {
            document.body.className = themeId === 'default' ? '' : themeId;
            localStorage.setItem('chronoFocusTheme', themeId);
            document.querySelectorAll('.theme-card-swatch').forEach(sw => sw.classList.remove('active'));
            const activeSwatch = document.querySelector(`.theme-card-swatch[data-theme="${themeId}"]`);
            if (activeSwatch) activeSwatch.classList.add('active');
        },
        createModalContent() {
            const themeGroups = this.themes.reduce((acc, theme) => {
                (acc[theme.group] = acc[theme.group] || []).push(theme);
                return acc;
            }, {});

            const groupOrder = ['special', 'cozy', 'vibrant', 'dark', 'retro'];
            let fullHTML = '';

            for (const groupName of groupOrder) {
                if (!themeGroups[groupName]) continue;
                const title = groupName.charAt(0).toUpperCase() + groupName.slice(1);
                const themesHTML = themeGroups[groupName].map(theme => `
                    <div class="theme-card" data-theme="${theme.id}">
                        <div class="theme-card-swatch" data-theme="${theme.id}" style="background: ${theme.gradient || theme.color};"></div>
                        <span>${theme.name}</span>
                    </div>`).join('');
                fullHTML += `<div class="theme-group"><h3>${title}</h3><div class="theme-palette">${themesHTML}</div></div>`;
            }
            this.app.dom.themeModalBody.innerHTML = fullHTML;
        }
    };

    // --- TASK MANAGEMENT ---
    getTasks = () => JSON.parse(localStorage.getItem('chronoFocusTasks')) || [];
    saveTasks = (tasks) => localStorage.setItem('chronoFocusTasks', JSON.stringify(tasks));
   
    loadTasks() {
        this.dom.taskList.innerHTML = '';
        const tasks = this.getTasks();
        const tasksForView = this.state.selectedDate
            ? tasks.filter(task => task.date === this.state.selectedDate)
            : tasks.filter(task => !task.date);

        // Sort by completion status, then by priority
        tasksForView.sort((a, b) => {
            if (a.completed !== b.completed) return a.completed - b.completed;
            if (a.priority === 'important' && b.priority !== 'important') return -1;
            if (a.priority !== 'important' && b.priority === 'important') return 1;
            return 0;
        });
       
        const filteredTasks = tasksForView.filter(task => {
            if (this.state.currentFilter === 'active') return !task.completed;
            if (this.state.currentFilter === 'completed') return task.completed;
            return true;
        });
       
        if (filteredTasks.length === 0) {
            const message = this.state.selectedDate ? 'No tasks for this date. Time to plan!' : 'Your mind is clear. Add a task to begin!';
            this.dom.taskList.innerHTML = `<li style="opacity: 1; animation: none; justify-content: center; color: var(--text-secondary); background: transparent; border: 1px dashed var(--border-color); box-shadow: none;">${message}</li>`;
        } else {
            const fragment = document.createDocumentFragment();
            filteredTasks.forEach(task => fragment.appendChild(this.createTaskElement(task)));
            this.dom.taskList.appendChild(fragment);
        }
        this.updateCalendarMarkers();
    }
   
    createTaskElement(task) {
        const li = document.createElement('li');
        li.dataset.id = task.id;
        if (task.completed) li.classList.add('completed');
        if (task.priority === 'important') li.classList.add('priority-important');
        if (task.color && task.color !== 'default') li.style.borderLeftColor = `var(--task-color-${task.color})`;

        const priorityStar = task.priority === 'important' ? `<i class="fa-solid fa-star important-star"></i>` : '';

        li.innerHTML = `
            <div class="task-content">
                <i class="${task.icon} task-icon"></i>
                <span class="task-text">${priorityStar}${task.text}</span>
            </div>
            <div class="task-actions">
                <button class="complete-btn" data-action="toggle" title="Complete"><i class="fa-solid fa-check"></i></button>
                <button class="edit-btn" data-action="edit" title="Edit"><i class="fa-solid fa-pencil"></i></button>
                <button class="delete-btn" data-action="delete" title="Delete"><i class="fa-solid fa-trash"></i></button>
            </div>`;
        return li;
    }

    addTask() {
        const text = this.dom.taskInput.value.trim();
        if (text === '') {
            this.showToast('Please enter a task description!');
            return;
        }
        let tasks = this.getTasks();
        tasks.push({
            id: 'task-' + Date.now(),
            text,
            icon: this.dom.taskIcon.value,
            priority: this.dom.taskPriority.value,
            color: this.dom.taskColor.value,
            completed: false,
            date: this.state.selectedDate
        });
        this.saveTasks(tasks);
        this.loadTasks();
        this.dom.taskInput.value = '';
        this.dom.taskInput.focus();
        this.showToast(`Task added${this.state.selectedDate ? ' for ' + new Date(this.state.selectedDate + 'T00:00:00').toLocaleDateString() : ''}!`);
    }

    deleteTask(taskId, taskElement) {
        if (confirm('Are you sure you want to delete this task?')) {
            taskElement.classList.add('deleting');
            setTimeout(() => {
                this.saveTasks(this.getTasks().filter(t => t.id !== taskId));
                this.loadTasks();
                this.showToast('Task deleted.');
            }, 500);
        }
    }
   
    toggleCompleteTask(taskId) {
        let tasks = this.getTasks();
        const task = tasks.find(t => t.id === taskId);
        if (task) {
            task.completed = !task.completed;
            this.saveTasks(tasks);
            this.loadTasks();
            if (task.completed) this.showToast('Task completed! Great job! üéâ');
        }
    }

    editTask(taskId) {
        let tasks = this.getTasks();
        const task = tasks.find(t => t.id === taskId);
        if (task && !task.completed) {
            const newText = prompt('Enter the new task text:', task.text);
            if (newText && newText.trim() && newText.trim() !== task.text) {
                task.text = newText.trim();
                this.saveTasks(tasks);
                this.loadTasks();
                this.showToast('Task updated!');
            }
        }
    }
   
    // --- CALENDAR ---
    renderDayNames() {
        this.dom.dayNames.innerHTML = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat']
            .map(day => `<div class="calendar-day-name">${day}</div>`).join('');
    }

    renderCalendar() {
        this.dom.calendarGrid.innerHTML = '';
        const { year, month } = { year: this.state.currentDate.getFullYear(), month: this.state.currentDate.getMonth() };
        this.dom.monthYear.textContent = `${this.state.currentDate.toLocaleString('default', { month: 'long' })} ${year}`;

        const firstDay = new Date(year, month, 1).getDay();
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        const today = new Date();
        const fragment = document.createDocumentFragment();

        for (let i = 0; i < firstDay; i++) {
            const emptyCell = document.createElement('div');
            emptyCell.classList.add('other-month');
            fragment.appendChild(emptyCell);
        }
       
        for (let i = 1; i <= daysInMonth; i++) {
            const dayCell = document.createElement('div');
            dayCell.className = 'calendar-day';
            dayCell.textContent = i;
            const dateString = `${year}-${String(month + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;
            dayCell.dataset.date = dateString;
           
            if (i === today.getDate() && month === today.getMonth() && year === today.getFullYear()) dayCell.classList.add('today');
            if (dateString === this.state.selectedDate) dayCell.classList.add('selected');
            fragment.appendChild(dayCell);
        }
        this.dom.calendarGrid.appendChild(fragment);
        this.updateCalendarMarkers();
    }
   
    updateCalendarMarkers() {
        const taskDates = new Set(this.getTasks().filter(t => t.date).map(t => t.date));
        document.querySelectorAll('.calendar-day[data-date]').forEach(day => {
            day.classList.toggle('has-task', taskDates.has(day.dataset.date));
        });
    }

    // --- POMODORO TIMER ---
    updatePomodoroDisplay() {
        const minutes = Math.floor(this.state.pomodoro.timeRemaining / 60).toString().padStart(2, '0');
        const seconds = (this.state.pomodoro.timeRemaining % 60).toString().padStart(2, '0');
        const timeString = `${minutes}:${seconds}`;
        this.dom.pomodoroDisplay.textContent = timeString;
        document.title = `${timeString} - Chrono Focus`;
        
        if (!this.circumference) return;
        const totalDuration = this.state.pomodoro.modes[this.state.pomodoro.mode];
        const progress = (totalDuration - this.state.pomodoro.timeRemaining) / totalDuration;
        const offset = this.circumference * (1 - progress);
        this.dom.progressRing.style.strokeDashoffset = offset;
    }

    startPausePomodoro() {
        this.state.pomodoro.isRunning = !this.state.pomodoro.isRunning;
        const icon = this.dom.pomodoroStartPause.querySelector('i');
        icon.className = `fa-solid ${this.state.pomodoro.isRunning ? 'fa-pause' : 'fa-play'}`;
        if (this.state.pomodoro.isRunning) {
            this.dom.pomodoroCircle.classList.add('running');
            this.state.pomodoro.timerId = setInterval(() => this.tickPomodoro(), 1000);
        } else {
            this.dom.pomodoroCircle.classList.remove('running');
            clearInterval(this.state.pomodoro.timerId);
        }
    }
   
    tickPomodoro() {
        if (this.state.pomodoro.timeRemaining > 0) {
            this.state.pomodoro.timeRemaining--;
            this.updatePomodoroDisplay();
        } else {
            clearInterval(this.state.pomodoro.timerId);
            this.state.pomodoro.isRunning = false;
            this.dom.pomodoroCircle.classList.remove('running');
            this.dom.pomodoroStartPause.querySelector('i').className = 'fa-solid fa-play';
            this.finishSound.play();
            const modeName = this.state.pomodoro.mode.replace(/([A-Z])/g, ' $1').toLowerCase();
            this.showToast(`${modeName.charAt(0).toUpperCase() + modeName.slice(1)} session finished!`);
            const nextMode = this.state.pomodoro.mode === 'pomodoro' ? 'shortBreak' : 'pomodoro';
            setTimeout(() => this.switchPomodoroMode(nextMode), 500);
        }
    }

    resetPomodoro = () => {
        clearInterval(this.state.pomodoro.timerId);
        this.state.pomodoro.isRunning = false;
        this.dom.pomodoroCircle.classList.remove('running');
        this.state.pomodoro.timeRemaining = this.state.pomodoro.modes[this.state.pomodoro.mode];
        this.dom.pomodoroStartPause.querySelector('i').className = 'fa-solid fa-play';
        this.updatePomodoroDisplay();
    };

    switchPomodoroMode(newMode) {
        this.state.pomodoro.mode = newMode;
        this.dom.pomodoroModes.querySelectorAll('button').forEach(btn => {
            btn.classList.toggle('active', btn.dataset.mode === newMode);
        });
        this.resetPomodoro();
    }
   
    // --- UI & HELPERS ---
    showToast(message, duration = 3000) {
        this.dom.toast.textContent = message;
        this.dom.toast.classList.add('show');
        setTimeout(() => this.dom.toast.classList.remove('show'), duration);
    }
   
    // --- EVENT LISTENERS ---
    setupEventListeners() {
        this.dom.addTaskBtn.addEventListener('click', () => this.addTask());
        this.dom.taskInput.addEventListener('keypress', e => { if (e.key === 'Enter') this.addTask(); });

        this.dom.taskFilters.addEventListener('click', e => {
            if (e.target.tagName === 'BUTTON') {
                this.dom.taskFilters.querySelector('.active').classList.remove('active');
                e.target.classList.add('active');
                this.state.currentFilter = e.target.dataset.filter;
                this.loadTasks();
            }
        });

        this.dom.taskList.addEventListener('click', e => {
            const targetButton = e.target.closest('button');
            if (!targetButton) return;
           
            const taskElement = e.target.closest('li');
            const taskId = taskElement.dataset.id;
            const action = targetButton.dataset.action;
           
            if (action === 'toggle') this.toggleCompleteTask(taskId);
            if (action === 'edit') this.editTask(taskId);
            if (action === 'delete') this.deleteTask(taskId, taskElement);
        });
       
        this.dom.prevMonthBtn.addEventListener('click', () => { this.state.currentDate.setMonth(this.state.currentDate.getMonth() - 1); this.renderCalendar(); });
        this.dom.nextMonthBtn.addEventListener('click', () => { this.state.currentDate.setMonth(this.state.currentDate.getMonth() + 1); this.renderCalendar(); });
        this.dom.calendarGrid.addEventListener('click', e => {
            const dayCell = e.target.closest('.calendar-day:not(.other-month)');
            if (dayCell) {
                const date = dayCell.dataset.date;
                this.state.selectedDate = this.state.selectedDate === date ? null : date;
                this.renderCalendar();
                this.loadTasks();
            }
        });
           
        this.dom.pomodoroStartPause.addEventListener('click', () => this.startPausePomodoro());
        this.dom.pomodoroReset.addEventListener('click', () => this.resetPomodoro());
        this.dom.pomodoroModes.addEventListener('click', (e) => {
            if (e.target.tagName === 'BUTTON' && e.target.dataset.mode) this.switchPomodoroMode(e.target.dataset.mode);
        });

        this.dom.themeFab.addEventListener('click', () => this.dom.themeModal.classList.add('visible'));
        this.dom.themeModal.querySelector('.close-modal-btn').addEventListener('click', () => this.dom.themeModal.classList.remove('visible'));
        this.dom.themeModal.addEventListener('click', e => { if (e.target === this.dom.themeModal) this.dom.themeModal.classList.remove('visible'); });
        document.addEventListener('keydown', e => { if (e.key === 'Escape') this.dom.themeModal.classList.remove('visible'); });
        this.dom.themeModalBody.addEventListener('click', e => {
            const card = e.target.closest('.theme-card'); if (card) this.ThemeManager.set(card.dataset.theme);
        });
    }
}

document.addEventListener('DOMContentLoaded', () => {
    const app = new ChronoFocusApp();
    window.App = app; // For easy debugging
    app.init();
});

</script>

</body>
</html>
