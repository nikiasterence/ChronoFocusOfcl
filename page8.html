<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Whiteboard ‚Äî Apple Notes style</title>
  <style>
    :root{ --toolbar-height:64px; --bg:#f7f7f8 }
    html,body{height:100%;margin:0;background:var(--bg);font-family:Inter, system-ui, sans-serif}
    .app{display:flex;flex-direction:column;height:100%}

    /* top toolbar */
    .toolbar{height:var(--toolbar-height);display:flex;align-items:center;padding:10px 14px;gap:10px;box-shadow:0 1px 0 rgba(0,0,0,0.06);background:linear-gradient(#ffffff,#fbfbfd)}
    .group{display:flex;align-items:center;gap:8px}
    .color-swatch{width:34px;height:34px;border-radius:8px;border:1px solid rgba(0,0,0,0.07);cursor:pointer;box-shadow:0 1px 0 rgba(255,255,255,0.6) inset}
    .color-swatch.selected{outline:3px solid rgba(0,0,0,0.08);transform:scale(0.98)}
    .tool-btn{height:34px;padding:0 10px;border-radius:8px;border:1px solid rgba(0,0,0,0.08);background:white;cursor:pointer;display:flex;align-items:center;gap:8px}
    .tool-btn.active{box-shadow:0 4px 12px rgba(0,0,0,0.06)}

    /* brush selector */
    .brushes{display:flex;gap:8px}
    .brush{width:40px;height:34px;border-radius:8px;border:1px solid rgba(0,0,0,0.06);display:flex;align-items:center;justify-content:center;cursor:pointer}
    .brush.active{background:linear-gradient(#f0f8ff,#fff);box-shadow:0 4px 10px rgba(0,0,0,0.06)}

    /* canvas area */
    .stage{flex:1;display:flex;align-items:center;justify-content:center;padding:18px}
    .board-wrap{width:100%;height:100%;max-width:1200px;max-height:900px;background:white;border-radius:14px;box-shadow:0 10px 30px rgba(16,24,40,0.08);position:relative;overflow:hidden}
    canvas{width:100%;height:100%;display:block;touch-action:none}

    /* bottom controls */
    .controls{position:absolute;right:12px;bottom:12px;display:flex;gap:8px}
    .small{height:36px;padding:6px 10px}
    input[type=range]{width:140px}

    /* simple responsive */
    @media (max-width:640px){
      .toolbar{padding:8px}
      .color-swatch{width:28px;height:28px}
      .brush{width:36px}
      input[type=range]{width:100px}
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="toolbar">
      <div class="group">
        <button id="undo" class="tool-btn">Undo</button>
        <button id="clear" class="tool-btn">Clear</button>
        <button id="save" class="tool-btn">Save</button>
      </div>

      <div class="group">
        <!-- 10 color swatches -->
        <div id="colors" style="display:flex;gap:8px">
          <!-- colors added by JS -->
        </div>
      </div>

      <div style="flex:1"></div>

      <div class="group">
        <label style="font-size:13px;color:#444;margin-right:8px">Brush</label>
        <div id="brushes" class="brushes">
          <div class="brush" data-brush="pencil" title="Pencil">‚úèÔ∏è</div>
          <div class="brush" data-brush="marker" title="Marker">üñäÔ∏è</div>
          <div class="brush" data-brush="highlighter" title="Highlighter">üü®</div>
          <div class="brush" data-brush="calligraphy" title="Calligraphy">üñãÔ∏è</div>
          <div class="brush" data-brush="neon" title="Neon">‚ú®</div>
          <div class="brush" data-brush="eraser" title="Eraser">üßΩ</div>
        </div>
      </div>

      <div style="width:12px"></div>
      <div class="group">
        <label style="font-size:13px">Size</label>
        <input id="size" type="range" min="1" max="80" value="6">
      </div>
    </div>

    <div class="stage">
      <div class="board-wrap">
        <canvas id="board"></canvas>

        <div class="controls">
          <button id="download" class="tool-btn small">Download PNG</button>
          <button id="exportJpg" class="tool-btn small">Download JPG</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Colors (10)
    const COLORS = ['#000000','#5856D6','#007AFF','#34C759','#FF9500','#FF2D55','#AF52DE','#FFCC00','#8E8E93','#FFFFFF'];

    const canvas = document.getElementById('board');
    const ctx = canvas.getContext('2d', { alpha: true });
    let drawing = false;
    let last = { x: 0, y: 0 };
    const undoStack = [];
    const MAX_UNDO = 30;

    function resizeCanvas(){
      // preserve content
      const data = canvas.toDataURL();
      const img = new Image();
      img.onload = () => {
        const ratio = window.devicePixelRatio || 1;
        canvas.width = Math.floor(canvas.clientWidth * ratio);
        canvas.height = Math.floor(canvas.clientHeight * ratio);
        ctx.setTransform(ratio,0,0,ratio,0,0);
        ctx.clearRect(0,0,canvas.width,canvas.height);
        ctx.drawImage(img,0,0,canvas.clientWidth,canvas.clientHeight);
      };
      img.src = data;
    }

    // Live-size the canvas to parent
    function fitCanvasToContainer(){
      const wrap = canvas.parentElement;
      canvas.style.width = '100%';
      canvas.style.height = '100%';
      // actual pixel size set on resize
      resizeCanvas();
    }

    // init colors UI
    const colorsEl = document.getElementById('colors');
    let currentColor = COLORS[0];
    COLORS.forEach((c,i)=>{
      const sw = document.createElement('div');
      sw.className = 'color-swatch' + (i===0? ' selected':'');
      sw.style.background = c;
      sw.dataset.color = c;
      sw.addEventListener('click', ()=>{
        document.querySelectorAll('.color-swatch').forEach(s=>s.classList.remove('selected'));
        sw.classList.add('selected');
        currentColor = c;
        setBrush(currentBrush);
      });
      colorsEl.appendChild(sw);
    });

    // brush handling
    const brushes = document.getElementById('brushes');
    let currentBrush = 'pencil';
    function setBrush(brush){
      currentBrush = brush;
      document.querySelectorAll('.brush').forEach(b=>b.classList.toggle('active', b.dataset.brush===brush));

      // base settings
      ctx.lineCap = 'round';
      ctx.lineJoin = 'round';
      ctx.globalCompositeOperation = 'source-over';
      ctx.globalAlpha = 1;
      ctx.shadowBlur = 0;
      ctx.shadowColor = currentColor;

      const sizeInput = document.getElementById('size');
      const size = parseInt(sizeInput.value,10) || 4;

      switch(brush){
        case 'pencil':
          ctx.strokeStyle = currentColor;
          ctx.lineWidth = Math.max(1, size*0.8);
          break;
        case 'marker':
          ctx.strokeStyle = currentColor;
          ctx.lineWidth = Math.max(6, size*1.6);
          ctx.globalAlpha = 0.9;
          break;
        case 'highlighter':
          ctx.strokeStyle = currentColor;
          ctx.lineWidth = Math.max(12, size*2.2);
          ctx.globalAlpha = 0.25;
          break;
        case 'calligraphy':
          ctx.strokeStyle = currentColor;
          ctx.lineWidth = Math.max(2, size*1.5);
          ctx.lineCap = 'butt';
          ctx.lineJoin = 'miter';
          break;
        case 'neon':
          ctx.strokeStyle = currentColor;
          ctx.lineWidth = Math.max(4, size*1.8);
          ctx.shadowBlur = 18;
          ctx.shadowColor = currentColor;
          break;
        case 'eraser':
          ctx.globalCompositeOperation = 'destination-out';
          ctx.lineWidth = Math.max(10, size*2.5);
          break;
      }
    }

    // create brush elements listener
    document.querySelectorAll('.brush').forEach(b=>{
      b.addEventListener('click', ()=> setBrush(b.dataset.brush));
    });

    // size control
    document.getElementById('size').addEventListener('input', ()=> setBrush(currentBrush));

    // pointer support
    function getPointerPos(evt){
      const rect = canvas.getBoundingClientRect();
      const x = (evt.clientX - rect.left);
      const y = (evt.clientY - rect.top);
      return { x, y };
    }

    function pushUndo(){
      try{
        if(undoStack.length >= MAX_UNDO) undoStack.shift();
        undoStack.push(canvas.toDataURL());
      }catch(e){ console.warn('undo push failed',e) }
    }

    function undo(){
      if(!undoStack.length) return;
      const last = undoStack.pop();
      const img = new Image();
      img.onload = ()=>{
        ctx.clearRect(0,0,canvas.width,canvas.height);
        ctx.drawImage(img,0,0,canvas.clientWidth,canvas.clientHeight);
      };
      img.src = last;
    }

    function pointerDown(e){
      e.preventDefault();
      pushUndo();
      drawing = true;
      const p = getPointerPos(e);
      last.x = p.x; last.y = p.y;
      ctx.beginPath();
      ctx.moveTo(last.x, last.y);
    }

    function pointerMove(e){
      if(!drawing) return;
      const p = getPointerPos(e);
      ctx.lineTo(p.x, p.y);
      ctx.stroke();
      last.x = p.x; last.y = p.y;
    }

    function pointerUp(e){
      if(!drawing) return;
      drawing = false;
      ctx.closePath();
    }

    // events
    canvas.addEventListener('pointerdown', pointerDown);
    window.addEventListener('pointermove', pointerMove);
    window.addEventListener('pointerup', pointerUp);

    // keyboard shortcuts
    window.addEventListener('keydown', (e)=>{
      if(e.ctrlKey || e.metaKey){
        if(e.key === 'z') { e.preventDefault(); undo(); }
      }
      if(e.key === 'Delete'){ document.getElementById('clear').click(); }
    });

    // toolbar actions
    document.getElementById('clear').addEventListener('click', ()=>{
      pushUndo();
      ctx.clearRect(0,0,canvas.width,canvas.height);
    });
    document.getElementById('undo').addEventListener('click', undo);

    function downloadDataURL(dataURL, filename){
      const a = document.createElement('a');
      a.href = dataURL;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      a.remove();
    }

    document.getElementById('save').addEventListener('click', ()=>{
      const data = canvas.toDataURL('image/png');
      downloadDataURL(data, 'whiteboard.png');
    });

    document.getElementById('download').addEventListener('click', ()=>{
      const data = canvas.toDataURL('image/png');
      downloadDataURL(data, 'whiteboard.png');
    });

    document.getElementById('exportJpg').addEventListener('click', ()=>{
      // create white background JPG
      const tmp = document.createElement('canvas');
      tmp.width = canvas.width; tmp.height = canvas.height;
      const tctx = tmp.getContext('2d');
      tctx.fillStyle = '#ffffff';
      tctx.fillRect(0,0,tmp.width,tmp.height);
      tctx.drawImage(canvas,0,0,tmp.width,tmp.height);
      const data = tmp.toDataURL('image/jpeg', 0.92);
      downloadDataURL(data, 'whiteboard.jpg');
    });

    // init
    function init(){
      // set container pixel size
      const ratio = window.devicePixelRatio || 1;
      const wrap = canvas.parentElement;
      // set initial CSS size based on parent
      canvas.style.width = '100%';
      canvas.style.height = '100%';
      canvas.width = Math.floor(canvas.clientWidth * ratio);
      canvas.height = Math.floor(canvas.clientHeight * ratio);
      ctx.setTransform(ratio,0,0,ratio,0,0);
      // white background
      ctx.fillStyle = 'white';
      ctx.fillRect(0,0,canvas.clientWidth,canvas.clientHeight);

      setBrush('pencil');
    }

    window.addEventListener('resize', ()=>{
      // smooth resize with a short debounce
      clearTimeout(window._resizeTimer);
      window._resizeTimer = setTimeout(()=>{
        // save current contents to image then redraw (resizeCanvas will use toDataURL)
        resizeCanvas();
      },120);
    });

    // initial
    init();

    // set first swatch as selected
    document.querySelectorAll('.color-swatch')[0].classList.add('selected');

    // make sure brush matches color change
    setBrush(currentBrush);

    // Prevent scrolling on touch
    document.body.addEventListener('touchstart', e=>{ if(e.target === canvas) e.preventDefault(); }, {passive:false});
    document.body.addEventListener('touchmove', e=>{ if(e.target === canvas) e.preventDefault(); }, {passive:false});

  </script>
</body>
</html>
